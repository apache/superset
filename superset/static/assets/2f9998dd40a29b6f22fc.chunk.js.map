{"version":3,"file":"2f9998dd40a29b6f22fc.chunk.js","mappings":"uKAIe,MAAMA,UAAuB,IACtCC,kBACF,OAAO,CACT,CAEIC,eACF,OAAOC,MAAMD,UAAYE,KAAKC,eAAeC,OAAMC,GAASA,EAAML,UACpE,CAEAG,eACE,OAAOD,KAAKI,eAAiBJ,KAAKI,cAAcC,WAAa,EAC/D,CAEAC,kBAAmB,CAEnBC,SAASC,GACPT,MAAMQ,SAASC,GACfR,KAAKS,gBACP,CAEAC,gBAAe,KACbC,IAEA,MAAM,OACJC,GACED,EAGJ,OAFsBC,GAAUA,EAAOC,UAAYD,EAAOC,SAASC,QAAUF,EAAOC,SAASC,OAAOC,KAAOf,KAAKe,IAMhHJ,EAAKC,OAASA,EAAOC,SAASD,OAC9BD,EAAKK,MAAQJ,EAAOC,SAASG,MACtBL,GALEA,CAMX,CAEAM,eACE,OAAO,IACT,CAEAC,eAAeC,GACb,OAAO,CACT,CAEAC,qBAAqBL,EAAIM,GACvB,MACEC,eAAgBC,GACdvB,KAAKwB,MACT,OAAOH,GAAQA,EAAKI,QAAUF,GAAmBA,EAAgBR,EACnE,CAEAW,iBAAiBX,EAAIY,GACnB,MACEL,eAAgBC,GACdvB,KAAKwB,MACT,OAAOD,GAAmBA,EAAgBR,IAAOQ,EAAgBR,GAAIa,MAAQD,CAC/E,CAEAE,eAAeC,EAAKC,EAAcC,GAMhC,OALAF,EAAIjB,SAAW,CACbC,OAAQd,KACRY,OAAQmB,EACRf,MAAOgB,GAEFF,CACT,CAEAG,oBAAoBC,GAClB,GAAwB,mBAAbA,EAAyB,CAClC,MAAMC,EAAa,CACjBd,KAAMrB,KAAKwB,MAAMH,KACjBe,OAAQ,IAEV,MAAO,CAACC,EAAGC,IACLD,GAAKA,EAAExB,UACTsB,EAAWnB,MAAQqB,EAAExB,SAASG,MACvBkB,EAASG,EAAExB,SAASD,OAAQuB,IAG9BD,EAASG,EAAGC,EAEvB,CAEA,OAAOJ,CACT,CAEAK,iBAAiBC,EAAgB,CAAC,GAChC,MAAM,QACJC,EAAO,SACPC,EAAQ,QACRC,EAAO,WACPC,EAAU,iBACVC,EAAgB,uBAChBC,EAAsB,cACtBC,EAAa,eACbC,EAAc,iBACdC,EAAgB,iBAChBC,EAAgB,cAChBC,EAAa,eACbC,EAAc,YACdC,EAAW,WACXC,EAAU,MACVC,EACAjC,eAAgBC,GACdvB,KAAKwB,MACHgC,EAAW,CACff,UACAC,WACAC,UACAC,aACAC,mBACAC,yBACAC,gBACAC,iBACAC,mBACAC,mBACAC,gBACAC,iBACAC,cACAC,aACAC,SAEIE,EAA0BlC,GAAmBA,EAAgBiB,EAAczB,IAC3E2C,EAA6BD,GAA2BA,EAAwBE,eAChFC,EAAapB,EAAczB,IAAM,WAEvC,GAAI0C,EAAyB,CAC3B,MAAMI,EAAY7D,KAAK8D,YAAYC,WAC7BC,EAAoBxB,EAAcZ,KAAOY,EAAcZ,KAAKmC,WAAa,CAAC,EAEhF,IAAK,MAAME,KAAOR,EAAyB,CACzC,MAAMS,EAAWF,EAAkBC,IAAQJ,EAAUI,GAEjDC,GAA8B,aAAlBA,EAAStC,OACvB6B,EAAwBQ,GAAOjE,KAAKiC,oBAAoBwB,EAAwBQ,IAEpF,CACF,CAEAE,OAAOC,OAAOZ,EAAUhB,EAAeiB,GACvCD,EAASzC,GAAK,GAAGsD,OAAOrE,KAAKwB,MAAMT,GAAI,KAAKsD,OAAOT,GACnDJ,EAASG,eAAiB,CACxBW,IAAKtE,KAAKwB,MAAMmC,eAAeW,OAC5B9B,EAAcmB,kBACdD,GAGL,IAAK,MAAMa,KAAajB,EAAY,CAClC,MAAMkB,EAAmBD,EAAUhC,iBAAiBkC,KAAKzE,KAAMuE,GAE3DC,GACFL,OAAOC,OAAOZ,EAAUgB,EAAkB,CACxCb,eAAgBQ,OAAOC,OAAOZ,EAASG,eAAgBa,EAAiBb,iBAG9E,CAEA,OAAOH,CACT,CAEAkB,qBAAqB/D,GACnB,IAAK,MAAMR,KAASH,KAAKC,eACvBE,EAAMwE,oBAAoBhE,EAE9B,CAEAiE,uBACE,OAAO,IACT,CAEAC,gBACE,IAAI,UACFxE,GACEL,KAAKI,cACT,MAAM0E,GAAgBzE,GAAaL,KAAK+E,cAEpCD,IACFzE,EAAYL,KAAKiB,eACjBZ,GAAY,OAAQA,EAAW2E,SAC/BhF,KAAKI,cAAcC,UAAYA,IAGjC,OAxLwB,8BAwLGL,KAAM8E,EAAczE,GAE/C,IAAK,MAAMF,KAASE,EAClBF,EAAMW,OAASd,IAEnB,EAGFJ,EAAeqF,UAAY,gB,8JCjK3B,MAAMC,EAAYC,EAAAA,GAAAA,GAAyC;IACtD,IAAD,IAAC,MAAEC,EAAF,IAASC,EAAT,KAAcC,GAAf,QAA0B,uCAEnBD,mBACCC,sBACoB,EAAjBF,EAAMG,4BACU,EAAjBH,EAAMG,gCACFH,EAAMI,OAAOC,UAAUC,sBAC5BN,EAAMI,OAAOC,UAAUE,gDAEpBP,EAAMQ,WAAWC,MAAMC,oDATnC;EAeU,SAAUC,EAAQvE,GAC9B,MAAM,QAAEwE,GAAYxE,EACpB,GAAI,MAAOwE,EACT,OAAO,KAGT,MAAM,EAAE3D,EAAF,EAAK4D,EAAL,QAAQC,GAAYF,EAE1B,GAAuB,iBAAZE,EAAsB,CAE/B,MAAMC,GAAcC,EAAAA,EAAAA,UAClB,KAAM,CACJC,QAAQC,EAAAA,EAAAA,WAAUJ,EAAS,CAAEK,gBAAgB,OAE/C,CAACL,IAEH,OACE,QAAChB,EAAD,CAAWG,IAAKY,EAAGX,KAAMjD,IACvB,eAEEmE,wBAAyBL,IAIhC,CAED,OACE,QAACjB,EAAD,CAAWG,IAAKY,EAAGX,KAAMjD,GACtB6D,EAGN,CClDD,MAEMrC,EAAY,CAChB4C,SAAUC,IAAAA,OAAAA,WACVC,OAAQD,IAAAA,MAAAA,WACRE,gBAAiBF,IAAAA,KACjBG,SAAUH,IAAAA,OACVI,qBAAsBJ,IAAAA,OAAAA,WACtBK,SAAUL,IAAAA,KACVM,aAAcN,IAAAA,OACdO,MAAOP,IAAAA,OAAAA,WACPQ,OAAQR,IAAAA,OAAAA,WACRS,iBAAkBT,IAAAA,MASb,MAAMU,UAAwBC,EAAAA,UACnCvD,YAAYtC,GACVzB,MAAMyB,GADW,KA+CnB8F,WAAatB,IACXhG,KAAKO,SAAS,CAAEyF,WAAhB,EA9CAhG,KAAKuH,KAAOvH,KAAKuH,KAAKC,KAAKxH,MAC3BA,KAAKyH,kBAAoBzH,KAAKyH,kBAAkBD,KAAKxH,MAErDA,KAAK0H,MAAQ,CACXC,MAAOC,YAAY5H,KAAKuH,KA5BjB,KA6BPvB,QAAS,KACT6B,UAAWrG,EAAMiF,SAEpB,CAEDqB,iCAAiCC,GAC1B,IAAQA,EAAUtB,SAAUzG,KAAKwB,MAAMiF,WAC1CzG,KAAKO,SAAS,CAAEsH,UAAWE,EAAUtB,UAExC,CAEDuB,uBACEC,cAAcjI,KAAK0H,MAAMC,MAC1B,CAEDF,kBAAkB,GAAgB,IAAhB,UAAEI,GAAa,EAC/B7H,KAAKO,SAAS,CAAEsH,YAAWK,WAAYC,KAAKC,OAC7C,CAEDb,OAEE,MAAM,WAAEW,GAAelI,KAAK0H,MAC5B,GAAIQ,GAAcC,KAAKC,MAAQF,EAnDtB,IAmDyC,CAChD,MAAMG,EAAQrI,KAAKwB,MAAMoF,gBACrByB,GACFA,EAAM,WAAYrI,KAAK0H,MAAMG,WAE/B7H,KAAKO,SAAS,CAAE2H,WAAY,MAC7B,CACF,CAEDvB,SAEE,OAAI3G,KAAKwB,MAAMmF,OAAO2B,MAAKC,GAAkB,mBAANA,IAC9BvI,KAAKwB,MAAMmF,OAAO6B,KAAID,GAAmB,mBAANA,EAAmBA,IAAMA,IAG9DvI,KAAKwB,MAAMmF,MACnB,CAMD8B,SACE,MAAM,SAAE1B,EAAF,aAAYC,EAAZ,OAA0BE,EAA1B,MAAkCD,GAAUjH,KAAKwB,OACjD,UAAEqG,EAAF,QAAa7B,GAAYhG,KAAK0H,MAC9BgB,EAAiBxB,EAASF,EAE1BL,EAAS3G,KAAK2G,SAEpB,OACE,yBACE,eAAKgC,MAAO,CAAEC,SAAU,WAAY3B,QAAOC,OAAQwB,KACjD,QAAC,IAAD,CACEG,qBAAmB,EACnBC,YAAU,EACV7B,MAAOA,EACPC,OAAQwB,EACR/B,OAAQA,EACRkB,UAAWA,EACXkB,UAAW,CAAEC,uBAAuB,GACpCvB,kBAAmBzH,KAAKyH,oBAExB,QAAC,KAAD,CACEuB,uBAAqB,EACrBnC,SAAU7G,KAAKwB,MAAMqF,SACrBC,qBAAsB9G,KAAKwB,MAAMsF,wBAGpCC,IAEH,QAAChB,EAAD,CAASC,QAASA,IAGvB,EAGHoB,EAAgBvD,UAAYA,EAC5BuD,EAAgB6B,aA9FK,CACnBpC,SAAU,QACVD,gBAAiB,OACjBG,SAAU,KACVC,aAAc,GA4FT,MAAMkC,GAA+B/D,EAAAA,EAAAA,IAAOiC,EAAiB;;;;;8FCxHpE,MAAMvD,EAAY,CAChBsF,MAAOzC,IAAAA,OAAAA,WACP0C,MAAO1C,IAAAA,OAAAA,YAGM,MAAM2C,UAAmBhC,EAAAA,cACtCoB,SACE,MAAM,MAAEU,EAAF,MAASC,GAAUpJ,KAAKwB,MAE9B,OACE,mBACG2H,GACD,sBAASC,GAGd,EAGHC,EAAWxF,UAAYA,C,yNCTvB,MAAMyF,EAAc,CAClBC,UAAW,YACXC,MAAO,YACPC,KAAM,YACN,aAAc,YACdC,YAAa,cACb,eAAgB,cAChB,eAAgB,eAGZC,EAAa,CAACnI,EAAOoI,KACzB,MAAMpG,EAAW,CAAC,EAelB,OAdAW,OAAO0F,KAAKrI,GAAOsI,SAAQC,IACrBA,KAAKT,EACP9F,EAAS8F,EAAYS,IAAMvI,EAAMuI,GAEjCvG,EAASuG,GAAKvI,EAAMuI,EACrB,IAE4B,iBAApBvI,EAAM+H,YACf/F,EAAS+F,WAAYS,EAAAA,EAAAA,UAASxI,EAAM+H,YAEL,iBAAtB/H,EAAMkI,cACflG,EAASkG,aAAcM,EAAAA,EAAAA,UAASxI,EAAMkI,cAGjC,IACFlG,KACAoG,EAFL,EAKF,IAAIK,EACJ,MAAMC,EAAiB,CAACC,EAAMP,EAAeQ,KAM3C,GALID,GAAQA,EAAKF,UACfE,EAAKF,SAASH,SAAQO,IACpBH,EAAeG,EAAKT,EAAeO,EAAKC,YAAcA,EAAtD,IAGAD,GAAQA,EAAKG,SAAU,CACzB,MAAMC,EAAU,IACXJ,EACHK,WAAYb,EAAWQ,EAAKK,WAAYZ,IAErCW,EAAQH,aACXG,EAAQH,WAAaA,GAEvBH,EAASQ,KAAKF,EACf,GAGH,SAASG,EAAkBC,GACzB,OACEA,EAAE/J,OAAOwJ,aACP,eAAKQ,UAAU,kBACZzG,OAAO0F,KAAKc,EAAE/J,OAAOwJ,YAAY5B,KAAI,CAACqC,EAAM7J,KAC3C,QAAC,IAAD,CACEiD,IAAM,QAAOjD,IACbmI,MAAQ,GAAE0B,MACVzB,MAAQ,GAAEuB,EAAE/J,OAAOwJ,WAAWS,SAMzC,CAED,MAAMC,EAAeC,IAAO,mBAAIA,GAAJ,SAAIA,EAASP,iBAAb,EAAI,EAAqBjB,SAAzB,EACtByB,EAAeD,IAAO,mBAAIA,GAAJ,SAAIA,EAASP,iBAAb,EAAI,EAAqBd,WAAzB,EAErB,SAASuB,EAASC,EAAUC,EAASC,EAAa9D,GACvD,MAAM+D,EAAKH,EACLI,EAAKD,EAAGE,kBACRC,EAAKH,EAAGI,oBACRlC,EAAY,CAAC+B,EAAGI,EAAGJ,EAAGK,EAAGL,EAAGM,EAAG,IAAMN,EAAGO,GACxCnC,EAAc,CAAC8B,EAAGE,EAAGF,EAAGG,EAAGH,EAAGI,EAAG,IAAMJ,EAAGK,GAC1CjC,EAAgB,CAAC,EAWvB,IAAIkC,EAOJ,OAjBIvC,EAAU,GAAK,IACjBK,EAAcL,UAAYA,GAExBG,EAAY,GAAK,IACnBE,EAAcF,YAAcA,GAG9BO,EAAW,GACXC,EAAeiB,EAAQ9J,KAAMuI,GAGzByB,EAAGU,kBAELD,GAAcE,EAAAA,EAAAA,GAAcX,EAAGU,iBAC/B9B,EAAW6B,EAAY7B,IAGlB,IAAIgC,EAAAA,EAAa,CACtBlL,GAAK,iBAAgBsK,EAAGa,WACxBC,OAAQd,EAAGc,OACX9K,KAAM4I,EACNmC,QAASf,EAAGe,QACZC,SAAUhB,EAAGgB,SACbC,iBAAkBjB,EAAGkB,mBACrBzB,eACA0B,aAAcnB,EAAGoB,YAAc,EAC/BzB,mBACG0B,EAAAA,EAAAA,GAAiBrB,EAAI/D,EAAYoD,IAEvC,CAED,MAAM7G,EAAY,CAChBqH,SAAUxE,IAAAA,OAAAA,WACVyE,QAASzE,IAAAA,OAAAA,WACTE,gBAAiBF,IAAAA,KAAAA,WACjBD,SAAUC,IAAAA,OAAAA,WACV0E,YAAa1E,IAAAA,MAETuC,EAAe,CACnBmC,cAAgB,GAGlB,MAAMuB,UAAsBtF,EAAAA,UAAiB,cAAD,yBAC1CuF,aAAevF,EAAAA,YAD2B,KAG1CC,WAAatB,IACX,MAAM,QAAE6G,GAAY7M,KAAK4M,aACrBC,GACFA,EAAQvF,WAAWtB,EACpB,CAPuC,CAU1CyC,SACE,MAAM,SAAEyC,EAAF,QAAYC,EAAZ,gBAAqBvE,EAArB,YAAsCwE,EAAtC,OAAmDlE,EAAnD,MAA2DD,GAC/DjH,KAAKwB,MAEP,IAAI,SAAEiF,GAAazG,KAAKwB,MACxB,GAAI0J,EAAS4B,SAAU,CAAC,IAAD,IACrB,MAAMC,GACG,MAAP5B,GAAA,SAAAA,EAAS9J,OAAT,WAAe4I,WAAf,QAAyB+C,YAAzB,IAAyBA,QAAS,CAACC,EAAKlC,KACtC,MAAMmC,EAASC,IAAcpC,GAC7B,OAAImC,EACK,IAAID,EAAK,CAACC,EAAO,GAAIA,EAAO,IAAK,CAACA,EAAO,GAAIA,EAAO,KAGtDD,CAAP,GACC,MAAO,GAERF,EAAOtL,SACTgF,GAAW2G,EAAAA,EAAAA,GAAY3G,EAAU,CAC/BQ,QACAC,SACA6F,WAGL,CAED,MAAM5M,EAAQ8K,EAASC,EAAUC,EAASC,EAAapL,KAAKsH,YAE5D,OACE,QAAC,IAAD,CACE+F,IAAKrN,KAAK4M,aACV9F,qBAAsBqE,EAAQ9J,KAAKiM,aACnC7G,SAAUA,EACVE,OAAQ,CAACxG,GACT0G,SAAUqE,EAASqC,aACnB3G,gBAAiBA,EACjBM,OAAQA,EACRD,MAAOA,GAGZ,EAGH0F,EAAc9I,UAAYA,EAC1B8I,EAAc1D,aAAeA,EAE7B,S,iFCtLO,SAASyD,EACdxB,EACA5D,EACAoD,EACA8C,GAEA,MAAMnC,EAAKH,EACX,IAAIuC,EAkBAC,EAjBAC,EAA0BjD,EA2B9B,OA1BIW,EAAGuC,aACLD,GAA0B3B,EAAAA,EAAAA,GAAcX,EAAGuC,aAEzCD,IACFF,EAAU9C,IACJA,EAAEkD,OACJvG,EAAW,CACTpB,QAASyH,EAAwBhD,GACjCtI,EAAGsI,EAAEtI,EACL4D,EAAG0E,EAAE1E,IAGPqB,EAAW,KACZ,GAID+D,EAAGyC,gBACLJ,EAAU/C,IACR,MAAMoD,GAAO/B,EAAAA,EAAAA,GAAcX,EAAGyC,gBAAjB9B,CAAkCrB,GAC/CqD,OAAOC,KAAKF,EAAZ,EAEO1C,EAAG6C,mBAA6BC,IAAbX,IAC5BE,EAAU/C,GAAK6C,EAAS7C,EAAE/J,OAAOyK,EAAG+C,eAG/B,CACLV,UACAD,UACA/K,SAAUsC,QAAQyI,GAErB,CAED,MAAMY,EAAc,CAClBC,GAAI,IACJC,GAAI,IACJC,IAAK,IACLC,IAAK,KAIA,SAASC,EAAW9M,EAAcM,GACvC,QADwD,IAA/BN,IAAAA,EAAO,YAAwB,IAAjBM,IAAAA,EAAW,MACrC,UAATN,EACF,OAAO+M,GAAOA,EAAIlN,OAEpB,IAAImN,EAiBJ,OAfEA,EADEhN,KAAQyM,EACD,CAACM,EAAK1B,KACb,IAAI4B,EASJ,OAPEA,EADE3M,EACUyM,EAAIG,MAAK,CAACC,EAAIC,IACxBC,EAAAA,UAAkB/M,EAAS6M,GAAK7M,EAAS8M,MAG/BL,EAAIG,KAAKG,EAAAA,WAGhBA,EAAAA,SAAiBJ,EAAWR,EAAYzM,GAAOqL,EAAtD,EAGOgC,EAAQrN,GAEdM,EAIEyM,GAAOC,EAAOD,EAAInG,KAAInG,GAAKH,EAASG,MAHlCsM,GAAOC,EAAOD,EAIxB,C,6EC5EM,SAAS3E,EAASkF,EAAKC,GAC5B,QADyC,IAAbA,IAAAA,EAAQ,MAC/BD,EACH,MAAO,CAAC,EAAG,EAAG,EAAGC,GAEnB,MAAM,EAAEzD,EAAF,EAAKC,EAAL,EAAQC,IAAMwD,EAAAA,EAAAA,IAAIF,GAExB,MAAO,CAACxD,EAAGC,EAAGC,EAAGuD,EAClB,C,wGCDD,MAAME,EAAiB,CACrBC,QACAC,EAFqB,KAGrB/J,OAHqB,EAIrByJ,QAJqB,GAQR,SAASjD,EAAcwD,EAAMrO,EAASsO,GACnD,MAAMC,EAAU,CAAC,EACXC,EAAa,aAAYC,KAAKC,MAAsB,IAAhBD,KAAKE,YAC/CJ,EAAQC,GAAa,CAAC,EACtB,MAAMI,EAAc,GAAEJ,KAAaH,IAC7BQ,EAAiB,IAAKX,KAAmBlO,GAC/CgD,OAAO0F,KAAKmG,GAAgBlG,SAAQ7F,IAClCyL,EAAQzL,GAAO+L,EAAe/L,EAA9B,IAEF,IAGE,OAFAgM,IAAAA,gBAAmBF,EAAYL,EAASD,GAEjCC,EAAQC,EAGhB,CAFC,MAAOO,GACP,MAAO,IAAMA,CACd,CACF,C,yEC9BD,MAAMC,EAAmB,EAAE,GAAI,IACzBC,EAAmB,EAAE,IAAK,KAKhC,SAASC,EAAT,IAGEC,GAAc,IAFbC,EAAQC,GAEK,GADbC,EAAUC,GACG,EAEd,YAFc,IAAdJ,IAAAA,EAAU,KAEHC,EAASC,EACZ,CAACD,EAAQC,GACT,CACEZ,KAAKe,IAAIF,EAAUF,EAASD,GAC5BV,KAAKgB,IAAIF,EAAUF,EAASF,GAEnC,CCEa,SAAUlD,EACtByD,EADY,GAUS,IARrB,OACE9D,EADF,MAEE9F,EAFF,OAGEC,EAHF,UAIE4J,EAJF,QAKEC,EALF,OAMEC,EANF,QAOEV,EAAU,IACS,EAErB,MAAM,QAAEW,EAAF,MAAWC,GAAUL,EACrB3D,EDbM,SACZH,GAEA,MAAMoE,EAAYd,GAChBe,EAAAA,EAAAA,QAASrE,GAAS1K,GAAaA,EAAE,KACjC8N,GAEIkB,EAAYhB,GAChBe,EAAAA,EAAAA,QAASrE,GAAS1K,GAAaA,EAAE,KACjC+N,GAEF,MAAO,CACL,CAACiB,EAAU,GAAIF,EAAU,IACzB,CAACE,EAAU,GAAIF,EAAU,IAE5B,CCFgBG,CAAwBvE,GAEvC,IACE,MAAO,KACFwE,EAAAA,EAAAA,IAAU,CACXrE,SACAjG,QACAC,SACA4J,YACAC,UACAC,SACAV,YAEFW,UACAC,QAKH,CAHC,MAAOhB,GAEPZ,QAAQY,MAAM,yBAA0BA,EACzC,CAED,OAAOW,CACR,C","sources":["webpack://superset/./node_modules/@deck.gl/core/dist/esm/lib/composite-layer.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/components/Tooltip.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/TooltipRow.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Geojson/Geojson.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/common.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/colors.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/sandbox.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/computeBoundsFromPoints.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/fitViewport.ts"],"sourcesContent":["import Layer from './layer';\nimport debug from '../debug';\nimport { flatten } from '../utils/flatten';\nconst TRACE_RENDER_LAYERS = 'compositeLayer.renderLayers';\nexport default class CompositeLayer extends Layer {\n  get isComposite() {\n    return true;\n  }\n\n  get isLoaded() {\n    return super.isLoaded && this.getSubLayers().every(layer => layer.isLoaded);\n  }\n\n  getSubLayers() {\n    return this.internalState && this.internalState.subLayers || [];\n  }\n\n  initializeState() {}\n\n  setState(updateObject) {\n    super.setState(updateObject);\n    this.setNeedsUpdate();\n  }\n\n  getPickingInfo({\n    info\n  }) {\n    const {\n      object\n    } = info;\n    const isDataWrapped = object && object.__source && object.__source.parent && object.__source.parent.id === this.id;\n\n    if (!isDataWrapped) {\n      return info;\n    }\n\n    info.object = object.__source.object;\n    info.index = object.__source.index;\n    return info;\n  }\n\n  renderLayers() {\n    return null;\n  }\n\n  filterSubLayer(context) {\n    return true;\n  }\n\n  shouldRenderSubLayer(id, data) {\n    const {\n      _subLayerProps: overridingProps\n    } = this.props;\n    return data && data.length || overridingProps && overridingProps[id];\n  }\n\n  getSubLayerClass(id, DefaultLayerClass) {\n    const {\n      _subLayerProps: overridingProps\n    } = this.props;\n    return overridingProps && overridingProps[id] && overridingProps[id].type || DefaultLayerClass;\n  }\n\n  getSubLayerRow(row, sourceObject, sourceObjectIndex) {\n    row.__source = {\n      parent: this,\n      object: sourceObject,\n      index: sourceObjectIndex\n    };\n    return row;\n  }\n\n  getSubLayerAccessor(accessor) {\n    if (typeof accessor === 'function') {\n      const objectInfo = {\n        data: this.props.data,\n        target: []\n      };\n      return (x, i) => {\n        if (x && x.__source) {\n          objectInfo.index = x.__source.index;\n          return accessor(x.__source.object, objectInfo);\n        }\n\n        return accessor(x, i);\n      };\n    }\n\n    return accessor;\n  }\n\n  getSubLayerProps(sublayerProps = {}) {\n    const {\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions,\n      fetch,\n      _subLayerProps: overridingProps\n    } = this.props;\n    const newProps = {\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions,\n      fetch\n    };\n    const overridingSublayerProps = overridingProps && overridingProps[sublayerProps.id];\n    const overridingSublayerTriggers = overridingSublayerProps && overridingSublayerProps.updateTriggers;\n    const sublayerId = sublayerProps.id || 'sublayer';\n\n    if (overridingSublayerProps) {\n      const propTypes = this.constructor._propTypes;\n      const subLayerPropTypes = sublayerProps.type ? sublayerProps.type._propTypes : {};\n\n      for (const key in overridingSublayerProps) {\n        const propType = subLayerPropTypes[key] || propTypes[key];\n\n        if (propType && propType.type === 'accessor') {\n          overridingSublayerProps[key] = this.getSubLayerAccessor(overridingSublayerProps[key]);\n        }\n      }\n    }\n\n    Object.assign(newProps, sublayerProps, overridingSublayerProps);\n    newProps.id = \"\".concat(this.props.id, \"-\").concat(sublayerId);\n    newProps.updateTriggers = {\n      all: this.props.updateTriggers.all,\n      ...sublayerProps.updateTriggers,\n      ...overridingSublayerTriggers\n    };\n\n    for (const extension of extensions) {\n      const passThroughProps = extension.getSubLayerProps.call(this, extension);\n\n      if (passThroughProps) {\n        Object.assign(newProps, passThroughProps, {\n          updateTriggers: Object.assign(newProps.updateTriggers, passThroughProps.updateTriggers)\n        });\n      }\n    }\n\n    return newProps;\n  }\n\n  _updateAutoHighlight(info) {\n    for (const layer of this.getSubLayers()) {\n      layer.updateAutoHighlight(info);\n    }\n  }\n\n  _getAttributeManager() {\n    return null;\n  }\n\n  _renderLayers() {\n    let {\n      subLayers\n    } = this.internalState;\n    const shouldUpdate = !subLayers || this.needsUpdate();\n\n    if (shouldUpdate) {\n      subLayers = this.renderLayers();\n      subLayers = flatten(subLayers, Boolean);\n      this.internalState.subLayers = subLayers;\n    }\n\n    debug(TRACE_RENDER_LAYERS, this, shouldUpdate, subLayers);\n\n    for (const layer of subLayers) {\n      layer.parent = this;\n    }\n  }\n\n}\nCompositeLayer.layerName = 'CompositeLayer';\n//# sourceMappingURL=composite-layer.js.map","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { styled } from '@superset-ui/core';\nimport React, { useMemo } from 'react';\nimport { filterXSS } from 'xss';\n\nexport type TooltipProps = {\n  tooltip:\n    | {\n        x: number;\n        y: number;\n        content: string;\n      }\n    | null\n    | undefined;\n};\n\nconst StyledDiv = styled.div<{ top: number; left: number }>`\n  ${({ theme, top, left }) => `\n    position: absolute;\n    top: ${top}px;\n    left: ${left}px;\n    padding: ${theme.gridUnit * 2}px;\n    margin: ${theme.gridUnit * 2}px;\n    background: ${theme.colors.grayscale.dark2};\n    color: ${theme.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${theme.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}\n`;\n\nexport default function Tooltip(props: TooltipProps) {\n  const { tooltip } = props;\n  if (typeof tooltip === 'undefined' || tooltip === null) {\n    return null;\n  }\n\n  const { x, y, content } = tooltip;\n\n  if (typeof content === 'string') {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const contentHtml = useMemo(\n      () => ({\n        __html: filterXSS(content, { stripIgnoreTag: true }),\n      }),\n      [content],\n    );\n    return (\n      <StyledDiv top={y} left={x}>\n        <div\n          // eslint-disable-next-line react/no-danger\n          dangerouslySetInnerHTML={contentHtml}\n        />\n      </StyledDiv>\n    );\n  }\n\n  return (\n    <StyledDiv top={y} left={x}>\n      {content}\n    </StyledDiv>\n  );\n}\n","/* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/forbid-prop-types */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { isEqual } from 'lodash';\nimport { StaticMap } from 'react-map-gl';\nimport DeckGL from 'deck.gl';\nimport { styled } from '@superset-ui/core';\nimport Tooltip from './components/Tooltip';\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\nconst TICK = 250; // milliseconds\n\nconst propTypes = {\n  viewport: PropTypes.object.isRequired,\n  layers: PropTypes.array.isRequired,\n  setControlValue: PropTypes.func,\n  mapStyle: PropTypes.string,\n  mapboxApiAccessToken: PropTypes.string.isRequired,\n  children: PropTypes.node,\n  bottomMargin: PropTypes.number,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired,\n  onViewportChange: PropTypes.func,\n};\nconst defaultProps = {\n  mapStyle: 'light',\n  setControlValue: () => {},\n  children: null,\n  bottomMargin: 0,\n};\n\nexport class DeckGLContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.tick = this.tick.bind(this);\n    this.onViewStateChange = this.onViewStateChange.bind(this);\n    // This has to be placed after this.tick is bound to this\n    this.state = {\n      timer: setInterval(this.tick, TICK),\n      tooltip: null,\n      viewState: props.viewport,\n    };\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (!isEqual(nextProps.viewport, this.props.viewport)) {\n      this.setState({ viewState: nextProps.viewport });\n    }\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.state.timer);\n  }\n\n  onViewStateChange({ viewState }) {\n    this.setState({ viewState, lastUpdate: Date.now() });\n  }\n\n  tick() {\n    // Rate limiting updating viewport controls as it triggers lotsa renders\n    const { lastUpdate } = this.state;\n    if (lastUpdate && Date.now() - lastUpdate > TICK) {\n      const setCV = this.props.setControlValue;\n      if (setCV) {\n        setCV('viewport', this.state.viewState);\n      }\n      this.setState({ lastUpdate: null });\n    }\n  }\n\n  layers() {\n    // Support for layer factory\n    if (this.props.layers.some(l => typeof l === 'function')) {\n      return this.props.layers.map(l => (typeof l === 'function' ? l() : l));\n    }\n\n    return this.props.layers;\n  }\n\n  setTooltip = tooltip => {\n    this.setState({ tooltip });\n  };\n\n  render() {\n    const { children, bottomMargin, height, width } = this.props;\n    const { viewState, tooltip } = this.state;\n    const adjustedHeight = height - bottomMargin;\n\n    const layers = this.layers();\n\n    return (\n      <>\n        <div style={{ position: 'relative', width, height: adjustedHeight }}>\n          <DeckGL\n            initWebGLParameters\n            controller\n            width={width}\n            height={adjustedHeight}\n            layers={layers}\n            viewState={viewState}\n            glOptions={{ preserveDrawingBuffer: true }}\n            onViewStateChange={this.onViewStateChange}\n          >\n            <StaticMap\n              preserveDrawingBuffer\n              mapStyle={this.props.mapStyle}\n              mapboxApiAccessToken={this.props.mapboxApiAccessToken}\n            />\n          </DeckGL>\n          {children}\n        </div>\n        <Tooltip tooltip={tooltip} />\n      </>\n    );\n  }\n}\n\nDeckGLContainer.propTypes = propTypes;\nDeckGLContainer.defaultProps = defaultProps;\n\nexport const DeckGLContainerStyledWrapper = styled(DeckGLContainer)`\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nconst propTypes = {\n  label: PropTypes.string.isRequired,\n  value: PropTypes.string.isRequired,\n};\n\nexport default class TooltipRow extends React.PureComponent {\n  render() {\n    const { label, value } = this.props;\n\n    return (\n      <div>\n        {label}\n        <strong>{value}</strong>\n      </div>\n    );\n  }\n}\n\nTooltipRow.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { GeoJsonLayer } from 'deck.gl';\nimport geojsonExtent from '@mapbox/geojson-extent';\n\nimport { DeckGLContainerStyledWrapper } from '../../DeckGLContainer';\nimport { hexToRGB } from '../../utils/colors';\nimport sandboxedEval from '../../utils/sandbox';\nimport { commonLayerProps } from '../common';\nimport TooltipRow from '../../TooltipRow';\nimport fitViewport from '../../utils/fitViewport';\n\nconst propertyMap = {\n  fillColor: 'fillColor',\n  color: 'fillColor',\n  fill: 'fillColor',\n  'fill-color': 'fillColor',\n  strokeColor: 'strokeColor',\n  'stroke-color': 'strokeColor',\n  'stroke-width': 'strokeWidth',\n};\n\nconst alterProps = (props, propOverrides) => {\n  const newProps = {};\n  Object.keys(props).forEach(k => {\n    if (k in propertyMap) {\n      newProps[propertyMap[k]] = props[k];\n    } else {\n      newProps[k] = props[k];\n    }\n  });\n  if (typeof props.fillColor === 'string') {\n    newProps.fillColor = hexToRGB(props.fillColor);\n  }\n  if (typeof props.strokeColor === 'string') {\n    newProps.strokeColor = hexToRGB(props.strokeColor);\n  }\n\n  return {\n    ...newProps,\n    ...propOverrides,\n  };\n};\nlet features;\nconst recurseGeoJson = (node, propOverrides, extraProps) => {\n  if (node && node.features) {\n    node.features.forEach(obj => {\n      recurseGeoJson(obj, propOverrides, node.extraProps || extraProps);\n    });\n  }\n  if (node && node.geometry) {\n    const newNode = {\n      ...node,\n      properties: alterProps(node.properties, propOverrides),\n    };\n    if (!newNode.extraProps) {\n      newNode.extraProps = extraProps;\n    }\n    features.push(newNode);\n  }\n};\n\nfunction setTooltipContent(o) {\n  return (\n    o.object.extraProps && (\n      <div className=\"deckgl-tooltip\">\n        {Object.keys(o.object.extraProps).map((prop, index) => (\n          <TooltipRow\n            key={`prop-${index}`}\n            label={`${prop}: `}\n            value={`${o.object.extraProps[prop]}`}\n          />\n        ))}\n      </div>\n    )\n  );\n}\n\nconst getFillColor = feature => feature?.properties?.fillColor;\nconst getLineColor = feature => feature?.properties?.strokeColor;\n\nexport function getLayer(formData, payload, onAddFilter, setTooltip) {\n  const fd = formData;\n  const fc = fd.fill_color_picker;\n  const sc = fd.stroke_color_picker;\n  const fillColor = [fc.r, fc.g, fc.b, 255 * fc.a];\n  const strokeColor = [sc.r, sc.g, sc.b, 255 * sc.a];\n  const propOverrides = {};\n  if (fillColor[3] > 0) {\n    propOverrides.fillColor = fillColor;\n  }\n  if (strokeColor[3] > 0) {\n    propOverrides.strokeColor = strokeColor;\n  }\n\n  features = [];\n  recurseGeoJson(payload.data, propOverrides);\n\n  let jsFnMutator;\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    features = jsFnMutator(features);\n  }\n\n  return new GeoJsonLayer({\n    id: `geojson-layer-${fd.slice_id}`,\n    filled: fd.filled,\n    data: features,\n    stroked: fd.stroked,\n    extruded: fd.extruded,\n    pointRadiusScale: fd.point_radius_scale,\n    getFillColor,\n    getLineWidth: fd.line_width || 1,\n    getLineColor,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nconst propTypes = {\n  formData: PropTypes.object.isRequired,\n  payload: PropTypes.object.isRequired,\n  setControlValue: PropTypes.func.isRequired,\n  viewport: PropTypes.object.isRequired,\n  onAddFilter: PropTypes.func,\n};\nconst defaultProps = {\n  onAddFilter() {},\n};\n\nclass DeckGLGeoJson extends React.Component {\n  containerRef = React.createRef();\n\n  setTooltip = tooltip => {\n    const { current } = this.containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  };\n\n  render() {\n    const { formData, payload, setControlValue, onAddFilter, height, width } =\n      this.props;\n\n    let { viewport } = this.props;\n    if (formData.autozoom) {\n      const points =\n        payload?.data?.features?.reduce?.((acc, feature) => {\n          const bounds = geojsonExtent(feature);\n          if (bounds) {\n            return [...acc, [bounds[0], bounds[1]], [bounds[2], bounds[3]]];\n          }\n\n          return acc;\n        }, []) || [];\n\n      if (points.length) {\n        viewport = fitViewport(viewport, {\n          width,\n          height,\n          points,\n        });\n      }\n    }\n\n    const layer = getLayer(formData, payload, onAddFilter, this.setTooltip);\n\n    return (\n      <DeckGLContainerStyledWrapper\n        ref={this.containerRef}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        viewport={viewport}\n        layers={[layer]}\n        mapStyle={formData.mapbox_style}\n        setControlValue={setControlValue}\n        height={height}\n        width={width}\n      />\n    );\n  }\n}\n\nDeckGLGeoJson.propTypes = propTypes;\nDeckGLGeoJson.defaultProps = defaultProps;\n\nexport default DeckGLGeoJson;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport * as d3array from 'd3-array';\nimport sandboxedEval from '../utils/sandbox';\n\nexport function commonLayerProps(\n  formData,\n  setTooltip,\n  setTooltipContent,\n  onSelect,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = o => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = o => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = o => onSelect(o.object[fd.line_column]);\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Get an a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(type = 'sum', accessor = null) {\n  if (type === 'count') {\n    return arr => arr.length;\n  }\n  let d3func;\n  if (type in percentiles) {\n    d3func = (arr, acc) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1, o2) =>\n          d3array.ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return arr => d3func(arr);\n  }\n\n  return arr => d3func(arr.map(x => accessor(x)));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { rgb } from 'd3-color';\n\n// eslint-disable-next-line import/prefer-default-export\nexport function hexToRGB(hex, alpha = 255) {\n  if (!hex) {\n    return [0, 0, 0, alpha];\n  }\n  const { r, g, b } = rgb(hex);\n\n  return [r, g, b, alpha];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// A safe alternative to JS's eval\nimport vm from 'vm';\nimport _ from 'underscore';\nimport * as d3array from 'd3-array';\nimport * as colors from './colors';\n\n// Objects exposed here should be treated like a public API\n// if `underscore` had backwards incompatible changes in a future release, we'd\n// have to be careful about bumping the library as those changes could break user charts\nconst GLOBAL_CONTEXT = {\n  console,\n  _,\n  colors,\n  d3array,\n};\n\n// Copied/modified from https://github.com/hacksparrow/safe-eval/blob/master/index.js\nexport default function sandboxedEval(code, context, opts) {\n  const sandbox = {};\n  const resultKey = `SAFE_EVAL_${Math.floor(Math.random() * 1000000)}`;\n  sandbox[resultKey] = {};\n  const codeToEval = `${resultKey}=${code}`;\n  const sandboxContext = { ...GLOBAL_CONTEXT, ...context };\n  Object.keys(sandboxContext).forEach(key => {\n    sandbox[key] = sandboxContext[key];\n  });\n  try {\n    vm.runInNewContext(codeToEval, sandbox, opts);\n\n    return sandbox[resultKey];\n  } catch (error) {\n    return () => error;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { extent as d3Extent } from 'd3-array';\nimport { Point, Range } from '../types';\n\nconst LAT_LIMIT: Range = [-90, 90];\nconst LNG_LIMIT: Range = [-180, 180];\n\n/**\n * Expand a coordinate range by `padding` and within limits, if needed\n */\nfunction expandIfNeeded(\n  [curMin, curMax]: Range,\n  [minBound, maxBound]: Range,\n  padding = 0.25,\n) {\n  return curMin < curMax\n    ? [curMin, curMax]\n    : [\n        Math.max(minBound, curMin - padding),\n        Math.min(maxBound, curMax + padding),\n      ];\n}\n\nexport default function computeBoundsFromPoints(\n  points: Point[],\n): [Point, Point] {\n  const latBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[1]) as Range,\n    LAT_LIMIT,\n  );\n  const lngBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[0]) as Range,\n    LNG_LIMIT,\n  );\n  return [\n    [lngBounds[0], latBounds[0]],\n    [lngBounds[1], latBounds[1]],\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { fitBounds } from '@math.gl/web-mercator';\nimport computeBoundsFromPoints from './computeBoundsFromPoints';\nimport { Point } from '../types';\n\nexport type Viewport = {\n  longitude: number;\n  latitude: number;\n  zoom: number;\n  bearing?: number;\n  pitch?: number;\n};\n\nexport type FitViewportOptions = {\n  points: Point[];\n  width: number;\n  height: number;\n  minExtent?: number;\n  maxZoom?: number;\n  offset?: [number, number];\n  padding?: number;\n};\n\nexport default function fitViewport(\n  originalViewPort: Viewport,\n  {\n    points,\n    width,\n    height,\n    minExtent,\n    maxZoom,\n    offset,\n    padding = 20,\n  }: FitViewportOptions,\n) {\n  const { bearing, pitch } = originalViewPort;\n  const bounds = computeBoundsFromPoints(points);\n\n  try {\n    return {\n      ...fitBounds({\n        bounds,\n        width,\n        height,\n        minExtent,\n        maxZoom,\n        offset,\n        padding,\n      }),\n      bearing,\n      pitch,\n    };\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Could not fit viewport', error);\n  }\n\n  return originalViewPort;\n}\n"],"names":["CompositeLayer","isComposite","isLoaded","super","this","getSubLayers","every","layer","internalState","subLayers","initializeState","setState","updateObject","setNeedsUpdate","getPickingInfo","info","object","__source","parent","id","index","renderLayers","filterSubLayer","context","shouldRenderSubLayer","data","_subLayerProps","overridingProps","props","length","getSubLayerClass","DefaultLayerClass","type","getSubLayerRow","row","sourceObject","sourceObjectIndex","getSubLayerAccessor","accessor","objectInfo","target","x","i","getSubLayerProps","sublayerProps","opacity","pickable","visible","parameters","getPolygonOffset","highlightedObjectIndex","autoHighlight","highlightColor","coordinateSystem","coordinateOrigin","wrapLongitude","positionFormat","modelMatrix","extensions","fetch","newProps","overridingSublayerProps","overridingSublayerTriggers","updateTriggers","sublayerId","propTypes","constructor","_propTypes","subLayerPropTypes","key","propType","Object","assign","concat","all","extension","passThroughProps","call","_updateAutoHighlight","updateAutoHighlight","_getAttributeManager","_renderLayers","shouldUpdate","needsUpdate","Boolean","layerName","StyledDiv","styled","theme","top","left","gridUnit","colors","grayscale","dark2","light5","typography","sizes","s","Tooltip","tooltip","y","content","contentHtml","useMemo","__html","filterXSS","stripIgnoreTag","dangerouslySetInnerHTML","viewport","PropTypes","layers","setControlValue","mapStyle","mapboxApiAccessToken","children","bottomMargin","width","height","onViewportChange","DeckGLContainer","React","setTooltip","tick","bind","onViewStateChange","state","timer","setInterval","viewState","UNSAFE_componentWillReceiveProps","nextProps","componentWillUnmount","clearInterval","lastUpdate","Date","now","setCV","some","l","map","render","adjustedHeight","style","position","initWebGLParameters","controller","glOptions","preserveDrawingBuffer","defaultProps","DeckGLContainerStyledWrapper","label","value","TooltipRow","propertyMap","fillColor","color","fill","strokeColor","alterProps","propOverrides","keys","forEach","k","hexToRGB","features","recurseGeoJson","node","extraProps","obj","geometry","newNode","properties","push","setTooltipContent","o","className","prop","getFillColor","feature","getLineColor","getLayer","formData","payload","onAddFilter","fd","fc","fill_color_picker","sc","stroke_color_picker","r","g","b","a","jsFnMutator","js_data_mutator","sandboxedEval","GeoJsonLayer","slice_id","filled","stroked","extruded","pointRadiusScale","point_radius_scale","getLineWidth","line_width","commonLayerProps","DeckGLGeoJson","containerRef","current","autozoom","points","reduce","acc","bounds","geojsonExtent","fitViewport","ref","mapboxApiKey","mapbox_style","onSelect","onHover","onClick","tooltipContentGenerator","js_tooltip","picked","js_onclick_href","href","window","open","table_filter","undefined","line_column","percentiles","p1","p5","p95","p99","getAggFunc","arr","d3func","sortedArr","sort","o1","o2","d3array","hex","alpha","rgb","GLOBAL_CONTEXT","console","_","code","opts","sandbox","resultKey","Math","floor","random","codeToEval","sandboxContext","vm","error","LAT_LIMIT","LNG_LIMIT","expandIfNeeded","padding","curMin","curMax","minBound","maxBound","max","min","originalViewPort","minExtent","maxZoom","offset","bearing","pitch","latBounds","d3Extent","lngBounds","computeBoundsFromPoints","fitBounds"],"sourceRoot":""}