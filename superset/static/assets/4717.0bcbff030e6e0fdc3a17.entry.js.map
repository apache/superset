{"version":3,"file":"4717.0bcbff030e6e0fdc3a17.entry.js","mappings":"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","sources":["webpack://superset/./src/dashboard/util/propShapes.jsx","webpack://superset/./src/components/CertifiedBadge/index.tsx","webpack://superset/./src/components/DeleteModal/index.tsx","webpack://superset/./src/components/FaveStar/index.tsx","webpack://superset/./src/components/ListViewCard/ImageLoader.tsx","webpack://superset/./src/components/Tags/utils.tsx","webpack://superset/./src/dashboard/components/ColorSchemeControlWrapper.jsx","webpack://superset/./src/dashboard/components/PropertiesModal/index.tsx","webpack://superset/./src/dashboard/util/getFilterScopeNodesTree.js","webpack://superset/./src/dashboard/util/getFilterScopeParentNodes.js","webpack://superset/./src/dashboard/util/getKeyForFilterScopeTree.js","webpack://superset/./src/dashboard/util/getSelectedChartIdForFilterScopeTree.js","webpack://superset/./src/dashboard/util/buildFilterScopeTreeEntry.js","webpack://superset/./src/dashboard/util/getFilterScopeFromNodesTree.js","webpack://superset/./src/dashboard/components/filterscope/renderFilterScopeTreeNodes.jsx","webpack://superset/./src/dashboard/components/filterscope/treeIcons.jsx","webpack://superset/./src/dashboard/components/filterscope/FilterScopeTree.jsx","webpack://superset/./src/dashboard/components/filterscope/FilterFieldItem.jsx","webpack://superset/./src/dashboard/components/filterscope/renderFilterFieldTreeNodes.jsx","webpack://superset/./src/dashboard/components/filterscope/FilterFieldTree.jsx","webpack://superset/./src/dashboard/components/filterscope/FilterScopeSelector.jsx","webpack://superset/./src/dashboard/util/getFilterFieldNodesTree.js","webpack://superset/./src/dashboard/util/getRevertedFilterScope.ts","webpack://superset/./src/dashboard/containers/FilterScope.jsx","webpack://superset/./src/dashboard/components/filterscope/FilterScopeModal.tsx","webpack://superset/./src/dashboard/util/backgroundStyleOptions.ts","webpack://superset/./src/dashboard/util/headerStyleOptions.ts","webpack://superset/./src/hooks/useComponentDidMount/useComponentDidMount.ts","webpack://superset/./src/tags.ts","webpack://superset/./src/utils/cacheWrapper.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport componentTypes from './componentTypes';\nimport backgroundStyleOptions from './backgroundStyleOptions';\nimport headerStyleOptions from './headerStyleOptions';\n\nexport const componentShape = PropTypes.shape({\n  id: PropTypes.string.isRequired,\n  type: PropTypes.oneOf(Object.values(componentTypes)).isRequired,\n  parents: PropTypes.arrayOf(PropTypes.string),\n  children: PropTypes.arrayOf(PropTypes.string),\n  meta: PropTypes.shape({\n    // Dimensions\n    width: PropTypes.number,\n    height: PropTypes.number,\n\n    // Header\n    headerSize: PropTypes.oneOf(headerStyleOptions.map(opt => opt.value)),\n\n    // Row\n    background: PropTypes.oneOf(backgroundStyleOptions.map(opt => opt.value)),\n\n    // Chart\n    chartId: PropTypes.number,\n  }),\n});\n\nexport const chartPropShape = PropTypes.shape({\n  id: PropTypes.number.isRequired,\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartUpdateEndTime: PropTypes.number,\n  chartUpdateStartTime: PropTypes.number,\n  latestQueryFormData: PropTypes.object,\n  queryController: PropTypes.shape({ abort: PropTypes.func }),\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  lastRendered: PropTypes.number,\n});\n\nexport const slicePropShape = PropTypes.shape({\n  slice_id: PropTypes.number.isRequired,\n  slice_url: PropTypes.string.isRequired,\n  slice_name: PropTypes.string.isRequired,\n  datasource: PropTypes.string,\n  datasource_name: PropTypes.string,\n  datasource_link: PropTypes.string,\n  changed_on: PropTypes.number.isRequired,\n  modified: PropTypes.string,\n  viz_type: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  description_markeddown: PropTypes.string,\n  owners: PropTypes.arrayOf(PropTypes.string),\n});\n\nexport const dashboardFilterPropShape = PropTypes.shape({\n  chartId: PropTypes.number.isRequired,\n  componentId: PropTypes.string.isRequired,\n  filterName: PropTypes.string.isRequired,\n  datasourceId: PropTypes.string.isRequired,\n  directPathToFilter: PropTypes.arrayOf(PropTypes.string).isRequired,\n  isDateFilter: PropTypes.bool.isRequired,\n  isInstantFilter: PropTypes.bool.isRequired,\n  columns: PropTypes.object,\n  labels: PropTypes.object,\n  scopes: PropTypes.object,\n});\n\nexport const dashboardStatePropShape = PropTypes.shape({\n  sliceIds: PropTypes.arrayOf(PropTypes.number),\n  expandedSlices: PropTypes.object,\n  editMode: PropTypes.bool,\n  isPublished: PropTypes.bool,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  updatedColorScheme: PropTypes.bool,\n  hasUnsavedChanges: PropTypes.bool,\n});\n\nexport const dashboardInfoPropShape = PropTypes.shape({\n  id: PropTypes.number,\n  metadata: PropTypes.object,\n  slug: PropTypes.string,\n  dash_edit_perm: PropTypes.bool,\n  dash_save_perm: PropTypes.bool,\n  common: PropTypes.object,\n  userId: PropTypes.string,\n});\n\n/* eslint-disable-next-line  no-undef */\nconst lazyFunction = f => () => f().apply(this, arguments);\n\nconst leafType = PropTypes.shape({\n  value: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\n  label: PropTypes.string.isRequired,\n});\n\nconst parentShape = {\n  value: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\n  label: PropTypes.string.isRequired,\n  children: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      PropTypes.shape(lazyFunction(() => parentShape)),\n      leafType,\n    ]),\n  ),\n};\n\nexport const filterScopeSelectorTreeNodePropShape = PropTypes.oneOfType([\n  PropTypes.shape(parentShape),\n  leafType,\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t, useTheme } from '@superset-ui/core';\nimport Icons, { IconType } from 'src/components/Icons';\nimport { Tooltip } from 'src/components/Tooltip';\n\nexport interface CertifiedBadgeProps {\n  certifiedBy?: string;\n  details?: string;\n  size?: IconType['iconSize'];\n}\n\nfunction CertifiedBadge({\n  certifiedBy,\n  details,\n  size = 'l',\n}: CertifiedBadgeProps) {\n  const theme = useTheme();\n\n  return (\n    <Tooltip\n      id=\"certified-details-tooltip\"\n      title={\n        <>\n          {certifiedBy && (\n            <div>\n              <strong>{t('Certified by %s', certifiedBy)}</strong>\n            </div>\n          )}\n          <div>{details}</div>\n        </>\n      }\n    >\n      <Icons.Certified iconColor={theme.colors.primary.base} iconSize={size} />\n    </Tooltip>\n  );\n}\n\nexport default CertifiedBadge;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, styled } from '@superset-ui/core';\nimport React, { useState } from 'react';\nimport { Input } from 'src/components/Input';\nimport Modal from 'src/components/Modal';\nimport { FormLabel } from 'src/components/Form';\n\nconst StyledDiv = styled.div`\n  padding-top: 8px;\n  width: 50%;\n  label {\n    color: ${({ theme }) => theme.colors.grayscale.base};\n    text-transform: uppercase;\n  }\n`;\n\nconst DescriptionContainer = styled.div`\n  line-height: 40px;\n  padding-top: 16px;\n`;\n\ninterface DeleteModalProps {\n  description: React.ReactNode;\n  onConfirm: () => void;\n  onHide: () => void;\n  open: boolean;\n  title: React.ReactNode;\n}\n\nexport default function DeleteModal({\n  description,\n  onConfirm,\n  onHide,\n  open,\n  title,\n}: DeleteModalProps) {\n  const [disableChange, setDisableChange] = useState(true);\n  const [confirmation, setConfirmation] = useState<string>('');\n\n  const hide = () => {\n    setConfirmation('');\n    onHide();\n  };\n\n  const confirm = () => {\n    setConfirmation('');\n    onConfirm();\n  };\n\n  const onChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const targetValue = event.target.value ?? '';\n    setDisableChange(targetValue.toUpperCase() !== t('DELETE'));\n    setConfirmation(targetValue);\n  };\n\n  const onPressEnter = () => {\n    if (!disableChange) {\n      confirm();\n    }\n  };\n\n  return (\n    <Modal\n      disablePrimaryButton={disableChange}\n      onHide={hide}\n      onHandledPrimaryAction={confirm}\n      primaryButtonName={t('delete')}\n      primaryButtonType=\"danger\"\n      show={open}\n      title={title}\n    >\n      <DescriptionContainer>{description}</DescriptionContainer>\n      <StyledDiv>\n        <FormLabel htmlFor=\"delete\">\n          {t('Type \"%s\" to confirm', t('DELETE'))}\n        </FormLabel>\n        <Input\n          data-test=\"delete-modal-input\"\n          type=\"text\"\n          id=\"delete\"\n          autoComplete=\"off\"\n          value={confirmation}\n          onChange={onChange}\n          onPressEnter={onPressEnter}\n        />\n      </StyledDiv>\n    </Modal>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useCallback } from 'react';\nimport { css, t, styled } from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { useComponentDidMount } from 'src/hooks/useComponentDidMount';\nimport Icons from 'src/components/Icons';\n\nexport interface FaveStarProps {\n  itemId: number;\n  isStarred?: boolean;\n  showTooltip?: boolean;\n  saveFaveStar(id: number, isStarred: boolean): any;\n  fetchFaveStar?: (id: number) => void;\n}\n\nconst StyledLink = styled.a`\n  ${({ theme }) => css`\n    font-size: ${theme.typography.sizes.xl}px;\n    display: flex;\n    padding: 0 0 0 ${theme.gridUnit * 2}px;\n  `};\n`;\n\nconst FaveStar = ({\n  itemId,\n  isStarred,\n  showTooltip,\n  saveFaveStar,\n  fetchFaveStar,\n}: FaveStarProps) => {\n  useComponentDidMount(() => {\n    if (fetchFaveStar) {\n      fetchFaveStar(itemId);\n    }\n  });\n\n  const onClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      saveFaveStar(itemId, !!isStarred);\n    },\n    [isStarred, itemId, saveFaveStar],\n  );\n\n  const content = (\n    <StyledLink\n      href=\"#\"\n      onClick={onClick}\n      className=\"fave-unfave-icon\"\n      data-test=\"fave-unfave-icon\"\n      role=\"button\"\n    >\n      {isStarred ? <Icons.FavoriteSelected /> : <Icons.FavoriteUnselected />}\n    </StyledLink>\n  );\n\n  if (showTooltip) {\n    return (\n      <Tooltip\n        id=\"fave-unfave-tooltip\"\n        title={t('Click to favorite/unfavorite')}\n      >\n        {content}\n      </Tooltip>\n    );\n  }\n\n  return content;\n};\nexport default FaveStar;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, logging } from '@superset-ui/core';\n\nexport type BackgroundPosition = 'top' | 'bottom';\ninterface ImageContainerProps {\n  src: string;\n  position: BackgroundPosition;\n}\n\nconst ImageContainer = styled.div<ImageContainerProps>`\n  background-image: url(${({ src }) => src});\n  background-size: cover;\n  background-position: center ${({ position }) => position};\n  display: inline-block;\n  height: calc(100% - 1px);\n  width: calc(100% - 2px);\n  margin: 1px 1px 0 1px;\n`;\ninterface ImageLoaderProps\n  extends React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  > {\n  fallback: string;\n  src: string;\n  isLoading?: boolean;\n  position: BackgroundPosition;\n}\n\nexport default function ImageLoader({\n  src,\n  fallback,\n  isLoading,\n  position,\n  ...rest\n}: ImageLoaderProps) {\n  const [imgSrc, setImgSrc] = useState<string>(fallback);\n\n  useEffect(() => {\n    if (src) {\n      fetch(src)\n        .then(response => response.blob())\n        .then(blob => {\n          if (/image/.test(blob.type)) {\n            const imgURL = URL.createObjectURL(blob);\n            setImgSrc(imgURL);\n          }\n        })\n        .catch(errMsg => {\n          logging.error(errMsg);\n          setImgSrc(fallback);\n        });\n    }\n\n    return () => {\n      // theres a very brief period where isLoading is false and this component is about to unmount\n      // where the stale imgSrc is briefly rendered. Setting imgSrc to fallback smoothes the transition.\n      setImgSrc(fallback);\n    };\n  }, [src, fallback]);\n\n  return (\n    <ImageContainer\n      src={isLoading ? fallback : imgSrc}\n      {...rest}\n      position={position}\n    />\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { SupersetClient, t } from '@superset-ui/core';\nimport Tag from 'src/types/TagType';\n\nimport rison from 'rison';\nimport { cacheWrapper } from 'src/utils/cacheWrapper';\nimport {\n  ClientErrorObject,\n  getClientErrorObject,\n} from 'src/utils/getClientErrorObject';\n\nconst localCache = new Map<string, any>();\n\nconst cachedSupersetGet = cacheWrapper(\n  SupersetClient.get,\n  localCache,\n  ({ endpoint }) => endpoint || '',\n);\n\ntype SelectTagsValue = {\n  value: string | number | undefined;\n  label: string;\n  key: string | number | undefined;\n};\n\nexport const tagToSelectOption = (\n  item: Tag & { table_name: string },\n): SelectTagsValue => ({\n  value: item.name,\n  label: item.name,\n  key: item.name,\n});\n\nexport const loadTags = async (\n  search: string,\n  page: number,\n  pageSize: number,\n) => {\n  const searchColumn = 'name';\n  const query = rison.encode({\n    filters: [{ col: searchColumn, opr: 'ct', value: search }],\n    page,\n    page_size: pageSize,\n    order_column: searchColumn,\n    order_direction: 'asc',\n  });\n\n  const getErrorMessage = ({ error, message }: ClientErrorObject) => {\n    let errorText = message || error || t('An error has occurred');\n    if (message === 'Forbidden') {\n      errorText = t('You do not have permission to edit this dashboard');\n    }\n    return errorText;\n  };\n\n  return cachedSupersetGet({\n    endpoint: `/api/v1/tag/?q=${query}`,\n  })\n    .then(response => {\n      const data: {\n        label: string;\n        value: string | number;\n      }[] = response.json.result\n        .filter((item: Tag & { table_name: string }) => item.type === 1)\n        .map(tagToSelectOption);\n      return {\n        data,\n        totalCount: response.json.count,\n      };\n    })\n    .catch(async error => {\n      const errorMessage = getErrorMessage(await getClientErrorObject(error));\n      throw new Error(errorMessage);\n    });\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { getCategoricalSchemeRegistry, t } from '@superset-ui/core';\n\nimport ColorSchemeControl from 'src/explore/components/controls/ColorSchemeControl';\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  labelMargin: PropTypes.number,\n  colorScheme: PropTypes.string,\n  hasCustomLabelColors: PropTypes.bool,\n};\n\nconst defaultProps = {\n  hasCustomLabelColors: false,\n  colorScheme: undefined,\n  onChange: () => {},\n};\n\nclass ColorSchemeControlWrapper extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = { hovered: false };\n    this.categoricalSchemeRegistry = getCategoricalSchemeRegistry();\n    this.choices = this.categoricalSchemeRegistry.keys().map(s => [s, s]);\n    this.schemes = this.categoricalSchemeRegistry.getMap();\n  }\n\n  setHover(hovered) {\n    this.setState({ hovered });\n  }\n\n  render() {\n    const { colorScheme, labelMargin = 0, hasCustomLabelColors } = this.props;\n    return (\n      <ColorSchemeControl\n        description={t(\n          \"Any color palette selected here will override the colors applied to this dashboard's individual charts\",\n        )}\n        labelMargin={labelMargin}\n        name=\"color_scheme\"\n        onChange={this.props.onChange}\n        value={colorScheme}\n        choices={this.choices}\n        clearable\n        schemes={this.schemes}\n        hovered={this.state.hovered}\n        hasCustomLabelColors={hasCustomLabelColors}\n      />\n    );\n  }\n}\n\nColorSchemeControlWrapper.propTypes = propTypes;\nColorSchemeControlWrapper.defaultProps = defaultProps;\n\nexport default ColorSchemeControlWrapper;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Input } from 'src/components/Input';\nimport { FormItem } from 'src/components/Form';\nimport jsonStringify from 'json-stringify-pretty-compact';\nimport Button from 'src/components/Button';\nimport { AntdForm, AsyncSelect, Col, Row } from 'src/components';\nimport rison from 'rison';\nimport {\n  CategoricalColorNamespace,\n  ensureIsArray,\n  getCategoricalSchemeRegistry,\n  getSharedLabelColor,\n  styled,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport { JsonEditor } from 'src/components/AsyncAceEditor';\n\nimport ColorSchemeControlWrapper from 'src/dashboard/components/ColorSchemeControlWrapper';\nimport FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport TagType from 'src/types/TagType';\nimport { addTag, deleteTaggedObjects, fetchTags, OBJECT_TYPES } from 'src/tags';\nimport { loadTags } from 'src/components/Tags/utils';\n\nconst StyledFormItem = styled(FormItem)`\n  margin-bottom: 0;\n`;\n\nconst StyledJsonEditor = styled(JsonEditor)`\n  border-radius: ${({ theme }) => theme.borderRadius}px;\n  border: 1px solid ${({ theme }) => theme.colors.secondary.light2};\n`;\n\ntype PropertiesModalProps = {\n  dashboardId: number;\n  dashboardTitle?: string;\n  dashboardInfo?: Record<string, any>;\n  show?: boolean;\n  onHide?: () => void;\n  colorScheme?: string;\n  onSubmit?: (params: Record<string, any>) => void;\n  addSuccessToast: (message: string) => void;\n  addDangerToast: (message: string) => void;\n  onlyApply?: boolean;\n};\n\ntype Roles = { id: number; name: string }[];\ntype Owners = {\n  id: number;\n  full_name?: string;\n  first_name?: string;\n  last_name?: string;\n}[];\ntype DashboardInfo = {\n  id: number;\n  title: string;\n  slug: string;\n  certifiedBy: string;\n  certificationDetails: string;\n  isManagedExternally: boolean;\n};\n\nconst PropertiesModal = ({\n  addSuccessToast,\n  addDangerToast,\n  colorScheme: currentColorScheme,\n  dashboardId,\n  dashboardInfo: currentDashboardInfo,\n  dashboardTitle,\n  onHide = () => {},\n  onlyApply = false,\n  onSubmit = () => {},\n  show = false,\n}: PropertiesModalProps) => {\n  const [form] = AntdForm.useForm();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);\n  const [colorScheme, setColorScheme] = useState(currentColorScheme);\n  const [jsonMetadata, setJsonMetadata] = useState('');\n  const [dashboardInfo, setDashboardInfo] = useState<DashboardInfo>();\n  const [owners, setOwners] = useState<Owners>([]);\n  const [roles, setRoles] = useState<Roles>([]);\n  const saveLabel = onlyApply ? t('Apply') : t('Save');\n  const [tags, setTags] = useState<TagType[]>([]);\n  const categoricalSchemeRegistry = getCategoricalSchemeRegistry();\n\n  const tagsAsSelectValues = useMemo(() => {\n    const selectTags = tags.map(tag => ({\n      value: tag.name,\n      label: tag.name,\n      key: tag.name,\n    }));\n    return selectTags;\n  }, [tags.length]);\n\n  const handleErrorResponse = async (response: Response) => {\n    const { error, statusText, message } = await getClientErrorObject(response);\n    let errorText = error || statusText || t('An error has occurred');\n    if (typeof message === 'object' && 'json_metadata' in message) {\n      errorText = (message as { json_metadata: string }).json_metadata;\n    } else if (typeof message === 'string') {\n      errorText = message;\n\n      if (message === 'Forbidden') {\n        errorText = t('You do not have permission to edit this dashboard');\n      }\n    }\n\n    Modal.error({\n      title: t('Error'),\n      content: errorText,\n      okButtonProps: { danger: true, className: 'btn-danger' },\n    });\n  };\n\n  const loadAccessOptions = useCallback(\n    (accessType = 'owners', input = '', page: number, pageSize: number) => {\n      const query = rison.encode({\n        filter: input,\n        page,\n        page_size: pageSize,\n      });\n      return SupersetClient.get({\n        endpoint: `/api/v1/dashboard/related/${accessType}?q=${query}`,\n      }).then(response => ({\n        data: response.json.result\n          .filter((item: { extra: { active: boolean } }) =>\n            item.extra.active !== undefined ? item.extra.active : true,\n          )\n          .map((item: { value: number; text: string }) => ({\n            value: item.value,\n            label: item.text,\n          })),\n        totalCount: response.json.count,\n      }));\n    },\n    [],\n  );\n\n  const handleDashboardData = useCallback(\n    dashboardData => {\n      const {\n        id,\n        dashboard_title,\n        slug,\n        certified_by,\n        certification_details,\n        owners,\n        roles,\n        metadata,\n        is_managed_externally,\n      } = dashboardData;\n      const dashboardInfo = {\n        id,\n        title: dashboard_title,\n        slug: slug || '',\n        certifiedBy: certified_by || '',\n        certificationDetails: certification_details || '',\n        isManagedExternally: is_managed_externally || false,\n      };\n\n      form.setFieldsValue(dashboardInfo);\n      setDashboardInfo(dashboardInfo);\n      setOwners(owners);\n      setRoles(roles);\n      setColorScheme(metadata.color_scheme);\n\n      // temporary fix to remove positions from dashboards' metadata\n      if (metadata?.positions) {\n        delete metadata.positions;\n      }\n      const metaDataCopy = { ...metadata };\n\n      delete metaDataCopy.shared_label_colors;\n\n      delete metaDataCopy.color_scheme_domain;\n\n      setJsonMetadata(metaDataCopy ? jsonStringify(metaDataCopy) : '');\n    },\n    [form],\n  );\n\n  const fetchDashboardDetails = useCallback(() => {\n    setIsLoading(true);\n    // We fetch the dashboard details because not all code\n    // that renders this component have all the values we need.\n    // At some point when we have a more consistent frontend\n    // datamodel, the dashboard could probably just be passed as a prop.\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/${dashboardId}`,\n    }).then(response => {\n      const dashboard = response.json.result;\n      const jsonMetadataObj = dashboard.json_metadata?.length\n        ? JSON.parse(dashboard.json_metadata)\n        : {};\n\n      handleDashboardData({\n        ...dashboard,\n        metadata: jsonMetadataObj,\n      });\n\n      setIsLoading(false);\n    }, handleErrorResponse);\n  }, [dashboardId, handleDashboardData]);\n\n  const getJsonMetadata = () => {\n    try {\n      const jsonMetadataObj = jsonMetadata?.length\n        ? JSON.parse(jsonMetadata)\n        : {};\n      return jsonMetadataObj;\n    } catch (_) {\n      return {};\n    }\n  };\n\n  const handleOnChangeOwners = (owners: { value: number; label: string }[]) => {\n    const parsedOwners: Owners = ensureIsArray(owners).map(o => ({\n      id: o.value,\n      full_name: o.label,\n    }));\n    setOwners(parsedOwners);\n  };\n\n  const handleOnChangeRoles = (roles: { value: number; label: string }[]) => {\n    const parsedRoles: Roles = ensureIsArray(roles).map(r => ({\n      id: r.value,\n      name: r.label,\n    }));\n    setRoles(parsedRoles);\n  };\n\n  const handleOwnersSelectValue = () => {\n    const parsedOwners = (owners || []).map(\n      (owner: {\n        id: number;\n        first_name?: string;\n        last_name?: string;\n        full_name?: string;\n      }) => ({\n        value: owner.id,\n        label: owner.full_name || `${owner.first_name} ${owner.last_name}`,\n      }),\n    );\n    return parsedOwners;\n  };\n\n  const handleRolesSelectValue = () => {\n    const parsedRoles = (roles || []).map(\n      (role: { id: number; name: string }) => ({\n        value: role.id,\n        label: `${role.name}`,\n      }),\n    );\n    return parsedRoles;\n  };\n\n  const onColorSchemeChange = (\n    colorScheme = '',\n    { updateMetadata = true } = {},\n  ) => {\n    // check that color_scheme is valid\n    const colorChoices = categoricalSchemeRegistry.keys();\n    const jsonMetadataObj = getJsonMetadata();\n\n    // only fire if the color_scheme is present and invalid\n    if (colorScheme && !colorChoices.includes(colorScheme)) {\n      Modal.error({\n        title: t('Error'),\n        content: t('A valid color scheme is required'),\n        okButtonProps: { danger: true, className: 'btn-danger' },\n      });\n      throw new Error('A valid color scheme is required');\n    }\n\n    // update metadata to match selection\n    if (updateMetadata) {\n      jsonMetadataObj.color_scheme = colorScheme;\n      jsonMetadataObj.label_colors = jsonMetadataObj.label_colors || {};\n\n      setJsonMetadata(jsonStringify(jsonMetadataObj));\n    }\n    setColorScheme(colorScheme);\n  };\n\n  const updateTags = (oldTags: TagType[], newTags: TagType[]) => {\n    // update the tags for this object\n    // add tags that are in new tags, but not in old tags\n    // eslint-disable-next-line array-callback-return\n    newTags.map((tag: TagType) => {\n      if (!oldTags.some(t => t.name === tag.name)) {\n        addTag(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n            includeTypes: false,\n          },\n          tag.name,\n          () => {},\n          () => {},\n        );\n      }\n    });\n    // delete tags that are in old tags, but not in new tags\n    // eslint-disable-next-line array-callback-return\n    oldTags.map((tag: TagType) => {\n      if (!newTags.some(t => t.name === tag.name)) {\n        deleteTaggedObjects(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n          },\n          tag,\n          () => {},\n          () => {},\n        );\n      }\n    });\n  };\n\n  const onFinish = () => {\n    const { title, slug, certifiedBy, certificationDetails } =\n      form.getFieldsValue();\n    let currentColorScheme = colorScheme;\n    let colorNamespace = '';\n    let currentJsonMetadata = jsonMetadata;\n\n    // validate currentJsonMetadata\n    let metadata;\n    try {\n      if (\n        !currentJsonMetadata.startsWith('{') ||\n        !currentJsonMetadata.endsWith('}')\n      ) {\n        throw new Error();\n      }\n      metadata = JSON.parse(currentJsonMetadata);\n    } catch (error) {\n      addDangerToast(t('JSON metadata is invalid!'));\n      return;\n    }\n\n    // color scheme in json metadata has precedence over selection\n    currentColorScheme = metadata?.color_scheme || colorScheme;\n    colorNamespace = metadata?.color_namespace;\n\n    // filter shared_label_color from user input\n    if (metadata?.shared_label_colors) {\n      delete metadata.shared_label_colors;\n    }\n    if (metadata?.color_scheme_domain) {\n      delete metadata.color_scheme_domain;\n    }\n\n    const sharedLabelColor = getSharedLabelColor();\n    const categoricalNamespace =\n      CategoricalColorNamespace.getNamespace(colorNamespace);\n    categoricalNamespace.resetColors();\n    if (currentColorScheme) {\n      sharedLabelColor.updateColorMap(colorNamespace, currentColorScheme);\n      metadata.shared_label_colors = Object.fromEntries(\n        sharedLabelColor.getColorMap(),\n      );\n      metadata.color_scheme_domain =\n        categoricalSchemeRegistry.get(colorScheme)?.colors || [];\n    } else {\n      sharedLabelColor.reset();\n      metadata.shared_label_colors = {};\n      metadata.color_scheme_domain = [];\n    }\n\n    currentJsonMetadata = jsonStringify(metadata);\n\n    onColorSchemeChange(currentColorScheme, {\n      updateMetadata: false,\n    });\n\n    if (isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) {\n      // update tags\n      try {\n        fetchTags(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n            includeTypes: false,\n          },\n          (currentTags: TagType[]) => updateTags(currentTags, tags),\n          error => {\n            handleErrorResponse(error);\n          },\n        );\n      } catch (error) {\n        handleErrorResponse(error);\n      }\n    }\n\n    const moreOnSubmitProps: { roles?: Roles } = {};\n    const morePutProps: { roles?: number[] } = {};\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)) {\n      moreOnSubmitProps.roles = roles;\n      morePutProps.roles = (roles || []).map(r => r.id);\n    }\n    const onSubmitProps = {\n      id: dashboardId,\n      title,\n      slug,\n      jsonMetadata: currentJsonMetadata,\n      owners,\n      colorScheme: currentColorScheme,\n      colorNamespace,\n      certifiedBy,\n      certificationDetails,\n      ...moreOnSubmitProps,\n    };\n    if (onlyApply) {\n      onSubmit(onSubmitProps);\n      onHide();\n      addSuccessToast(t('Dashboard properties updated'));\n    } else {\n      SupersetClient.put({\n        endpoint: `/api/v1/dashboard/${dashboardId}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          dashboard_title: title,\n          slug: slug || null,\n          json_metadata: currentJsonMetadata || null,\n          owners: (owners || []).map(o => o.id),\n          certified_by: certifiedBy || null,\n          certification_details:\n            certifiedBy && certificationDetails ? certificationDetails : null,\n          ...morePutProps,\n        }),\n      }).then(() => {\n        onSubmit(onSubmitProps);\n        onHide();\n        addSuccessToast(t('The dashboard has been saved'));\n      }, handleErrorResponse);\n    }\n  };\n\n  const getRowsWithoutRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys(\n      jsonMetadataObj?.label_colors || {},\n    ).length;\n\n    return (\n      <Row gutter={16}>\n        <Col xs={24} md={12}>\n          <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n          <StyledFormItem label={t('Owners')}>\n            <AsyncSelect\n              allowClear\n              ariaLabel={t('Owners')}\n              disabled={isLoading}\n              mode=\"multiple\"\n              onChange={handleOnChangeOwners}\n              options={(input, page, pageSize) =>\n                loadAccessOptions('owners', input, page, pageSize)\n              }\n              value={handleOwnersSelectValue()}\n            />\n          </StyledFormItem>\n          <p className=\"help-block\">\n            {t(\n              'Owners is a list of users who can alter the dashboard. Searchable by name or username.',\n            )}\n          </p>\n        </Col>\n        <Col xs={24} md={12}>\n          <h3 style={{ marginTop: '1em' }}>{t('Colors')}</h3>\n          <ColorSchemeControlWrapper\n            hasCustomLabelColors={hasCustomLabelColors}\n            onChange={onColorSchemeChange}\n            colorScheme={colorScheme}\n            labelMargin={4}\n          />\n        </Col>\n      </Row>\n    );\n  };\n\n  const getRowsWithRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys(\n      jsonMetadataObj?.label_colors || {},\n    ).length;\n\n    return (\n      <>\n        <Row>\n          <Col xs={24} md={24}>\n            <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Owners')}>\n              <AsyncSelect\n                allowClear\n                allowNewOptions\n                ariaLabel={t('Owners')}\n                disabled={isLoading}\n                mode=\"multiple\"\n                onChange={handleOnChangeOwners}\n                options={(input, page, pageSize) =>\n                  loadAccessOptions('owners', input, page, pageSize)\n                }\n                value={handleOwnersSelectValue()}\n              />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t(\n                'Owners is a list of users who can alter the dashboard. Searchable by name or username.',\n              )}\n            </p>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Roles')}>\n              <AsyncSelect\n                allowClear\n                ariaLabel={t('Roles')}\n                disabled={isLoading}\n                mode=\"multiple\"\n                onChange={handleOnChangeRoles}\n                options={(input, page, pageSize) =>\n                  loadAccessOptions('roles', input, page, pageSize)\n                }\n                value={handleRolesSelectValue()}\n              />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t(\n                'Roles is a list which defines access to the dashboard. Granting a role access to a dashboard will bypass dataset level checks. If no roles are defined, then the dashboard is available to all roles.',\n              )}\n            </p>\n          </Col>\n        </Row>\n        <Row>\n          <Col xs={24} md={12}>\n            <ColorSchemeControlWrapper\n              hasCustomLabelColors={hasCustomLabelColors}\n              onChange={onColorSchemeChange}\n              colorScheme={colorScheme}\n              labelMargin={4}\n            />\n          </Col>\n        </Row>\n      </>\n    );\n  };\n\n  useEffect(() => {\n    if (show) {\n      if (!currentDashboardInfo) {\n        fetchDashboardDetails();\n      } else {\n        handleDashboardData(currentDashboardInfo);\n      }\n    }\n\n    JsonEditor.preload();\n  }, [currentDashboardInfo, fetchDashboardDetails, handleDashboardData, show]);\n\n  useEffect(() => {\n    // the title can be changed inline in the dashboard, this catches it\n    if (\n      dashboardTitle &&\n      dashboardInfo &&\n      dashboardInfo.title !== dashboardTitle\n    ) {\n      form.setFieldsValue({\n        ...dashboardInfo,\n        title: dashboardTitle,\n      });\n    }\n  }, [dashboardInfo, dashboardTitle, form]);\n\n  useEffect(() => {\n    if (!isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) return;\n    try {\n      fetchTags(\n        {\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId,\n          includeTypes: false,\n        },\n        (tags: TagType[]) => setTags(tags),\n        (error: Response) => {\n          addDangerToast(`Error fetching tags: ${error.text}`);\n        },\n      );\n    } catch (error) {\n      handleErrorResponse(error);\n    }\n  }, [dashboardId]);\n\n  const handleChangeTags = (values: { label: string; value: number }[]) => {\n    // triggered whenever a new tag is selected or a tag was deselected\n    // on new tag selected, add the tag\n\n    const uniqueTags = [...new Set(values.map(v => v.label))];\n    setTags([...uniqueTags.map(t => ({ name: t }))]);\n  };\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      title={t('Dashboard properties')}\n      footer={\n        <>\n          <Button\n            htmlType=\"button\"\n            buttonSize=\"small\"\n            onClick={onHide}\n            data-test=\"properties-modal-cancel-button\"\n            cta\n          >\n            {t('Cancel')}\n          </Button>\n          <Button\n            data-test=\"properties-modal-apply-button\"\n            onClick={form.submit}\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            className=\"m-r-5\"\n            cta\n            disabled={dashboardInfo?.isManagedExternally}\n            tooltip={\n              dashboardInfo?.isManagedExternally\n                ? t(\n                    \"This dashboard is managed externally, and can't be edited in Superset\",\n                  )\n                : ''\n            }\n          >\n            {saveLabel}\n          </Button>\n        </>\n      }\n      responsive\n    >\n      <AntdForm\n        form={form}\n        onFinish={onFinish}\n        data-test=\"dashboard-edit-properties-form\"\n        layout=\"vertical\"\n        initialValues={dashboardInfo}\n      >\n        <Row>\n          <Col xs={24} md={24}>\n            <h3>{t('Basic information')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <FormItem label={t('Title')} name=\"title\">\n              <Input\n                data-test=\"dashboard-title-input\"\n                type=\"text\"\n                disabled={isLoading}\n              />\n            </FormItem>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('URL slug')} name=\"slug\">\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('A readable URL for your dashboard')}\n            </p>\n          </Col>\n        </Row>\n        {isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)\n          ? getRowsWithRoles()\n          : getRowsWithoutRoles()}\n        <Row>\n          <Col xs={24} md={24}>\n            <h3>{t('Certification')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Certified by')} name=\"certifiedBy\">\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('Person or group that has certified this dashboard.')}\n            </p>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem\n              label={t('Certification details')}\n              name=\"certificationDetails\"\n            >\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('Any additional detail to show in the certification tooltip.')}\n            </p>\n          </Col>\n        </Row>\n        {isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? (\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              <h3 css={{ marginTop: '1em' }}>{t('Tags')}</h3>\n            </Col>\n          </Row>\n        ) : null}\n        {isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? (\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              <StyledFormItem>\n                <AsyncSelect\n                  ariaLabel=\"Tags\"\n                  mode=\"multiple\"\n                  allowNewOptions\n                  value={tagsAsSelectValues}\n                  options={loadTags}\n                  onChange={handleChangeTags}\n                  allowClear\n                />\n              </StyledFormItem>\n              <p className=\"help-block\">\n                {t('A list of tags that have been applied to this chart.')}\n              </p>\n            </Col>\n          </Row>\n        ) : null}\n        <Row>\n          <Col xs={24} md={24}>\n            <h3 style={{ marginTop: '1em' }}>\n              <Button\n                buttonStyle=\"link\"\n                onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}\n              >\n                <i\n                  className={`fa fa-angle-${isAdvancedOpen ? 'down' : 'right'}`}\n                  style={{ minWidth: '1em' }}\n                />\n                {t('Advanced')}\n              </Button>\n            </h3>\n            {isAdvancedOpen && (\n              <>\n                <StyledFormItem label={t('JSON metadata')}>\n                  <StyledJsonEditor\n                    showLoadingForImport\n                    name=\"json_metadata\"\n                    value={jsonMetadata}\n                    onChange={setJsonMetadata}\n                    tabSize={2}\n                    width=\"100%\"\n                    height=\"200px\"\n                    wrapEnabled\n                  />\n                </StyledFormItem>\n                <p className=\"help-block\">\n                  {t(\n                    'This JSON object is generated dynamically when clicking the save or overwrite button in the dashboard view. It is exposed here for reference and for power users who may want to alter specific parameters.',\n                  )}\n                  {onlyApply && (\n                    <>\n                      {' '}\n                      {t(\n                        'Please DO NOT overwrite the \"filter_scopes\" key.',\n                      )}{' '}\n                      <FilterScopeModal\n                        triggerNode={\n                          <span className=\"alert-link\">\n                            {t('Use \"%(menuName)s\" menu instead.', {\n                              menuName: t('Set filter mapping'),\n                            })}\n                          </span>\n                        }\n                      />\n                    </>\n                  )}\n                </p>\n              </>\n            )}\n          </Col>\n        </Row>\n      </AntdForm>\n    </Modal>\n  );\n};\n\nexport default withToasts(PropertiesModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { isEmpty } from 'lodash';\nimport { t } from '@superset-ui/core';\n\nimport { DASHBOARD_ROOT_ID } from './constants';\nimport { CHART_TYPE, DASHBOARD_ROOT_TYPE, TAB_TYPE } from './componentTypes';\n\nconst FILTER_SCOPE_CONTAINER_TYPES = [TAB_TYPE, DASHBOARD_ROOT_TYPE];\n\nfunction traverse({\n  currentNode = {},\n  components = {},\n  filterFields = [],\n  selectedChartId,\n}) {\n  if (!currentNode) {\n    return null;\n  }\n\n  const { type } = currentNode;\n  if (\n    CHART_TYPE === type &&\n    currentNode &&\n    currentNode.meta &&\n    currentNode.meta.chartId\n  ) {\n    const chartNode = {\n      value: currentNode.meta.chartId,\n      label:\n        currentNode.meta.sliceName || `${type} ${currentNode.meta.chartId}`,\n      type,\n      showCheckbox: selectedChartId !== currentNode.meta.chartId,\n    };\n\n    return {\n      ...chartNode,\n      children: filterFields.map(filterField => ({\n        value: `${currentNode.meta.chartId}:${filterField}`,\n        label: `${chartNode.label}`,\n        type: 'filter_box',\n        showCheckbox: false,\n      })),\n    };\n  }\n\n  let children = [];\n  if (currentNode.children && currentNode.children.length) {\n    currentNode.children.forEach(child => {\n      const childNodeTree = traverse({\n        currentNode: components[child],\n        components,\n        filterFields,\n        selectedChartId,\n      });\n\n      const childType = components[child].type;\n      if (FILTER_SCOPE_CONTAINER_TYPES.includes(childType)) {\n        children.push(childNodeTree);\n      } else {\n        children = children.concat(childNodeTree);\n      }\n    });\n  }\n\n  if (FILTER_SCOPE_CONTAINER_TYPES.includes(type)) {\n    let label = null;\n    if (type === DASHBOARD_ROOT_TYPE) {\n      label = t('All charts');\n    } else {\n      label =\n        currentNode.meta && currentNode.meta.text\n          ? currentNode.meta.text\n          : `${type} ${currentNode.id}`;\n    }\n\n    return {\n      value: currentNode.id,\n      label,\n      type,\n      children,\n    };\n  }\n\n  return children;\n}\n\nexport default function getFilterScopeNodesTree({\n  components = {},\n  filterFields = [],\n  selectedChartId,\n}) {\n  if (isEmpty(components)) {\n    return [];\n  }\n\n  const root = traverse({\n    currentNode: components[DASHBOARD_ROOT_ID],\n    components,\n    filterFields,\n    selectedChartId,\n  });\n  return [\n    {\n      ...root,\n    },\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function getFilterScopeParentNodes(nodes = [], depthLimit = -1) {\n  const parentNodes = [];\n  const traverse = (currentNode, depth) => {\n    if (!currentNode) {\n      return;\n    }\n\n    if (currentNode.children && (depthLimit === -1 || depth < depthLimit)) {\n      parentNodes.push(currentNode.value);\n      currentNode.children.forEach(child => traverse(child, depth + 1));\n    }\n  };\n\n  if (nodes.length > 0) {\n    nodes.forEach(node => {\n      traverse(node, 0);\n    });\n  }\n\n  return parentNodes;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { safeStringify } from '../../utils/safeStringify';\n\nexport default function getKeyForFilterScopeTree({\n  activeFilterField,\n  checkedFilterFields,\n}) {\n  return safeStringify(\n    activeFilterField ? [activeFilterField] : checkedFilterFields,\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getChartIdAndColumnFromFilterKey } from './getDashboardFilterKey';\n\nexport default function getSelectedChartIdForFilterScopeTree({\n  activeFilterField,\n  checkedFilterFields,\n}) {\n  // we don't apply filter on filter_box itself, so we will disable\n  // checkbox in filter scope selector.\n  // this function returns chart id based on current filter scope selector local state:\n  // 1. if in single-edit mode, return the chart id for selected filter field.\n  // 2. if in multi-edit mode, if all filter fields are from same chart id,\n  // return the single chart id.\n  // otherwise, there is no chart to disable.\n  if (activeFilterField) {\n    return getChartIdAndColumnFromFilterKey(activeFilterField).chartId;\n  }\n\n  if (checkedFilterFields.length) {\n    const { chartId } = getChartIdAndColumnFromFilterKey(\n      checkedFilterFields[0],\n    );\n\n    if (\n      checkedFilterFields.some(\n        filterKey =>\n          getChartIdAndColumnFromFilterKey(filterKey).chartId !== chartId,\n      )\n    ) {\n      return null;\n    }\n    return chartId;\n  }\n\n  return null;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport getFilterScopeNodesTree from './getFilterScopeNodesTree';\nimport getFilterScopeParentNodes from './getFilterScopeParentNodes';\nimport getKeyForFilterScopeTree from './getKeyForFilterScopeTree';\nimport getSelectedChartIdForFilterScopeTree from './getSelectedChartIdForFilterScopeTree';\n\nexport default function buildFilterScopeTreeEntry({\n  checkedFilterFields = [],\n  activeFilterField,\n  filterScopeMap = {},\n  layout = {},\n}) {\n  const key = getKeyForFilterScopeTree({\n    checkedFilterFields,\n    activeFilterField,\n  });\n  const editingList = activeFilterField\n    ? [activeFilterField]\n    : checkedFilterFields;\n  const selectedChartId = getSelectedChartIdForFilterScopeTree({\n    checkedFilterFields,\n    activeFilterField,\n  });\n  const nodes = getFilterScopeNodesTree({\n    components: layout,\n    filterFields: editingList,\n    selectedChartId,\n  });\n  const checkedChartIdSet = new Set();\n  editingList.forEach(filterField => {\n    (filterScopeMap[filterField].checked || []).forEach(chartId => {\n      checkedChartIdSet.add(`${chartId}:${filterField}`);\n    });\n  });\n  const checked = [...checkedChartIdSet];\n  const expanded = filterScopeMap[key]\n    ? filterScopeMap[key].expanded\n    : getFilterScopeParentNodes(nodes, 1);\n\n  return {\n    [key]: {\n      nodes,\n      nodesFiltered: [...nodes],\n      checked,\n      expanded,\n    },\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { flow, keyBy, mapValues } from 'lodash/fp';\nimport { flatMap, isEmpty } from 'lodash';\n\nimport { CHART_TYPE, TAB_TYPE } from './componentTypes';\nimport { getChartIdAndColumnFromFilterKey } from './getDashboardFilterKey';\n\nfunction getImmuneChartIdsFromTabsNotInScope({ tabs = [], tabsInScope = [] }) {\n  const chartsNotInScope = [];\n  tabs.forEach(({ value: tab, children: tabChildren }) => {\n    if (tabChildren && !tabsInScope.includes(tab)) {\n      tabChildren.forEach(({ value: subTab, children: subTabChildren }) => {\n        if (subTabChildren && !tabsInScope.includes(subTab)) {\n          chartsNotInScope.push(\n            ...subTabChildren.filter(({ type }) => type === CHART_TYPE),\n          );\n        }\n      });\n    }\n  });\n\n  // return chartId only\n  return chartsNotInScope.map(({ value }) => value);\n}\nfunction getTabChildrenScope({\n  tabScopes,\n  parentNodeValue,\n  forceAggregate = false,\n  hasChartSiblings = false,\n  tabChildren = [],\n  immuneChartSiblings = [],\n}) {\n  // if all sub-tabs are in scope, or forceAggregate =  true\n  // aggregate scope to parentNodeValue\n  if (\n    forceAggregate ||\n    (!hasChartSiblings &&\n      Object.entries(tabScopes).every(\n        ([key, { scope }]) => scope && scope.length && key === scope[0],\n      ))\n  ) {\n    // get all charts from tabChildren that is not in scope\n    const immuneChartIdsFromTabsNotInScope =\n      getImmuneChartIdsFromTabsNotInScope({\n        tabs: tabChildren,\n        tabsInScope: flatMap(tabScopes, ({ scope }) => scope),\n      });\n    const immuneChartIdsFromTabsInScope = flatMap(\n      Object.values(tabScopes),\n      ({ immune }) => immune,\n    );\n    const immuneCharts = [\n      ...new Set([\n        ...immuneChartIdsFromTabsNotInScope,\n        ...immuneChartIdsFromTabsInScope,\n      ]),\n    ];\n    return {\n      scope: [parentNodeValue],\n      immune: immuneCharts,\n    };\n  }\n\n  const componentsInScope = Object.values(tabScopes).filter(\n    ({ scope }) => scope && scope.length,\n  );\n  return {\n    scope: flatMap(componentsInScope, ({ scope }) => scope),\n    immune: componentsInScope.length\n      ? flatMap(componentsInScope, ({ immune }) => immune)\n      : flatMap(Object.values(tabScopes), ({ immune }) => immune).concat(\n          immuneChartSiblings,\n        ),\n  };\n}\n\nfunction traverse({ currentNode = {}, filterId, checkedChartIds = [] }) {\n  if (!currentNode) {\n    return {};\n  }\n\n  const { value: currentValue, children } = currentNode;\n  const chartChildren = children.filter(({ type }) => type === CHART_TYPE);\n  const tabChildren = children.filter(({ type }) => type === TAB_TYPE);\n\n  const chartsImmune = chartChildren\n    .filter(\n      ({ value }) => filterId !== value && !checkedChartIds.includes(value),\n    )\n    .map(({ value }) => value);\n  const tabScopes = flow(\n    keyBy(child => child.value),\n    mapValues(child =>\n      traverse({\n        currentNode: child,\n        filterId,\n        checkedChartIds,\n      }),\n    ),\n  )(tabChildren);\n\n  // if any chart type child is in scope,\n  // no matter has tab children or not, current node should be scope\n  if (\n    !isEmpty(chartChildren) &&\n    chartChildren.some(({ value }) => checkedChartIds.includes(value))\n  ) {\n    if (isEmpty(tabChildren)) {\n      return { scope: [currentValue], immune: chartsImmune };\n    }\n\n    const { scope, immune } = getTabChildrenScope({\n      tabScopes,\n      parentNodeValue: currentValue,\n      forceAggregate: true,\n      tabChildren,\n    });\n    return {\n      scope,\n      immune: chartsImmune.concat(immune),\n    };\n  }\n\n  // has tab children but only some sub-tab in scope\n  if (tabChildren.length) {\n    return getTabChildrenScope({\n      tabScopes,\n      parentNodeValue: currentValue,\n      hasChartSiblings: !isEmpty(chartChildren),\n      tabChildren,\n      immuneChartSiblings: chartsImmune,\n    });\n  }\n\n  // no tab children and no chart children in scope\n  return {\n    scope: [],\n    immune: chartsImmune,\n  };\n}\n\nexport default function getFilterScopeFromNodesTree({\n  filterKey,\n  nodes = [],\n  checkedChartIds = [],\n}) {\n  if (nodes.length) {\n    const { chartId } = getChartIdAndColumnFromFilterKey(filterKey);\n    return traverse({\n      currentNode: nodes[0],\n      filterId: chartId,\n      checkedChartIds,\n    });\n  }\n\n  return {};\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport cx from 'classnames';\nimport { styled } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport { CHART_TYPE } from 'src/dashboard/util/componentTypes';\n\nconst ChartIcon = styled(Icons.BarChartOutlined)`\n  ${({ theme }) => `\n    position: relative;\n    top: ${theme.gridUnit - 1}px;\n    color: ${theme.colors.primary.base};\n    margin-right: ${theme.gridUnit * 2}px;\n  `}\n`;\n\nfunction traverse({ currentNode = {}, selectedChartId }) {\n  if (!currentNode) {\n    return null;\n  }\n\n  const { label, value, type, children } = currentNode;\n  if (children && children.length) {\n    const updatedChildren = children.map(child =>\n      traverse({ currentNode: child, selectedChartId }),\n    );\n    return {\n      ...currentNode,\n      label: (\n        <span\n          className={cx(`filter-scope-type ${type.toLowerCase()}`, {\n            'selected-filter': selectedChartId === value,\n          })}\n        >\n          {type === CHART_TYPE && <ChartIcon />}\n          {label}\n        </span>\n      ),\n      children: updatedChildren,\n    };\n  }\n  return {\n    ...currentNode,\n    label: (\n      <span\n        className={cx(`filter-scope-type ${type.toLowerCase()}`, {\n          'selected-filter': selectedChartId === value,\n        })}\n      >\n        {label}\n      </span>\n    ),\n  };\n}\n\nexport default function renderFilterScopeTreeNodes({ nodes, selectedChartId }) {\n  if (!nodes) {\n    return [];\n  }\n\n  return nodes.map(node => traverse({ currentNode: node, selectedChartId }));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport 'react-checkbox-tree/lib/react-checkbox-tree.css';\n\nimport {\n  CheckboxChecked,\n  CheckboxUnchecked,\n  CheckboxHalfChecked,\n} from 'src/components/Checkbox/CheckboxIcons';\n\nconst treeIcons = {\n  check: <CheckboxChecked />,\n  uncheck: <CheckboxUnchecked />,\n  halfCheck: <CheckboxHalfChecked />,\n  expandClose: <span className=\"rct-icon rct-icon-expand-close\" />,\n  expandOpen: <span className=\"rct-icon rct-icon-expand-open\" />,\n  expandAll: (\n    <span className=\"rct-icon rct-icon-expand-all\">{t('Expand all')}</span>\n  ),\n  collapseAll: (\n    <span className=\"rct-icon rct-icon-collapse-all\">{t('Collapse all')}</span>\n  ),\n  parentClose: <span className=\"rct-icon rct-icon-parent-close\" />,\n  parentOpen: <span className=\"rct-icon rct-icon-parent-open\" />,\n  leaf: <span className=\"rct-icon rct-icon-leaf\" />,\n};\n\nexport default treeIcons;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport CheckboxTree from 'react-checkbox-tree';\nimport { filterScopeSelectorTreeNodePropShape } from 'src/dashboard/util/propShapes';\nimport renderFilterScopeTreeNodes from './renderFilterScopeTreeNodes';\nimport treeIcons from './treeIcons';\n\nconst propTypes = {\n  nodes: PropTypes.arrayOf(filterScopeSelectorTreeNodePropShape).isRequired,\n  checked: PropTypes.arrayOf(\n    PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  ).isRequired,\n  expanded: PropTypes.arrayOf(\n    PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  ).isRequired,\n  onCheck: PropTypes.func.isRequired,\n  onExpand: PropTypes.func.isRequired,\n  selectedChartId: PropTypes.number,\n};\n\nconst defaultProps = {\n  selectedChartId: null,\n};\n\nconst NOOP = () => {};\n\nexport default function FilterScopeTree({\n  nodes = [],\n  checked = [],\n  expanded = [],\n  onCheck,\n  onExpand,\n  selectedChartId,\n}) {\n  return (\n    <CheckboxTree\n      showExpandAll\n      expandOnClick\n      showNodeIcon={false}\n      nodes={renderFilterScopeTreeNodes({ nodes, selectedChartId })}\n      checked={checked}\n      expanded={expanded}\n      onCheck={onCheck}\n      onExpand={onExpand}\n      onClick={NOOP}\n      icons={treeIcons}\n    />\n  );\n}\n\nFilterScopeTree.propTypes = propTypes;\nFilterScopeTree.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport { FormLabel } from 'src/components/Form';\n\nconst propTypes = {\n  label: PropTypes.string.isRequired,\n  isSelected: PropTypes.bool.isRequired,\n};\n\nexport default function FilterFieldItem({ label, isSelected }) {\n  return (\n    <span\n      className={cx('filter-field-item filter-container', {\n        'is-selected': isSelected,\n      })}\n    >\n      <FormLabel htmlFor={label}>{label}</FormLabel>\n    </span>\n  );\n}\n\nFilterFieldItem.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport FilterFieldItem from './FilterFieldItem';\n\nexport default function renderFilterFieldTreeNodes({ nodes, activeKey }) {\n  if (!nodes) {\n    return [];\n  }\n\n  const root = nodes[0];\n  const allFilterNodes = root.children;\n  const children = allFilterNodes.map(node => ({\n    ...node,\n    children: node.children.map(child => {\n      const { label, value } = child;\n      return {\n        ...child,\n        label: (\n          <FilterFieldItem isSelected={value === activeKey} label={label} />\n        ),\n      };\n    }),\n  }));\n\n  return [\n    {\n      ...root,\n      label: <span className=\"root\">{root.label}</span>,\n      children,\n    },\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport CheckboxTree from 'react-checkbox-tree';\nimport { filterScopeSelectorTreeNodePropShape } from 'src/dashboard/util/propShapes';\nimport treeIcons from './treeIcons';\nimport renderFilterFieldTreeNodes from './renderFilterFieldTreeNodes';\n\nconst propTypes = {\n  activeKey: PropTypes.string,\n  nodes: PropTypes.arrayOf(filterScopeSelectorTreeNodePropShape).isRequired,\n  checked: PropTypes.arrayOf(\n    PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  ).isRequired,\n  expanded: PropTypes.arrayOf(\n    PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  ).isRequired,\n  onCheck: PropTypes.func.isRequired,\n  onExpand: PropTypes.func.isRequired,\n  onClick: PropTypes.func.isRequired,\n};\n\nconst defaultProps = {\n  activeKey: null,\n};\n\nexport default function FilterFieldTree({\n  activeKey,\n  nodes = [],\n  checked = [],\n  expanded = [],\n  onClick,\n  onCheck,\n  onExpand,\n}) {\n  return (\n    <CheckboxTree\n      showExpandAll\n      showNodeIcon={false}\n      expandOnClick\n      nodes={renderFilterFieldTreeNodes({ nodes, activeKey })}\n      checked={checked}\n      expanded={expanded}\n      onClick={onClick}\n      onCheck={onCheck}\n      onExpand={onExpand}\n      icons={treeIcons}\n    />\n  );\n}\n\nFilterFieldTree.propTypes = propTypes;\nFilterFieldTree.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport Button from 'src/components/Button';\nimport { css, t, styled } from '@superset-ui/core';\n\nimport buildFilterScopeTreeEntry from 'src/dashboard/util/buildFilterScopeTreeEntry';\nimport getFilterScopeNodesTree from 'src/dashboard/util/getFilterScopeNodesTree';\nimport getFilterFieldNodesTree from 'src/dashboard/util/getFilterFieldNodesTree';\nimport getFilterScopeParentNodes from 'src/dashboard/util/getFilterScopeParentNodes';\nimport getKeyForFilterScopeTree from 'src/dashboard/util/getKeyForFilterScopeTree';\nimport getSelectedChartIdForFilterScopeTree from 'src/dashboard/util/getSelectedChartIdForFilterScopeTree';\nimport getFilterScopeFromNodesTree from 'src/dashboard/util/getFilterScopeFromNodesTree';\nimport getRevertedFilterScope from 'src/dashboard/util/getRevertedFilterScope';\nimport { getChartIdsInFilterBoxScope } from 'src/dashboard/util/activeDashboardFilters';\nimport {\n  getChartIdAndColumnFromFilterKey,\n  getDashboardFilterKey,\n} from 'src/dashboard/util/getDashboardFilterKey';\nimport { ALL_FILTERS_ROOT } from 'src/dashboard/util/constants';\nimport { dashboardFilterPropShape } from 'src/dashboard/util/propShapes';\nimport FilterScopeTree from './FilterScopeTree';\nimport FilterFieldTree from './FilterFieldTree';\n\nconst propTypes = {\n  dashboardFilters: PropTypes.objectOf(dashboardFilterPropShape).isRequired,\n  layout: PropTypes.object.isRequired,\n\n  updateDashboardFiltersScope: PropTypes.func.isRequired,\n  setUnsavedChanges: PropTypes.func.isRequired,\n  onCloseModal: PropTypes.func.isRequired,\n};\n\nconst ScopeContainer = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: column;\n    height: 80%;\n    margin-right: ${theme.gridUnit * -6}px;\n    font-size: ${theme.typography.sizes.m}px;\n\n    & .nav.nav-tabs {\n      border: none;\n    }\n\n    & .filter-scope-body {\n      flex: 1;\n      max-height: calc(100% - ${theme.gridUnit * 32}px);\n\n      .filter-field-pane,\n      .filter-scope-pane {\n        overflow-y: auto;\n      }\n    }\n\n    & .warning-message {\n      padding: ${theme.gridUnit * 6}px;\n    }\n  `}\n`;\n\nconst ScopeBody = styled.div`\n  ${({ theme }) => css`\n    &.filter-scope-body {\n      flex: 1;\n      max-height: calc(100% - ${theme.gridUnit * 32}px);\n\n      .filter-field-pane,\n      .filter-scope-pane {\n        overflow-y: auto;\n      }\n    }\n  `}\n`;\n\nconst ScopeHeader = styled.div`\n  ${({ theme }) => css`\n    height: ${theme.gridUnit * 16}px;\n    border-bottom: 1px solid ${theme.colors.grayscale.light2};\n    padding-left: ${theme.gridUnit * 6}px;\n    margin-left: ${theme.gridUnit * -6}px;\n\n    h4 {\n      margin-top: 0;\n    }\n\n    .selected-fields {\n      margin: ${theme.gridUnit * 3}px 0 ${theme.gridUnit * 4}px;\n      visibility: hidden;\n\n      &.multi-edit-mode {\n        visibility: visible;\n      }\n\n      .selected-scopes {\n        padding-left: ${theme.gridUnit}px;\n      }\n    }\n  `}\n`;\n\nconst ScopeSelector = styled.div`\n  ${({ theme }) => css`\n    &.filters-scope-selector {\n      display: flex;\n      flex-direction: row;\n      position: relative;\n      height: 100%;\n\n      a,\n      a:active,\n      a:hover {\n        color: inherit;\n        text-decoration: none;\n      }\n\n      .react-checkbox-tree .rct-icon.rct-icon-expand-all,\n      .react-checkbox-tree .rct-icon.rct-icon-collapse-all {\n        font-family: ${theme.typography.families.sansSerif};\n        font-size: ${theme.typography.sizes.m}px;\n        color: ${theme.colors.primary.base};\n\n        &::before {\n          content: '';\n        }\n\n        &:hover {\n          text-decoration: underline;\n        }\n\n        &:focus {\n          outline: none;\n        }\n      }\n\n      .filter-field-pane {\n        position: relative;\n        width: 40%;\n        padding: ${theme.gridUnit * 4}px;\n        padding-left: 0;\n        border-right: 1px solid ${theme.colors.grayscale.light2};\n\n        .filter-container label {\n          font-weight: ${theme.typography.weights.normal};\n          margin: 0 0 0 ${theme.gridUnit * 4}px;\n          word-break: break-all;\n        }\n\n        .filter-field-item {\n          height: ${theme.gridUnit * 9}px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          padding: 0 ${theme.gridUnit * 6}px;\n          margin-left: ${theme.gridUnit * -6}px;\n\n          &.is-selected {\n            border: 1px solid ${theme.colors.text.label};\n            border-radius: ${theme.borderRadius}px;\n            background-color: ${theme.colors.grayscale.light4};\n            margin-left: ${theme.gridUnit * -6}px;\n          }\n        }\n\n        .react-checkbox-tree {\n          .rct-title .root {\n            font-weight: ${theme.typography.weights.bold};\n          }\n\n          .rct-text {\n            height: ${theme.gridUnit * 10}px;\n          }\n        }\n      }\n\n      .filter-scope-pane {\n        position: relative;\n        flex: 1;\n        padding: ${theme.gridUnit * 4}px;\n        padding-right: ${theme.gridUnit * 6}px;\n      }\n\n      .react-checkbox-tree {\n        flex-direction: column;\n        color: ${theme.colors.grayscale.dark1};\n        font-size: ${theme.typography.sizes.m}px;\n\n        .filter-scope-type {\n          padding: ${theme.gridUnit * 2}px 0;\n          display: flex;\n          align-items: center;\n\n          &.chart {\n            font-weight: ${theme.typography.weights.normal};\n          }\n\n          &.selected-filter {\n            padding-left: ${theme.gridUnit * 7}px;\n            position: relative;\n            color: ${theme.colors.text.label};\n\n            &::before {\n              content: ' ';\n              position: absolute;\n              left: 0;\n              top: 50%;\n              width: ${theme.gridUnit * 4}px;\n              height: ${theme.gridUnit * 4}px;\n              border-radius: ${theme.borderRadius}px;\n              margin-top: ${theme.gridUnit * -2}px;\n              box-shadow: inset 0 0 0 2px ${theme.colors.grayscale.light2};\n              background: ${theme.colors.grayscale.light3};\n            }\n          }\n\n          &.root {\n            font-weight: ${theme.typography.weights.bold};\n          }\n        }\n\n        .rct-checkbox {\n          svg {\n            position: relative;\n            top: 3px;\n            width: ${theme.gridUnit * 4.5}px;\n          }\n        }\n\n        .rct-node-leaf {\n          .rct-bare-label {\n            &::before {\n              padding-left: ${theme.gridUnit}px;\n            }\n          }\n        }\n\n        .rct-options {\n          text-align: left;\n          margin-left: 0;\n          margin-bottom: ${theme.gridUnit * 2}px;\n        }\n\n        .rct-text {\n          margin: 0;\n          display: flex;\n        }\n\n        .rct-title {\n          display: block;\n        }\n\n        // disable style from react-checkbox-trees.css\n        .rct-node-clickable:hover,\n        .rct-node-clickable:focus,\n        label:hover,\n        label:active {\n          background: none !important;\n        }\n      }\n\n      .multi-edit-mode {\n        &.filter-scope-pane {\n          .rct-node.rct-node-leaf .filter-scope-type.filter_box {\n            display: none;\n          }\n        }\n\n        .filter-field-item {\n          padding: 0 ${theme.gridUnit * 4}px 0 ${theme.gridUnit * 12}px;\n          margin-left: ${theme.gridUnit * -12}px;\n\n          &.is-selected {\n            margin-left: ${theme.gridUnit * -13}px;\n          }\n        }\n      }\n\n      .scope-search {\n        position: absolute;\n        right: ${theme.gridUnit * 4}px;\n        top: ${theme.gridUnit * 4}px;\n        border-radius: ${theme.borderRadius}px;\n        border: 1px solid ${theme.colors.grayscale.light2};\n        padding: ${theme.gridUnit}px ${theme.gridUnit * 2}px;\n        font-size: ${theme.typography.sizes.m}px;\n        outline: none;\n\n        &:focus {\n          border: 1px solid ${theme.colors.primary.base};\n        }\n      }\n    }\n  `}\n`;\n\nconst ActionsContainer = styled.div`\n  ${({ theme }) => `\n    height: ${theme.gridUnit * 16}px;\n\n    border-top: ${theme.gridUnit / 4}px solid ${theme.colors.primary.light3};\n    padding: ${theme.gridUnit * 6}px;\n    margin: 0 0 0 ${-theme.gridUnit * 6}px;\n    text-align: right;\n\n    .btn {\n      margin-right: ${theme.gridUnit * 4}px;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  `}\n`;\n\nexport default class FilterScopeSelector extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    const { dashboardFilters, layout } = props;\n\n    if (Object.keys(dashboardFilters).length > 0) {\n      // display filter fields in tree structure\n      const filterFieldNodes = getFilterFieldNodesTree({\n        dashboardFilters,\n      });\n      // filterFieldNodes root node is dashboard_root component,\n      // so that we can offer a select/deselect all link\n      const filtersNodes = filterFieldNodes[0].children;\n      this.allfilterFields = [];\n      filtersNodes.forEach(({ children }) => {\n        children.forEach(child => {\n          this.allfilterFields.push(child.value);\n        });\n      });\n      this.defaultFilterKey = filtersNodes[0].children[0].value;\n\n      // build FilterScopeTree object for each filterKey\n      const filterScopeMap = Object.values(dashboardFilters).reduce(\n        (map, { chartId: filterId, columns }) => {\n          const filterScopeByChartId = Object.keys(columns).reduce(\n            (mapByChartId, columnName) => {\n              const filterKey = getDashboardFilterKey({\n                chartId: filterId,\n                column: columnName,\n              });\n              const nodes = getFilterScopeNodesTree({\n                components: layout,\n                filterFields: [filterKey],\n                selectedChartId: filterId,\n              });\n              const expanded = getFilterScopeParentNodes(nodes, 1);\n              // force display filter_box chart as unchecked, but show checkbox as disabled\n              const chartIdsInFilterScope = (\n                getChartIdsInFilterBoxScope({\n                  filterScope: dashboardFilters[filterId].scopes[columnName],\n                }) || []\n              ).filter(id => id !== filterId);\n\n              return {\n                ...mapByChartId,\n                [filterKey]: {\n                  // unfiltered nodes\n                  nodes,\n                  // filtered nodes in display if searchText is not empty\n                  nodesFiltered: [...nodes],\n                  checked: chartIdsInFilterScope,\n                  expanded,\n                },\n              };\n            },\n            {},\n          );\n\n          return {\n            ...map,\n            ...filterScopeByChartId,\n          };\n        },\n        {},\n      );\n\n      // initial state: active defaultFilerKey\n      const { chartId } = getChartIdAndColumnFromFilterKey(\n        this.defaultFilterKey,\n      );\n      const checkedFilterFields = [];\n      const activeFilterField = this.defaultFilterKey;\n      // expand defaultFilterKey in filter field tree\n      const expandedFilterIds = [ALL_FILTERS_ROOT].concat(chartId);\n\n      const filterScopeTreeEntry = buildFilterScopeTreeEntry({\n        checkedFilterFields,\n        activeFilterField,\n        filterScopeMap,\n        layout,\n      });\n      this.state = {\n        showSelector: true,\n        activeFilterField,\n        searchText: '',\n        filterScopeMap: {\n          ...filterScopeMap,\n          ...filterScopeTreeEntry,\n        },\n        filterFieldNodes,\n        checkedFilterFields,\n        expandedFilterIds,\n      };\n    } else {\n      this.state = {\n        showSelector: false,\n      };\n    }\n\n    this.filterNodes = this.filterNodes.bind(this);\n    this.onChangeFilterField = this.onChangeFilterField.bind(this);\n    this.onCheckFilterScope = this.onCheckFilterScope.bind(this);\n    this.onExpandFilterScope = this.onExpandFilterScope.bind(this);\n    this.onSearchInputChange = this.onSearchInputChange.bind(this);\n    this.onCheckFilterField = this.onCheckFilterField.bind(this);\n    this.onExpandFilterField = this.onExpandFilterField.bind(this);\n    this.onClose = this.onClose.bind(this);\n    this.onSave = this.onSave.bind(this);\n  }\n\n  onCheckFilterScope(checked = []) {\n    const { activeFilterField, filterScopeMap, checkedFilterFields } =\n      this.state;\n\n    const key = getKeyForFilterScopeTree({\n      activeFilterField,\n      checkedFilterFields,\n    });\n    const editingList = activeFilterField\n      ? [activeFilterField]\n      : checkedFilterFields;\n    const updatedEntry = {\n      ...filterScopeMap[key],\n      checked,\n    };\n\n    const updatedFilterScopeMap = getRevertedFilterScope({\n      checked,\n      filterFields: editingList,\n      filterScopeMap,\n    });\n\n    this.setState(() => ({\n      filterScopeMap: {\n        ...filterScopeMap,\n        ...updatedFilterScopeMap,\n        [key]: updatedEntry,\n      },\n    }));\n  }\n\n  onExpandFilterScope(expanded = []) {\n    const { activeFilterField, checkedFilterFields, filterScopeMap } =\n      this.state;\n    const key = getKeyForFilterScopeTree({\n      activeFilterField,\n      checkedFilterFields,\n    });\n    const updatedEntry = {\n      ...filterScopeMap[key],\n      expanded,\n    };\n    this.setState(() => ({\n      filterScopeMap: {\n        ...filterScopeMap,\n        [key]: updatedEntry,\n      },\n    }));\n  }\n\n  onCheckFilterField(checkedFilterFields = []) {\n    const { layout } = this.props;\n    const { filterScopeMap } = this.state;\n    const filterScopeTreeEntry = buildFilterScopeTreeEntry({\n      checkedFilterFields,\n      activeFilterField: null,\n      filterScopeMap,\n      layout,\n    });\n\n    this.setState(() => ({\n      activeFilterField: null,\n      checkedFilterFields,\n      filterScopeMap: {\n        ...filterScopeMap,\n        ...filterScopeTreeEntry,\n      },\n    }));\n  }\n\n  onExpandFilterField(expandedFilterIds = []) {\n    this.setState(() => ({\n      expandedFilterIds,\n    }));\n  }\n\n  onChangeFilterField(filterField = {}) {\n    const { layout } = this.props;\n    const nextActiveFilterField = filterField.value;\n    const {\n      activeFilterField: currentActiveFilterField,\n      checkedFilterFields,\n      filterScopeMap,\n    } = this.state;\n\n    // we allow single edit and multiple edit in the same view.\n    // if user click on the single filter field,\n    // will show filter scope for the single field.\n    // if user click on the same filter filed again,\n    // will toggle off the single filter field,\n    // and allow multi-edit all checked filter fields.\n    if (nextActiveFilterField === currentActiveFilterField) {\n      const filterScopeTreeEntry = buildFilterScopeTreeEntry({\n        checkedFilterFields,\n        activeFilterField: null,\n        filterScopeMap,\n        layout,\n      });\n\n      this.setState({\n        activeFilterField: null,\n        filterScopeMap: {\n          ...filterScopeMap,\n          ...filterScopeTreeEntry,\n        },\n      });\n    } else if (this.allfilterFields.includes(nextActiveFilterField)) {\n      const filterScopeTreeEntry = buildFilterScopeTreeEntry({\n        checkedFilterFields,\n        activeFilterField: nextActiveFilterField,\n        filterScopeMap,\n        layout,\n      });\n\n      this.setState({\n        activeFilterField: nextActiveFilterField,\n        filterScopeMap: {\n          ...filterScopeMap,\n          ...filterScopeTreeEntry,\n        },\n      });\n    }\n  }\n\n  onSearchInputChange(e) {\n    this.setState({ searchText: e.target.value }, this.filterTree);\n  }\n\n  onClose() {\n    this.props.onCloseModal();\n  }\n\n  onSave() {\n    const { filterScopeMap } = this.state;\n\n    const allFilterFieldScopes = this.allfilterFields.reduce(\n      (map, filterKey) => {\n        const { nodes } = filterScopeMap[filterKey];\n        const checkedChartIds = filterScopeMap[filterKey].checked;\n\n        return {\n          ...map,\n          [filterKey]: getFilterScopeFromNodesTree({\n            filterKey,\n            nodes,\n            checkedChartIds,\n          }),\n        };\n      },\n      {},\n    );\n\n    this.props.updateDashboardFiltersScope(allFilterFieldScopes);\n    this.props.setUnsavedChanges(true);\n\n    // click Save button will do save and close modal\n    this.props.onCloseModal();\n  }\n\n  filterTree() {\n    // Reset nodes back to unfiltered state\n    if (!this.state.searchText) {\n      this.setState(prevState => {\n        const { activeFilterField, checkedFilterFields, filterScopeMap } =\n          prevState;\n        const key = getKeyForFilterScopeTree({\n          activeFilterField,\n          checkedFilterFields,\n        });\n\n        const updatedEntry = {\n          ...filterScopeMap[key],\n          nodesFiltered: filterScopeMap[key].nodes,\n        };\n        return {\n          filterScopeMap: {\n            ...filterScopeMap,\n            [key]: updatedEntry,\n          },\n        };\n      });\n    } else {\n      const updater = prevState => {\n        const { activeFilterField, checkedFilterFields, filterScopeMap } =\n          prevState;\n        const key = getKeyForFilterScopeTree({\n          activeFilterField,\n          checkedFilterFields,\n        });\n\n        const nodesFiltered = filterScopeMap[key].nodes.reduce(\n          this.filterNodes,\n          [],\n        );\n        const expanded = getFilterScopeParentNodes([...nodesFiltered]);\n        const updatedEntry = {\n          ...filterScopeMap[key],\n          nodesFiltered,\n          expanded,\n        };\n\n        return {\n          filterScopeMap: {\n            ...filterScopeMap,\n            [key]: updatedEntry,\n          },\n        };\n      };\n\n      this.setState(updater);\n    }\n  }\n\n  filterNodes(filtered = [], node = {}) {\n    const { searchText } = this.state;\n    const children = (node.children || []).reduce(this.filterNodes, []);\n\n    if (\n      // Node's label matches the search string\n      node.label.toLocaleLowerCase().indexOf(searchText.toLocaleLowerCase()) >\n        -1 ||\n      // Or a children has a matching node\n      children.length\n    ) {\n      filtered.push({ ...node, children });\n    }\n\n    return filtered;\n  }\n\n  renderFilterFieldList() {\n    const {\n      activeFilterField,\n      filterFieldNodes,\n      checkedFilterFields,\n      expandedFilterIds,\n    } = this.state;\n    return (\n      <FilterFieldTree\n        activeKey={activeFilterField}\n        nodes={filterFieldNodes}\n        checked={checkedFilterFields}\n        expanded={expandedFilterIds}\n        onClick={this.onChangeFilterField}\n        onCheck={this.onCheckFilterField}\n        onExpand={this.onExpandFilterField}\n      />\n    );\n  }\n\n  renderFilterScopeTree() {\n    const {\n      filterScopeMap,\n      activeFilterField,\n      checkedFilterFields,\n      searchText,\n    } = this.state;\n\n    const key = getKeyForFilterScopeTree({\n      activeFilterField,\n      checkedFilterFields,\n    });\n\n    const selectedChartId = getSelectedChartIdForFilterScopeTree({\n      activeFilterField,\n      checkedFilterFields,\n    });\n    return (\n      <>\n        <input\n          className=\"filter-text scope-search multi-edit-mode\"\n          placeholder={t('Search...')}\n          type=\"text\"\n          value={searchText}\n          onChange={this.onSearchInputChange}\n        />\n        <FilterScopeTree\n          nodes={filterScopeMap[key].nodesFiltered}\n          checked={filterScopeMap[key].checked}\n          expanded={filterScopeMap[key].expanded}\n          onCheck={this.onCheckFilterScope}\n          onExpand={this.onExpandFilterScope}\n          // pass selectedFilterId prop to FilterScopeTree component,\n          // to hide checkbox for selected filter field itself\n          selectedChartId={selectedChartId}\n        />\n      </>\n    );\n  }\n\n  renderEditingFiltersName() {\n    const { dashboardFilters } = this.props;\n    const { activeFilterField, checkedFilterFields } = this.state;\n    const currentFilterLabels = []\n      .concat(activeFilterField || checkedFilterFields)\n      .map(key => {\n        const { chartId, column } = getChartIdAndColumnFromFilterKey(key);\n        return dashboardFilters[chartId].labels[column] || column;\n      });\n\n    return (\n      <div className=\"selected-fields multi-edit-mode\">\n        {currentFilterLabels.length === 0 && t('No filter is selected.')}\n        {currentFilterLabels.length === 1 && t('Editing 1 filter:')}\n        {currentFilterLabels.length > 1 &&\n          t('Batch editing %d filters:', currentFilterLabels.length)}\n        <span className=\"selected-scopes\">\n          {currentFilterLabels.join(', ')}\n        </span>\n      </div>\n    );\n  }\n\n  render() {\n    const { showSelector } = this.state;\n\n    return (\n      <ScopeContainer>\n        <ScopeHeader>\n          <h4>{t('Configure filter scopes')}</h4>\n          {showSelector && this.renderEditingFiltersName()}\n        </ScopeHeader>\n\n        <ScopeBody className=\"filter-scope-body\">\n          {!showSelector ? (\n            <div className=\"warning-message\">\n              {t('There are no filters in this dashboard.')}\n            </div>\n          ) : (\n            <ScopeSelector className=\"filters-scope-selector\">\n              <div className={cx('filter-field-pane multi-edit-mode')}>\n                {this.renderFilterFieldList()}\n              </div>\n              <div className=\"filter-scope-pane multi-edit-mode\">\n                {this.renderFilterScopeTree()}\n              </div>\n            </ScopeSelector>\n          )}\n        </ScopeBody>\n\n        <ActionsContainer>\n          <Button buttonSize=\"small\" onClick={this.onClose}>\n            {t('Close')}\n          </Button>\n          {showSelector && (\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              onClick={this.onSave}\n            >\n              {t('Save')}\n            </Button>\n          )}\n        </ActionsContainer>\n      </ScopeContainer>\n    );\n  }\n}\n\nFilterScopeSelector.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nimport { getDashboardFilterKey } from './getDashboardFilterKey';\nimport { ALL_FILTERS_ROOT } from './constants';\nimport { DASHBOARD_ROOT_TYPE } from './componentTypes';\n\nexport default function getFilterFieldNodesTree({ dashboardFilters = {} }) {\n  const allFilters = Object.values(dashboardFilters).map(dashboardFilter => {\n    const { chartId, filterName, columns, labels } = dashboardFilter;\n    const children = Object.keys(columns).map(column => ({\n      value: getDashboardFilterKey({ chartId, column }),\n      label: labels[column] || column,\n    }));\n    return {\n      value: chartId,\n      label: filterName,\n      children,\n      showCheckbox: true,\n    };\n  });\n\n  return [\n    {\n      value: ALL_FILTERS_ROOT,\n      type: DASHBOARD_ROOT_TYPE,\n      label: t('All filters'),\n      children: allFilters,\n    },\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getChartIdAndColumnFromFilterKey } from './getDashboardFilterKey';\n\ninterface FilterScopeMap {\n  [key: string]: number[];\n}\n\ninterface GetRevertFilterScopeProps {\n  checked: string[];\n  filterFields: string[];\n  filterScopeMap: FilterScopeMap;\n}\n\nexport default function getRevertedFilterScope({\n  checked = [],\n  filterFields = [],\n  filterScopeMap = {},\n}: GetRevertFilterScopeProps) {\n  const checkedChartIdsByFilterField = checked.reduce<FilterScopeMap>(\n    (map, value) => {\n      const [chartId, filterField] = value.split(':');\n      return {\n        ...map,\n        [filterField]: (map[filterField] || []).concat(parseInt(chartId, 10)),\n      };\n    },\n    {},\n  );\n\n  return filterFields.reduce<FilterScopeMap>((map, filterField) => {\n    const { chartId } = getChartIdAndColumnFromFilterKey(filterField);\n    // force display filter_box chart as unchecked, but show checkbox as disabled\n    const updatedCheckedIds = (\n      checkedChartIdsByFilterField[filterField] || []\n    ).filter(id => id !== chartId);\n\n    return {\n      ...map,\n      [filterField]: {\n        ...filterScopeMap[filterField],\n        checked: updatedCheckedIds,\n      },\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\n\nimport { updateDashboardFiltersScope } from '../actions/dashboardFilters';\nimport { setUnsavedChanges } from '../actions/dashboardState';\nimport FilterScopeSelector from '../components/filterscope/FilterScopeSelector';\n\nfunction mapStateToProps({ dashboardLayout, dashboardFilters }) {\n  return {\n    dashboardFilters,\n    layout: dashboardLayout.present,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators(\n    {\n      updateDashboardFiltersScope,\n      setUnsavedChanges,\n    },\n    dispatch,\n  );\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(FilterScopeSelector);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport ModalTrigger, { ModalTriggerRef } from 'src/components/ModalTrigger';\nimport FilterScope from 'src/dashboard/containers/FilterScope';\n\ntype FilterScopeModalProps = {\n  triggerNode: JSX.Element;\n};\n\nconst FilterScopeModalBody = styled.div(({ theme: { gridUnit } }) => ({\n  padding: gridUnit * 2,\n  paddingBottom: gridUnit * 3,\n}));\n\nexport default class FilterScopeModal extends React.PureComponent<\n  FilterScopeModalProps,\n  {}\n> {\n  modal: ModalTriggerRef;\n\n  constructor(props: FilterScopeModalProps) {\n    super(props);\n\n    this.modal = React.createRef() as ModalTriggerRef;\n    this.handleCloseModal = this.handleCloseModal.bind(this);\n  }\n\n  handleCloseModal(): void {\n    this?.modal?.current?.close?.();\n  }\n\n  render() {\n    const filterScopeProps = {\n      onCloseModal: this.handleCloseModal,\n    };\n\n    return (\n      <ModalTrigger\n        ref={this.modal}\n        triggerNode={this.props.triggerNode}\n        modalBody={\n          <FilterScopeModalBody>\n            <FilterScope {...filterScopeProps} />\n          </FilterScopeModalBody>\n        }\n        width=\"80%\"\n      />\n    );\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\nimport { BACKGROUND_TRANSPARENT, BACKGROUND_WHITE } from './constants';\n\nexport default [\n  {\n    value: BACKGROUND_TRANSPARENT,\n    label: t('Transparent'),\n    className: 'background--transparent',\n  },\n  {\n    value: BACKGROUND_WHITE,\n    label: t('White'),\n    className: 'background--white',\n  },\n];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\nimport { SMALL_HEADER, MEDIUM_HEADER, LARGE_HEADER } from './constants';\n\nexport default [\n  {\n    value: SMALL_HEADER,\n    label: t('Small'),\n    className: 'header-style-option header-small',\n  },\n  {\n    value: MEDIUM_HEADER,\n    label: t('Medium'),\n    className: 'header-style-option header-medium',\n  },\n  {\n    value: LARGE_HEADER,\n    label: t('Large'),\n    className: 'header-style-option header-large',\n  },\n];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { EffectCallback, useEffect } from 'react';\n\nexport const useComponentDidMount = (effect: EffectCallback) => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(effect, []);\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { JsonObject, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport Tag from 'src/types/TagType';\n\nexport const OBJECT_TYPES_VALUES = Object.freeze([\n  'dashboard',\n  'chart',\n  'saved_query',\n]);\n\nexport const OBJECT_TYPES = Object.freeze({\n  DASHBOARD: 'dashboard',\n  CHART: 'chart',\n  QUERY: 'saved_query',\n});\n\nconst OBJECT_TYPE_ID_MAP = {\n  saved_query: 1,\n  chart: 2,\n  dashboard: 3,\n};\n\nconst map_object_type_to_id = (objectType: string) => {\n  if (!OBJECT_TYPES_VALUES.includes(objectType)) {\n    const msg = `objectType ${objectType} is invalid`;\n    throw new Error(msg);\n  }\n  return OBJECT_TYPE_ID_MAP[objectType];\n};\n\nexport function fetchAllTags(\n  callback: (json: JsonObject) => void,\n  error: (response: Response) => void,\n) {\n  SupersetClient.get({ endpoint: `/api/v1/tag` })\n    .then(({ json }) => callback(json))\n    .catch(response => error(response));\n}\n\nexport function fetchTags(\n  {\n    objectType,\n    objectId,\n    includeTypes = false,\n  }: {\n    objectType: string;\n    objectId: number;\n    includeTypes: boolean;\n  },\n  callback: (json: JsonObject) => void,\n  error: (response: Response) => void,\n) {\n  if (objectType === undefined || objectId === undefined) {\n    throw new Error('Need to specify objectType and objectId');\n  }\n  if (!OBJECT_TYPES_VALUES.includes(objectType)) {\n    const msg = `objectType ${objectType} is invalid`;\n    throw new Error(msg);\n  }\n  SupersetClient.get({\n    endpoint: `/api/v1/${objectType}/${objectId}`,\n  })\n    .then(({ json }) =>\n      callback(\n        json.result.tags.filter(\n          (tag: Tag) => tag.name.indexOf(':') === -1 || includeTypes,\n        ),\n      ),\n    )\n    .catch(response => error(response));\n}\nexport function deleteTaggedObjects(\n  { objectType, objectId }: { objectType: string; objectId: number },\n  tag: Tag,\n  callback: (text: string) => void,\n  error: (response: string) => void,\n) {\n  if (objectType === undefined || objectId === undefined) {\n    throw new Error('Need to specify objectType and objectId');\n  }\n  if (!OBJECT_TYPES_VALUES.includes(objectType)) {\n    const msg = `objectType ${objectType} is invalid`;\n    throw new Error(msg);\n  }\n  SupersetClient.delete({\n    endpoint: `/api/v1/tag/${map_object_type_to_id(objectType)}/${objectId}/${\n      tag.name\n    }`,\n  })\n    .then(({ json }) =>\n      json\n        ? callback(JSON.stringify(json))\n        : callback('Successfully Deleted Tagged Objects'),\n    )\n    .catch(response => {\n      const err_str = response.message;\n      return err_str ? error(err_str) : error('Error Deleting Tagged Objects');\n    });\n}\n\nexport function deleteTags(\n  tags: Tag[],\n  callback: (text: string) => void,\n  error: (response: string) => void,\n) {\n  const tag_names = tags.map(tag => tag.name) as string[];\n  SupersetClient.delete({\n    endpoint: `/api/v1/tag/?q=${rison.encode(tag_names)}`,\n  })\n    .then(({ json }) =>\n      json.message\n        ? callback(json.message)\n        : callback('Successfully Deleted Tag'),\n    )\n    .catch(response => {\n      const err_str = response.message;\n      return err_str ? error(err_str) : error('Error Deleting Tag');\n    });\n}\n\nexport function addTag(\n  {\n    objectType,\n    objectId,\n    includeTypes = false,\n  }: {\n    objectType: string;\n    objectId: number;\n    includeTypes: boolean;\n  },\n  tag: string,\n  callback: (text: string) => void,\n  error: (response: Response) => void,\n) {\n  if (objectType === undefined || objectId === undefined) {\n    throw new Error('Need to specify objectType and objectId');\n  }\n  if (tag.indexOf(':') !== -1 && !includeTypes) {\n    return;\n  }\n  const objectTypeId = map_object_type_to_id(objectType);\n  SupersetClient.post({\n    endpoint: `/api/v1/tag/${objectTypeId}/${objectId}/`,\n    body: JSON.stringify({\n      properties: {\n        tags: [tag],\n      },\n    }),\n    parseMethod: 'json',\n    headers: { 'Content-Type': 'application/json' },\n  })\n    .then(({ json }) => callback(JSON.stringify(json)))\n    .catch(response => error(response));\n}\n\nexport function fetchObjects(\n  { tags = '', types }: { tags: string; types: string | null },\n  callback: (json: JsonObject) => void,\n  error: (response: Response) => void,\n) {\n  let url = `/api/v1/tag/get_objects/?tags=${tags}`;\n  if (types) {\n    url += `&types=${types}`;\n  }\n  SupersetClient.get({ endpoint: url })\n    .then(({ json }) => callback(json.result))\n    .catch(response => error(response));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport const cacheWrapper =\n  <T extends Array<any>, U>(\n    fn: (...args: T) => U,\n    cache: Map<string, any>,\n    keyFn: (...args: T) => string = (...args: T) => JSON.stringify([...args]),\n  ) =>\n  (...args: T): U => {\n    const key = keyFn(...args);\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    const result = fn(...args);\n    cache.set(key, result);\n    return result;\n  };\n"],"names":["componentShape","PropTypes","id","type","Object","values","componentTypes","isRequired","parents","children","meta","width","height","headerSize","headerStyleOptions","opt","value","background","backgroundStyleOptions","chartId","chartPropShape","chartAlert","chartStatus","chartUpdateEndTime","chartUpdateStartTime","latestQueryFormData","queryController","abort","queriesResponse","triggerQuery","lastRendered","slicePropShape","slice_id","slice_url","slice_name","datasource","datasource_name","datasource_link","changed_on","modified","viz_type","description","description_markeddown","owners","dashboardFilterPropShape","componentId","filterName","datasourceId","directPathToFilter","isDateFilter","isInstantFilter","columns","labels","scopes","dashboardStatePropShape","sliceIds","expandedSlices","editMode","isPublished","colorNamespace","colorScheme","updatedColorScheme","hasUnsavedChanges","dashboardInfoPropShape","metadata","slug","dash_edit_perm","dash_save_perm","common","userId","leafType","label","parentShape","f","apply","arguments","filterScopeSelectorTreeNodePropShape","certifiedBy","details","size","theme","useTheme","title","t","iconColor","colors","primary","base","iconSize","StyledDiv","styled","grayscale","DescriptionContainer","DeleteModal","onConfirm","onHide","open","disableChange","setDisableChange","useState","confirmation","setConfirmation","confirm","disablePrimaryButton","onHandledPrimaryAction","primaryButtonName","primaryButtonType","show","htmlFor","autoComplete","onChange","event","targetValue","target","toUpperCase","onPressEnter","StyledLink","css","typography","sizes","xl","gridUnit","itemId","isStarred","showTooltip","saveFaveStar","fetchFaveStar","useComponentDidMount","onClick","useCallback","e","preventDefault","content","href","className","role","ImageContainer","src","position","ImageLoader","fallback","isLoading","rest","imgSrc","setImgSrc","useEffect","fetch","then","response","blob","test","imgURL","URL","createObjectURL","catch","errMsg","logging","localCache","Map","cachedSupersetGet","cacheWrapper","SupersetClient","endpoint","tagToSelectOption","item","name","key","loadTags","async","search","page","pageSize","searchColumn","query","rison","filters","col","opr","page_size","order_column","order_direction","data","json","result","filter","map","totalCount","count","error","errorMessage","message","errorText","getErrorMessage","getClientErrorObject","Error","propTypes","labelMargin","hasCustomLabelColors","ColorSchemeControlWrapper","React","constructor","props","super","this","state","hovered","categoricalSchemeRegistry","getCategoricalSchemeRegistry","choices","keys","s","schemes","getMap","setHover","setState","render","ColorSchemeControl","clearable","defaultProps","undefined","StyledFormItem","FormItem","StyledJsonEditor","JsonEditor","borderRadius","secondary","light2","withToasts","addSuccessToast","addDangerToast","currentColorScheme","dashboardId","dashboardInfo","currentDashboardInfo","dashboardTitle","onlyApply","onSubmit","form","AntdForm","setIsLoading","isAdvancedOpen","setIsAdvancedOpen","setColorScheme","jsonMetadata","setJsonMetadata","setDashboardInfo","setOwners","roles","setRoles","saveLabel","tags","setTags","tagsAsSelectValues","useMemo","tag","length","handleErrorResponse","statusText","json_metadata","Modal","okButtonProps","danger","loadAccessOptions","accessType","input","extra","active","text","handleDashboardData","dashboardData","dashboard_title","certified_by","certification_details","is_managed_externally","certificationDetails","isManagedExternally","setFieldsValue","color_scheme","positions","metaDataCopy","shared_label_colors","color_scheme_domain","jsonStringify","fetchDashboardDetails","dashboard","jsonMetadataObj","JSON","parse","getJsonMetadata","_","handleOnChangeOwners","parsedOwners","ensureIsArray","o","full_name","handleOnChangeRoles","parsedRoles","r","handleOwnersSelectValue","owner","first_name","last_name","onColorSchemeChange","updateMetadata","colorChoices","label_colors","isFeatureEnabled","FeatureFlag","fetchTags","objectType","OBJECT_TYPES","objectId","includeTypes","footer","Button","htmlType","buttonSize","cta","submit","buttonStyle","disabled","tooltip","responsive","onFinish","getFieldsValue","currentJsonMetadata","startsWith","endsWith","color_namespace","sharedLabelColor","getSharedLabelColor","CategoricalColorNamespace","getNamespace","resetColors","updateColorMap","fromEntries","getColorMap","get","reset","currentTags","updateTags","oldTags","newTags","some","addTag","deleteTaggedObjects","moreOnSubmitProps","morePutProps","onSubmitProps","headers","body","stringify","layout","initialValues","xs","md","gutter","Form","Input","style","marginTop","allowClear","allowNewOptions","ariaLabel","mode","options","getRowsWithRoles","getRowsWithoutRoles","uniqueTags","Set","v","minWidth","showLoadingForImport","tabSize","wrapEnabled","FilterScopeModal","triggerNode","menuName","FILTER_SCOPE_CONTAINER_TYPES","TAB_TYPE","DASHBOARD_ROOT_TYPE","traverse","currentNode","components","filterFields","selectedChartId","CHART_TYPE","chartNode","sliceName","showCheckbox","filterField","forEach","child","childNodeTree","childType","push","concat","getFilterScopeNodesTree","DASHBOARD_ROOT_ID","getFilterScopeParentNodes","nodes","depthLimit","parentNodes","depth","node","getKeyForFilterScopeTree","activeFilterField","checkedFilterFields","safeStringify","getSelectedChartIdForFilterScopeTree","getChartIdAndColumnFromFilterKey","filterKey","buildFilterScopeTreeEntry","filterScopeMap","editingList","checkedChartIdSet","checked","add","expanded","nodesFiltered","getTabChildrenScope","tabScopes","parentNodeValue","forceAggregate","hasChartSiblings","tabChildren","immuneChartSiblings","entries","every","scope","immuneChartIdsFromTabsNotInScope","tabs","tabsInScope","chartsNotInScope","tab","subTab","subTabChildren","getImmuneChartIdsFromTabsNotInScope","immuneChartIdsFromTabsInScope","immune","componentsInScope","filterId","checkedChartIds","currentValue","chartChildren","chartsImmune","getFilterScopeFromNodesTree","ChartIcon","Icons","updatedChildren","cx","toLowerCase","renderFilterScopeTreeNodes","check","uncheck","halfCheck","expandClose","expandOpen","expandAll","collapseAll","parentClose","parentOpen","leaf","onCheck","onExpand","NOOP","FilterScopeTree","showExpandAll","expandOnClick","showNodeIcon","icons","treeIcons","isSelected","FilterFieldItem","renderFilterFieldTreeNodes","activeKey","root","FilterFieldTree","dashboardFilters","updateDashboardFiltersScope","setUnsavedChanges","onCloseModal","ScopeContainer","m","ScopeBody","ScopeHeader","ScopeSelector","families","sansSerif","weights","normal","light4","bold","dark1","light3","ActionsContainer","FilterScopeSelector","filterFieldNodes","allFilters","dashboardFilter","column","getDashboardFilterKey","ALL_FILTERS_ROOT","getFilterFieldNodesTree","filtersNodes","allfilterFields","defaultFilterKey","reduce","mapByChartId","columnName","chartIdsInFilterScope","getChartIdsInFilterBoxScope","filterScope","expandedFilterIds","filterScopeTreeEntry","showSelector","searchText","filterNodes","bind","onChangeFilterField","onCheckFilterScope","onExpandFilterScope","onSearchInputChange","onCheckFilterField","onExpandFilterField","onClose","onSave","updatedEntry","updatedFilterScopeMap","checkedChartIdsByFilterField","split","parseInt","updatedCheckedIds","getRevertedFilterScope","nextActiveFilterField","currentActiveFilterField","filterTree","allFilterFieldScopes","updater","prevState","filtered","toLocaleLowerCase","indexOf","renderFilterFieldList","renderFilterScopeTree","placeholder","renderEditingFiltersName","currentFilterLabels","join","connect","dashboardLayout","present","dispatch","bindActionCreators","FilterScopeModalBody","padding","paddingBottom","modal","handleCloseModal","current","close","filterScopeProps","ModalTrigger","ref","modalBody","FilterScope","BACKGROUND_TRANSPARENT","BACKGROUND_WHITE","SMALL_HEADER","MEDIUM_HEADER","LARGE_HEADER","effect","OBJECT_TYPES_VALUES","freeze","DASHBOARD","CHART","QUERY","OBJECT_TYPE_ID_MAP","saved_query","chart","map_object_type_to_id","callback","err_str","deleteTags","tag_names","objectTypeId","properties","parseMethod","fetchObjects","types","url","fn","cache","keyFn","args","has","set"],"sourceRoot":""}