{"version":3,"file":"f29b8f3dc3716ccd1769.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/src/Calendar.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/extent.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/range.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx","webpack://superset/./packages/superset-ui-core/src/chart/components/reactify.tsx"],"sourcesContent":["// [LICENSE TBD]\n/* Copied and altered from http://cal-heatmap.com/ , alterations around:\n * - tuning tooltips\n * - supporting multi-colors scales\n * - legend format\n * - UTC handling\n */\n\n/* eslint-disable */\n\nimport d3tip from 'd3-tip';\nimport { getContrastingColor, t } from '@superset-ui/core';\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar CalHeatMap = function () {\n  'use strict';\n\n  var self = this;\n  self.tip = d3tip()\n    .attr('class', 'd3-tip')\n    .direction('n')\n    .offset([-5, 0])\n    .html(\n      d => `\n      ${self.options.timeFormatter(d.t)}: <strong>${self.options.valueFormatter(\n        d.v,\n      )}</strong>\n    `,\n    );\n  self.legendTip = d3tip()\n    .attr('class', 'd3-tip')\n    .direction('n')\n    .offset([-5, 0])\n    .html(d => self.options.valueFormatter(d));\n\n  this.allowedDataType = ['json', 'csv', 'tsv', 'txt'];\n\n  // Default settings\n  this.options = {\n    // selector string of the container to append the graph to\n    // Accept any string value accepted by document.querySelector or CSS3\n    // or an Element object\n    itemSelector: '#cal-heatmap',\n\n    // Whether to paint the calendar on init()\n    // Used by testsuite to reduce testing time\n    paintOnLoad: true,\n\n    // ================================================\n    // DOMAIN\n    // ================================================\n\n    // Number of domain to display on the graph\n    range: 12,\n\n    // Size of each cell, in pixel\n    cellSize: 10,\n\n    // Padding between each cell, in pixel\n    cellPadding: 2,\n\n    // For rounded subdomain rectangles, in pixels\n    cellRadius: 0,\n\n    domainGutter: 2,\n\n    domainMargin: [0, 0, 0, 0],\n\n    valueFormatter: d => d,\n\n    timeFormatter: d => d,\n\n    domain: 'hour',\n\n    subDomain: 'min',\n\n    // Number of columns to split the subDomains to\n    // If not null, will takes precedence over rowLimit\n    colLimit: null,\n\n    // Number of rows to split the subDomains to\n    // Will be ignored if colLimit is not null\n    rowLimit: null,\n\n    // First day of the week is Monday\n    // 0 to start the week on Sunday\n    weekStartOnMonday: true,\n\n    // Start date of the graph\n    // @default now\n    start: new Date(),\n\n    minDate: null,\n\n    maxDate: null,\n\n    // ================================================\n    // DATA\n    // ================================================\n\n    // Data source\n    // URL, where to fetch the original datas\n    data: '',\n\n    // Data type\n    // Default: json\n    dataType: this.allowedDataType[0],\n\n    // Payload sent when using POST http method\n    // Leave to null (default) for GET request\n    // Expect a string, formatted like \"a=b;c=d\"\n    dataPostPayload: null,\n\n    // Additional headers sent when requesting data\n    // Expect an object formatted like:\n    // { 'X-CSRF-TOKEN': 'token' }\n    dataRequestHeaders: null,\n\n    // Whether to consider missing date:value from the datasource\n    // as equal to 0, or just leave them as missing\n    considerMissingDataAsZero: false,\n\n    // Load remote data on calendar creation\n    // When false, the calendar will be left empty\n    loadOnInit: true,\n\n    // Calendar orientation\n    // false: display domains side by side\n    // true : display domains one under the other\n    verticalOrientation: false,\n\n    // Domain dynamic width/height\n    // The width on a domain depends on the number of\n    domainDynamicDimension: true,\n\n    // Domain Label properties\n    label: {\n      // valid: top, right, bottom, left\n      position: 'bottom',\n\n      // Valid: left, center, right\n      // Also valid are the direct svg values: start, middle, end\n      align: 'center',\n\n      // By default, there is no margin/padding around the label\n      offset: {\n        x: 0,\n        y: 0,\n      },\n\n      rotate: null,\n\n      // Used only on vertical orientation\n      width: 100,\n\n      // Used only on horizontal orientation\n      height: null,\n    },\n\n    // ================================================\n    // LEGEND\n    // ================================================\n\n    // Threshold for the legend\n    legend: [10, 20, 30, 40],\n\n    // Whether to display the legend\n    displayLegend: true,\n\n    legendCellSize: 10,\n\n    legendCellPadding: 2,\n\n    legendMargin: [0, 0, 0, 0],\n\n    // Legend vertical position\n    // top: place legend above calendar\n    // bottom: place legend below the calendar\n    legendVerticalPosition: 'bottom',\n\n    // Legend horizontal position\n    // accepted values: left, center, right\n    legendHorizontalPosition: 'left',\n\n    // Legend rotation\n    // accepted values: horizontal, vertical\n    legendOrientation: 'horizontal',\n\n    // Objects holding all the heatmap different colors\n    // null to disable, and use the default css styles\n    //\n    // Examples:\n    // legendColors: {\n    //    min: \"green\",\n    //    max: \"red\",\n    //    empty: \"#ffffff\",\n    //    base: \"grey\",\n    //    overflow: \"red\",\n    //    colorScaler: null,\n    // }\n    legendColors: null,\n\n    // ================================================\n    // HIGHLIGHT\n    // ================================================\n\n    // List of dates to highlight\n    // Valid values:\n    // - []: don't highlight anything\n    // - \"now\": highlight the current date\n    // - an array of Date objects: highlight the specified dates\n    highlight: [],\n\n    // ================================================\n    // TEXT FORMATTING / i18n\n    // ================================================\n\n    // Name of the items to represent in the calendar\n    itemName: ['item', 'items'],\n\n    // Formatting of the domain label\n    // @default: null, will use the formatting according to domain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    domainLabelFormat: null,\n\n    // Formatting of the title displayed when hovering a subDomain cell\n    subDomainTitleFormat: {\n      empty: '{date}',\n      filled: '{count} {name} {connector} {date}',\n    },\n\n    // Formatting of the {date} used in subDomainTitleFormat\n    // @default: null, will use the formatting according to subDomain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainDateFormat: null,\n\n    // Formatting of the text inside each subDomain cell\n    // @default: null, no text\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainTextFormat: null,\n\n    // Formatting of the title displayed when hovering a legend cell\n    legendTitleFormat: {\n      lower: t('less than {min} {name}'),\n      inner: t('between {down} and {up} {name}'),\n      upper: t('more than {max} {name}'),\n    },\n\n    // Animation duration, in ms\n    animationDuration: 500,\n\n    nextSelector: false,\n\n    previousSelector: false,\n\n    itemNamespace: 'cal-heatmap',\n\n    tooltip: false,\n\n    // ================================================\n    // EVENTS CALLBACK\n    // ================================================\n\n    // Callback when clicking on a time block\n    onClick: null,\n\n    // Callback after painting the empty calendar\n    // Can be used to trigger an API call, once the calendar is ready to be filled\n    afterLoad: null,\n\n    // Callback after loading the next domain in the calendar\n    afterLoadNextDomain: null,\n\n    // Callback after loading the previous domain in the calendar\n    afterLoadPreviousDomain: null,\n\n    // Callback after finishing all actions on the calendar\n    onComplete: null,\n\n    // Callback after fetching the datas, but before applying them to the calendar\n    // Used mainly to convert the datas if they're not formatted like expected\n    // Takes the fetched \"data\" object as argument, must return a json object\n    // formatted like {timestamp:count, timestamp2:count2},\n    afterLoadData: function (data) {\n      return data;\n    },\n\n    // Callback triggered after calling and completing update().\n    afterUpdate: null,\n\n    // Callback triggered after calling next().\n    // The `status` argument is equal to true if there is no\n    // more next domain to load\n    //\n    // This callback is also executed once, after calling previous(),\n    // only when the max domain is reached\n    onMaxDomainReached: null,\n\n    // Callback triggered after calling previous().\n    // The `status` argument is equal to true if there is no\n    // more previous domain to load\n    //\n    // This callback is also executed once, after calling next(),\n    // only when the min domain is reached\n    onMinDomainReached: null,\n  };\n\n  this._domainType = {\n    min: {\n      name: 'minute',\n      level: 10,\n      maxItemNumber: 60,\n      defaultRowNumber: 10,\n      defaultColumnNumber: 6,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMinutes() / self._domainType.min.row(d));\n        },\n        y: function (d) {\n          return d.getMinutes() % self._domainType.min.row(d);\n        },\n      },\n      format: {\n        date: '%H:%M, %A %B %-e, %Y',\n        legend: '',\n        connector: 'at',\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours(),\n          d.getMinutes(),\n        ).getTime();\n      },\n    },\n    hour: {\n      name: 'hour',\n      level: 20,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 24;\n          case 'week':\n            return 24 * 7;\n          case 'month':\n            return (\n              24 *\n              (self.options.domainDynamicDimension\n                ? self.getDayCountInMonth(d)\n                : 31)\n            );\n        }\n      },\n      defaultRowNumber: 6,\n      defaultColumnNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 4;\n          case 'week':\n            return 28;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInMonth(d)\n              : 31;\n        }\n      },\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          if (self.options.domain === 'month') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + (d.getDate() - 1) * 24) /\n                  self._domainType.hour.row(d),\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              (d.getDate() - 1) * 4\n            );\n          } else if (self.options.domain === 'week') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + self.getWeekDay(d) * 24) /\n                  self._domainType.hour.row(d),\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              self.getWeekDay(d) * 4\n            );\n          }\n          return Math.floor(d.getHours() / self._domainType.hour.row(d));\n        },\n        y: function (d) {\n          var p = d.getHours();\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'month':\n                p += (d.getDate() - 1) * 24;\n                break;\n              case 'week':\n                p += self.getWeekDay(d) * 24;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.hour.row(d));\n        },\n      },\n      format: {\n        date: '%Hh, %A %B %-e, %Y',\n        legend: '%H:00',\n        connector: 'at',\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours(),\n        ).getTime();\n      },\n    },\n    day: {\n      name: 'day',\n      level: 30,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'week':\n            return 7;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInMonth(d)\n              : 31;\n          case 'year':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInYear(d)\n              : 366;\n        }\n      },\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'week':\n            return 1;\n          case 'month':\n            return self.options.domainDynamicDimension &&\n              !self.options.verticalOrientation\n              ? self.getWeekNumber(\n                  new Date(d.getFullYear(), d.getMonth() + 1, 0),\n                ) -\n                  self.getWeekNumber(d) +\n                  1\n              : 6;\n          case 'year':\n            return self.options.domainDynamicDimension\n              ? self.getWeekNumber(new Date(d.getFullYear(), 11, 31)) -\n                  self.getWeekNumber(new Date(d.getFullYear(), 0)) +\n                  1\n              : 54;\n        }\n      },\n      defaultRowNumber: 7,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'week':\n              return Math.floor(\n                self.getWeekDay(d) / self._domainType.day.row(d),\n              );\n            case 'month':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (d.getDate() - 1) / self._domainType.day.row(d),\n                );\n              }\n              return (\n                self.getWeekNumber(d) -\n                self.getWeekNumber(new Date(d.getFullYear(), d.getMonth()))\n              );\n            case 'year':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (self.getDayOfYear(d) - 1) / self._domainType.day.row(d),\n                );\n              }\n              return self.getWeekNumber(d);\n          }\n        },\n        y: function (d) {\n          var p = self.getWeekDay(d);\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'year':\n                p = self.getDayOfYear(d) - 1;\n                break;\n              case 'week':\n                p = self.getWeekDay(d);\n                break;\n              case 'month':\n                p = d.getDate() - 1;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.day.row(d));\n        },\n      },\n      format: {\n        date: '%A %B %-e, %Y',\n        legend: '%e %b',\n        connector: 'on',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime();\n      },\n    },\n    week: {\n      name: 'week',\n      level: 40,\n      maxItemNumber: 54,\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'year':\n            return self._domainType.week.maxItemNumber;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getWeekNumber(\n                  new Date(d.getFullYear(), d.getMonth() + 1, 0),\n                ) - self.getWeekNumber(d)\n              : 5;\n        }\n      },\n      defaultRowNumber: 1,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'year':\n              return Math.floor(\n                self.getWeekNumber(d) / self._domainType.week.row(d),\n              );\n            case 'month':\n              return Math.floor(\n                self.getMonthWeekNumber(d) / self._domainType.week.row(d),\n              );\n          }\n        },\n        y: function (d) {\n          return self.getWeekNumber(d) % self._domainType.week.row(d);\n        },\n      },\n      format: {\n        date: '%B Week #%W',\n        legend: '%B Week #%W',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        var dt = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        // According to ISO-8601, week number computation are based on week starting on Monday\n        var weekDay = dt.getDay() - (self.options.weekStartOnMonday ? 1 : 0);\n        if (weekDay < 0) {\n          weekDay = 6;\n        }\n        dt.setDate(dt.getDate() - weekDay);\n        return dt.getTime();\n      },\n    },\n    month: {\n      name: 'month',\n      level: 50,\n      maxItemNumber: 12,\n      defaultColumnNumber: 12,\n      defaultRowNumber: 1,\n      row: function () {\n        return self.getSubDomainRowNumber();\n      },\n      column: function () {\n        return self.getSubDomainColumnNumber();\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMonth() / self._domainType.month.row(d));\n        },\n        y: function (d) {\n          return d.getMonth() % self._domainType.month.row(d);\n        },\n      },\n      format: {\n        date: '%B %Y',\n        legend: '%B',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth()).getTime();\n      },\n    },\n    year: {\n      name: 'year',\n      level: 60,\n      row: function () {\n        return self.options.rowLimit || 1;\n      },\n      column: function () {\n        return self.options.colLimit || 1;\n      },\n      position: {\n        x: function () {\n          return 1;\n        },\n        y: function () {\n          return 1;\n        },\n      },\n      format: {\n        date: '%Y',\n        legend: '%Y',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear()).getTime();\n      },\n    },\n  };\n\n  for (var type in this._domainType) {\n    if (this._domainType.hasOwnProperty(type)) {\n      var d = this._domainType[type];\n      this._domainType['x_' + type] = {\n        name: 'x_' + type,\n        level: d.type,\n        maxItemNumber: d.maxItemNumber,\n        defaultRowNumber: d.defaultRowNumber,\n        defaultColumnNumber: d.defaultColumnNumber,\n        row: d.column,\n        column: d.row,\n        position: {\n          x: d.position.y,\n          y: d.position.x,\n        },\n        format: d.format,\n        extractUnit: d.extractUnit,\n      };\n    }\n  }\n\n  // Record the address of the last inserted domain when browsing\n  this.lastInsertedSvg = null;\n\n  this._completed = false;\n\n  // Record all the valid domains\n  // Each domain value is a timestamp in milliseconds\n  this._domains = d3.map();\n\n  this.graphDim = {\n    width: 0,\n    height: 0,\n  };\n\n  this.legendDim = {\n    width: 0,\n    height: 0,\n  };\n\n  this.NAVIGATE_LEFT = 1;\n  this.NAVIGATE_RIGHT = 2;\n\n  // Various update mode when using the update() API\n  this.RESET_ALL_ON_UPDATE = 0;\n  this.RESET_SINGLE_ON_UPDATE = 1;\n  this.APPEND_ON_UPDATE = 2;\n\n  this.DEFAULT_LEGEND_MARGIN = 10;\n\n  this.root = null;\n  this.tooltip = null;\n\n  this._maxDomainReached = false;\n  this._minDomainReached = false;\n\n  this.domainPosition = new DomainPosition();\n  this.Legend = null;\n  this.legendScale = null;\n\n  // List of domains that are skipped because of DST\n  // All times belonging to these domains should be re-assigned to the previous domain\n  this.DSTDomain = [];\n\n  /**\n   * Display the graph for the first time\n   * @return bool True if the calendar is created\n   */\n  this._init = function () {\n    self\n      .getDomain(self.options.start)\n      .map(function (d) {\n        return d.getTime();\n      })\n      .map(function (d) {\n        self._domains.set(\n          d,\n          self.getSubDomain(d).map(function (d) {\n            return {\n              t: self._domainType[self.options.subDomain].extractUnit(d),\n              v: null,\n            };\n          }),\n        );\n      });\n\n    self.root = d3\n      .select(self.options.itemSelector)\n      .append('svg')\n      .attr('class', 'cal-heatmap-container');\n\n    self.root.attr('x', 0).attr('y', 0).append('svg').attr('class', 'graph');\n\n    self.Legend = new Legend(self);\n\n    if (self.options.paintOnLoad) {\n      _initCalendar();\n    }\n    self.root.call(self.tip);\n    self.root.call(self.legendTip);\n\n    return true;\n  };\n\n  function _initCalendar() {\n    self.verticalDomainLabel =\n      self.options.label.position === 'top' ||\n      self.options.label.position === 'bottom';\n\n    self.domainVerticalLabelHeight =\n      self.options.label.height === null\n        ? Math.max(25, self.options.cellSize * 2)\n        : self.options.label.height;\n    self.domainHorizontalLabelWidth = 0;\n\n    if (\n      self.options.domainLabelFormat === '' &&\n      self.options.label.height === null\n    ) {\n      self.domainVerticalLabelHeight = 0;\n    }\n\n    if (!self.verticalDomainLabel) {\n      self.domainVerticalLabelHeight = 0;\n      self.domainHorizontalLabelWidth = self.options.label.width;\n    }\n\n    self.paint();\n\n    // =========================================================================//\n    // ATTACHING DOMAIN NAVIGATION EVENT                    //\n    // =========================================================================//\n    if (self.options.nextSelector !== false) {\n      d3.select(self.options.nextSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadNextDomain(1);\n        },\n      );\n    }\n\n    if (self.options.previousSelector !== false) {\n      d3.select(self.options.previousSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadPreviousDomain(1);\n        },\n      );\n    }\n\n    self.Legend.redraw(\n      self.graphDim.width -\n        self.options.domainGutter -\n        self.options.cellPadding,\n    );\n    self.afterLoad();\n\n    var domains = self.getDomainKeys();\n\n    // Fill the graph with some datas\n    if (self.options.loadOnInit) {\n      self.getDatas(\n        self.options.data,\n        new Date(domains[0]),\n        self.getSubDomain(domains[domains.length - 1]).pop(),\n        function () {\n          self.fill();\n          self.onComplete();\n        },\n      );\n    } else {\n      self.onComplete();\n    }\n\n    self.checkIfMinDomainIsReached(domains[0]);\n    self.checkIfMaxDomainIsReached(self.getNextDomain().getTime());\n  }\n\n  // Return the width of the domain block, without the domain gutter\n  // @param int d Domain start timestamp\n  function w(d, outer) {\n    var width =\n      self.options.cellSize *\n        self._domainType[self.options.subDomain].column(d) +\n      self.options.cellPadding *\n        self._domainType[self.options.subDomain].column(d);\n    if (arguments.length === 2 && outer === true) {\n      return (width +=\n        self.domainHorizontalLabelWidth +\n        self.options.domainGutter +\n        self.options.domainMargin[1] +\n        self.options.domainMargin[3]);\n    }\n    return width;\n  }\n\n  // Return the height of the domain block, without the domain gutter\n  function h(d, outer) {\n    var height =\n      self.options.cellSize * self._domainType[self.options.subDomain].row(d) +\n      self.options.cellPadding *\n        self._domainType[self.options.subDomain].row(d);\n    if (arguments.length === 2 && outer === true) {\n      height +=\n        self.options.domainGutter +\n        self.domainVerticalLabelHeight +\n        self.options.domainMargin[0] +\n        self.options.domainMargin[2];\n    }\n    return height;\n  }\n\n  /**\n   *\n   *\n   * @param int navigationDir\n   */\n  this.paint = function (navigationDir) {\n    var options = self.options;\n\n    if (arguments.length === 0) {\n      navigationDir = false;\n    }\n\n    // Painting all the domains\n    var domainSvg = self.root\n      .select('.graph')\n      .selectAll('.graph-domain')\n      .data(\n        function () {\n          var data = self.getDomainKeys();\n          return navigationDir === self.NAVIGATE_LEFT ? data.reverse() : data;\n        },\n        function (d) {\n          return d;\n        },\n      );\n    var enteringDomainDim = 0;\n    var exitingDomainDim = 0;\n\n    // =========================================================================//\n    // PAINTING DOMAIN                              //\n    // =========================================================================//\n\n    var svg = domainSvg\n      .enter()\n      .append('svg')\n      .attr('width', function (d) {\n        return w(d, true);\n      })\n      .attr('height', function (d) {\n        return h(d, true);\n      })\n      .attr('x', function (d) {\n        if (options.verticalOrientation) {\n          self.graphDim.width = Math.max(self.graphDim.width, w(d, true));\n          return 0;\n        } else {\n          return getDomainPosition(d, self.graphDim, 'width', w(d, true));\n        }\n      })\n      .attr('y', function (d) {\n        if (options.verticalOrientation) {\n          return getDomainPosition(d, self.graphDim, 'height', h(d, true));\n        } else {\n          self.graphDim.height = Math.max(self.graphDim.height, h(d, true));\n          return 0;\n        }\n      })\n      .attr('class', function (d) {\n        var classname = 'graph-domain';\n        var date = new Date(d);\n        switch (options.domain) {\n          case 'hour':\n            classname += ' h_' + date.getHours();\n          /* falls through */\n          case 'day':\n            classname += ' d_' + date.getDate() + ' dy_' + date.getDay();\n          /* falls through */\n          case 'week':\n            classname += ' w_' + self.getWeekNumber(date);\n          /* falls through */\n          case 'month':\n            classname += ' m_' + (date.getMonth() + 1);\n          /* falls through */\n          case 'year':\n            classname += ' y_' + date.getFullYear();\n        }\n        return classname;\n      });\n    self.lastInsertedSvg = svg;\n\n    function getDomainPosition(domainIndex, graphDim, axis, domainDim) {\n      var tmp = 0;\n      switch (navigationDir) {\n        case false:\n          tmp = graphDim[axis];\n\n          graphDim[axis] += domainDim;\n          self.domainPosition.setPosition(domainIndex, tmp);\n          return tmp;\n\n        case self.NAVIGATE_RIGHT:\n          self.domainPosition.setPosition(domainIndex, graphDim[axis]);\n\n          enteringDomainDim = domainDim;\n          exitingDomainDim = self.domainPosition.getPositionFromIndex(1);\n\n          self.domainPosition.shiftRightBy(exitingDomainDim);\n          return graphDim[axis];\n\n        case self.NAVIGATE_LEFT:\n          tmp = -domainDim;\n\n          enteringDomainDim = -tmp;\n          exitingDomainDim = graphDim[axis] - self.domainPosition.getLast();\n\n          self.domainPosition.setPosition(domainIndex, tmp);\n          self.domainPosition.shiftLeftBy(enteringDomainDim);\n          return tmp;\n      }\n    }\n\n    svg\n      .append('rect')\n      .attr('width', function (d) {\n        return w(d, true) - options.domainGutter - options.cellPadding;\n      })\n      .attr('height', function (d) {\n        return h(d, true) - options.domainGutter - options.cellPadding;\n      })\n      .attr('class', 'domain-background');\n\n    // =========================================================================//\n    // PAINTING SUBDOMAINS                            //\n    // =========================================================================//\n    var subDomainSvgGroup = svg\n      .append('svg')\n      .attr('x', function () {\n        if (options.label.position === 'left') {\n          return self.domainHorizontalLabelWidth + options.domainMargin[3];\n        } else {\n          return options.domainMargin[3];\n        }\n      })\n      .attr('y', function () {\n        if (options.label.position === 'top') {\n          return self.domainVerticalLabelHeight + options.domainMargin[0];\n        } else {\n          return options.domainMargin[0];\n        }\n      })\n      .attr('class', 'graph-subdomain-group');\n    var rect = subDomainSvgGroup\n      .selectAll('g')\n      .data(function (d) {\n        return self._domains.get(d);\n      })\n      .enter()\n      .append('g');\n    rect\n      .append('rect')\n      .attr('class', function (d) {\n        return (\n          'graph-rect' +\n          self.getHighlightClassName(d.t) +\n          (options.onClick !== null ? ' hover_cursor' : '')\n        );\n      })\n      .attr('width', options.cellSize)\n      .attr('height', options.cellSize)\n      .attr('x', function (d) {\n        return self.positionSubDomainX(d.t);\n      })\n      .attr('y', function (d) {\n        return self.positionSubDomainY(d.t);\n      })\n      .on('click', function (d) {\n        if (options.onClick !== null) {\n          return self.onClick(new Date(d.t), d.v);\n        }\n      })\n      .call(function (selection) {\n        if (options.cellRadius > 0) {\n          selection\n            .attr('rx', options.cellRadius)\n            .attr('ry', options.cellRadius);\n        }\n\n        if (\n          self.legendScale !== null &&\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('base')\n        ) {\n          selection.attr('fill', options.legendColors.base);\n        }\n\n        if (options.tooltip) {\n          selection\n            .on('mouseover', function (d) {\n              self.tip.show(d, this);\n            })\n            .on('mouseout', function () {\n              self.tip.hide(d);\n            });\n        }\n      });\n\n    // Appending a title to each subdomain\n    if (!options.tooltip) {\n      rect.append('title').text(function (d) {\n        return self.formatDate(new Date(d.t), options.subDomainDateFormat);\n      });\n    }\n\n    // =========================================================================//\n    // PAINTING LABEL                              //\n    // =========================================================================//\n    if (options.domainLabelFormat !== '') {\n      svg\n        .append('text')\n        .attr('class', 'graph-label')\n        .attr('y', function (d) {\n          var y = options.domainMargin[0];\n          switch (options.label.position) {\n            case 'top':\n              y += self.domainVerticalLabelHeight / 2;\n              break;\n            case 'bottom':\n              y += h(d) + self.domainVerticalLabelHeight / 2;\n          }\n\n          return (\n            y +\n            options.label.offset.y *\n              ((options.label.rotate === 'right' &&\n                options.label.position === 'right') ||\n              (options.label.rotate === 'left' &&\n                options.label.position === 'left')\n                ? -1\n                : 1)\n          );\n        })\n        .attr('x', function (d) {\n          var x = options.domainMargin[3];\n          switch (options.label.position) {\n            case 'right':\n              x += w(d);\n              break;\n            case 'bottom':\n            case 'top':\n              x += w(d) / 2;\n          }\n\n          if (options.label.align === 'right') {\n            return (\n              x +\n              self.domainHorizontalLabelWidth -\n              options.label.offset.x *\n                (options.label.rotate === 'right' ? -1 : 1)\n            );\n          }\n          return x + options.label.offset.x;\n        })\n        .attr('text-anchor', function () {\n          switch (options.label.align) {\n            case 'start':\n            case 'left':\n              return 'start';\n            case 'end':\n            case 'right':\n              return 'end';\n            default:\n              return 'middle';\n          }\n        })\n        .attr('dominant-baseline', function () {\n          return self.verticalDomainLabel ? 'middle' : 'top';\n        })\n        .text(function (d) {\n          return self.formatDate(new Date(d), options.domainLabelFormat);\n        })\n        .call(domainRotate);\n    }\n\n    function domainRotate(selection) {\n      switch (options.label.rotate) {\n        case 'right':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(90), ';\n            switch (options.label.position) {\n              case 'right':\n                s += 'translate(-' + w(d) + ' , -' + w(d) + ')';\n                break;\n              case 'left':\n                s += 'translate(0, -' + self.domainHorizontalLabelWidth + ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n        case 'left':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(270), ';\n            switch (options.label.position) {\n              case 'right':\n                s +=\n                  'translate(-' +\n                  (w(d) + self.domainHorizontalLabelWidth) +\n                  ' , ' +\n                  w(d) +\n                  ')';\n                break;\n              case 'left':\n                s +=\n                  'translate(-' +\n                  self.domainHorizontalLabelWidth +\n                  ' , ' +\n                  self.domainHorizontalLabelWidth +\n                  ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n      }\n    }\n\n    // =========================================================================//\n    // PAINTING DOMAIN SUBDOMAIN CONTENT                    //\n    // =========================================================================//\n    if (options.subDomainTextFormat !== null) {\n      rect\n        .append('text')\n        .attr('class', function (d) {\n          return 'subdomain-text' + self.getHighlightClassName(d.t);\n        })\n        .attr('x', function (d) {\n          return self.positionSubDomainX(d.t) + options.cellSize / 2;\n        })\n        .attr('y', function (d) {\n          return self.positionSubDomainY(d.t) + options.cellSize / 2;\n        })\n        .attr('text-anchor', 'middle')\n        .attr('dominant-baseline', 'central')\n        .text(function (d) {\n          return self.formatDate(new Date(d.t), options.subDomainTextFormat);\n        });\n    }\n\n    // =========================================================================//\n    // ANIMATION                                //\n    // =========================================================================//\n\n    if (navigationDir !== false) {\n      domainSvg\n        .transition()\n        .duration(options.animationDuration)\n        .attr('x', function (d) {\n          return options.verticalOrientation\n            ? 0\n            : self.domainPosition.getPosition(d);\n        })\n        .attr('y', function (d) {\n          return options.verticalOrientation\n            ? self.domainPosition.getPosition(d)\n            : 0;\n        });\n    }\n\n    var tempWidth = self.graphDim.width;\n    var tempHeight = self.graphDim.height;\n\n    if (options.verticalOrientation) {\n      self.graphDim.height += enteringDomainDim - exitingDomainDim;\n    } else {\n      self.graphDim.width += enteringDomainDim - exitingDomainDim;\n    }\n\n    // At the time of exit, domainsWidth and domainsHeight already automatically shifted\n    domainSvg\n      .exit()\n      .transition()\n      .duration(options.animationDuration)\n      .attr('x', function (d) {\n        if (options.verticalOrientation) {\n          return 0;\n        } else {\n          switch (navigationDir) {\n            case self.NAVIGATE_LEFT:\n              return Math.min(self.graphDim.width, tempWidth);\n            case self.NAVIGATE_RIGHT:\n              return -w(d, true);\n          }\n        }\n      })\n      .attr('y', function (d) {\n        if (options.verticalOrientation) {\n          switch (navigationDir) {\n            case self.NAVIGATE_LEFT:\n              return Math.min(self.graphDim.height, tempHeight);\n            case self.NAVIGATE_RIGHT:\n              return -h(d, true);\n          }\n        } else {\n          return 0;\n        }\n      })\n      .remove();\n\n    // Resize the root container\n    self.resize();\n  };\n};\n\nCalHeatMap.prototype = {\n  /**\n   * Validate and merge user settings with default settings\n   *\n   * @param  {object} settings User settings\n   * @return {bool} False if settings contains error\n   */\n  /* jshint maxstatements:false */\n  init: function (settings) {\n    'use strict';\n\n    var parent = this;\n\n    var options = (parent.options = mergeRecursive(parent.options, settings));\n\n    // Fatal errors\n    // Stop script execution on error\n    validateDomainType();\n    validateSelector(options.itemSelector, false, 'itemSelector');\n\n    if (parent.allowedDataType.indexOf(options.dataType) === -1) {\n      throw new Error(\n        \"The data type '\" + options.dataType + \"' is not valid data type\",\n      );\n    }\n\n    if (d3.select(options.itemSelector)[0][0] === null) {\n      throw new Error(\n        \"The node '\" +\n          options.itemSelector +\n          \"' specified in itemSelector does not exists\",\n      );\n    }\n\n    try {\n      validateSelector(options.nextSelector, true, 'nextSelector');\n      validateSelector(options.previousSelector, true, 'previousSelector');\n    } catch (error) {\n      console.log(error.message);\n      return false;\n    }\n\n    // If other settings contains error, will fallback to default\n\n    if (!settings.hasOwnProperty('subDomain')) {\n      this.options.subDomain = getOptimalSubDomain(settings.domain);\n    }\n\n    if (\n      typeof options.itemNamespace !== 'string' ||\n      options.itemNamespace === ''\n    ) {\n      console.log(\n        'itemNamespace can not be empty, falling back to cal-heatmap',\n      );\n      options.itemNamespace = 'cal-heatmap';\n    }\n\n    // Don't touch these settings\n    var s = [\n      'data',\n      'onComplete',\n      'onClick',\n      'afterLoad',\n      'afterLoadData',\n      'afterLoadPreviousDomain',\n      'afterLoadNextDomain',\n      'afterUpdate',\n    ];\n\n    for (var k in s) {\n      if (settings.hasOwnProperty(s[k])) {\n        options[s[k]] = settings[s[k]];\n      }\n    }\n\n    options.subDomainDateFormat =\n      typeof options.subDomainDateFormat === 'string' ||\n      typeof options.subDomainDateFormat === 'function'\n        ? options.subDomainDateFormat\n        : this._domainType[options.subDomain].format.date;\n    options.domainLabelFormat =\n      typeof options.domainLabelFormat === 'string' ||\n      typeof options.domainLabelFormat === 'function'\n        ? options.domainLabelFormat\n        : this._domainType[options.domain].format.legend;\n    options.subDomainTextFormat =\n      (typeof options.subDomainTextFormat === 'string' &&\n        options.subDomainTextFormat !== '') ||\n      typeof options.subDomainTextFormat === 'function'\n        ? options.subDomainTextFormat\n        : null;\n    options.domainMargin = expandMarginSetting(options.domainMargin);\n    options.legendMargin = expandMarginSetting(options.legendMargin);\n    options.highlight = parent.expandDateSetting(options.highlight);\n    options.itemName = expandItemName(options.itemName);\n    options.colLimit = parseColLimit(options.colLimit);\n    options.rowLimit = parseRowLimit(options.rowLimit);\n    if (!settings.hasOwnProperty('legendMargin')) {\n      autoAddLegendMargin();\n    }\n    autoAlignLabel();\n\n    /**\n     * Validate that a queryString is valid\n     *\n     * @param  {Element|string|bool} selector   The queryString to test\n     * @param  {bool}  canBeFalse  Whether false is an accepted and valid value\n     * @param  {string} name    Name of the tested selector\n     * @throws {Error}        If the selector is not valid\n     * @return {bool}        True if the selector is a valid queryString\n     */\n    function validateSelector(selector, canBeFalse, name) {\n      if (\n        ((canBeFalse && selector === false) ||\n          selector instanceof Element ||\n          typeof selector === 'string') &&\n        selector !== ''\n      ) {\n        return true;\n      }\n      throw new Error('The ' + name + ' is not valid');\n    }\n\n    /**\n     * Return the optimal subDomain for the specified domain\n     *\n     * @param  {string} domain a domain name\n     * @return {string}        the subDomain name\n     */\n    function getOptimalSubDomain(domain) {\n      switch (domain) {\n        case 'year':\n          return 'month';\n        case 'month':\n          return 'day';\n        case 'week':\n          return 'day';\n        case 'day':\n          return 'hour';\n        default:\n          return 'min';\n      }\n    }\n\n    /**\n     * Ensure that the domain and subdomain are valid\n     *\n     * @throw {Error} when domain or subdomain are not valid\n     * @return {bool} True if domain and subdomain are valid and compatible\n     */\n    function validateDomainType() {\n      if (\n        !parent._domainType.hasOwnProperty(options.domain) ||\n        options.domain === 'min' ||\n        options.domain.substring(0, 2) === 'x_'\n      ) {\n        throw new Error(\"The domain '\" + options.domain + \"' is not valid\");\n      }\n\n      if (\n        !parent._domainType.hasOwnProperty(options.subDomain) ||\n        options.subDomain === 'year'\n      ) {\n        throw new Error(\n          \"The subDomain '\" + options.subDomain + \"' is not valid\",\n        );\n      }\n\n      if (\n        parent._domainType[options.domain].level <=\n        parent._domainType[options.subDomain].level\n      ) {\n        throw new Error(\n          \"'\" +\n            options.subDomain +\n            \"' is not a valid subDomain to '\" +\n            options.domain +\n            \"'\",\n        );\n      }\n\n      return true;\n    }\n\n    /**\n     * Fine-tune the label alignement depending on its position\n     *\n     * @return void\n     */\n    function autoAlignLabel() {\n      // Auto-align label, depending on it's position\n      if (\n        !settings.hasOwnProperty('label') ||\n        (settings.hasOwnProperty('label') &&\n          !settings.label.hasOwnProperty('align'))\n      ) {\n        switch (options.label.position) {\n          case 'left':\n            options.label.align = 'right';\n            break;\n          case 'right':\n            options.label.align = 'left';\n            break;\n          default:\n            options.label.align = 'center';\n        }\n\n        if (options.label.rotate === 'left') {\n          options.label.align = 'right';\n        } else if (options.label.rotate === 'right') {\n          options.label.align = 'left';\n        }\n      }\n\n      if (\n        !settings.hasOwnProperty('label') ||\n        (settings.hasOwnProperty('label') &&\n          !settings.label.hasOwnProperty('offset'))\n      ) {\n        if (\n          options.label.position === 'left' ||\n          options.label.position === 'right'\n        ) {\n          options.label.offset = {\n            x: 10,\n            y: 15,\n          };\n        }\n      }\n    }\n\n    /**\n     * If not specified, add some margin around the legend depending on its position\n     *\n     * @return void\n     */\n    function autoAddLegendMargin() {\n      switch (options.legendVerticalPosition) {\n        case 'top':\n          options.legendMargin[2] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'bottom':\n          options.legendMargin[0] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'middle':\n        case 'center':\n          options.legendMargin[\n            options.legendHorizontalPosition === 'right' ? 3 : 1\n          ] = parent.DEFAULT_LEGEND_MARGIN;\n      }\n    }\n\n    /**\n     * Expand a number of an array of numbers to an usable 4 values array\n     *\n     * @param  {integer|array} value\n     * @return {array}        array\n     */\n    function expandMarginSetting(value) {\n      if (typeof value === 'number') {\n        value = [value];\n      }\n\n      if (!Array.isArray(value)) {\n        console.log('Margin only takes an integer or an array of integers');\n        value = [0];\n      }\n\n      switch (value.length) {\n        case 1:\n          return [value[0], value[0], value[0], value[0]];\n        case 2:\n          return [value[0], value[1], value[0], value[1]];\n        case 3:\n          return [value[0], value[1], value[2], value[1]];\n        case 4:\n          return value;\n        default:\n          return value.slice(0, 4);\n      }\n    }\n\n    /**\n     * Convert a string to an array like [singular-form, plural-form]\n     *\n     * @param  {string|array} value Date to convert\n     * @return {array}       An array like [singular-form, plural-form]\n     */\n    function expandItemName(value) {\n      if (typeof value === 'string') {\n        return [value, value + (value !== '' ? 's' : '')];\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 1) {\n          return [value[0], value[0] + 's'];\n        } else if (value.length > 2) {\n          return value.slice(0, 2);\n        }\n\n        return value;\n      }\n\n      return ['item', 'items'];\n    }\n\n    function parseColLimit(value) {\n      return value > 0 ? value : null;\n    }\n\n    function parseRowLimit(value) {\n      if (value > 0 && options.colLimit > 0) {\n        console.log(\n          'colLimit and rowLimit are mutually exclusive, rowLimit will be ignored',\n        );\n        return null;\n      }\n      return value > 0 ? value : null;\n    }\n\n    return this._init();\n  },\n\n  /**\n   * Convert a keyword or an array of keyword/date to an array of date objects\n   *\n   * @param  {string|array|Date} value Data to convert\n   * @return {array}       An array of Dates\n   */\n  expandDateSetting: function (value) {\n    'use strict';\n\n    if (!Array.isArray(value)) {\n      value = [value];\n    }\n\n    return value\n      .map(function (data) {\n        if (data === 'now') {\n          return new Date();\n        }\n        if (data instanceof Date) {\n          return data;\n        }\n        return false;\n      })\n      .filter(function (d) {\n        return d !== false;\n      });\n  },\n\n  /**\n   * Fill the calendar by coloring the cells\n   *\n   * @param array svg An array of html node to apply the transformation to (optional)\n   *                  It's used to limit the painting to only a subset of the calendar\n   * @return void\n   */\n  fill: function (svg) {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n\n    if (arguments.length === 0) {\n      svg = parent.root.selectAll('.graph-domain');\n    }\n\n    var rect = svg\n      .selectAll('svg')\n      .selectAll('g')\n      .data(function (d) {\n        return parent._domains.get(d);\n      });\n    /**\n     * Colorize the cell via a style attribute if enabled\n     */\n    function addStyle(element) {\n      if (parent.legendScale === null) {\n        return false;\n      }\n\n      element.attr('fill', function (d) {\n        if (\n          d.v === null &&\n          options.hasOwnProperty('considerMissingDataAsZero') &&\n          !options.considerMissingDataAsZero\n        ) {\n          if (options.legendColors.hasOwnProperty('base')) {\n            return options.legendColors.base;\n          }\n        }\n\n        if (\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('empty') &&\n          (d.v === 0 ||\n            (d.v === null &&\n              options.hasOwnProperty('considerMissingDataAsZero') &&\n              options.considerMissingDataAsZero))\n        ) {\n          return options.legendColors.empty;\n        }\n\n        if (\n          d.v < 0 &&\n          options.legend[0] > 0 &&\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('overflow')\n        ) {\n          return options.legendColors.overflow;\n        }\n\n        return parent.legendScale(\n          Math.min(d.v, options.legend[options.legend.length - 1]),\n        );\n      });\n    }\n\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('rect')\n      .attr('class', function (d) {\n        var htmlClass = parent.getHighlightClassName(d.t).trim().split(' ');\n        var pastDate = parent.dateIsLessThan(d.t, new Date());\n        var sameDate = parent.dateIsEqual(d.t, new Date());\n\n        if (\n          parent.legendScale === null ||\n          (d.v === null &&\n            options.hasOwnProperty('considerMissingDataAsZero') &&\n            !options.considerMissingDataAsZero &&\n            !options.legendColors.hasOwnProperty('base'))\n        ) {\n          htmlClass.push('graph-rect');\n        }\n\n        if (sameDate) {\n          htmlClass.push('now');\n        } else if (!pastDate) {\n          htmlClass.push('future');\n        }\n\n        if (d.v !== null) {\n          htmlClass.push(\n            parent.Legend.getClass(d.v, parent.legendScale === null),\n          );\n        } else if (options.considerMissingDataAsZero && pastDate) {\n          htmlClass.push(\n            parent.Legend.getClass(0, parent.legendScale === null),\n          );\n        }\n\n        if (options.onClick !== null) {\n          htmlClass.push('hover_cursor');\n        }\n\n        return htmlClass.join(' ');\n      })\n      .call(addStyle);\n\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('title')\n      .text(function (d) {\n        return parent.getSubDomainTitle(d);\n      });\n\n    function formatSubDomainText(element) {\n      if (typeof options.subDomainTextFormat === 'function') {\n        element.text(function (d) {\n          return options.subDomainTextFormat(d.t, d.v);\n        });\n      }\n    }\n\n    /**\n     * Change the subDomainText class if necessary\n     * Also change the text, e.g when text is representing the value\n     * instead of the date\n     */\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('text')\n      .attr('class', function (d) {\n        return 'subdomain-text' + parent.getHighlightClassName(d.t);\n      })\n      .call(formatSubDomainText)\n      .attr('fill', d => {\n        if (!d.v) return '#000';\n        const rgb = parent.legendScale(\n          Math.min(d.v, options.legend[options.legend.length - 1]),\n        );\n        return getContrastingColor(rgb, 135);\n      });\n  },\n\n  /**\n   * Sprintf like function.\n   * Replaces placeholders {0} in string with values from provided object.\n   *\n   * @param string formatted String containing placeholders.\n   * @param object args Object with properties to replace placeholders in string.\n   *\n   * @return String\n   */\n  formatStringWithObject: function (formatted, args) {\n    'use strict';\n    for (var prop in args) {\n      if (args.hasOwnProperty(prop)) {\n        var regexp = new RegExp('\\\\{' + prop + '\\\\}', 'gi');\n        formatted = formatted.replace(regexp, args[prop]);\n      }\n    }\n    return formatted;\n  },\n\n  // =========================================================================//\n  // EVENTS CALLBACK                              //\n  // =========================================================================//\n\n  /**\n   * Helper method for triggering event callback\n   *\n   * @param  string  eventName       Name of the event to trigger\n   * @param  array  successArgs     List of argument to pass to the callback\n   * @param  boolean  skip      Whether to skip the event triggering\n   * @return mixed  True when the triggering was skipped, false on error, else the callback function\n   */\n  triggerEvent: function (eventName, successArgs, skip) {\n    'use strict';\n\n    if ((arguments.length === 3 && skip) || this.options[eventName] === null) {\n      return true;\n    }\n\n    if (typeof this.options[eventName] === 'function') {\n      if (typeof successArgs === 'function') {\n        successArgs = successArgs();\n      }\n      return this.options[eventName].apply(this, successArgs);\n    } else {\n      console.log('Provided callback for ' + eventName + ' is not a function.');\n      return false;\n    }\n  },\n\n  /**\n   * Event triggered on a mouse click on a subDomain cell\n   *\n   * @param  Date    d    Date of the subdomain block\n   * @param  int    itemNb  Number of items in that date\n   */\n  onClick: function (d, itemNb) {\n    'use strict';\n\n    return this.triggerEvent('onClick', [d, itemNb]);\n  },\n\n  /**\n   * Event triggered after drawing the calendar, byt before filling it with data\n   */\n  afterLoad: function () {\n    'use strict';\n\n    return this.triggerEvent('afterLoad');\n  },\n\n  /**\n   * Event triggered after completing drawing and filling the calendar\n   */\n  onComplete: function () {\n    'use strict';\n\n    var response = this.triggerEvent('onComplete', [], this._completed);\n    this._completed = true;\n    return response;\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain back\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadPreviousDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadPreviousDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain above\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadNextDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadNextDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after loading the leftmost domain allowed by minDate\n   *\n   * @param  boolean  reached True if the leftmost domain was reached\n   */\n  onMinDomainReached: function (reached) {\n    'use strict';\n\n    this._minDomainReached = reached;\n    return this.triggerEvent('onMinDomainReached', [reached]);\n  },\n\n  /**\n   * Event triggered after loading the rightmost domain allowed by maxDate\n   *\n   * @param  boolean  reached True if the rightmost domain was reached\n   */\n  onMaxDomainReached: function (reached) {\n    'use strict';\n\n    this._maxDomainReached = reached;\n    return this.triggerEvent('onMaxDomainReached', [reached]);\n  },\n\n  checkIfMinDomainIsReached: function (date, upperBound) {\n    'use strict';\n\n    if (this.minDomainIsReached(date)) {\n      this.onMinDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._maxDomainReached && !this.maxDomainIsReached(upperBound)) {\n        this.onMaxDomainReached(false);\n      }\n    }\n  },\n\n  checkIfMaxDomainIsReached: function (date, lowerBound) {\n    'use strict';\n\n    if (this.maxDomainIsReached(date)) {\n      this.onMaxDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._minDomainReached && !this.minDomainIsReached(lowerBound)) {\n        this.onMinDomainReached(false);\n      }\n    }\n  },\n\n  afterUpdate: function () {\n    'use strict';\n\n    return this.triggerEvent('afterUpdate');\n  },\n\n  // =========================================================================//\n  // FORMATTER                                //\n  // =========================================================================//\n\n  formatNumber: d3.format(',g'),\n\n  formatDate: function (d, format) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      format = 'title';\n    }\n\n    if (typeof format === 'function') {\n      return format(d);\n    } else {\n      var f = d3.time.format(format);\n      return f(d);\n    }\n  },\n\n  getSubDomainTitle: function (d) {\n    'use strict';\n\n    if (d.v === null && !this.options.considerMissingDataAsZero) {\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.empty,\n        {\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat,\n          ),\n        },\n      );\n    } else {\n      var value = d.v;\n      // Consider null as 0\n      if (value === null && this.options.considerMissingDataAsZero) {\n        value = 0;\n      }\n\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.filled,\n        {\n          count: this.formatNumber(value),\n          name: this.options.itemName[value !== 1 ? 1 : 0],\n          connector: this._domainType[this.options.subDomain].format.connector,\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat,\n          ),\n        },\n      );\n    }\n  },\n\n  // =========================================================================//\n  // DOMAIN NAVIGATION                            //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar one domain forward\n   *\n   * The new domain is loaded only if it's not beyond maxDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the next domain was loaded, else false\n   */\n  loadNextDomain: function (n) {\n    'use strict';\n\n    if (this._maxDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_RIGHT,\n      this.getDomain(this.getNextDomain(), n),\n    );\n\n    this.afterLoadNextDomain(bound.end);\n    this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(), bound.start);\n\n    return true;\n  },\n\n  /**\n   * Shift the calendar one domain backward\n   *\n   * The previous domain is loaded only if it's not beyond the minDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the previous domain was loaded, else false\n   */\n  loadPreviousDomain: function (n) {\n    'use strict';\n\n    if (this._minDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_LEFT,\n      this.getDomain(this.getDomainKeys()[0], -n).reverse(),\n    );\n\n    this.afterLoadPreviousDomain(bound.start);\n    this.checkIfMinDomainIsReached(bound.start, bound.end);\n\n    return true;\n  },\n\n  loadNewDomains: function (direction, newDomains) {\n    'use strict';\n\n    var parent = this;\n    var backward = direction === this.NAVIGATE_LEFT;\n    var i = -1;\n    var total = newDomains.length;\n    var domains = this.getDomainKeys();\n\n    function buildSubDomain(d) {\n      return {\n        t: parent._domainType[parent.options.subDomain].extractUnit(d),\n        v: null,\n      };\n    }\n\n    // Remove out of bound domains from list of new domains to prepend\n    while (++i < total) {\n      if (backward && this.minDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i + 1);\n        break;\n      }\n      if (!backward && this.maxDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i);\n        break;\n      }\n    }\n\n    newDomains = newDomains.slice(-this.options.range);\n\n    for (i = 0, total = newDomains.length; i < total; i += 1) {\n      this._domains.set(\n        newDomains[i].getTime(),\n        this.getSubDomain(newDomains[i]).map(buildSubDomain),\n      );\n\n      this._domains.remove(backward ? domains.pop() : domains.shift());\n    }\n\n    domains = this.getDomainKeys();\n\n    if (backward) {\n      newDomains = newDomains.reverse();\n    }\n\n    this.paint(direction);\n\n    this.getDatas(\n      this.options.data,\n      newDomains[0],\n      this.getSubDomain(newDomains[newDomains.length - 1]).pop(),\n      function () {\n        parent.fill(parent.lastInsertedSvg);\n      },\n    );\n\n    return {\n      start: newDomains[backward ? 0 : 1],\n      end: domains[domains.length - 1],\n    };\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by maxDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar upper bound\n   */\n  maxDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.maxDate !== null &&\n      this.options.maxDate.getTime() < datetimestamp\n    );\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by minDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar lower bound\n   */\n  minDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.minDate !== null &&\n      this.options.minDate.getTime() >= datetimestamp\n    );\n  },\n\n  /**\n   * Return the list of the calendar's domain timestamp\n   *\n   * @return Array a sorted array of timestamp\n   */\n  getDomainKeys: function () {\n    'use strict';\n\n    return this._domains\n      .keys()\n      .map(function (d) {\n        return parseInt(d, 10);\n      })\n      .sort(function (a, b) {\n        return a - b;\n      });\n  },\n\n  // =========================================================================//\n  // POSITIONNING                                //\n  // =========================================================================//\n\n  positionSubDomainX: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.x(\n      new Date(d),\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  positionSubDomainY: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.y(\n      new Date(d),\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  getSubDomainColumnNumber: function (d) {\n    'use strict';\n\n    if (this.options.rowLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.rowLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultColumnNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.colLimit || j;\n  },\n\n  getSubDomainRowNumber: function (d) {\n    'use strict';\n\n    if (this.options.colLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.colLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultRowNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.rowLimit || j;\n  },\n\n  /**\n   * Return a classname if the specified date should be highlighted\n   *\n   * @param  timestamp date Date of the current subDomain\n   * @return String the highlight class\n   */\n  getHighlightClassName: function (d) {\n    'use strict';\n\n    d = new Date(d);\n\n    if (this.options.highlight.length > 0) {\n      for (var i in this.options.highlight) {\n        if (this.dateIsEqual(this.options.highlight[i], d)) {\n          return this.isNow(this.options.highlight[i])\n            ? ' highlight-now'\n            : ' highlight';\n        }\n      }\n    }\n    return '';\n  },\n\n  /**\n   * Return whether the specified date is now,\n   * according to the type of subdomain\n   *\n   * @param  Date d The date to compare\n   * @return bool True if the date correspond to a subdomain cell\n   */\n  isNow: function (d) {\n    'use strict';\n\n    return this.dateIsEqual(d, new Date());\n  },\n\n  /**\n   * Return whether 2 dates are equals\n   * This function is subdomain-aware,\n   * and dates comparison are dependent of the subdomain\n   *\n   * @param  Date dateA First date to compare\n   * @param  Date dateB Secon date to compare\n   * @return bool true if the 2 dates are equals\n   */\n  /* jshint maxcomplexity: false */\n  dateIsEqual: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours() &&\n          dateA.getMinutes() === dateB.getMinutes()\n        );\n      case 'x_hour':\n      case 'hour':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours()\n        );\n      case 'x_day':\n      case 'day':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate()\n        );\n      case 'x_week':\n      case 'week':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          this.getWeekNumber(dateA) === this.getWeekNumber(dateB)\n        );\n      case 'x_month':\n      case 'month':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth()\n        );\n      default:\n        return false;\n    }\n  },\n\n  /**\n   * Returns wether or not dateA is less than or equal to dateB. This function is subdomain aware.\n   * Performs automatic conversion of values.\n   * @param dateA may be a number or a Date\n   * @param dateB may be a number or a Date\n   * @returns {boolean}\n   */\n  dateIsLessThan: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    function normalizedMillis(date, subdomain) {\n      switch (subdomain) {\n        case 'x_min':\n        case 'min':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n            date.getMinutes(),\n          ).getTime();\n        case 'x_hour':\n        case 'hour':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n          ).getTime();\n        case 'x_day':\n        case 'day':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n          ).getTime();\n        case 'x_week':\n        case 'week':\n        case 'x_month':\n        case 'month':\n          return new Date(date.getFullYear(), date.getMonth()).getTime();\n        default:\n          return date.getTime();\n      }\n    }\n\n    return (\n      normalizedMillis(dateA, this.options.subDomain) <\n      normalizedMillis(dateB, this.options.subDomain)\n    );\n  },\n\n  // =========================================================================//\n  // DATE COMPUTATION                              //\n  // =========================================================================//\n\n  /**\n   * Return the day of the year for the date\n   * @param  Date\n   * @return  int Day of the year [1,366]\n   */\n  getDayOfYear: d3.time.format('%j'),\n\n  /**\n   * Return the week number of the year\n   * Monday as the first day of the week\n   * @return int  Week number [0-53]\n   */\n  getWeekNumber: function (d) {\n    'use strict';\n\n    var f =\n      this.options.weekStartOnMonday === true\n        ? d3.time.format('%W')\n        : d3.time.format('%U');\n    return f(d);\n  },\n\n  /**\n   * Return the week number, relative to its month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Week number, relative to the month [0-5]\n   */\n  getMonthWeekNumber: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n\n    var monthFirstWeekNumber = this.getWeekNumber(\n      new Date(d.getFullYear(), d.getMonth()),\n    );\n    return this.getWeekNumber(d) - monthFirstWeekNumber - 1;\n  },\n\n  /**\n   * Return the number of weeks in the dates' year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of weeks in the date's year\n   */\n  getWeekNumberInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n  },\n\n  /**\n   * Return the number of days in the date's month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's month\n   */\n  getDayCountInMonth: function (d) {\n    'use strict';\n\n    return this.getEndOfMonth(d).getDate();\n  },\n\n  /**\n   * Return the number of days in the date's year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's year\n   */\n  getDayCountInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), 1, 29).getMonth() === 1 ? 366 : 365;\n  },\n\n  /**\n   * Get the weekday from a date\n   *\n   * Return the week day number (0-6) of a date,\n   * depending on whether the week start on monday or sunday\n   *\n   * @param  Date d\n   * @return int The week day number (0-6)\n   */\n  getWeekDay: function (d) {\n    'use strict';\n\n    if (this.options.weekStartOnMonday === false) {\n      return d.getDay();\n    }\n    return d.getDay() === 0 ? 6 : d.getDay() - 1;\n  },\n\n  /**\n   * Get the last day of the month\n   * @param  Date|int  d  Date or timestamp in milliseconds\n   * @return Date      Last day of the month\n   */\n  getEndOfMonth: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), d.getMonth() + 1, 0);\n  },\n\n  /**\n   *\n   * @param  Date date\n   * @param  int count\n   * @param  string step\n   * @return Date\n   */\n  jumpDate: function (date, count, step) {\n    'use strict';\n\n    var d = new Date(date);\n    switch (step) {\n      case 'hour':\n        d.setHours(d.getHours() + count);\n        break;\n      case 'day':\n        d.setHours(d.getHours() + count * 24);\n        break;\n      case 'week':\n        d.setHours(d.getHours() + count * 24 * 7);\n        break;\n      case 'month':\n        d.setMonth(d.getMonth() + count);\n        break;\n      case 'year':\n        d.setFullYear(d.getFullYear() + count);\n    }\n\n    return new Date(d);\n  },\n\n  // =========================================================================//\n  // DOMAIN COMPUTATION                            //\n  // =========================================================================//\n\n  /**\n   * Return all the minutes between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of minutes\n   */\n  getMinuteDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours(),\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours(),\n      );\n    } else {\n      stop = new Date(+start + range * 1000 * 60);\n    }\n    return d3.time.minutes(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the hours between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of hours in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getHourDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours(),\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours(),\n      );\n    } else {\n      stop = new Date(start);\n      stop.setHours(stop.getHours() + range);\n    }\n\n    var domains = d3.time.hours(Math.min(start, stop), Math.max(start, stop));\n\n    // Passing from DST to standard time\n    // If there are 25 hours, let's compress the duplicate hours\n    var i = 0;\n    var total = domains.length;\n    for (i = 0; i < total; i += 1) {\n      if (i > 0 && domains[i].getHours() === domains[i - 1].getHours()) {\n        this.DSTDomain.push(domains[i].getTime());\n        domains.splice(i, 1);\n        break;\n      }\n    }\n\n    // d3.time.hours is returning more hours than needed when changing\n    // from DST to standard time, because there is really 2 hours between\n    // 1am and 2am!\n    if (typeof range === 'number' && domains.length > Math.abs(range)) {\n      domains.splice(domains.length - 1, 1);\n    }\n\n    return domains;\n  },\n\n  /**\n   * Return all the days between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of days in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getDayDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth(), range.getDate());\n    } else {\n      stop = new Date(start);\n      stop = new Date(stop.setDate(stop.getDate() + parseInt(range, 10)));\n    }\n\n    return d3.time.days(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the weeks between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getWeekDomain: function (d, range) {\n    'use strict';\n\n    var weekStart;\n\n    if (this.options.weekStartOnMonday === false) {\n      weekStart = new Date(\n        d.getFullYear(),\n        d.getMonth(),\n        d.getDate() - d.getDay(),\n      );\n    } else {\n      if (d.getDay() === 1) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n      } else if (d.getDay() === 0) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        weekStart.setDate(weekStart.getDate() - 6);\n      } else {\n        weekStart = new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate() - d.getDay() + 1,\n        );\n      }\n    }\n\n    var endDate = new Date(weekStart);\n\n    var stop = range;\n    if (typeof range !== 'object') {\n      stop = new Date(endDate.setDate(endDate.getDate() + range * 7));\n    }\n\n    return this.options.weekStartOnMonday === true\n      ? d3.time.mondays(Math.min(weekStart, stop), Math.max(weekStart, stop))\n      : d3.time.sundays(Math.min(weekStart, stop), Math.max(weekStart, stop));\n  },\n\n  /**\n   * Return all the months between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of months in the range, or a stop date\n   * @return array  An array of months\n   */\n  getMonthDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth());\n    } else {\n      stop = new Date(start);\n      stop = stop.setMonth(stop.getMonth() + range);\n    }\n\n    return d3.time.months(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the years between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getYearDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), 0);\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), 0);\n    } else {\n      stop = new Date(d.getFullYear() + range, 0);\n    }\n\n    return d3.time.years(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Get an array of domain start dates\n   *\n   * @param  int|Date date A random date included in the wanted domain\n   * @param  int|Date range Number of dates to get, or a stop date\n   * @return Array of dates\n   */\n  getDomain: function (date, range) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    if (arguments.length < 2) {\n      range = this.options.range;\n    }\n\n    switch (this.options.domain) {\n      case 'hour':\n        var domains = this.getHourDomain(date, range);\n\n        // Case where an hour is missing, when passing from standard time to DST\n        // Missing hour is perfectly acceptabl in subDomain, but not in domains\n        if (typeof range === 'number' && domains.length < range) {\n          if (range > 0) {\n            domains.push(this.getHourDomain(domains[domains.length - 1], 2)[1]);\n          } else {\n            domains.shift(this.getHourDomain(domains[0], -2)[0]);\n          }\n        }\n        return domains;\n      case 'day':\n        return this.getDayDomain(date, range);\n      case 'week':\n        return this.getWeekDomain(date, range);\n      case 'month':\n        return this.getMonthDomain(date, range);\n      case 'year':\n        return this.getYearDomain(date, range);\n    }\n  },\n\n  /* jshint maxcomplexity: false */\n  getSubDomain: function (date) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    var parent = this;\n\n    /**\n     * @return int\n     */\n    var computeDaySubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'year':\n          return parent.getDayCountInYear(date);\n        case 'month':\n          return parent.getDayCountInMonth(date);\n        case 'week':\n          return 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeMinSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'hour':\n          return 60;\n        case 'day':\n          return 60 * 24;\n        case 'week':\n          return 60 * 24 * 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeHourSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'day':\n          return 24;\n        case 'week':\n          return 168;\n        case 'month':\n          return parent.getDayCountInMonth(date) * 24;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeWeekSubDomainSize = function (date, domain) {\n      if (domain === 'month') {\n        var endOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);\n        var endWeekNb = parent.getWeekNumber(endOfMonth);\n        var startWeekNb = parent.getWeekNumber(\n          new Date(date.getFullYear(), date.getMonth()),\n        );\n\n        if (startWeekNb > endWeekNb) {\n          startWeekNb = 0;\n          endWeekNb += 1;\n        }\n\n        return endWeekNb - startWeekNb + 1;\n      } else if (domain === 'year') {\n        return parent.getWeekNumber(new Date(date.getFullYear(), 11, 31));\n      }\n    };\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return this.getMinuteDomain(\n          date,\n          computeMinSubDomainSize(date, this.options.domain),\n        );\n      case 'x_hour':\n      case 'hour':\n        return this.getHourDomain(\n          date,\n          computeHourSubDomainSize(date, this.options.domain),\n        );\n      case 'x_day':\n      case 'day':\n        return this.getDayDomain(\n          date,\n          computeDaySubDomainSize(date, this.options.domain),\n        );\n      case 'x_week':\n      case 'week':\n        return this.getWeekDomain(\n          date,\n          computeWeekSubDomainSize(date, this.options.domain),\n        );\n      case 'x_month':\n      case 'month':\n        return this.getMonthDomain(date, 12);\n    }\n  },\n\n  /**\n   * Get the n-th next domain after the calendar newest (rightmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getNextDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().pop(), n, this.options.domain),\n      1,\n    )[0];\n  },\n\n  /**\n   * Get the n-th domain before the calendar oldest (leftmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getPreviousDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().shift(), -n, this.options.domain),\n      1,\n    )[0];\n  },\n\n  // =========================================================================//\n  // DATAS                                  //\n  // =========================================================================//\n\n  /**\n   * Fetch and interpret data from the datasource\n   *\n   * @param string|object source\n   * @param Date startDate\n   * @param Date endDate\n   * @param function callback\n   * @param function|boolean afterLoad function used to convert the data into a json object. Use true to use the afterLoad callback\n   * @param updateMode\n   *\n   * @return mixed\n   * - True if there are no data to load\n   * - False if data are loaded asynchronously\n   */\n  getDatas: function (\n    source,\n    startDate,\n    endDate,\n    callback,\n    afterLoad,\n    updateMode,\n  ) {\n    'use strict';\n\n    var self = this;\n    if (arguments.length < 5) {\n      afterLoad = true;\n    }\n    if (arguments.length < 6) {\n      updateMode = this.APPEND_ON_UPDATE;\n    }\n    var _callback = function (error, data) {\n      if (afterLoad !== false) {\n        if (typeof afterLoad === 'function') {\n          data = afterLoad(data);\n        } else if (typeof self.options.afterLoadData === 'function') {\n          data = self.options.afterLoadData(data);\n        } else {\n          console.log('Provided callback for afterLoadData is not a function.');\n        }\n      } else if (\n        self.options.dataType === 'csv' ||\n        self.options.dataType === 'tsv'\n      ) {\n        data = this.interpretCSV(data);\n      }\n      self.parseDatas(data, updateMode, startDate, endDate);\n      if (typeof callback === 'function') {\n        callback();\n      }\n    };\n\n    switch (typeof source) {\n      case 'string':\n        if (source === '') {\n          _callback(null, {});\n          return true;\n        } else {\n          var url = this.parseURI(source, startDate, endDate);\n          var requestType = 'GET';\n          if (self.options.dataPostPayload !== null) {\n            requestType = 'POST';\n          }\n          var payload = null;\n          if (self.options.dataPostPayload !== null) {\n            payload = this.parseURI(\n              self.options.dataPostPayload,\n              startDate,\n              endDate,\n            );\n          }\n\n          var xhr = null;\n          switch (this.options.dataType) {\n            case 'json':\n              xhr = d3.json(url);\n              break;\n            case 'csv':\n              xhr = d3.csv(url);\n              break;\n            case 'tsv':\n              xhr = d3.tsv(url);\n              break;\n            case 'txt':\n              xhr = d3.text(url, 'text/plain');\n              break;\n          }\n\n          // jshint maxdepth:5\n          if (self.options.dataRequestHeaders !== null) {\n            for (var header in self.options.dataRequestHeaders) {\n              if (self.options.dataRequestHeaders.hasOwnProperty(header)) {\n                xhr.header(header, self.options.dataRequestHeaders[header]);\n              }\n            }\n          }\n\n          xhr.send(requestType, payload, _callback);\n        }\n        return false;\n      case 'object':\n        if (source === Object(source)) {\n          _callback(null, source);\n          return false;\n        }\n      /* falls through */\n      default:\n        _callback(null, {});\n        return true;\n    }\n  },\n\n  /**\n   * Populate the calendar internal data\n   *\n   * @param object data\n   * @param constant updateMode\n   * @param Date startDate\n   * @param Date endDate\n   *\n   * @return void\n   */\n  parseDatas: function (data, updateMode, startDate, endDate) {\n    'use strict';\n\n    if (updateMode === this.RESET_ALL_ON_UPDATE) {\n      this._domains.forEach(function (key, value) {\n        value.forEach(function (element, index, array) {\n          array[index].v = null;\n        });\n      });\n    }\n\n    var temp = {};\n\n    var extractTime = function (d) {\n      return d.t;\n    };\n\n    /*jshint forin:false */\n    for (var d in data) {\n      var date = new Date(d * 1000);\n      var domainUnit = this.getDomain(date)[0].getTime();\n      // The current data belongs to a domain that was compressed\n      // Compress the data for the two duplicate hours into the same hour\n      if (this.DSTDomain.indexOf(domainUnit) >= 0) {\n        // Re-assign all data to the first or the second duplicate hours\n        // depending on which is visible\n        if (this._domains.has(domainUnit - 3600 * 1000)) {\n          domainUnit -= 3600 * 1000;\n        }\n      }\n\n      // Skip if data is not relevant to current domain\n      if (\n        isNaN(d) ||\n        !data.hasOwnProperty(d) ||\n        !this._domains.has(domainUnit) ||\n        !(domainUnit >= +startDate && domainUnit < +endDate)\n      ) {\n        continue;\n      }\n\n      var subDomainsData = this._domains.get(domainUnit);\n\n      if (!temp.hasOwnProperty(domainUnit)) {\n        temp[domainUnit] = subDomainsData.map(extractTime);\n      }\n\n      var index = temp[domainUnit].indexOf(\n        this._domainType[this.options.subDomain].extractUnit(date),\n      );\n\n      if (updateMode === this.RESET_SINGLE_ON_UPDATE) {\n        subDomainsData[index].v = data[d];\n      } else {\n        if (!isNaN(subDomainsData[index].v)) {\n          subDomainsData[index].v += data[d];\n        } else {\n          subDomainsData[index].v = data[d];\n        }\n      }\n    }\n  },\n\n  parseURI: function (str, startDate, endDate) {\n    'use strict';\n\n    // Use a timestamp in seconds\n    str = str.replace(/\\{\\{t:start\\}\\}/g, startDate.getTime() / 1000);\n    str = str.replace(/\\{\\{t:end\\}\\}/g, endDate.getTime() / 1000);\n\n    // Use a string date, following the ISO-8601\n    str = str.replace(/\\{\\{d:start\\}\\}/g, startDate.toISOString());\n    str = str.replace(/\\{\\{d:end\\}\\}/g, endDate.toISOString());\n\n    return str;\n  },\n\n  interpretCSV: function (data) {\n    'use strict';\n\n    var d = {};\n    var keys = Object.keys(data[0]);\n    var i, total;\n    for (i = 0, total = data.length; i < total; i += 1) {\n      d[data[i][keys[0]]] = +data[i][keys[1]];\n    }\n    return d;\n  },\n\n  /**\n   * Handle the calendar layout and dimension\n   *\n   * Expand and shrink the container depending on its children dimension\n   * Also rearrange the children position depending on their dimension,\n   * and the legend position\n   *\n   * @return void\n   */\n  resize: function () {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n    var legendWidth = options.displayLegend\n      ? parent.Legend.getDim('width') +\n        options.legendMargin[1] +\n        options.legendMargin[3]\n      : 0;\n    var legendHeight = options.displayLegend\n      ? parent.Legend.getDim('height') +\n        options.legendMargin[0] +\n        options.legendMargin[2]\n      : 0;\n\n    var graphWidth =\n      parent.graphDim.width - options.domainGutter - options.cellPadding;\n    var graphHeight =\n      parent.graphDim.height - options.domainGutter - options.cellPadding;\n\n    this.root\n      .transition()\n      .duration(options.animationDuration)\n      .attr('width', function () {\n        if (\n          options.legendVerticalPosition === 'middle' ||\n          options.legendVerticalPosition === 'center'\n        ) {\n          return graphWidth + legendWidth;\n        }\n        return Math.max(graphWidth, legendWidth);\n      })\n      .attr('height', function () {\n        if (\n          options.legendVerticalPosition === 'middle' ||\n          options.legendVerticalPosition === 'center'\n        ) {\n          return Math.max(graphHeight, legendHeight);\n        }\n        return graphHeight + legendHeight;\n      });\n\n    this.root\n      .select('.graph')\n      .transition()\n      .duration(options.animationDuration)\n      .attr('y', function () {\n        if (options.legendVerticalPosition === 'top') {\n          return legendHeight;\n        }\n        return 0;\n      })\n      .attr('x', function () {\n        if (\n          (options.legendVerticalPosition === 'middle' ||\n            options.legendVerticalPosition === 'center') &&\n          options.legendHorizontalPosition === 'left'\n        ) {\n          return legendWidth;\n        }\n        return 0;\n      });\n  },\n\n  // =========================================================================//\n  // PUBLIC API                                //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar forward\n   */\n  next: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadNextDomain(n);\n  },\n\n  /**\n   * Shift the calendar backward\n   */\n  previous: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadPreviousDomain(n);\n  },\n\n  /**\n   * Jump directly to a specific date\n   *\n   * JumpTo will scroll the calendar until the wanted domain with the specified\n   * date is visible. Unless you set reset to true, the wanted domain\n   * will not necessarily be the first (leftmost) domain of the calendar.\n   *\n   * @param Date date Jump to the domain containing that date\n   * @param bool reset Whether the wanted domain should be the first domain of the calendar\n   * @param bool True of the calendar was scrolled\n   */\n  jumpTo: function (date, reset) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      reset = false;\n    }\n    var domains = this.getDomainKeys();\n    var firstDomain = domains[0];\n    var lastDomain = domains[domains.length - 1];\n\n    if (date < firstDomain) {\n      return this.loadPreviousDomain(this.getDomain(firstDomain, date).length);\n    } else {\n      if (reset) {\n        return this.loadNextDomain(this.getDomain(firstDomain, date).length);\n      }\n\n      if (date > lastDomain) {\n        return this.loadNextDomain(this.getDomain(lastDomain, date).length);\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   * Navigate back to the start date\n   *\n   * @since  3.3.8\n   * @return void\n   */\n  rewind: function () {\n    'use strict';\n\n    this.jumpTo(this.options.start, true);\n  },\n\n  /**\n   * Update the calendar with new data\n   *\n   * @param  object|string    dataSource    The calendar's datasource, same type as this.options.data\n   * @param  boolean|function    afterLoad    Whether to execute afterLoad() on the data. Pass directly a function\n   * if you don't want to use the afterLoad() callback\n   */\n  update: function (dataSource, afterLoad, updateMode) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      dataSource = this.options.data;\n    }\n    if (arguments.length < 2) {\n      afterLoad = true;\n    }\n    if (arguments.length < 3) {\n      updateMode = this.RESET_ALL_ON_UPDATE;\n    }\n\n    var domains = this.getDomainKeys();\n    var self = this;\n    this.getDatas(\n      dataSource,\n      new Date(domains[0]),\n      this.getSubDomain(domains[domains.length - 1]).pop(),\n      function () {\n        self.fill();\n        self.afterUpdate();\n      },\n      afterLoad,\n      updateMode,\n    );\n  },\n\n  /**\n   * Set the legend\n   *\n   * @param array legend an array of integer, representing the different threshold value\n   * @param array colorRange an array of 2 hex colors, for the minimum and maximum colors\n   */\n  setLegend: function () {\n    'use strict';\n\n    var oldLegend = this.options.legend.slice(0);\n    if (arguments.length >= 1 && Array.isArray(arguments[0])) {\n      this.options.legend = arguments[0];\n    }\n    if (arguments.length >= 2) {\n      if (Array.isArray(arguments[1]) && arguments[1].length >= 2) {\n        this.options.legendColors = [arguments[1][0], arguments[1][1]];\n      } else {\n        this.options.legendColors = arguments[1];\n      }\n    }\n\n    if (\n      (arguments.length > 0 && !arrayEquals(oldLegend, this.options.legend)) ||\n      arguments.length >= 2\n    ) {\n      this.Legend.buildColors();\n      this.fill();\n    }\n\n    this.Legend.redraw(\n      this.graphDim.width -\n        this.options.domainGutter -\n        this.options.cellPadding,\n    );\n  },\n\n  /**\n   * Remove the legend\n   *\n   * @return bool False if there is no legend to remove\n   */\n  removeLegend: function () {\n    'use strict';\n\n    if (!this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = false;\n    this.Legend.remove();\n    return true;\n  },\n\n  /**\n   * Display the legend\n   *\n   * @return bool False if the legend was already displayed\n   */\n  showLegend: function () {\n    'use strict';\n\n    if (this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = true;\n    this.Legend.redraw(\n      this.graphDim.width -\n        this.options.domainGutter -\n        this.options.cellPadding,\n    );\n    return true;\n  },\n\n  /**\n   * Highlight dates\n   *\n   * Add a highlight class to a set of dates\n   *\n   * @since  3.3.5\n   * @param  array Array of dates to highlight\n   * @return bool True if dates were highlighted\n   */\n  highlight: function (args) {\n    'use strict';\n\n    if ((this.options.highlight = this.expandDateSetting(args)).length > 0) {\n      this.fill();\n      return true;\n    }\n    return false;\n  },\n\n  /**\n   * Destroy the calendar\n   *\n   * Usage: cal = cal.destroy();\n   *\n   * @since  3.3.6\n   * @param function A callback function to trigger after destroying the calendar\n   * @return null\n   */\n  destroy: function (callback) {\n    'use strict';\n\n    this.root\n      .transition()\n      .duration(this.options.animationDuration)\n      .attr('width', 0)\n      .attr('height', 0)\n      .remove()\n      .each('end', function () {\n        if (typeof callback === 'function') {\n          callback();\n        } else if (typeof callback !== 'undefined') {\n          console.log('Provided callback for destroy() is not a function.');\n        }\n      });\n\n    return null;\n  },\n\n  getSVG: function () {\n    'use strict';\n\n    var styles = {\n      '.cal-heatmap-container': {},\n      '.graph': {},\n      '.graph-rect': {},\n      'rect.highlight': {},\n      'rect.now': {},\n      'rect.highlight-now': {},\n      'text.highlight': {},\n      'text.now': {},\n      'text.highlight-now': {},\n      '.domain-background': {},\n      '.graph-label': {},\n      '.subdomain-text': {},\n      '.q0': {},\n      '.qi': {},\n    };\n\n    for (\n      var j = 1, total = this.options.legend.length + 1;\n      j <= total;\n      j += 1\n    ) {\n      styles['.q' + j] = {};\n    }\n\n    var root = this.root;\n\n    var whitelistStyles = [\n      // SVG specific properties\n      'stroke',\n      'stroke-width',\n      'stroke-opacity',\n      'stroke-dasharray',\n      'stroke-dashoffset',\n      'stroke-linecap',\n      'stroke-miterlimit',\n      'fill',\n      'fill-opacity',\n      'fill-rule',\n      'marker',\n      'marker-start',\n      'marker-mid',\n      'marker-end',\n      'alignement-baseline',\n      'baseline-shift',\n      'dominant-baseline',\n      'glyph-orientation-horizontal',\n      'glyph-orientation-vertical',\n      'kerning',\n      'text-anchor',\n      'shape-rendering',\n\n      // Text Specific properties\n      'text-transform',\n      'font-family',\n      'font',\n      'font-size',\n      'font-weight',\n    ];\n\n    var filterStyles = function (attribute, property, value) {\n      if (whitelistStyles.indexOf(property) !== -1) {\n        styles[attribute][property] = value;\n      }\n    };\n\n    var getElement = function (e) {\n      return root.select(e)[0][0];\n    };\n\n    /* jshint forin:false */\n    for (var element in styles) {\n      if (!styles.hasOwnProperty(element)) {\n        continue;\n      }\n\n      var dom = getElement(element);\n\n      if (dom === null) {\n        continue;\n      }\n\n      // The DOM Level 2 CSS way\n      /* jshint maxdepth: false */\n      if ('getComputedStyle' in window) {\n        var cs = getComputedStyle(dom, null);\n        if (cs.length !== 0) {\n          for (var i = 0; i < cs.length; i += 1) {\n            filterStyles(element, cs.item(i), cs.getPropertyValue(cs.item(i)));\n          }\n\n          // Opera workaround. Opera doesn\"t support `item`/`length`\n          // on CSSStyleDeclaration.\n        } else {\n          for (var k in cs) {\n            if (cs.hasOwnProperty(k)) {\n              filterStyles(element, k, cs[k]);\n            }\n          }\n        }\n\n        // The IE way\n      } else if ('currentStyle' in dom) {\n        var css = dom.currentStyle;\n        for (var p in css) {\n          filterStyles(element, p, css[p]);\n        }\n      }\n    }\n\n    var string =\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" ' +\n      'xmlns:xlink=\"http://www.w3.org/1999/xlink\"><style type=\"text/css\"><![CDATA[ ';\n\n    for (var style in styles) {\n      string += style + ' {\\n';\n      for (var l in styles[style]) {\n        string += '\\t' + l + ':' + styles[style][l] + ';\\n';\n      }\n      string += '}\\n';\n    }\n\n    string += ']]></style>';\n    string += new XMLSerializer().serializeToString(this.root[0][0]);\n    string += '</svg>';\n\n    return string;\n  },\n};\n\n// =========================================================================//\n// DOMAIN POSITION COMPUTATION                        //\n// =========================================================================//\n\n/**\n * Compute the position of a domain, relative to the calendar\n */\nvar DomainPosition = function () {\n  'use strict';\n\n  this.positions = d3.map();\n};\n\nDomainPosition.prototype.getPosition = function (d) {\n  'use strict';\n\n  return this.positions.get(d);\n};\n\nDomainPosition.prototype.getPositionFromIndex = function (i) {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[i]);\n};\n\nDomainPosition.prototype.getLast = function () {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.setPosition = function (d, dim) {\n  'use strict';\n\n  this.positions.set(d, dim);\n};\n\nDomainPosition.prototype.shiftRightBy = function (exitingDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value - exitingDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[0]);\n};\n\nDomainPosition.prototype.shiftLeftBy = function (enteringDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value + enteringDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.getKeys = function () {\n  'use strict';\n\n  return this.positions.keys().sort(function (a, b) {\n    return parseInt(a, 10) - parseInt(b, 10);\n  });\n};\n\n// =========================================================================//\n// LEGEND                                  //\n// =========================================================================//\n\nvar Legend = function (calendar) {\n  'use strict';\n\n  this.calendar = calendar;\n  this.computeDim();\n\n  if (calendar.options.legendColors !== null) {\n    this.buildColors();\n  }\n};\n\nLegend.prototype.computeDim = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n  this.dim = {\n    width:\n      options.legendCellSize * (options.legend.length + 1) +\n      options.legendCellPadding * options.legend.length,\n    height: options.legendCellSize,\n  };\n};\n\nLegend.prototype.remove = function () {\n  'use strict';\n\n  this.calendar.root.select('.graph-legend').remove();\n  this.calendar.resize();\n};\n\nLegend.prototype.redraw = function (width) {\n  'use strict';\n\n  if (!this.calendar.options.displayLegend) {\n    return false;\n  }\n\n  var parent = this;\n  var calendar = this.calendar;\n  var legend = calendar.root;\n  var legendItem;\n  var options = calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  this.computeDim();\n\n  var _legend = options.legend.slice(0);\n  _legend.push(_legend[_legend.length - 1] + 1);\n\n  var legendElement = calendar.root.select('.graph-legend');\n  if (legendElement[0][0] !== null) {\n    legend = legendElement;\n    legendItem = legend.select('g').selectAll('rect').data(_legend);\n  } else {\n    // Creating the new legend DOM if it doesn't already exist\n    legend =\n      options.legendVerticalPosition === 'top'\n        ? legend.insert('svg', '.graph')\n        : legend.append('svg');\n\n    legend.attr('x', getLegendXPosition()).attr('y', getLegendYPosition());\n\n    legendItem = legend\n      .attr('class', 'graph-legend')\n      .attr('height', parent.getDim('height'))\n      .attr('width', parent.getDim('width'))\n      .append('g')\n      .selectAll()\n      .data(_legend);\n  }\n\n  legendItem\n    .enter()\n    .append('rect')\n    .call(legendCellLayout)\n    .attr('class', function (d) {\n      return calendar.Legend.getClass(d, calendar.legendScale === null);\n    })\n    .attr('fill-opacity', 0)\n    .call(function (selection) {\n      if (\n        calendar.legendScale !== null &&\n        options.legendColors !== null &&\n        options.legendColors.hasOwnProperty('base')\n      ) {\n        selection.attr('fill', options.legendColors.base);\n      }\n    })\n    .append('title');\n\n  legendItem\n    .exit()\n    .transition()\n    .duration(options.animationDuration)\n    .attr('fill-opacity', 0)\n    .remove();\n\n  legendItem\n    .transition()\n    .delay(function (d, i) {\n      return (options.animationDuration * i) / 10;\n    })\n    .call(legendCellLayout)\n    .attr('fill-opacity', 1)\n    .call(function (element) {\n      element.attr('fill', function (d, i) {\n        if (calendar.legendScale === null) {\n          return '';\n        }\n\n        if (i === 0) {\n          return calendar.legendScale(d - 1);\n        }\n        return calendar.legendScale(options.legend[i - 1]);\n      });\n\n      element.attr('class', function (d) {\n        return calendar.Legend.getClass(d, calendar.legendScale === null);\n      });\n    });\n\n  function legendCellLayout(selection) {\n    selection\n      .attr('width', options.legendCellSize)\n      .attr('height', options.legendCellSize)\n      .attr('rx', options.legendCellRadius)\n      .attr('ry', options.legendCellRadius)\n      .attr('x', function (d, i) {\n        return i * (options.legendCellSize + options.legendCellPadding);\n      });\n  }\n\n  legendItem.select('title').text(function (d, i) {\n    if (i === 0) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.lower, {\n        min: options.legend[i],\n        name: options.itemName[1],\n      });\n    } else if (i === _legend.length - 1) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.upper, {\n        max: options.legend[i - 1],\n        name: options.itemName[1],\n      });\n    } else {\n      return calendar.formatStringWithObject(options.legendTitleFormat.inner, {\n        down: options.legend[i - 1],\n        up: options.legend[i],\n        name: options.itemName[1],\n      });\n    }\n  });\n  legendItem\n    .on('mouseover', function (d) {\n      calendar.legendTip.show(d, this);\n    })\n    .on('mouseout', function () {\n      calendar.legendTip.hide();\n    });\n\n  legend\n    .transition()\n    .duration(options.animationDuration)\n    .attr('x', getLegendXPosition())\n    .attr('y', getLegendYPosition())\n    .attr('width', parent.getDim('width'))\n    .attr('height', parent.getDim('height'));\n\n  legend\n    .select('g')\n    .transition()\n    .duration(options.animationDuration)\n    .attr('transform', function () {\n      if (options.legendOrientation === 'vertical') {\n        return (\n          'rotate(90 ' +\n          options.legendCellSize / 2 +\n          ' ' +\n          options.legendCellSize / 2 +\n          ')'\n        );\n      }\n      return '';\n    });\n\n  function getLegendXPosition() {\n    switch (options.legendHorizontalPosition) {\n      case 'right':\n        if (\n          options.legendVerticalPosition === 'center' ||\n          options.legendVerticalPosition === 'middle'\n        ) {\n          return width + options.legendMargin[3];\n        }\n        return width - parent.getDim('width') - options.legendMargin[1];\n      case 'middle':\n      case 'center':\n        return Math.round(width / 2 - parent.getDim('width') / 2);\n      default:\n        return options.legendMargin[3];\n    }\n  }\n\n  function getLegendYPosition() {\n    if (options.legendVerticalPosition === 'bottom') {\n      return (\n        calendar.graphDim.height +\n        options.legendMargin[0] -\n        options.domainGutter -\n        options.cellPadding\n      );\n    }\n    return options.legendMargin[0];\n  }\n\n  calendar.resize();\n};\n\n/**\n * Return the dimension of the legend\n *\n * Takes into account rotation\n *\n * @param  string axis Width or height\n * @return int height or width in pixels\n */\nLegend.prototype.getDim = function (axis) {\n  'use strict';\n\n  var isHorizontal = this.calendar.options.legendOrientation === 'horizontal';\n\n  switch (axis) {\n    case 'width':\n      return this.dim[isHorizontal ? 'width' : 'height'];\n    case 'height':\n      return this.dim[isHorizontal ? 'height' : 'width'];\n  }\n};\n\nLegend.prototype.buildColors = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  if (options.legendColors === null) {\n    this.calendar.legendScale = null;\n    return false;\n  }\n\n  var _colorRange = [];\n\n  if (Array.isArray(options.legendColors)) {\n    _colorRange = options.legendColors;\n  } else if (\n    options.legendColors.hasOwnProperty('min') &&\n    options.legendColors.hasOwnProperty('max')\n  ) {\n    _colorRange = [options.legendColors.min, options.legendColors.max];\n  } else {\n    options.legendColors = null;\n    return false;\n  }\n\n  var _legend = options.legend.slice(0);\n\n  if (_legend[0] > 0) {\n    _legend.unshift(0);\n  } else if (_legend[0] <= 0) {\n    // Let's guess the leftmost value, it we have to add one\n    _legend.unshift(\n      _legend[0] - (_legend[_legend.length - 1] - _legend[0]) / _legend.length,\n    );\n  }\n  var colorScale;\n  if (options.legendColors.hasOwnProperty('colorScale')) {\n    colorScale = options.legendColors.colorScale;\n  } else {\n    colorScale = d3.scale\n      .linear()\n      .range(_colorRange)\n      .interpolate(d3.interpolateHcl)\n      .domain([d3.min(_legend), d3.max(_legend)]);\n  }\n\n  var legendColors = _legend.map(function (element) {\n    return colorScale(element);\n  });\n  this.calendar.legendScale = d3.scale\n    .threshold()\n    .domain(options.legend)\n    .range(legendColors);\n\n  return true;\n};\n\n/**\n * Return the classname on the legend for the specified value\n *\n * @param integer n Value associated to a date\n * @param bool withCssClass Whether to display the css class used to style the cell.\n *                          Disabling will allow styling directly via html fill attribute\n *\n * @return string Classname according to the legend\n */\nLegend.prototype.getClass = function (n, withCssClass) {\n  'use strict';\n\n  if (n === null || isNaN(n)) {\n    return '';\n  }\n\n  var index = [this.calendar.options.legend.length + 1];\n\n  for (\n    var i = 0, total = this.calendar.options.legend.length - 1;\n    i <= total;\n    i += 1\n  ) {\n    if (this.calendar.options.legend[0] > 0 && n < 0) {\n      index = ['1', 'i'];\n      break;\n    }\n\n    if (n <= this.calendar.options.legend[i]) {\n      index = [i + 1];\n      break;\n    }\n  }\n\n  if (n === 0) {\n    index.push(0);\n  }\n\n  index.unshift('');\n  return (index.join(' r') + (withCssClass ? index.join(' q') : '')).trim();\n};\n\n/**\n * #source http://stackoverflow.com/a/383245/805649\n */\nfunction mergeRecursive(obj1, obj2) {\n  'use strict';\n\n  /*jshint forin:false */\n  for (var p in obj2) {\n    try {\n      // Property in destination object set; update its value.\n      if (obj2[p].constructor === Object) {\n        obj1[p] = mergeRecursive(obj1[p], obj2[p]);\n      } else {\n        obj1[p] = obj2[p];\n      }\n    } catch (e) {\n      // Property in destination object not set; create it and set its value.\n      obj1[p] = obj2[p];\n    }\n  }\n\n  return obj1;\n}\n\n/**\n * Check if 2 arrays are equals\n *\n * @link http://stackoverflow.com/a/14853974/805649\n * @param  array array the array to compare to\n * @return bool true of the 2 arrays are equals\n */\nfunction arrayEquals(arrayA, arrayB) {\n  'use strict';\n\n  // if the other array is a falsy value, return\n  if (!arrayB || !arrayA) {\n    return false;\n  }\n\n  // compare lengths - can save a lot of time\n  if (arrayA.length !== arrayB.length) {\n    return false;\n  }\n\n  for (var i = 0; i < arrayA.length; i += 1) {\n    // Check if we have nested arrays\n    if (arrayA[i] instanceof Array && arrayB[i] instanceof Array) {\n      // recurse into the nested arrays\n      if (!arrayEquals(arrayA[i], arrayB[i])) {\n        return false;\n      }\n    } else if (arrayA[i] !== arrayB[i]) {\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\n      return false;\n    }\n  }\n  return true;\n}\n\nexport default CalHeatMap;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { extent as d3Extent, range as d3Range } from 'd3-array';\nimport { select as d3Select } from 'd3-selection';\nimport { getSequentialSchemeRegistry, t } from '@superset-ui/core';\nimport CalHeatMap from './vendor/cal-heatmap';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    // Object hashed by metric name,\n    // then hashed by timestamp (in seconds, not milliseconds) as float\n    // the innermost value is count\n    // e.g. { count_distinct_something: { 1535034236.0: 3 } }\n    data: PropTypes.object,\n    domain: PropTypes.string,\n    range: PropTypes.number,\n    // timestamp in milliseconds\n    start: PropTypes.number,\n    subdomain: PropTypes.string,\n  }),\n  height: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellPadding: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellRadius: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellSize: PropTypes.number,\n  linearColorScheme: PropTypes.string,\n  showLegend: PropTypes.bool,\n  showMetricName: PropTypes.bool,\n  showValues: PropTypes.bool,\n  steps: PropTypes.number,\n  timeFormatter: PropTypes.func,\n  valueFormatter: PropTypes.func,\n  verboseMap: PropTypes.object,\n  theme: PropTypes.object,\n};\n\nfunction Calendar(element, props) {\n  const {\n    data,\n    height,\n    cellPadding = 3,\n    cellRadius = 0,\n    cellSize = 10,\n    domainGranularity,\n    linearColorScheme,\n    showLegend,\n    showMetricName,\n    showValues,\n    steps,\n    subdomainGranularity,\n    timeFormatter,\n    valueFormatter,\n    verboseMap,\n    theme,\n  } = props;\n\n  const container = d3Select(element)\n    .classed('superset-legacy-chart-calendar', true)\n    .style('height', height);\n  container.selectAll('*').remove();\n  const div = container.append('div');\n\n  const subDomainTextFormat = showValues\n    ? (date, value) => valueFormatter(value)\n    : null;\n\n  const metricsData = data.data;\n\n  const METRIC_TEXT = t('Metric');\n\n  Object.keys(metricsData).forEach(metric => {\n    const calContainer = div.append('div');\n    if (showMetricName) {\n      calContainer.text(`${METRIC_TEXT}: ${verboseMap[metric] || metric}`);\n    }\n    const timestamps = metricsData[metric];\n    const extents = d3Extent(Object.keys(timestamps), key => timestamps[key]);\n    const step = (extents[1] - extents[0]) / (steps - 1);\n    const colorScale = getSequentialSchemeRegistry()\n      .get(linearColorScheme)\n      .createLinearScale(extents);\n\n    const legend = d3Range(steps).map(i => extents[0] + step * i);\n    const legendColors = legend.map(x => colorScale(x));\n\n    const cal = new CalHeatMap();\n    cal.init({\n      start: data.start,\n      data: timestamps,\n      itemSelector: calContainer.node(),\n      legendVerticalPosition: 'top',\n      cellSize,\n      cellPadding,\n      cellRadius,\n      legendCellSize: cellSize,\n      legendCellPadding: 2,\n      legendCellRadius: cellRadius,\n      tooltip: true,\n      domain: domainGranularity,\n      subDomain: subdomainGranularity,\n      range: data.range,\n      browsing: true,\n      legend,\n      legendColors: {\n        colorScale,\n        min: legendColors[0],\n        max: legendColors[legendColors.length - 1],\n        empty: theme.colors.grayscale.light5,\n      },\n      displayLegend: showLegend,\n      itemName: '',\n      valueFormatter,\n      timeFormatter,\n      subDomainTextFormat,\n    });\n  });\n}\n\nCalendar.displayName = 'Calendar';\nCalendar.propTypes = propTypes;\n\nexport default Calendar;\n","export default function(values, valueof) {\n  let min;\n  let max;\n  if (valueof === undefined) {\n    for (const value of values) {\n      if (value != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  }\n  return [min, max];\n}\n","export default function(start, stop, step) {\n  start = +start, stop = +stop, step = (n = arguments.length) < 2 ? (stop = start, start = 0, 1) : n < 3 ? 1 : +step;\n\n  var i = -1,\n      n = Math.max(0, Math.ceil((stop - start) / step)) | 0,\n      range = new Array(n);\n\n  while (++i < n) {\n    range[i] = start + i * step;\n  }\n\n  return range;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { reactify, styled, css, useTheme } from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport Component from './Calendar';\n\nconst ReactComponent = reactify(Component);\n\nconst Calendar = ({ className, ...otherProps }) => {\n  const theme = useTheme();\n  return (\n    <div className={className}>\n      <Global\n        styles={css`\n          .d3-tip {\n            line-height: 1;\n            padding: ${theme.gridUnit * 3}px;\n            background: ${theme.colors.grayscale.dark2};\n            color: ${theme.colors.grayscale.light5};\n            border-radius: 4px;\n            pointer-events: none;\n            z-index: 1000;\n            font-size: ${theme.typography.sizes.s}px;\n          }\n          /* Creates a small triangle extender for the tooltip */\n          .d3-tip:after {\n            box-sizing: border-box;\n            display: inline;\n            font-size: ${theme.typography.sizes.xs};\n            width: 100%;\n            line-height: 1;\n            color: ${theme.colors.grayscale.dark2};\n            position: absolute;\n            pointer-events: none;\n          }\n          /* Northward tooltips */\n          .d3-tip.n:after {\n            content: '\\\\25BC';\n            margin: -${theme.gridUnit}px 0 0 0;\n            top: 100%;\n            left: 0;\n            text-align: center;\n          }\n          /* Eastward tooltips */\n          .d3-tip.e:after {\n            content: '\\\\25C0';\n            margin: -${theme.gridUnit}px 0 0 0;\n            top: 50%;\n            left: -${theme.gridUnit * 2}px;\n          }\n          /* Southward tooltips */\n          .d3-tip.s:after {\n            content: '\\\\25B2';\n            margin: 0;\n            top: -${theme.gridUnit * 2}px;\n            left: 0;\n            text-align: center;\n          }\n          /* Westward tooltips */\n          .d3-tip.w:after {\n            content: '\\\\25B6';\n            margin: -${theme.gridUnit}px 0 0 0px;\n            top: 50%;\n            left: 100%;\n          }\n        `}\n      />\n      <ReactComponent {...otherProps} theme={theme} />\n    </div>\n  );\n};\n\nCalendar.defaultProps = {\n  otherProps: {},\n};\n\nCalendar.propTypes = {\n  className: PropTypes.string.isRequired,\n  otherProps: PropTypes.objectOf(PropTypes.any),\n};\n\nexport default styled(Calendar)`\n  ${({ theme }) => `\n    .superset-legacy-chart-calendar {\n      padding: ${theme.gridUnit * 3}px;\n      position: static !important;\n      overflow: auto !important;\n    }\n\n    .superset-legacy-chart-calendar .ch-tooltip {\n      margin-left: ${theme.gridUnit * 5}px;\n      margin-top: ${theme.gridUnit}px;\n    }\n\n    .superset-legacy-chart-calendar .d3-tip {\n      line-height: 1;\n      padding: ${theme.gridUnit * 3}px;\n      background: ${theme.colors.grayscale.dark2};\n      color: ${theme.colors.grayscale.light5};\n      border-radius: ${theme.borderRadius}px;\n      pointer-events: none;\n      z-index: 1000;\n    }\n\n    .cal-heatmap-container {\n      display: block;\n    }\n\n    .cal-heatmap-container .graph-label {\n      fill: ${theme.colors.grayscale.base};\n      font-size: ${theme.typography.sizes.xs}px;\n    }\n\n    .cal-heatmap-container .graph,\n    .cal-heatmap-container .graph-legend rect {\n      shape-rendering: crispedges;\n    }\n\n    .cal-heatmap-container .graph-rect {\n      fill: ${theme.colors.grayscale.light2};\n    }\n\n    .cal-heatmap-container .graph-subdomain-group rect:hover {\n      stroke: ${theme.colors.grayscale.dark2};\n      stroke-width: 1px;\n    }\n\n    .cal-heatmap-container .subdomain-text {\n      font-size: ${theme.typography.sizes.xs}px;\n      pointer-events: none;\n    }\n\n    .cal-heatmap-container .hover_cursor:hover {\n      cursor: pointer;\n    }\n\n    .cal-heatmap-container .qi {\n      background-color: ${theme.colors.grayscale.base};\n      fill: ${theme.colors.grayscale.base};\n    }\n\n    .cal-heatmap-container .q1 {\n      background-color: ${theme.colors.alert.light2};\n      fill: ${theme.colors.alert.light2};\n    }\n\n    .cal-heatmap-container .q2 {\n      background-color: ${theme.colors.alert.light1};\n      fill: ${theme.colors.alert.light1};\n    }\n\n    .cal-heatmap-container .q3 {\n      background-color: ${theme.colors.success.light1};\n      fill: ${theme.colors.success.light1};\n    }\n\n    .cal-heatmap-container .q4 {\n      background-color: ${theme.colors.success.base};\n      fill: ${theme.colors.success.base};\n    }\n\n    .cal-heatmap-container .q5 {\n      background-color: ${theme.colors.success.dark1};\n      fill: ${theme.colors.success.dark1};\n    }\n\n    .cal-heatmap-container rect.highlight {\n      stroke: ${theme.colors.grayscale.dark1};\n      stroke-width: 1;\n    }\n\n    .cal-heatmap-container text.highlight {\n      fill: ${theme.colors.grayscale.dark1};\n    }\n\n    .cal-heatmap-container rect.highlight-now {\n      stroke: ${theme.colors.error.base};\n    }\n\n    .cal-heatmap-container text.highlight-now {\n      fill: ${theme.colors.error.base};\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    .cal-heatmap-container .domain-background {\n      fill: none;\n      shape-rendering: crispedges;\n    }\n\n    .ch-tooltip {\n      padding: ${theme.gridUnit * 2}px;\n      background: ${theme.colors.grayscale.dark1};\n      color: ${theme.colors.grayscale.light1};\n      font-size: ${theme.typography.sizes.s}px;\n      line-height: 1.4;\n      width: 140px;\n      position: absolute;\n      z-index: 99999;\n      text-align: center;\n      border-radius: ${theme.borderRadius}px;\n      box-shadow: 2px 2px 2px ${theme.colors.grayscale.dark2};\n      display: none;\n      box-sizing: border-box;\n    }\n\n    .ch-tooltip::after {\n      position: absolute;\n      width: 0;\n      height: 0;\n      border-color: transparent;\n      border-style: solid;\n      content: '';\n      padding: 0;\n      display: block;\n      bottom: -${theme.gridUnit}px;\n      left: 50%;\n      margin-left: -${theme.gridUnit}px;\n      border-width: ${theme.gridUnit}px ${theme.gridUnit}px 0;\n      border-top-color: ${theme.colors.grayscale.dark1};\n    }\n  `}\n`;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\n\n// TODO: Note that id and className can collide between Props and ReactifyProps\n// leading to (likely) unexpected behaviors. We should either require Props to not\n// contain an id/className, or not combine them (via intersection), instead preferring\n// wrapping (composition). As an example:\n// interface MyProps {\n//   id: number;\n// }\n// function myRender(container: HTMLDivElement, props: Readonly<MyProps>): void {\n//   props.id // unusable: id is string & number\n// }\n// new (reactify(myRender))({ id: 5 }); // error: id has to be string & number\n\nexport type ReactifyProps = {\n  id?: string;\n  className?: string;\n};\n\n// TODO: add more React lifecycle callbacks as needed\nexport type LifeCycleCallbacks = {\n  componentWillUnmount?: () => void;\n};\n\nexport interface RenderFuncType<Props> {\n  (container: HTMLDivElement, props: Readonly<Props & ReactifyProps>): void;\n  displayName?: string;\n  defaultProps?: Partial<Props & ReactifyProps>;\n  propTypes?: React.WeakValidationMap<Props & ReactifyProps>;\n}\n\nexport default function reactify<Props extends object>(\n  renderFn: RenderFuncType<Props>,\n  callbacks?: LifeCycleCallbacks,\n): React.ComponentClass<Props & ReactifyProps> {\n  class ReactifiedComponent extends React.Component<Props & ReactifyProps> {\n    container?: HTMLDivElement;\n\n    constructor(props: Props & ReactifyProps) {\n      super(props);\n      this.setContainerRef = this.setContainerRef.bind(this);\n    }\n\n    componentDidMount() {\n      this.execute();\n    }\n\n    componentDidUpdate() {\n      this.execute();\n    }\n\n    componentWillUnmount() {\n      this.container = undefined;\n      if (callbacks?.componentWillUnmount) {\n        callbacks.componentWillUnmount.bind(this)();\n      }\n    }\n\n    setContainerRef(ref: HTMLDivElement) {\n      this.container = ref;\n    }\n\n    execute() {\n      if (this.container) {\n        renderFn(this.container, this.props);\n      }\n    }\n\n    render() {\n      const { id, className } = this.props;\n\n      return <div ref={this.setContainerRef} id={id} className={className} />;\n    }\n  }\n\n  const ReactifiedClass: React.ComponentClass<Props & ReactifyProps> =\n    ReactifiedComponent;\n\n  if (renderFn.displayName) {\n    ReactifiedClass.displayName = renderFn.displayName;\n  }\n  // eslint-disable-next-line react/forbid-foreign-prop-types\n  if (renderFn.propTypes) {\n    ReactifiedClass.propTypes = {\n      ...ReactifiedClass.propTypes,\n      ...renderFn.propTypes,\n    };\n  }\n  if (renderFn.defaultProps) {\n    ReactifiedClass.defaultProps = renderFn.defaultProps;\n  }\n\n  return ReactifiedComponent;\n}\n"],"names":["d3","require","CalHeatMap","self","this","type","tip","d3tip","attr","direction","offset","html","d","options","timeFormatter","t","valueFormatter","v","legendTip","allowedDataType","itemSelector","paintOnLoad","range","cellSize","cellPadding","cellRadius","domainGutter","domainMargin","domain","subDomain","colLimit","rowLimit","weekStartOnMonday","start","Date","minDate","maxDate","data","dataType","dataPostPayload","dataRequestHeaders","considerMissingDataAsZero","loadOnInit","verticalOrientation","domainDynamicDimension","label","position","align","x","y","rotate","width","height","legend","displayLegend","legendCellSize","legendCellPadding","legendMargin","legendVerticalPosition","legendHorizontalPosition","legendOrientation","legendColors","highlight","itemName","domainLabelFormat","subDomainTitleFormat","empty","filled","subDomainDateFormat","subDomainTextFormat","legendTitleFormat","lower","inner","upper","animationDuration","nextSelector","previousSelector","itemNamespace","tooltip","onClick","afterLoad","afterLoadNextDomain","afterLoadPreviousDomain","onComplete","afterLoadData","afterUpdate","onMaxDomainReached","onMinDomainReached","_domainType","min","name","level","maxItemNumber","defaultRowNumber","defaultColumnNumber","row","getSubDomainRowNumber","column","getSubDomainColumnNumber","Math","floor","getMinutes","format","date","connector","extractUnit","getFullYear","getMonth","getDate","getHours","getTime","hour","getDayCountInMonth","getWeekDay","p","day","getDayCountInYear","getWeekNumber","getDayOfYear","week","getMonthWeekNumber","dt","weekDay","getDay","setDate","month","year","hasOwnProperty","w","outer","arguments","length","domainHorizontalLabelWidth","h","domainVerticalLabelHeight","lastInsertedSvg","_completed","_domains","map","graphDim","legendDim","NAVIGATE_LEFT","NAVIGATE_RIGHT","RESET_ALL_ON_UPDATE","RESET_SINGLE_ON_UPDATE","APPEND_ON_UPDATE","DEFAULT_LEGEND_MARGIN","root","_maxDomainReached","_minDomainReached","domainPosition","DomainPosition","Legend","legendScale","DSTDomain","_init","getDomain","set","getSubDomain","select","append","verticalDomainLabel","max","paint","on","event","preventDefault","loadNextDomain","loadPreviousDomain","redraw","domains","getDomainKeys","getDatas","pop","fill","checkIfMinDomainIsReached","checkIfMaxDomainIsReached","getNextDomain","_initCalendar","call","navigationDir","domainSvg","selectAll","reverse","enteringDomainDim","exitingDomainDim","svg","enter","getDomainPosition","classname","domainIndex","axis","domainDim","tmp","setPosition","getPositionFromIndex","shiftRightBy","getLast","shiftLeftBy","subDomainSvgGroup","rect","get","domainRotate","selection","s","getHighlightClassName","positionSubDomainX","positionSubDomainY","base","show","hide","text","formatDate","transition","duration","getPosition","tempWidth","tempHeight","exit","remove","resize","prototype","init","settings","parent","mergeRecursive","substring","Error","validateDomainType","validateSelector","indexOf","error","console","log","message","getOptimalSubDomain","value","k","selector","canBeFalse","Element","expandMarginSetting","Array","isArray","slice","expandDateSetting","expandItemName","parseRowLimit","autoAddLegendMargin","autoAlignLabel","filter","addStyle","element","overflow","formatSubDomainText","htmlClass","trim","split","pastDate","dateIsLessThan","sameDate","dateIsEqual","push","getClass","join","getSubDomainTitle","rgb","getContrastingColor","formatStringWithObject","formatted","args","prop","regexp","RegExp","replace","triggerEvent","eventName","successArgs","skip","apply","itemNb","response","shift","reached","upperBound","minDomainIsReached","maxDomainIsReached","lowerBound","formatNumber","f","time","count","n","bound","loadNewDomains","end","newDomains","backward","i","total","buildSubDomain","datetimestamp","keys","parseInt","sort","a","b","index","ceil","j","isNow","dateA","dateB","normalizedMillis","subdomain","monthFirstWeekNumber","getWeekNumberInYear","getEndOfMonth","jumpDate","step","setHours","setMonth","setFullYear","getMinuteDomain","stop","minutes","getHourDomain","hours","splice","abs","getDayDomain","days","getWeekDomain","weekStart","endDate","mondays","sundays","getMonthDomain","months","getYearDomain","years","computeMinSubDomainSize","computeHourSubDomainSize","computeDaySubDomainSize","endOfMonth","endWeekNb","startWeekNb","computeWeekSubDomainSize","getPreviousDomain","source","startDate","callback","updateMode","_callback","interpretCSV","parseDatas","url","parseURI","requestType","payload","xhr","json","csv","tsv","header","send","Object","forEach","key","array","temp","extractTime","domainUnit","has","isNaN","subDomainsData","str","toISOString","legendWidth","getDim","legendHeight","graphWidth","graphHeight","next","previous","jumpTo","reset","firstDomain","lastDomain","rewind","update","dataSource","setLegend","oldLegend","arrayEquals","buildColors","removeLegend","showLegend","destroy","each","getSVG","styles","e","whitelistStyles","filterStyles","attribute","property","dom","window","cs","getComputedStyle","item","getPropertyValue","css","currentStyle","string","style","l","XMLSerializer","serializeToString","positions","getKeys","dim","calendar","computeDim","obj1","obj2","constructor","arrayA","arrayB","legendItem","_legend","legendElement","legendCellLayout","legendCellRadius","getLegendXPosition","round","getLegendYPosition","insert","delay","down","up","isHorizontal","_colorRange","colorScale","unshift","scale","linear","interpolate","interpolateHcl","threshold","withCssClass","propTypes","PropTypes","linearColorScheme","showMetricName","showValues","steps","verboseMap","theme","Calendar","props","domainGranularity","subdomainGranularity","container","d3Select","classed","div","metricsData","METRIC_TEXT","metric","calContainer","timestamps","extents","values","valueof","undefined","d3Extent","getSequentialSchemeRegistry","createLinearScale","d3Range","node","browsing","colors","grayscale","light5","displayName","ReactComponent","reactify","Component","className","otherProps","useTheme","gridUnit","dark2","typography","sizes","xs","defaultProps","styled","borderRadius","light2","alert","light1","success","dark1","weights","bold","renderFn","callbacks","ReactifiedComponent","React","super","setContainerRef","bind","componentDidMount","execute","componentDidUpdate","componentWillUnmount","ref","render","id","ReactifiedClass"],"sourceRoot":""}