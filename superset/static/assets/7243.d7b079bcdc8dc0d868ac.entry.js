"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7243],{52256:(e,t,n)=>{n.r(t),n.d(t,{CHART_UPDATE_STARTED:()=>E,chartUpdateStarted:()=>T,CHART_UPDATE_SUCCEEDED:()=>S,chartUpdateSucceeded:()=>x,CHART_UPDATE_STOPPED:()=>w,chartUpdateStopped:()=>A,CHART_UPDATE_FAILED:()=>R,chartUpdateFailed:()=>D,CHART_RENDERING_FAILED:()=>O,chartRenderingFailed:()=>M,CHART_RENDERING_SUCCEEDED:()=>L,chartRenderingSucceeded:()=>N,REMOVE_CHART:()=>I,removeChart:()=>k,ANNOTATION_QUERY_SUCCESS:()=>F,annotationQuerySuccess:()=>P,ANNOTATION_QUERY_STARTED:()=>$,annotationQueryStarted:()=>U,ANNOTATION_QUERY_FAILED:()=>V,annotationQueryFailed:()=>q,DYNAMIC_PLUGIN_CONTROLS_READY:()=>j,dynamicPluginControlsReady:()=>H,getChartDataRequest:()=>z,runAnnotationQuery:()=>B,TRIGGER_QUERY:()=>G,triggerQuery:()=>W,RENDER_TRIGGERED:()=>K,renderTriggered:()=>Y,UPDATE_QUERY_FORM_DATA:()=>Q,updateQueryFormData:()=>J,UPDATE_CHART_ID:()=>X,updateChartId:()=>ee,ADD_CHART:()=>te,addChart:()=>ne,exploreJSON:()=>ae,GET_SAVED_CHART:()=>oe,getSavedChart:()=>re,POST_CHART_FORM_DATA:()=>ie,postChartFormData:()=>le,redirectSQLLab:()=>se,refreshChart:()=>ce,getDatasourceSamples:()=>de});var a=n(78580),o=n.n(a),r=n(30381),i=n.n(r),l=n(31069),s=n(55867),c=n(37731),d=n(35854),u=n(91877),p=n(93185),h=n(12515),m=n(10945),g=n(72570),v=n(97381),f=n(3741),b=n(98286),y=n(9679),_=n(86374),C=n(74599),Z=n(77997);const E="CHART_UPDATE_STARTED";function T(e,t,n){return{type:E,queryController:e,latestQueryFormData:t,key:n}}const S="CHART_UPDATE_SUCCEEDED";function x(e,t){return{type:S,queriesResponse:e,key:t}}const w="CHART_UPDATE_STOPPED";function A(e){return{type:w,key:e}}const R="CHART_UPDATE_FAILED";function D(e,t){return{type:R,queriesResponse:e,key:t}}const O="CHART_RENDERING_FAILED";function M(e,t,n){return{type:O,error:e,key:t,stackTrace:n}}const L="CHART_RENDERING_SUCCEEDED";function N(e){return{type:L,key:e}}const I="REMOVE_CHART";function k(e){return{type:I,key:e}}const F="ANNOTATION_QUERY_SUCCESS";function P(e,t,n){return{type:F,annotation:e,queryResponse:t,key:n}}const $="ANNOTATION_QUERY_STARTED";function U(e,t,n){return{type:$,annotation:e,queryController:t,key:n}}const V="ANNOTATION_QUERY_FAILED";function q(e,t,n){return{type:V,annotation:e,queryResponse:t,key:n}}const j="DYNAMIC_PLUGIN_CONTROLS_READY",H=()=>(e,t)=>{const n=t(),a=(0,d.R3)(n.explore,n.explore.form_data);e({type:j,key:a.slice_id.value,controlsState:a})};async function z(e){let{formData:t,setDataMask:n=(()=>{}),resultFormat:a="json",resultType:o="full",force:r=!1,method:i="POST",requestParams:s={},ownState:c={}}=e,d={...s};return _._&&(d={...d,mode:"cors",credentials:"include"}),(0,h.kP)(t)?async function(e,t,n,a,o,r){var i;void 0===o&&(o="POST"),void 0===r&&(r={});const s=(0,h.pd)({resultFormat:t,resultType:n}),c=_._&&(null==(i=r)?void 0:i.dashboard_id),d=(0,h.H6)({formData:e,endpointType:s,force:a,allowDomainSharding:c,method:o,requestParams:r.dashboard_id?{dashboard_id:r.dashboard_id}:{}}),m={...r,url:d,postPayload:{form_data:e},parseMethod:"json-bigint"};return((0,u.cr)(p.T.CLIENT_CACHE)?l.Z.get:l.Z.post)(m).then((e=>{let{json:t,response:n}=e;return{response:n,json:{result:[t]}}}))}(t,a,o,r,i,d):(async(e,t,n,a,o,r,i)=>{const s=(0,h.u)({formData:e,resultType:n,resultFormat:t,force:a,setDataMask:r,ownState:i}),{slice_id:c}=e,{dashboard_id:d}=o,u={};void 0!==c&&(u.form_data=`{"slice_id":${c}}`),void 0!==d&&(u.dashboard_id=d),!1!==a&&(u.force=a);const p=_._&&(null==o?void 0:o.dashboard_id),m=(0,h.kN)({path:"/api/v1/chart/data",qs:u,allowDomainSharding:p}).toString(),g={...o,url:m,headers:{"Content-Type":"application/json"},body:JSON.stringify(s),parseMethod:"json-bigint"};return l.Z.post(g)})(t,a,o,r,d,n,c)}function B(e){let{annotation:t,timeout:n=60,formData:a=null,key:r,isDashboardRequest:i=!1,force:s=!1}=e;return function(e,c){var d;const u=r||Object.keys(c().charts)[0],p={...a||c().charts[u].latestQueryFormData};if(!(0,m.m7)(t.sourceType))return Promise.resolve();const g=p.time_grain_sqla||p.granularity;p.time_grain_sqla=g,p.granularity=g;const v=Object.keys(t.overrides);(o()(v).call(v,"since")||o()(v).call(v,"until"))&&(t.overrides={...t.overrides,time_range:null});const f=Object.keys(t.overrides).reduce(((e,n)=>({...e,[n]:t.overrides[n]||p[n]})),{});if(!i&&p){const e=p.extra_filters&&p.extra_filters.length>0;f.extra_filters=e?p.extra_filters:void 0}const y=(0,h.xW)(t.value,s),_=new AbortController,{signal:C}=_;e(U(t,_,u));const Z=null==p||null==(d=p.annotation_layers)?void 0:d.findIndex((e=>e.name===t.name));return Z>=0&&(p.annotation_layers[Z].overrides=f),l.Z.post({url:y,signal:C,timeout:1e3*n,headers:{"Content-Type":"application/json"},jsonPayload:(0,h.u)({formData:p,force:s,resultFormat:"json",resultType:"full"})}).then((n=>{var a,o,r;let{json:i}=n;const l=null==i||null==(a=i.result)||null==(o=a[0])||null==(r=o.annotation_data)?void 0:r[t.name];return e(P(t,{data:l},u))})).catch((n=>(0,b.O$)(n).then((n=>{var a;"timeout"===n.statusText?e(q(t,{error:"Query timeout"},u)):o()(a=(n.error||"").toLowerCase()).call(a,"no data")?e(P(t,n,u)):"abort"!==n.statusText&&e(q(t,n,u))}))))}}const G="TRIGGER_QUERY";function W(e,t){return void 0===e&&(e=!0),{type:G,value:e,key:t}}const K="RENDER_TRIGGERED";function Y(e,t){return{type:K,value:e,key:t}}const Q="UPDATE_QUERY_FORM_DATA";function J(e,t){return{type:Q,value:e,key:t}}const X="UPDATE_CHART_ID";function ee(e,t){return void 0===t&&(t=0),{type:X,newId:e,key:t}}const te="ADD_CHART";function ne(e,t){return{type:te,chart:e,key:t}}function ae(e,t,n,a,o,r,l){return void 0===t&&(t=!1),void 0===n&&(n=60),async s=>{const c=f.Yd.getTimestamp(),d=new AbortController,m={signal:d.signal,timeout:1e3*n};r&&(m.dashboard_id=r);const g=z({setDataMask:t=>{s((0,C.eG)(e.slice_id,t))},formData:e,resultFormat:"json",resultType:"full",force:t,method:o,requestParams:m,ownState:l});s(T(d,e,a));const y=g.then((t=>{let{response:n,json:a}=t;if((0,u.cr)(p.T.GLOBAL_ASYNC_QUERIES)){const t="result"in a?a.result:a;switch(n.status){case 200:return Promise.resolve(t);case 202:return(0,h.kP)(e)?(0,Z.YJ)(t[0]):(0,Z.YJ)(t);default:throw new Error(`Received unexpected response status (${n.status}) while fetching chart data`)}}return a.result})).then((n=>(n.forEach((n=>s((0,v.logEvent)(f.W9,{slice_id:a,applied_filters:n.applied_filters,is_cached:n.is_cached,force_refresh:t,row_count:n.rowcount,datasource:e.datasource,start_offset:c,ts:(new Date).getTime(),duration:f.Yd.getTimestamp()-c,has_extra_filters:e.extra_filters&&e.extra_filters.length>0,viz_type:e.viz_type,data_age:n.is_cached?i()(new Date).diff(i().utc(n.cached_dttm)):null})))),s(x(n,a))))).catch((t=>{if((0,u.cr)(p.T.GLOBAL_ASYNC_QUERIES))return s(D([t],a));const n=(t,n)=>{s((0,v.logEvent)(f.W9,{slice_id:a,has_err:!0,is_cached:n,error_details:t,datasource:e.datasource,start_offset:c,ts:(new Date).getTime(),duration:f.Yd.getTimestamp()-c}))};return"AbortError"===t.name?(n("abort"),s(A(a))):(0,b.O$)(t).then((e=>("timeout"===t.statusText?n("timeout"):n(e.error,e.is_cached),s(D([e],a)))))})),_=(0,h.kP)(e)&&e.annotation_layers||[],E=r>0;return Promise.all([y,s(W(!1,a)),s(J(e,a)),..._.map((o=>s(B({annotation:o,timeout:n,formData:e,key:a,isDashboardRequest:E,force:t}))))])}}const oe="GET_SAVED_CHART";function re(e,t,n,a,o,r){return void 0===t&&(t=!1),void 0===n&&(n=60),ae(e,t,n,a,"GET",o,r)}const ie="POST_CHART_FORM_DATA";function le(e,t,n,a,o,r){return void 0===t&&(t=!1),void 0===n&&(n=60),ae(e,t,n,a,"POST",o,r)}function se(e){return t=>{z({formData:e,resultFormat:"json",resultType:"query"}).then((t=>{let{json:n}=t;const a={datasourceKey:e.datasource,sql:n.result[0].query};l.Z.postForm("/superset/sqllab/",{form_data:(0,y.o)(a)})})).catch((()=>t((0,g.Gb)((0,s.t)("An error occurred while loading the SQL")))))}}function ce(e,t,n){return(a,o)=>{var r;const i=(o().charts||{})[e],l=o().dashboardInfo.common.conf.SUPERSET_WEBSERVER_TIMEOUT;i.latestQueryFormData&&0!==Object.keys(i.latestQueryFormData).length&&a(le(i.latestQueryFormData,t,l,i.id,n,null==(r=o().dataMask[i.id])?void 0:r.ownState))}}const de=async(e,t,n,a,o,r)=>{try{const i={force:n,datasource_type:e,datasource_id:t};return(0,c.Z)(o)&&(0,c.Z)(r)&&(i.per_page=o,i.page=r),(await l.Z.post({endpoint:"/datasource/samples",jsonPayload:a,searchParams:i})).json.result}catch(e){const t=await(0,b.O$)(e);throw new Error(t.message||t.error||(0,s.t)("Sorry, an error occurred"),{cause:e})}}},57902:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(67294),o=n(45697),r=n.n(o),i=n(55867),l=n(72875),s=n(11965);const c={children:r().node.isRequired,onError:r().func,showMessage:r().bool};class d extends a.Component{constructor(e){super(e),this.state={error:null,info:null}}componentDidCatch(e,t){this.props.onError&&this.props.onError(e,t),this.setState({error:e,info:t})}render(){const{error:e,info:t}=this.state;if(e){const n=e.toString(),a=(0,s.tZ)("span",null,(0,s.tZ)("strong",null,(0,i.t)("Unexpected error")),n?`: ${n}`:"");return this.props.showMessage?(0,s.tZ)(l.Z,{subtitle:a,copyText:a,stackTrace:t?t.componentStack:null}):null}return this.props.children}}d.propTypes=c,d.defaultProps={onError:()=>{},showMessage:!0}},81395:(e,t,n)=>{n.d(t,{fK:()=>i,KJ:()=>l,l3:()=>s,ku:()=>c,oW:()=>d,M6:()=>u,oT:()=>p,yz:()=>h,ib:()=>m,P_:()=>g,cK:()=>v,l6:()=>f});var a=n(78580),o=n.n(a);function r(e,t){var n;return o()(n=e().dashboardState.sliceIds).call(n,t)}const i="ADD_FILTER";function l(e,t,n){return(a,o)=>r(o,e)?a({type:i,chartId:e,component:t,form_data:n}):o().dashboardFilters}const s="REMOVE_FILTER";function c(e){return(t,n)=>r(n,e)?t({type:s,chartId:e}):n().dashboardFilters}const d="CHANGE_FILTER";function u(e,t,n){return(a,o)=>{if(r(o,e)){const r=o().dashboardLayout.present;return a({type:d,chartId:e,newSelectedValues:t,merge:n,components:r})}return o().dashboardFilters}}const p="UPDATE_DIRECT_PATH_TO_FILTER";function h(e,t){return(n,a)=>r(a,e)?n({type:p,chartId:e,path:t}):a().dashboardFilters}const m="UPDATE_LAYOUT_COMPONENTS";function g(e){return t=>{t({type:m,components:e})}}const v="UPDATE_DASHBOARD_FILTERS_SCOPE";function f(e){return t=>{t({type:v,scopes:e})}}},12885:(e,t,n)=>{n.d(t,{J0:()=>_,YA:()=>Z,bK:()=>v,CB:()=>b,Mu:()=>T,L1:()=>D,aZ:()=>A,qL:()=>x,nj:()=>p,x_:()=>N,LM:()=>C,Ww:()=>f,v7:()=>y,g3:()=>S,_p:()=>O,az:()=>L,iO:()=>w,Ou:()=>M,WZ:()=>m,A7:()=>g});var a=n(21090),o=n(55867),r=n(72570),i=n(81255),l=n(80621),s=n(47456),c=n(95173),d=n(81395),u=n(9467);const p="UPDATE_COMPONENTS";function h(e){return function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(t,a)=>{const o=e(...n);t("function"==typeof o?o(t,a):o);const{dashboardLayout:r,dashboardState:i}=a();if(o.type!==p||!o.payload||!o.payload.nextComponents){const e=r.present;t((0,d.P_)(e))}i.hasUnsavedChanges||t((0,u.if)(!0))}}}const m=h((e=>({type:p,payload:{nextComponents:e}})));function g(e){return(t,n)=>{const{dashboardLayout:a}=n();t(m({[l.M2]:{...a.present[l.M2],meta:{text:e}}}))}}const v="DASHBOARD_TITLE_CHANGED";function f(e){return{type:v,text:e}}const b="DELETE_COMPONENT",y=h(((e,t)=>({type:b,payload:{id:e,parentId:t}}))),_="CREATE_COMPONENT",C=h((e=>({type:_,payload:{dropResult:e}}))),Z="CREATE_TOP_LEVEL_TABS",E=h((e=>({type:Z,payload:{dropResult:e}}))),T="DELETE_TOP_LEVEL_TABS",S=h((()=>({type:T,payload:{}}))),x="RESIZE_COMPONENT";function w(e){let{id:t,width:n,height:a}=e;return(e,o)=>{const{dashboardLayout:r}=o(),{present:i}=r,l=i[t],s=n&&l.meta.width!==n,c=a&&l.meta.height!==a;if(l&&(s||c)){const o={[t]:{...l,meta:{...l.meta,width:n||l.meta.width,height:a||l.meta.height}}};e(m(o))}}}const A="MOVE_COMPONENT",R=h((e=>({type:A,payload:{dropResult:e}}))),D="HANDLE_COMPONENT_DROP";function O(e){return(t,n)=>{const a=function(e,t){const n=(0,s.Z)({dropResult:e,layout:t});return"number"==typeof n&&n<0}(e,n().dashboardLayout.present);if(a)return t((0,r.Dz)((0,o.t)("There is not enough space for this component. Try decreasing its width, or increasing the destination width.")));const{source:d,destination:u}=e,p=u&&u.id===l._4,h=d.id===l.D0,m=n().dashboardLayout.present[l._4],g=m&&m.children?m.children[0]:"";if(p)t(E(e));else if(u&&h)t(C(e));else{if(d.type===i.yR&&u.type===i.yR&&d.id===g&&u.id!==g)return t((0,r.Dz)((0,o.t)("Can not move top level tab into nested tabs")));u&&d&&(u.id!==d.id||u.index!==d.index)&&t(R(e))}const{dashboardFilters:v,dashboardLayout:f}=n();if(!h){const{present:e}=f,n=e[d.id]||{},a=e[u.id]||{};if((n.type===i.yR||n.type===i.Os)&&n.children&&0===n.children.length){const n=(0,c.Z)({childId:d.id,layout:e});t(y(d.id,n))}(function(e){let{dashboardFilters:t={},source:n=[],destination:a=[]}=e;const o=new Set(n),r=new Set(a);return[].concat(...Object.values(t).map((e=>{let{scopes:t}=e;return[].concat(...Object.values(t).map((e=>{let{scope:t}=e;return t})))}))).some((e=>r.has(e)!==o.has(e)))})({dashboardFilters:v,source:(n.parents||[]).concat(d.id),destination:(a.parents||[]).concat(u.id)})&&t((0,r.Dz)((0,o.t)("This chart has been moved to a different filter scope.")))}return null}}function M(){return(e,t)=>{e(a.zF.undo());const{dashboardLayout:n,dashboardState:o}=t();0!==n.past.length||o.maxUndoHistoryExceeded||o.updatedColorScheme||e((0,u.if)(!1))}}const L=h(a.zF.redo),N="UPDATE_COMPONENTS_PARENTS_LIST"},9467:(e,t,n)=>{n.d(t,{BD:()=>N,P0:()=>K,bs:()=>ce,sm:()=>de,ec:()=>he,k5:()=>pe,Ii:()=>Q,Vd:()=>I,qJ:()=>re,hD:()=>oe,nV:()=>Ee,J$:()=>ye,FF:()=>Ne,RU:()=>Ce,$f:()=>G,mq:()=>Se,r$:()=>Re,n1:()=>Oe,w9:()=>ne,yV:()=>X,ee:()=>M,oJ:()=>ge,ek:()=>j,Z9:()=>F,H9:()=>V,Iw:()=>we,Be:()=>z,Pi:()=>fe,Mn:()=>se,Lb:()=>$,Qt:()=>Le,z2:()=>Y,YC:()=>ue,Yy:()=>me,Vv:()=>J,rL:()=>be,M8:()=>le,TN:()=>U,dr:()=>q,$_:()=>Te,uW:()=>_e,sL:()=>Ie,E2:()=>Ze,Mb:()=>W,GH:()=>xe,zL:()=>De,uN:()=>Me,Qo:()=>ae,fE:()=>ee,if:()=>L,O8:()=>ve,WL:()=>H,oY:()=>Ae,Sn:()=>B});var a=n(78580),o=n.n(a),r=n(21090),i=n(31069),l=n(55867),s=n(55786),c=n(78161),d=n(52256),u=n(37863),p=n(35854),h=n(98286),m=n(80621),g=n(52838),v=n(72570),f=n(11370),b=n(43399),y=n(9679),_=n(91877),C=n(93185),Z=n(97381),E=n(3741),T=n(12885),S=n(41295),x=n(50810),w=n(81395),A=n(52794),R=n(9531);const D=new Set(["json_metadata","position_json"]);function O(e,t){return t.split(".").reduce(((e,t)=>{const n=null==e?void 0:e[t];return D.has(t)&&n?JSON.parse(n):n}),e)}const M="SET_UNSAVED_CHANGES";function L(e){return{type:M,payload:{hasUnsavedChanges:e}}}const N="ADD_SLICE",I="REMOVE_SLICE",k="/superset/favstar/Dashboard",F="TOGGLE_FAVE_STAR";function P(e){return{type:F,isStarred:e}}function $(e){return function(t){return i.Z.get({endpoint:`${k}/${e}/count/`}).then((e=>{let{json:n}=e;n.count>0&&t(P(!0))})).catch((()=>t((0,v.Gb)((0,l.t)("There was an issue fetching the favorite status of this dashboard.")))))}}function U(e,t){return function(n){const a=t?"unselect":"select";return i.Z.get({endpoint:`${k}/${e}/${a}/`}).then((()=>{n(P(!t))})).catch((()=>n((0,v.Gb)((0,l.t)("There was an issue favoriting this dashboard.")))))}}const V="TOGGLE_PUBLISHED";function q(e,t){return function(n){return i.Z.put({endpoint:`/api/v1/dashboard/${e}`,headers:{"Content-Type":"application/json"},body:JSON.stringify({published:t})}).then((()=>{n((0,v.ws)(t?(0,l.t)("This dashboard is now published"):(0,l.t)("This dashboard is now hidden"))),n(function(e){return{type:V,isPublished:e}}(t))})).catch((()=>{n((0,v.Gb)((0,l.t)("You do not have permissions to edit this dashboard.")))}))}}const j="TOGGLE_EXPAND_SLICE";function H(e){return{type:j,sliceId:e}}const z="UPDATE_CSS";function B(e){return{type:z,css:e}}const G="SET_EDIT_MODE";function W(e){return{type:G,editMode:e}}const K="ON_CHANGE";function Y(){return{type:K}}const Q="ON_SAVE";function J(e){return{type:Q,lastModifiedTime:e}}const X="SET_REFRESH_FREQUENCY";function ee(e,t){return void 0===t&&(t=!1),{type:X,refreshFrequency:e,isPersistent:t}}function te(e){return t=>{t(J(e)),t(r.zF.clearHistory())}}const ne="SET_OVERRIDE_CONFIRM";function ae(e){return{type:ne,overwriteConfirmMetadata:e}}const oe="SAVE_DASHBOARD_STARTED",re="SAVE_DASHBOARD_FINISHED";function ie(){return{type:re}}function le(e,t,n){return(a,r)=>{var c,d,u,p,x,M,L,N,I,k;a({type:T.x_}),a({type:oe});const{dashboardFilters:F,dashboardLayout:P}=r(),$=P.present;Object.values(F).forEach((e=>{var t;const{chartId:n}=e,o=e.directPathToFilter.slice().pop(),r=((null==(t=$[o])?void 0:t.parents)||[]).slice();r.push(o),a((0,w.yz)(n,r))}));const U=(0,f.Z)((0,b.De)()),V=function(e){return Object.values(e).reduce(((e,t)=>{let{chartId:n,scopes:a}=t;return{...e,[n]:Object.keys(a).reduce(((e,t)=>({...e,[t]:a[t]})),{})}}),{})}(F),{certified_by:q,certification_details:j,css:H,dashboard_title:z,owners:B,roles:G,slug:W}=e,K=e=>void 0!==e.id,Y=null==(c=e.metadata)?void 0:c.cross_filters_enabled,Q={...e,certified_by:q||"",certification_details:q&&j?j:"",css:H||"",dashboard_title:z||(0,l.t)("[ untitled dashboard ]"),owners:(0,s.Z)(B).map((e=>K(e)?e.id:e)),roles:(0,_.cr)(C.T.DASHBOARD_RBAC)?(0,s.Z)(G).map((e=>K(e)?e.id:e)):void 0,slug:W||null,metadata:{...e.metadata,color_namespace:(null==(d=e.metadata)?void 0:d.color_namespace)||void 0,color_scheme:(null==(u=e.metadata)?void 0:u.color_scheme)||"",color_scheme_domain:(null==(p=e.metadata)?void 0:p.color_scheme_domain)||[],expanded_slices:(null==(x=e.metadata)?void 0:x.expanded_slices)||{},label_colors:(null==(M=e.metadata)?void 0:M.label_colors)||{},shared_label_colors:(null==(L=e.metadata)?void 0:L.shared_label_colors)||{},refresh_frequency:(null==(N=e.metadata)?void 0:N.refresh_frequency)||0,timed_refresh_immune_slices:(null==(I=e.metadata)?void 0:I.timed_refresh_immune_slices)||[],cross_filters_enabled:(0,g.U)(Y)}},J=()=>{const{dashboardInfo:{metadata:{chart_configuration:e={}}}}=r();return Object.values(e).reduce(((e,t)=>Object.values($).find((e=>{var n;return(null==e||null==(n=e.meta)?void 0:n.chartId)===t.id}))?{...e,[t.id]:t}:e),{})},X=async e=>{const{error:t,message:n}=await(0,h.O$)(e);let o=(0,l.t)("Sorry, an unknown error occurred");t&&(o=(0,l.t)("Sorry, there was an error saving this dashboard: %s",t)),"string"==typeof n&&"Forbidden"===n&&(o=(0,l.t)("You do not have permission to edit this dashboard")),a(ie()),a((0,v.Gb)(o))};if(o()(k=[m.TN,m.NT]).call(k,n)){let o={};(0,_.cr)(C.T.DASHBOARD_CROSS_FILTERS)&&(o=J());const r=n===m.NT?e:{certified_by:Q.certified_by,certification_details:Q.certification_details,css:Q.css,dashboard_title:Q.dashboard_title,slug:Q.slug,owners:Q.owners,roles:Q.roles,json_metadata:(0,y.o)({...(null==Q?void 0:Q.metadata)||{},default_filters:(0,y.o)(U),filter_scopes:V,chart_configuration:o})},s=()=>i.Z.put({endpoint:`/api/v1/dashboard/${t}`,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>(e=>{const n=e.json.result,o=e.json.last_modified_time;if(n.json_metadata){const e=JSON.parse(n.json_metadata);a((0,S.a8)({metadata:e})),e.chart_configuration&&a({type:S.t$,chartConfiguration:e.chart_configuration}),e.native_filter_configuration&&a({type:A.qe,filterConfig:e.native_filter_configuration})}return o&&a(te(o)),a(ie()),window.history.pushState({event:"dashboard_properties_changed"},"",`/superset/dashboard/${W||t}/`),a((0,v.ws)((0,l.t)("This dashboard was saved successfully."))),a(ae(void 0)),e})(e))).catch((e=>X(e)));return new Promise(((e,o)=>{(0,_.cr)(C.T.CONFIRM_DASHBOARD_DIFF)&&n!==m.NT?i.Z.get({endpoint:`/api/v1/dashboard/${t}`}).then((n=>{const i=n.json.result,l=(s=i,c=r,R.yT.map((e=>({keyPath:e,...e.split(".").find((e=>D.has(e)))?{oldValue:JSON.stringify(O(s,e),null,2)||"{}",newValue:JSON.stringify(O(c,e),null,2)||"{}"}:{oldValue:O(s,e)||"",newValue:O(c,e)||""}}))).filter((e=>{let{oldValue:t,newValue:n}=e;return t!==n})));var s,c;return l.length>0?(a(ae({updatedAt:i.changed_on,updatedBy:i.changed_by_name,overwriteConfirmItems:l,dashboardId:t,data:r})),o(l)):e()})):e()})).then(s).catch((e=>{const n=(0,l.t)("Please confirm the overwrite values.");a((0,Z.logEvent)(E.yw,{dashboard_id:t,items:e})),a((0,v.Gb)(n))}))}const ee={...Q};ee.metadata&&delete ee.metadata;const ne={...ee,...(null==Q?void 0:Q.metadata)||{}};return i.Z.post({endpoint:`/superset/copy_dash/${t}/`,postPayload:{data:{...ne,default_filters:(0,y.o)(U),filter_scopes:(0,y.o)(V)}}}).then((e=>(e=>{const t=e.json.last_modified_time;if(t&&a(te(t)),(0,_.cr)(C.T.DASHBOARD_CROSS_FILTERS)){const e=J();a((0,S.Aw)(e))}return a(ie()),a((0,v.ws)((0,l.t)("This dashboard was saved successfully."))),e})(e))).catch((e=>X(e)))}}function se(e,t,n,a){return void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===n&&(n=0),(o,r)=>{if(!n)return void e.forEach((e=>o((0,d.refreshChart)(e,t,a))));const{metadata:i}=r().dashboardInfo,l=Math.max(n,i.stagger_time||5e3);"boolean"!=typeof i.stagger_refresh&&(i.stagger_refresh=void 0===i.stagger_refresh||"true"===i.stagger_refresh);const s=i.stagger_refresh?l/(e.length-1):0;e.forEach(((e,n)=>{setTimeout((()=>o((0,d.refreshChart)(e,t,a))),s*n)}))}}const ce="ON_FILTERS_REFRESH",de="ON_FILTERS_REFRESH_SUCCESS";function ue(){return{type:de}}const pe="ON_REFRESH_SUCCESS",he="ON_REFRESH";function me(e,t,n,a){return void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===n&&(n=0),o=>{o({type:he}),((e,t,n,a,o)=>new Promise((r=>{o(se(e,t,n,a)),r()})))(e,t,n,a,o).then((()=>{o({type:pe}),o({type:ce})}))}}const ge="SHOW_BUILDER_PANE";function ve(){return{type:ge}}function fe(e,t){return(n,a)=>{const{sliceEntities:o}=a(),r=o.slices[e];if(!r)return n((0,v.Dz)("Sorry, there is no chart definition associated with the chart trying to be added."));const i={...r.form_data,slice_id:r.slice_id},l={...u.u,id:e,form_data:(0,p.oN)(i)};return Promise.all([n((0,d.addChart)(l,e)),n((0,x.QR)(i.datasource))]).then((()=>{n({type:N,slice:r}),r&&"filter_box"===r.viz_type&&n((0,w.KJ)(e,t,r.form_data))}))}}function be(e){return(t,n)=>{const a=n().sliceEntities.slices[e];a&&"filter_box"===a.viz_type&&t((0,w.ku)(e)),t({type:I,sliceId:e}),t((0,d.removeChart)(e)),(0,c.ZP)().removeSlice(e)}}const ye="SET_COLOR_SCHEME";function _e(e){return{type:ye,colorScheme:e}}const Ce="SET_DIRECT_PATH";function Ze(e){return{type:Ce,path:e}}const Ee="SET_ACTIVE_TABS";function Te(e,t){return{type:Ee,tabId:e,prevTabId:t}}const Se="SET_FOCUSED_FILTER_FIELD";function xe(e,t){return{type:Se,chartId:e,column:t}}const we="UNSET_FOCUSED_FILTER_FIELD";function Ae(e,t){return{type:we,chartId:e,column:t}}const Re="SET_FULL_SIZE_CHART_ID";function De(e){return{type:Re,chartId:e}}const Oe="SET_MAX_UNDO_HISTORY_EXCEEDED";function Me(e){return void 0===e&&(e=!0),{type:Oe,payload:{maxUndoHistoryExceeded:e}}}function Le(){return(e,t)=>{const{dashboardLayout:n}=t(),a=n.past.length;return e((0,v.Dz)((0,l.t)("You have used all %(historyLength)s undo slots and will not be able to fully undo subsequent actions. You may save your current state to reset the history.",{historyLength:a})))}}const Ne="SET_DATASETS_STATUS";function Ie(e){return{type:Ne,status:e}}},4305:(e,t,n)=>{n.d(t,{$:()=>M,Y:()=>L});var a=n(78580),o=n.n(a),r=n(11064),i=n(16355),l=n(37863),s=n(37927),c=n(39759),d=n(35854),u=n(43399),p=n(12617),h=n(22318),m=n(52838),g=n(39023),v=n(80621),f=n(81255),b=n(53046),y=n(56967),_=n(28428),C=n(16454),Z=n(27600),E=n(23525),T=n(42190),S=n(91877),x=n(93185),w=n(70400),A=n(41295),R=n(32873),D=n(37418),O=n(52004);const M="HYDRATE_DASHBOARD",L=e=>{let{history:t,dashboard:n,charts:a,dataMask:L,activeTabs:N}=e;return(e,I)=>{const{user:k,common:F,dashboardState:P}=I(),{metadata:$,position_data:U}=n,V=(0,w.Z)("regular"),q="true"===(0,w.Z)("reserved").edit;let j={};a.forEach((e=>{e.slice_id=e.form_data.slice_id}));try{j=(0,E.eY)(Z.KD.preselectFilters)||JSON.parse($.default_filters)}catch(e){}null!=$&&$.shared_label_colors&&(0,A.fO)($,null==$?void 0:$.shared_label_colors),null!=$&&$.label_colors&&(0,A.fO)($,null==$?void 0:$.label_colors);const H=U&&Object.keys(U).length>0?U:{[v.Zn]:"v2",[v._4]:{type:f.U0,id:v._4,children:[v.PV]},[v.PV]:{type:f.BG,id:v.PV,children:[],parents:[v._4]}},z={};Object.values(H).forEach((e=>{e.type===f.dW&&(z[e.meta.chartId]=e.id)}));const B=function(e){void 0===e&&(e={});let t=e[v._4];return t=t&&t.children.length&&e[t.children[0]].type===f.yR?e[e[t.children[0]].children[0]]:e[t.children[0]],t.id}(H),G=H[B];let W,K=0;const Y=(null==$?void 0:$.filter_scopes)||{},Q={},J={},X={},ee=new Set,te=new Map;a.forEach((e=>{const t=e.slice_id,n={...e.form_data,url_params:{...e.form_data.url_params,...V}};if(Q[t]={...l.u,id:t,form_data:(0,d.oN)(n)},X[t]={slice_id:t,slice_url:e.slice_url,slice_name:e.slice_name,form_data:e.form_data,viz_type:e.form_data.viz_type,datasource:e.form_data.datasource,description:e.description,description_markeddown:e.description_markeddown,owners:e.owners,modified:e.modified,changed_on:new Date(e.changed_on).getTime()},ee.add(t),!z[t]&&H[B]){var a;(0===K||K+v.fw>v.cz)&&(W=(0,_.Z)(f.Os,(G.parents||[]).slice()),H[W.id]=W,G.children.push(W.id),K=0);const t=(0,_.Z)(f.dW,{chartId:e.slice_id},(W.parents||[]).slice()),n=(null!=(a=te.get(e.slice_id))?a:0)+1;t.id=`${f.dW}-explore-${e.slice_id}-${n}`,te.set(e.slice_id,n),H[t.id]=t,W.children.push(t.id),z[t.meta.chartId]=t.id,K+=v.fw}if("filter_box"===e.form_data.viz_type){var r;const n=(0,b.Z)(e.form_data);let{columns:a}=n;const{labels:i}=n;j[t]&&Object.keys(a).forEach((e=>{j[t][e]&&(a={...a,[e]:j[t][e]})}));const l=Object.keys(a).reduce(((e,n)=>{const a={...Y[t]},{scope:o,immune:r}={...g.GI,...a[n]};return{...e,[n]:{scope:o,immune:r}}}),{}),s=z[t],c=(H[s].parents||[]).slice();c.push(s),J[t]={...g.Mj,chartId:t,componentId:s,datasourceId:e.form_data.datasource,filterName:e.slice_name,directPathToFilter:c,columns:a,labels:i,scopes:l,isDateFilter:o()(r=Object.keys(a)).call(r,C.TIME_RANGE)}}const i=z[t];i&&H[i]&&(H[i].meta.sliceName=e.slice_name)})),Object.values(H).some((e=>e.id!==v._4&&!e.parents))&&(0,D.Z)({currentComponent:H[v._4],layout:H}),(0,u.DU)({dashboardFilters:J,components:H}),H[v.M2]={id:v.M2,type:f.Vl,meta:{text:n.dashboard_title}};const ne={past:[],present:H,future:[]},ae=(0,E.eY)(Z.KD.dashboardFocusedChart);let oe;if(ae){const e=Object.values(ne.present).find((e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===ae}));oe=null==e?void 0:e.id;const n=new URLSearchParams(window.location.search);n.delete(Z.KD.dashboardFocusedChart.name),t.replace({search:n.toString()})}const re=oe||(0,y.Z)();let ie=P.directPathToChild||[];H[re]&&(ie=(H[re].parents||[]).slice(),ie.push(re));const le=(0,c.a)({filterConfig:(null==$?void 0:$.native_filter_configuration)||[]});$.show_native_filters=(0,S.cr)(x.T.DASHBOARD_NATIVE_FILTERS),(0,S.cr)(x.T.DASHBOARD_CROSS_FILTERS)&&Object.values(ne.present).forEach((e=>{var t,n,a,l,s,c;const d=null==(t=e.meta)?void 0:t.chartId,u=null!=(n=null==(a=null!=(l=(0,r.Z)().get(null==(s=Q[d])||null==(c=s.form_data)?void 0:c.viz_type))?l:{})?void 0:a.behaviors)?n:[];$.chart_configuration||($.chart_configuration={}),o()(u).call(u,i.cg.INTERACTIVE_CHART)&&($.chart_configuration[d]||($.chart_configuration[d]={id:d,crossFilters:{scope:{rootPath:[v._4],excluded:[d]}}}),$.chart_configuration[d].crossFilters.chartsInScope=(0,R.Q)($.chart_configuration[d].crossFilters.scope,Q,ne.present)),o()(u).call(u,i.cg.INTERACTIVE_CHART)&&!$.chart_configuration[d]&&($.chart_configuration[d]={id:d,crossFilters:{scope:{rootPath:[v._4],excluded:[d]}}})}));const{roles:se}=k,ce=(0,h.Ms)(n,k),de=(0,m.U)($.cross_filters_enabled);return e({type:M,data:{sliceEntities:{...s.b,slices:X,isLoading:!1},charts:Q,dashboardInfo:{...n,metadata:$,userId:k.userId?String(k.userId):null,dash_edit_perm:ce,dash_save_perm:(0,p.R)("can_save_dash","Superset",se),dash_share_perm:(0,p.R)("can_share_dashboard","Superset",se),superset_can_explore:(0,p.R)("can_explore","Superset",se),superset_can_share:(0,p.R)("can_share_chart","Superset",se),superset_can_csv:(0,p.R)("can_csv","Superset",se),slice_can_edit:(0,p.R)("can_slice","Superset",se),common:{flash_messages:null==F?void 0:F.flash_messages,conf:null==F?void 0:F.conf},filterBarOrientation:(0,S.cr)(x.T.HORIZONTAL_FILTER_BAR)&&$.filter_bar_orientation||O.B.VERTICAL,crossFiltersEnabled:de},dataMask:L,dashboardFilters:J,nativeFilters:le,dashboardState:{preselectNativeFilters:(0,E.eY)(Z.KD.nativeFilters),sliceIds:Array.from(ee),directPathToChild:ie,directPathLastUpdated:Date.now(),focusedFilterField:null,expandedSlices:(null==$?void 0:$.expanded_slices)||{},refreshFrequency:(null==$?void 0:$.refresh_frequency)||0,shouldPersistRefreshFrequency:!1,css:n.css||"",colorNamespace:(null==$?void 0:$.color_namespace)||null,colorScheme:(null==$?void 0:$.color_scheme)||null,editMode:ce&&q,isPublished:n.published,hasUnsavedChanges:!1,dashboardIsSaving:!1,maxUndoHistoryExceeded:!1,lastModifiedTime:n.changed_on,isRefreshing:!1,isFiltersRefreshing:!1,activeTabs:N||(null==P?void 0:P.activeTabs)||[],datasetsStatus:T.ni.LOADING},dashboardLayout:ne}})}}},68969:(e,t,n)=>{n.d(t,{lf:()=>c,D2:()=>u,cK:()=>h,To:()=>g,Fv:()=>v,uC:()=>f});var a=n(31069),o=n(55867),r=n(15926),i=n.n(r),l=n(72570),s=n(98286);const c="SET_ALL_SLICES";function d(e){return{type:c,payload:{slices:e}}}const u="FETCH_ALL_SLICES_STARTED";function p(){return{type:u}}const h="FETCH_ALL_SLICES_FAILED";function m(e,t,n,r,c){void 0===r&&(r="changed_on"),void 0===c&&(c={});const u=n?[{col:"slice_name",opr:"chart_all_text",value:n}]:[],p={...c};return a.Z.get({endpoint:`/api/v1/chart/?q=${i().encode({columns:["changed_on_delta_humanized","changed_on_utc","datasource_id","datasource_type","datasource_url","datasource_name_text","description_markeddown","description","id","params","slice_name","thumbnail_url","url","viz_type"],filters:[...u],page_size:200,order_column:"changed_on"===r?"changed_on_delta_humanized":r,order_direction:"changed_on"===r?"desc":"asc"})}`}).then((e=>{let{json:n}=e;const{result:a}=n;return a.forEach((e=>{let t=JSON.parse(e.params);var n,a;t={...t,datasource:(n=e.datasource_id,a=e.datasource_type,`${n}__${a}`||t.datasource)},p[e.id]={slice_id:e.id,slice_url:e.url,slice_name:e.slice_name,form_data:t,datasource_name:e.datasource_name_text,datasource_url:e.datasource_url,datasource_id:e.datasource_id,datasource_type:e.datasource_type,changed_on:new Date(e.changed_on_utc).getTime(),description:e.description,description_markdown:e.description_markeddown,viz_type:e.viz_type,modified:e.changed_on_delta_humanized,changed_on_humanized:e.changed_on_delta_humanized,thumbnail_url:e.thumbnail_url}})),t(d(p))})).catch((e=>(0,s.O$)(e).then((e=>{let{error:n}=e;t(function(e){return{type:h,payload:{error:e}}}(n||(0,o.t)("Could not fetch all saved charts"))),t((0,l.Gb)((0,o.t)("Sorry there was an error fetching saved charts: ")+n))}))))}function g(e){return(e,t)=>{const{sliceEntities:n}=t();return 0===n.lastUpdated?(e(p()),m(0,e,void 0)):e(d(n.slices))}}function v(e,t){return e=>(e(p()),m(0,e,void 0,t))}function f(e,t){return(e,n)=>{e(p());const{sliceEntities:a}=n();return m(0,e,t,void 0,a.slices)}}},39023:(e,t,n)=>{n.d(t,{GI:()=>p,Mj:()=>h,ZP:()=>g});var a=n(78580),o=n.n(a),r=n(81395),i=n(4305),l=n(16454),s=n(80621),c=n(53046),d=n(43399),u=n(20194);const p={scope:[s._4],immune:[]},h={chartId:null,componentId:null,filterName:null,datasourceId:null,directPathToFilter:[],isDateFilter:!1,isInstantFilter:!0,columns:{},labels:{},scopes:{}},m=[r.fK,r.l3,r.oW];function g(e,t){void 0===e&&(e={});const n={[r.fK](){var e;const{chartId:n,component:a,form_data:r}=t,{columns:i,labels:s}=(0,c.Z)(r),d=Object.keys(i).reduce(((e,t)=>({...e,[t]:p})),{}),u=a?(a.parents||[]).slice().concat(a.id):[];return{...h,chartId:n,componentId:a.id,datasourceId:r.datasource,filterName:a.meta.sliceName,directPathToFilter:u,columns:i,labels:s,scopes:d,isInstantFilter:!!r.instant_filtering,isDateFilter:o()(e=Object.keys(i)).call(e,l.TIME_RANGE)}},[r.oW](e){const{newSelectedValues:n,merge:a}=t,o=Object.keys(n).reduce(((e,t)=>a&&t in e?{...e,[t]:[...e[t],...n[t]]}:{...e,[t]:n[t]}),{...e.columns});return{...e,columns:o}},[r.oT](e){const{path:n}=t;return{...e,directPathToFilter:n}}};if(t.type===r.ib)return(0,d.DU)({dashboardFilters:e,components:t.components}),e;if(t.type===r.cK){const n=t.scopes,a=Object.entries(n).reduce(((e,t)=>{const[n,{scope:a,immune:o}]=t,{chartId:r,column:i}=(0,u._)(n),l={...e[r].scopes,[i]:{scope:a,immune:o}};return{...e,[r]:{...e[r],scopes:l}}}),e);return(0,d.DU)({dashboardFilters:a}),a}if(t.type===r.l3){const{chartId:n}=t,{[n]:a,...o}=e;return(0,d.DU)({dashboardFilters:o}),o}if(t.type===i.$)return t.data.dashboardFilters;if(t.type in n){const a={...e,[t.chartId]:n[t.type](e[t.chartId])};return o()(m).call(m,t.type)&&(0,d.DU)({dashboardFilters:a}),a}return e}},37927:(e,t,n)=>{n.d(t,{b:()=>i,Z:()=>l});var a=n(55867),o=n(68969),r=n(4305);const i={slices:{},isLoading:!0,errorMessage:null,lastUpdated:0};function l(e,t){void 0===e&&(e=i);const n={[r.$]:()=>({...t.data.sliceEntities}),[o.D2]:()=>({...e,isLoading:!0}),[o.lf]:()=>({...e,isLoading:!1,slices:{...e.slices,...t.payload.slices},lastUpdated:(new Date).getTime()}),[o.cK]:()=>({...e,isLoading:!1,lastUpdated:(new Date).getTime(),errorMessage:t.payload.error||(0,a.t)("Could not fetch all saved charts")})};return t.type in n?n[t.type]():e}},43399:(e,t,n)=>{n.d(t,{De:()=>_,Z3:()=>C,_f:()=>Z,up:()=>E,DU:()=>T});var a=n(58809),o=n.n(a),r=n(8816),i=n.n(r),l=n(83927),s=n.n(l),c=n(41609),d=n.n(c),u=n(78580),p=n.n(u),h=n(20194),m=n(81255),g=n(39023);let v=[],f={},b={},y={};function _(){return f}function C(e){return p()(v).call(v,e)}function Z(e,t){if(!(e in b)){const n=Object.entries(t||f).filter((t=>{let[,{scope:n}]=t;return p()(n).call(n,e)}));b[e]=i()(o()((e=>{let[t]=e;return(0,h._)(t).column})),s()((e=>{let[,{values:t}]=e;return t})))(n)}return b[e]}function E(e){let{filterScope:t}=e;function n(e,t,a){void 0===e&&(e=[]),void 0===t&&(t={}),void 0===a&&(a=[]),t&&(t.type===m.dW&&t.meta&&t.meta.chartId&&!p()(a).call(a,t.meta.chartId)?e.push(t.meta.chartId):t.children&&t.children.forEach((t=>n(e,y[t],a))))}const a=[],{scope:o,immune:r}=t||g.GI;return o.forEach((e=>n(a,y[e],r))),a}function T(e){let{dashboardFilters:t={},components:n={}}=e;v=Object.values(t).map((e=>e.chartId)),d()(n)||(y=n),b={},f=Object.values(t).reduce(((e,t)=>{const{chartId:n,columns:a,scopes:o}=t,r={};return Object.keys(a).forEach((e=>{if(Array.isArray(a[e])?a[e].length:void 0!==a[e]){const t=E({filterScope:o[e]}).filter((e=>n!==e));r[(0,h.w)({chartId:n,column:e})]={values:a[e],scope:t}}})),{...e,...r}}),{})}},47456:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(80621),o=n(95173),r=n(72673),i=n(28428);function l(e){let{dropResult:t,layout:n}=e;const{source:l,destination:s,dragging:c}=t,d=l.id===a.D0?(0,i.Z)(c.type):n[c.id]||{};if(l.id===s.id)return d.meta.width;const{width:u,minimumWidth:p}=(0,r.Z)({component:d,components:n}),{width:h,occupiedWidth:m}=(0,r.Z)({id:s.id,components:n});let g=Number(h-m);if(Number.isNaN(g)){const{width:e,occupiedWidth:t}=(0,r.Z)({id:(0,o.Z)({childId:s.id,layout:n}),components:n});g=Number(e-t)}return Number.isNaN(g)||Number.isNaN(Number(u))||g>=u?u:g>=p?g:-1}},72673:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(95173),o=n(80621),r=n(81255);function i(e){let{id:t,components:n}=e;const a=n[t];if(!a)return 0;let o=0;return(a.children||[]).forEach((e=>{const t=n[e]||{};o+=(t.meta||{}).width||0})),o}function l(e){let{id:t,component:n,components:s={}}=e;const c={width:void 0,occupiedWidth:void 0,minimumWidth:void 0},d=n||s[t];return d?(c.width=(d.meta||{}).width,c.occupiedWidth=c.width,d.type===r.Os?(c.width=l({id:(0,a.Z)({childId:d.id,layout:s}),components:s}).width||o.cz,c.occupiedWidth=i({id:d.id,components:s}),c.minimumWidth=c.occupiedWidth||o.cx):d.type===r.BA?(c.minimumWidth=o.cx,c.occupiedWidth=0,(d.children||[]).forEach((e=>{s[e].type===r.Os&&(c.minimumWidth=Math.max(c.minimumWidth,i({id:e,components:s})))}))):d.type!==r.t&&d.type!==r.xh&&d.type!==r.dW||(c.minimumWidth=o.cx),c):c}},53046:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(69856);function o(e){void 0===e&&(e={});const{date_filter:t,filter_configs:n=[],show_druid_time_granularity:o,show_sqla_time_column:r,show_sqla_time_granularity:i}=e;let l=n.reduce(((e,t)=>{let{columns:n,labels:o}=e,r=t[a.ft.DEFAULT_VALUE];return""===r&&(r=null),r&&t[a.ft.MULTIPLE]&&(r=t.defaultValue.split(";")),{columns:{...n,[t.column]:t.vals||r},labels:{...o,[t.column]:t.label}}}),{columns:{},labels:{}});if(t){let t={...l.columns,[a.i2.time_range]:e.time_range};const n={...l.labels,...Object.entries(a.i2).reduce(((e,t)=>{let[n,o]=t;return{...e,[o]:a.m_[n]}}),{})};i&&(t={...t,[a.i2.time_grain_sqla]:e.time_grain_sqla}),r&&(t={...t,[a.i2.granularity_sqla]:e.granularity_sqla}),o&&(t={...t,[a.i2.granularity]:e.granularity}),l={...l,columns:t,labels:n}}return l}},28428:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(14670),o=n.n(a),r=n(55867),i=n(81255),l=n(80621);const s={[i.dW]:{width:l.fw,height:50},[i.BA]:{width:l.fw,background:l.HE},[i.hE]:null,[i.Nc]:{text:(0,r.t)("New header"),headerSize:l.OE,background:l.HE},[i.xh]:{width:l.fw,height:50},[i.Os]:{background:l.HE},[i.yR]:null,[i.gn]:{text:"",defaultText:(0,r.t)("Tab title"),placeholder:(0,r.t)("Tab title")},[i.t]:{width:l.cz,background:l.HE}};function c(e){return`${e}-${o().generate()}`}function d(e,t,n){return void 0===n&&(n=[]),{type:e,id:c(e),children:[],parents:n,meta:{...s[e],...t}}}},11370:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(20194);function o(e){return Object.entries(e).reduce(((e,t)=>{const[n,{values:o}]=t,{chartId:r,column:i}=(0,a._)(n),l={...e[r],[i]:o};return{...e,[r]:l}}),{})}},37418:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(68492);function o(e){let{currentComponent:t,layout:n={}}=e;if(t&&n)if(n[t.id]){const e=Array.isArray(t.parents)?t.parents.slice():[];e.push(t.id),Array.isArray(t.children)&&t.children.forEach((t=>{const r=n[t];r?(r.parents=e,o({currentComponent:r,layout:n})):a.Z.warn(`The current layout does not contain a component with the id: ${t}.  Skipping this component`)}))}else a.Z.warn(`The current layout does not contain a component with the id: ${null==t?void 0:t.id}.  Skipping this component`)}},79069:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(5872),o=n.n(a),r=n(67294),i=n(45697),l=n.n(i),s=n(51995),c=n(11965),d=n(82342),u=n(87253);const p={value:l().bool,label:l().string,onChange:l().func},h=s.iK.div`
  ${e=>{let{theme:t}=e;return c.iv`
    .ControlHeader label {
      color: ${t.colors.grayscale.dark1};
    }
    span[role='checkbox'] {
      padding-right: ${2*t.gridUnit}px;
    }
  `}}
`;class m extends r.Component{onChange(){this.props.onChange(!this.props.value)}renderCheckbox(){return(0,c.tZ)(u.ZP,{onChange:this.onChange.bind(this),checked:!!this.props.value})}render(){return this.props.label?(0,c.tZ)(h,null,(0,c.tZ)(d.Z,o()({},this.props,{leftNode:this.renderCheckbox(),onClick:this.onChange.bind(this)}))):this.renderCheckbox()}}m.propTypes=p,m.defaultProps={value:!1,onChange:()=>{}}},28543:(e,t,n)=>{n.d(t,{vq:()=>r,Pr:()=>i,ZP:()=>d});var a=n(69856),o=n(12515);const r={SIMPLE:"SIMPLE",SQL:"SQL"},i={HAVING:"HAVING",WHERE:"WHERE"},l={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":e=>{let{datasource:t}=e;return`= '{{ presto.latest_partition('${t.schema}.${t.datasource_name}') }}'`}},s=[...a.qB].map((e=>a.LT[e].operation));function c(e,t){let{useSimple:n}=void 0===t?{}:t;if(e.expressionType===r.SIMPLE||n){const{subject:t,comparator:n}=e,r=e.operator&&e.operator===a.LT[a.d.LATEST_PARTITION].operation?l[e.operator](e):l[e.operator];return(0,o.CB)(t,r,n)}return e.expressionType===r.SQL?e.sqlExpression:""}class d{constructor(e){var t;this.expressionType=e.expressionType||r.SIMPLE,this.expressionType===r.SIMPLE?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,[a.d.IS_TRUE,a.d.IS_FALSE].indexOf(e.operatorId)>=0&&(this.comparator=e.operatorId===a.d.IS_TRUE),[a.d.IS_NULL,a.d.IS_NOT_NULL].indexOf(e.operatorId)>=0&&(this.comparator=null),this.clause=e.clause||i.WHERE,this.sqlExpression=null):this.expressionType===r.SQL&&(this.sqlExpression="string"==typeof e.sqlExpression?e.sqlExpression:c(e,{useSimple:!0}),this.clause=e.clause,e.operator&&s.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null),this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.datasourceWarning=!!e.datasourceWarning,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new d({...this,isNew:!1,...e})}equals(e){return e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){const e=[a.d.IS_NOT_NULL,a.d.IS_NULL].map((e=>a.LT[e].operation)),t=[a.d.IS_TRUE,a.d.IS_FALSE].map((e=>a.LT[e].operation));if(this.expressionType===r.SIMPLE){if(e.indexOf(this.operator)>=0)return!(!this.operator||!this.subject);if(t.indexOf(this.operator)>=0)return!(!this.subject||null===this.comparator);if(this.operator&&this.subject&&this.clause)if(Array.isArray(this.comparator)){if(this.comparator.length>0)return!0}else if(null!==this.comparator)return!0}else if(this.expressionType===r.SQL)return!(!this.sqlExpression||!this.clause);return!1}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return c(this)}}},61890:(e,t,n)=>{n.d(t,{Z:()=>L});var a=n(67294),o=n(45697),r=n.n(o),i=n(31069),l=n(68492),s=n(55867),c=n(55786),d=n(68135),u=n(82342),p=n(17536),h=n(27130),m=n(19113),g=n(69856),v=n(40266),f=n(33334),b=n(70163),y=n(74069),_=n(96055),C=n(42753),Z=n(7848),E=n(11965);function T(e){let{adhocFilter:t,options:n,datasource:a,onFilterEdit:o,onRemoveFilter:r,partitionColumn:i,onMoveLabel:l,onDropLabel:s,index:c,sections:d,operators:u}=e;const{actualTimeRange:p,title:h}=(0,Z.w)(t);return(0,E.tZ)(_.Z,{sections:d,operators:u,adhocFilter:t,options:n,datasource:a,onFilterEdit:o,partitionColumn:i},(0,E.tZ)(f.yz,{label:null!=p?p:t.getDefaultLabel(),tooltipTitle:null!=h?h:t.getTooltipTitle(),onRemove:r,onMoveLabel:l,onDropLabel:s,index:c,type:C.g.FilterOption,withCaret:!0,isExtra:t.isExtra}))}var S=n(28543);const x=r().oneOfType([r().shape({expressionType:r().oneOf([S.vq.SIMPLE]).isRequired,clause:r().oneOf([S.Pr.HAVING,S.Pr.WHERE]).isRequired,subject:r().string.isRequired,comparator:r().oneOfType([r().string,r().arrayOf(r().string)]).isRequired}),r().shape({expressionType:r().oneOf([S.vq.SQL]).isRequired,clause:r().oneOf([S.Pr.WHERE,S.Pr.HAVING]).isRequired,sqlExpression:r().string.isRequired})]);var w=n(72201);const{warning:A}=y.Z,R=r().oneOfType([r().string,p.Z]),D={label:r().oneOfType([r().object,r().string]),name:r().string,sections:r().arrayOf(r().string),operators:r().arrayOf(r().string),onChange:r().func,value:r().arrayOf(x),datasource:r().object,columns:r().arrayOf(w.Z),savedMetrics:r().arrayOf(h.Z),selectedMetrics:r().oneOfType([R,r().arrayOf(R)]),isLoading:r().bool,canDelete:r().func};function O(e){return e&&!(e instanceof S.ZP)&&e.expressionType}class M extends a.Component{constructor(e){super(e),this.optionsForSelect=this.optionsForSelect.bind(this),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this),this.removeFilter=this.removeFilter.bind(this);const t=(this.props.value||[]).map((e=>O(e)?new S.ZP(e):e));this.optionRenderer=e=>(0,E.tZ)(v.Z,{option:e}),this.valueRenderer=(e,t)=>(0,E.tZ)(T,{key:t,index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:e=>{e.stopPropagation(),this.onRemoveFilter(t)},onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn}),this.state={values:t,options:this.optionsForSelect(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const n=null==(t=e.database)?void 0:t.id,{datasource_name:a,schema:o,is_sqllab_view:r}=e;!r&&n&&a&&o&&i.Z.get({endpoint:`/api/v1/database/${n}/table_extra/${a}/${o}/`}).then((e=>{let{json:t}=e;if(t&&t.partitions){const{partitions:e}=t;e&&e.cols&&1===Object.keys(e.cols).length&&this.setState({partitionColumn:e.cols[0]})}})).catch((e=>{l.Z.error("fetch extra_table_metadata:",e.statusText)}))}}UNSAFE_componentWillReceiveProps(e){this.props.columns!==e.columns&&this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((e=>O(e)?new S.ZP(e):e))})}removeFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState((e=>({...e,values:t}))),this.props.onChange(t)}onRemoveFilter(e){const{canDelete:t}=this.props,{values:n}=this.state,a=null==t?void 0:t(n[e],n);"string"!=typeof a?this.removeFilter(e):A({title:(0,s.t)("Warning"),content:a})}onNewFilter(e){const t=this.mapOption(e);t&&this.setState((e=>({...e,values:[...e.values,t]})),(()=>{this.props.onChange(this.state.values)}))}onFilterEdit(e){this.props.onChange(this.state.values.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}onChange(e){const t=(e||[]).map((e=>this.mapOption(e))).filter((e=>e));this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find((t=>t.metric_name===e)).expression}moveLabel(e,t){const{values:n}=this.state,a=[...n];[a[t],a[e]]=[a[e],a[t]],this.setState({values:a})}mapOption(e){return e instanceof S.ZP?e:e.saved_metric_name?new S.ZP({expressionType:S.vq.SQL,subject:this.getMetricExpression(e.saved_metric_name),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:S.Pr.HAVING}):e.label?new S.ZP({expressionType:S.vq.SQL,subject:new m.Z(e).translateToSql(),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:S.Pr.HAVING}):e.column_name?new S.ZP({expressionType:S.vq.SIMPLE,subject:e.column_name,operator:g.LT[g.d.EQUALS].operation,comparator:"",clause:S.Pr.WHERE,isNew:!0}):null}optionsForSelect(e){return[...e.columns,...(0,c.Z)(e.selectedMetrics).map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new m.Z(e))))].filter((e=>e)).reduce(((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof m.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)))}addNewFilterPopoverTrigger(e){return(0,E.tZ)(_.Z,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new S.ZP({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn},e)}render(){const{theme:e}=this.props;return(0,E.tZ)("div",{className:"metrics-select"},(0,E.tZ)(f.gM,null,(0,E.tZ)(u.Z,this.props),this.addNewFilterPopoverTrigger((0,E.tZ)(f.IG,null,(0,E.tZ)(b.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5})))),(0,E.tZ)(f.yj,null,this.state.values.length>0?this.state.values.map(((e,t)=>this.valueRenderer(e,t))):this.addNewFilterPopoverTrigger((0,E.tZ)(f.SW,null,(0,E.tZ)(b.Z.PlusSmall,{iconColor:e.colors.grayscale.light1}),(0,s.t)("Add filter")))))}}M.propTypes=D,M.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const L=(0,d.b)(M)},72201:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(45697),o=n.n(a);const r=o().shape({column_name:o().string.isRequired,type:o().string})},19113:(e,t,n)=>{n.d(t,{v:()=>o,Z:()=>l});var a=n(69856);const o={SIMPLE:"SIMPLE",SQL:"SQL"};function r(e){if(e.sqlExpression&&a.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),n=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&n>0)return e.sqlExpression.substring(n+1,t)}return null}function i(e){if(e.sqlExpression&&a.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class l{constructor(e){if(this.expressionType=e.expressionType||o.SIMPLE,this.expressionType===o.SIMPLE){const t=r(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||i(e),this.sqlExpression=null}else this.expressionType===o.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null);this.datasourceWarning=!!e.datasourceWarning,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){const e=this.translateToSql({useVerboseName:!0});return e.length<43?e:`${e.substring(0,40)}...`}translateToSql(e){if(void 0===e&&(e={useVerboseName:!1,transformCountDistinct:!1}),this.expressionType===o.SIMPLE){var t,n;const o=this.aggregate||"",r=e.useVerboseName&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(n=this.column)&&n.column_name?`(${this.column.column_name})`:"";return e.transformCountDistinct&&o===a.YY.COUNT_DISTINCT&&/^\(.*\)$/.test(r)?`COUNT(DISTINCT ${r.slice(1,-1)})`:o+r}return this.expressionType===o.SQL?this.sqlExpression:""}duplicateWith(e){return new l({...this,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===o.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===o.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return i(this)}inferSqlExpressionColumn(){return r(this)}}},40266:(e,t,n)=>{n.d(t,{Z:()=>d}),n(67294);var a=n(45697),o=n.n(a),r=n(34087),i=n(17536),l=n(99963),s=n(11965);const c={option:o().oneOfType([r.Z,o().shape({saved_metric_name:o().string.isRequired}),i.Z]).isRequired};function d(e){let{option:t}=e;return t.saved_metric_name?(0,s.tZ)(l.l,{column:{column_name:t.saved_metric_name,type:"expression"},showType:!0}):t.column_name?(0,s.tZ)(l.l,{column:t,showType:!0}):t.label?(0,s.tZ)(l.l,{column:{column_name:t.label,type:"expression"},showType:!0}):null}d.propTypes=c},17536:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(45697),o=n.n(a),r=n(69856),i=n(34087),l=n(19113);const s=o().oneOfType([o().shape({expressionType:o().oneOf([l.v.SIMPLE]).isRequired,column:i.Z.isRequired,aggregate:o().oneOf(Object.keys(r.YY)).isRequired,label:o().string.isRequired}),o().shape({expressionType:o().oneOf([l.v.SQL]).isRequired,sqlExpression:o().string.isRequired,label:o().string.isRequired})])},34087:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(45697),o=n.n(a);const r=o().shape({column_name:o().string.isRequired,type:o().string})},27130:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(45697),o=n.n(a);const r=o().shape({metric_name:o().string,verbose_name:o().string,expression:o().string})},82199:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(67294),o=n(45697),r=n.n(o),i=n(1111),l=n(55867),s=n(11965),c=n(81315),d=n(82342);const u={ariaLabel:r().string,autoFocus:r().bool,choices:r().array,clearable:r().bool,description:r().oneOfType([r().string,r().node]),disabled:r().bool,freeForm:r().bool,isLoading:r().bool,multi:r().bool,isMulti:r().bool,name:r().string.isRequired,onChange:r().func,onFocus:r().func,value:r().oneOfType([r().string,r().number,r().array]),default:r().oneOfType([r().string,r().number,r().array]),showHeader:r().bool,optionRenderer:r().func,valueKey:r().string,options:r().array,placeholder:r().string,filterOption:r().func,tokenSeparators:r().arrayOf(r().string),notFoundContent:r().object,label:r().string,renderTrigger:r().bool,validationErrors:r().array,rightNode:r().node,leftNode:r().node,onClick:r().func,hovered:r().bool,tooltipOnClick:r().func,warning:r().string,danger:r().string};class p extends a.PureComponent{constructor(e){super(e),this.state={options:this.getOptions(e)},this.onChange=this.onChange.bind(this),this.handleFilterOptions=this.handleFilterOptions.bind(this)}UNSAFE_componentWillReceiveProps(e){if(!(0,i.Z)(e.choices,this.props.choices)||!(0,i.Z)(e.options,this.props.options)){const t=this.getOptions(e);this.setState({options:t})}}onChange(e){const{valueKey:t}=this.props;let n=e;Array.isArray(e)&&(n=e.map((e=>void 0!==(null==e?void 0:e[t])?e[t]:e))),"object"==typeof e&&void 0!==(null==e?void 0:e[t])&&(n=e[t]),this.props.onChange(n,[])}getOptions(e){const{choices:t,optionRenderer:n,valueKey:a}=e;let o=[];return e.options?o=e.options.map((e=>({...e,value:e[a],label:e.label||e[a],customLabel:n?n(e):void 0}))):t&&(o=t.map((e=>{if(Array.isArray(e)){const[t,n]=e.length>1?e:[e[0],e[0]];return{value:t,label:n}}return Object.is(e)?{...e,value:e[a],label:e.label||e[a]}:{value:e,label:e}}))),o}handleFilterOptions(e,t){const{filterOption:n}=this.props;return n({data:t},e)}render(){const{ariaLabel:e,autoFocus:t,clearable:n,disabled:a,filterOption:o,freeForm:r,isLoading:i,isMulti:u,label:p,multi:h,name:m,placeholder:g,onFocus:v,showHeader:f,value:b,tokenSeparators:y,notFoundContent:_,description:C,renderTrigger:Z,rightNode:E,leftNode:T,validationErrors:S,onClick:x,hovered:w,tooltipOnClick:A,warning:R,danger:D}=this.props,O={name:m,label:p,description:C,renderTrigger:Z,rightNode:E,leftNode:T,validationErrors:S,onClick:x,hovered:w,tooltipOnClick:A,warning:R,danger:D},M={allowNewOptions:r,autoFocus:t,ariaLabel:e||("string"==typeof p?p:(0,l.t)("Select ...")),allowClear:n,disabled:a,filterOption:!o||"function"!=typeof o||this.handleFilterOptions,header:f&&(0,s.tZ)(d.Z,O),loading:i,mode:u||h?"multiple":"single",name:`select-${m}`,onChange:this.onChange,onFocus:v,options:this.state.options,placeholder:g,sortComparator:this.props.sortComparator,value:(()=>{const e=b||(void 0!==this.props.default?this.props.default:void 0);if(null!==e||this.state.options.find((e=>null===e.value)))return e})(),tokenSeparators:y,notFoundContent:_};return(0,s.tZ)("div",{css:e=>s.iv`
          .type-label {
            margin-right: ${2*e.gridUnit}px;
          }
          .Select__multi-value__label > span,
          .Select__option > span,
          .Select__single-value > span {
            display: flex;
            align-items: center;
          }
        `},(0,s.tZ)(c.Z,M))}}p.propTypes=u,p.defaultProps={autoFocus:!1,choices:[],clearable:!0,description:null,disabled:!1,freeForm:!1,isLoading:!1,label:null,multi:!1,onChange:()=>{},onFocus:()=>{},showHeader:!0,valueKey:"value"}},665:(e,t,n)=>{n.d(t,{Z:()=>y});var a=n(67294),o=n(45697),r=n.n(o),i=n(4715),l=n(55867),s=n(37921),c=n(76697),d=n(83734),u=n(87253),p=n(82342),h=n(82199),m=n(11965);const g="latlong",v="delimited",f="geohash",b={onChange:r().func,value:r().object,animation:r().bool,choices:r().array};class y extends a.Component{constructor(e){super(e);const t=e.value||{};let n;e.choices.length>0&&(n=e.choices[0][0]),this.state={type:t.type||g,delimiter:t.delimiter||",",latCol:t.latCol||n,lonCol:t.lonCol||n,lonlatCol:t.lonlatCol||n,reverseCheckbox:t.reverseCheckbox||!1,geohashCol:t.geohashCol||n,value:null,errors:[]},this.toggleCheckbox=this.toggleCheckbox.bind(this),this.onChange=this.onChange.bind(this),this.renderReverseCheckbox=this.renderReverseCheckbox.bind(this)}componentDidMount(){this.onChange()}onChange(){const{type:e}=this.state,t={type:e},n=[],a=(0,l.t)("Invalid lat/long configuration.");e===g?(t.latCol=this.state.latCol,t.lonCol=this.state.lonCol,t.lonCol&&t.latCol||n.push(a)):e===v?(t.lonlatCol=this.state.lonlatCol,t.delimiter=this.state.delimiter,t.reverseCheckbox=this.state.reverseCheckbox,t.lonlatCol&&t.delimiter||n.push(a)):e===f&&(t.geohashCol=this.state.geohashCol,t.reverseCheckbox=this.state.reverseCheckbox,t.geohashCol||n.push(a)),this.setState({value:t,errors:n}),this.props.onChange(t,n)}setType(e){this.setState({type:e},this.onChange)}toggleCheckbox(){this.setState((e=>({reverseCheckbox:!e.reverseCheckbox})),this.onChange)}renderLabelContent(){return this.state.errors.length>0?"N/A":this.state.type===g?`${this.state.lonCol} | ${this.state.latCol}`:this.state.type===v?`${this.state.lonlatCol}`:this.state.type===f?`${this.state.geohashCol}`:null}renderSelect(e,t){return(0,m.tZ)(h.Z,{ariaLabel:e,name:e,choices:this.props.choices,value:this.state[e],clearable:!1,onFocus:()=>{this.setType(t)},onChange:t=>{this.setState({[e]:t},this.onChange)}})}renderReverseCheckbox(){return(0,m.tZ)("span",null,(0,l.t)("Reverse lat/long "),(0,m.tZ)(u.ZP,{checked:this.state.reverseCheckbox,onChange:this.toggleCheckbox}))}renderPopoverContent(){return(0,m.tZ)("div",{style:{width:"300px"}},(0,m.tZ)(d.Z,{title:(0,l.t)("Longitude & Latitude columns"),isSelected:this.state.type===g,onSelect:this.setType.bind(this,g)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Longitude"),this.renderSelect("lonCol",g)),(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Latitude"),this.renderSelect("latCol",g)))),(0,m.tZ)(d.Z,{title:(0,l.t)("Delimited long & lat single column"),info:(0,l.t)("Multiple formats accepted, look the geopy.points Python library for more details"),isSelected:this.state.type===v,onSelect:this.setType.bind(this,v)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Column"),this.renderSelect("lonlatCol",v)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))),(0,m.tZ)(d.Z,{title:(0,l.t)("Geohash"),isSelected:this.state.type===f,onSelect:this.setType.bind(this,f)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Column"),this.renderSelect("geohashCol",f)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))))}render(){return(0,m.tZ)("div",null,(0,m.tZ)(p.Z,this.props),(0,m.tZ)(c.ZP,{content:this.renderPopoverContent(),placement:"topLeft",trigger:"click"},(0,m.tZ)(s.Z,{className:"pointer"},this.renderLabelContent())))}}y.propTypes=b,y.defaultProps={onChange:()=>{},animation:!0,choices:[]}},42878:(e,t,n)=>{n.d(t,{Z:()=>b});var a=n(5872),o=n.n(a),r=n(67294),i=n(45697),l=n.n(i),s=n(9875),c=n(55867),d=n(68135),u=n(35932),p=n(94670),h=n(1304),m=n(82342),g=n(11965);const v={name:l().string,onChange:l().func,initialValue:l().string,height:l().number,minLines:l().number,maxLines:l().number,offerEditInModal:l().bool,language:l().oneOf([null,"json","html","sql","markdown","javascript"]),aboveEditorSection:l().node,readOnly:l().bool,resize:l().oneOf([null,"block","both","horizontal","inline","none","vertical"]),textAreaStyles:l().object};class f extends r.Component{onControlChange(e){const{value:t}=e.target;this.props.onChange(t)}onAreaEditorChange(e){this.props.onChange(e)}renderEditor(e){void 0===e&&(e=!1);const t=e?40:this.props.minLines||12;if(this.props.language){const n={border:`1px solid ${this.props.theme.colors.grayscale.light1}`,minHeight:`${t}em`,width:"auto",...this.props.textAreaStyles};return this.props.resize&&(n.resize=this.props.resize),this.props.readOnly&&(n.backgroundColor="#f2f2f2"),(0,g.tZ)(p.YH,o()({mode:this.props.language,style:n,minLines:t,maxLines:e?1e3:this.props.maxLines,editorProps:{$blockScrolling:!0},defaultValue:this.props.initialValue,readOnly:this.props.readOnly,key:this.props.name},this.props,{onChange:this.onAreaEditorChange.bind(this)}))}return(0,g.tZ)(s.Kx,{placeholder:(0,c.t)("textarea"),onChange:this.onControlChange.bind(this),defaultValue:this.props.initialValue,disabled:this.props.readOnly,style:{height:this.props.height}})}renderModalBody(){return(0,g.tZ)(r.Fragment,null,(0,g.tZ)("div",null,this.props.aboveEditorSection),this.renderEditor(!0))}render(){const e=(0,g.tZ)(m.Z,this.props);return(0,g.tZ)("div",null,e,this.renderEditor(),this.props.offerEditInModal&&(0,g.tZ)(h.Z,{modalTitle:e,triggerNode:(0,g.tZ)(u.Z,{buttonSize:"small",className:"m-t-5"},(0,c.t)("Edit")," ",(0,g.tZ)("strong",null,this.props.language)," ",(0,c.t)("in modal")),modalBody:this.renderModalBody(!0),responsive:!0}))}}f.propTypes=v,f.defaultProps={onChange:()=>{},initialValue:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1,resize:null,textAreaStyles:{}};const b=(0,d.b)(f)},92252:(e,t,n)=>{n.d(t,{ai:()=>y}),n(67294);var a=n(81545),o=n(45511),r=n(55867),i=n(95826),l=n(75294),s=n(12515),c=n(69856),d=n(99963),u=n(11965);const p=(0,a.Z)(),h=(0,o.Z)(),m=[["SMART_NUMBER",(0,r.t)("Adaptive formatting")],["~g",(0,r.t)("Original value")],[",d",",d (12345.432 => 12,345)"],[".1s",".1s (12345.432 => 10k)"],[".3s",".3s (12345.432 => 12.3k)"],[",.1%",",.1% (12345.432 => 1,234,543.2%)"],[".3%",".3% (12345.432 => 1234543.200%)"],[".4r",".4r (12345.432 => 12350)"],[",.3f",",.3f (12345.432 => 12,345.432)"],["+,","+, (12345.432 => +12,345.432)"],["$,.2f","$,.2f (12345.432 => $12,345.43)"],["DURATION",(0,r.t)("Duration in ms (66000 => 1m 6s)")],["DURATION_SUB",(0,r.t)("Duration in ms (100.40008 => 100ms 400s 80ns)")]],g=((0,r.t)("Adaptive formatting"),{verbose_name:"Time",column_name:"__timestamp",description:(0,r.t)("A reference to the [Time] configuration, taking granularity into account")}),v={type:"SelectControl",multi:!0,freeForm:!0,label:(0,r.t)("Dimensions"),default:[],includeTime:!1,description:(0,r.t)("One or many columns to group by. High cardinality groupings should include a series limit to limit the number of fetched and rendered series."),optionRenderer:e=>(0,u.tZ)(d.l,{column:e,showType:!0}),valueKey:"column_name",filterOption:(e,t)=>{let{data:n}=e;return n.column_name&&n.column_name.toLowerCase().indexOf(t.toLowerCase())>=0||n.verbose_name&&n.verbose_name.toLowerCase().indexOf(t.toLowerCase())>=0},mapStateToProps:(e,t)=>{const n={};return e.datasource&&(n.options=e.datasource.columns.filter((e=>e.groupby)),t&&t.includeTime&&n.options.push(g)),n}},f={type:"MetricsControl",multi:!0,label:(0,r.t)("Metrics"),validators:[i.Z],mapStateToProps:e=>{const{datasource:t}=e;return{columns:t?t.columns:[],savedMetrics:t?t.metrics:[],datasource:t}},description:(0,r.t)("One or many metrics to display")},b={...f,multi:!1,label:(0,r.t)("Metric"),description:(0,r.t)("Metric")},y={metrics:f,metric:b,datasource:{type:"DatasourceControl",label:(0,r.t)("Dataset"),default:null,description:null,mapStateToProps:e=>{let{datasource:t}=e;return{datasource:t,isEditable:!!t}}},viz_type:{type:"VizTypeControl",default:"table",description:(0,r.t)("The type of visualization to display")},color_picker:{label:(0,r.t)("Fixed color"),description:(0,r.t)("Use this to define a static color for all circles"),type:"ColorPickerControl",default:{r:0,g:122,b:135,a:1},renderTrigger:!0},metric_2:{...b,label:(0,r.t)("Right axis metric"),clearable:!0,description:(0,r.t)("Choose a metric for right axis")},linear_color_scheme:{type:"ColorSchemeControl",label:(0,r.t)("Linear color scheme"),choices:()=>h.values().map((e=>[e.id,e.label])),default:h.getDefaultKey(),clearable:!1,description:"",renderTrigger:!0,schemes:()=>h.getMap(),isLinear:!0},secondary_metric:{...b,label:(0,r.t)("Color metric"),default:null,validators:[],description:(0,r.t)("A metric to use for color")},groupby:v,columns:{...v,label:(0,r.t)("Columns"),description:(0,r.t)("One or many controls to pivot as columns")},granularity:{type:"SelectControl",freeForm:!0,label:c.m_.granularity,default:"P1D",choices:[[null,(0,r.t)("all")],["PT5S",(0,r.t)("5 seconds")],["PT30S",(0,r.t)("30 seconds")],["PT1M",(0,r.t)("1 minute")],["PT5M",(0,r.t)("5 minutes")],["PT30M",(0,r.t)("30 minutes")],["PT1H",(0,r.t)("1 hour")],["PT6H",(0,r.t)("6 hour")],["P1D",(0,r.t)("1 day")],["P7D",(0,r.t)("7 days")],["P1W",(0,r.t)("week")],["week_starting_sunday",(0,r.t)("week starting Sunday")],["week_ending_saturday",(0,r.t)("week ending Saturday")],["P1M",(0,r.t)("month")],["P3M",(0,r.t)("quarter")],["P1Y",(0,r.t)("year")]],description:(0,r.t)("The time granularity for the visualization. Note that you can type and use simple natural language as in `10 seconds`,`1 day` or `56 weeks`")},granularity_sqla:{type:"SelectControl",label:c.m_.granularity_sqla,description:(0,r.t)("The time column for the visualization. Note that you can define arbitrary expression that return a DATETIME column in the table. Also note that the filter below is applied against this column or expression"),clearable:!1,optionRenderer:e=>(0,u.tZ)(d.l,{column:e,showType:!0}),valueKey:"column_name",mapStateToProps:e=>{const t={};return e.datasource&&(t.choices=e.datasource.granularity_sqla,t.default=null,e.datasource.main_dttm_col?t.default=e.datasource.main_dttm_col:t.choices&&t.choices.length>0&&(t.default=t.choices[0].column_name)),t}},time_grain_sqla:{type:"SelectControl",label:c.m_.time_grain_sqla,default:"P1D",description:(0,r.t)("The time granularity for the visualization. This applies a date transformation to alter your time column and defines a new time granularity. The options here are defined on a per database engine basis in the Superset source code."),mapStateToProps:e=>({choices:e.datasource?e.datasource.time_grain_sqla:null})},time_range:{type:"DateFilterControl",freeForm:!0,label:c.m_.time_range,default:(0,r.t)("No filter"),description:(0,r.t)('The time range for the visualization. All relative times, e.g. "Last month", "Last 7 days", "now", etc. are evaluated on the server using the server\'s local time (sans timezone). All tooltips and placeholder times are expressed in UTC (sans timezone). The timestamps are then evaluated by the database using the engine\'s local timezone. Note one can explicitly set the timezone per the ISO 8601 format if specifying either the start and/or end time.')},row_limit:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Row limit"),validators:[l.Z],default:1e4,choices:(0,s.mG)([10,50,100,250,500,1e3,5e3,1e4,5e4]),description:(0,r.t)("Limits the number of rows that get displayed.")},limit:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Series limit"),validators:[l.Z],choices:(0,s.mG)([5,10,25,50,100,500]),clearable:!0,description:(0,r.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},timeseries_limit_metric:{type:"MetricsControl",label:(0,r.t)("Sort by"),default:null,clearable:!0,description:(0,r.t)("Metric used to define how the top series are sorted if a series or row limit is present. If undefined reverts to the first metric (where appropriate)."),mapStateToProps:e=>({columns:e.datasource?e.datasource.columns:[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},series:{...v,label:(0,r.t)("Dimensions"),multi:!1,default:null,description:(0,r.t)("Defines the grouping of entities. Each series is shown as a specific color on the chart and has a legend toggle")},entity:{...v,label:(0,r.t)("Entity"),default:null,multi:!1,validators:[i.Z],description:(0,r.t)("This defines the element to be plotted on the chart")},x:{...b,label:(0,r.t)("X Axis"),description:(0,r.t)("Metric assigned to the [X] axis"),default:null},y:{...b,label:(0,r.t)("Y Axis"),default:null,description:(0,r.t)("Metric assigned to the [Y] axis")},size:{...b,label:(0,r.t)("Bubble size"),default:null},y_axis_format:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Y Axis Format"),renderTrigger:!0,default:"SMART_NUMBER",choices:m,description:"D3 format syntax: https://github.com/d3/d3-format",mapStateToProps:e=>{const t=e.controls&&e.controls.comparison_type&&"percentage"===e.controls.comparison_type.value;return{warning:t?(0,r.t)('When `Calculation type` is set to "Percentage change", the Y Axis Format is forced to `.1%`'):null,disabled:t}}},adhoc_filters:{type:"AdhocFilterControl",label:(0,r.t)("Filters"),default:null,description:"",mapStateToProps:e=>({columns:e.datasource?e.datasource.columns.filter((e=>e.filterable)):[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},color_scheme:{type:"ColorSchemeControl",label:(0,r.t)("Color scheme"),default:p.getDefaultKey(),renderTrigger:!0,choices:()=>p.keys().map((e=>[e,e])),description:(0,r.t)("The color scheme for rendering chart"),schemes:()=>p.getMap()}}},35854:(e,t,n)=>{n.d(t,{R3:()=>i,oN:()=>l});var a=n(37687),o=n(10331),r=n(92252);function i(e,t){var n;const r={...t},i=r.viz_type||(null==(n=e.common)?void 0:n.conf.DEFAULT_VIZ_TYPE)||"table";!function(e){e.y_axis_zero&&(e.y_axis_bounds=[0,null])}(r);const l=(0,o.mi)(i,e.datasource.type,e,r),s=(0,a.Z)().get(i)||{};return s.onInit?s.onInit(l):l}function l(e){const t=e.datasource.split("__")[1],n=e.viz_type,a=(0,o.mi)(n,t,null,e),r=(0,o.Hu)(a),i={};return Object.keys(a).concat(Object.keys(e)).forEach((t=>{void 0===e[t]?i[t]=r[t]:i[t]=e[t]})),i}const s={...r.ai};Object.keys(r.ai).forEach((e=>{s[e].value=r.ai[e].default})),(0,o.Hu)(s)},10945:(e,t,n)=>{n.d(t,{J_:()=>r,DT:()=>i,qy:()=>l,dS:()=>s,S4:()=>c,m7:()=>d});var a=n(55867);function o(e){return Object.keys(e).reduce(((e,t)=>{const n=e;return n[t]=t,n}),{})}const r={FORMULA:{value:"FORMULA",label:(0,a.t)("Formula")},EVENT:{value:"EVENT",label:(0,a.t)("Event"),supportNativeSource:!0},INTERVAL:{value:"INTERVAL",label:(0,a.t)("Interval"),supportNativeSource:!0},TIME_SERIES:{value:"TIME_SERIES",label:(0,a.t)("Time series")}},i=o(r),l=i.FORMULA,s={NATIVE:{value:"NATIVE",label:"Superset annotation"}},c=o(s);function d(e){return!!e}},61358:(e,t,n)=>{n.d(t,{jt:()=>d,Aw:()=>u,J8:()=>h,cq:()=>m,Dr:()=>g,Me:()=>v,M:()=>f,MZ:()=>b});var a=n(41609),o=n.n(a),r=n(31069),i=n(55867),l=n(15926),s=n.n(l),c=n(72570);const d="SET_REPORT";function u(e){let{userId:t,filterField:n,creationMethod:a,resourceId:o}=e;const l=s().encode({filters:[{col:n,opr:"eq",value:o},{col:"creation_method",opr:"eq",value:a},{col:"created_by",opr:"rel_o_m",value:t}]});return function(e){return r.Z.get({endpoint:`/api/v1/report/?q=${l}`}).then((t=>{let{json:r}=t;e(function(e,t,n,a){return{type:d,report:e,resourceId:t,creationMethod:n,filterField:a}}(r,o,a,n))})).catch((()=>e((0,c.Gb)((0,i.t)("There was an issue fetching reports attached to this dashboard.")))))}}const p=(e,t)=>{const n=t(),{user:a,dashboardInfo:r,charts:i,explore:l}=n;if(o()(r)){var s;const[t]=Object.keys(i);e(u({userId:(null==(s=l.user)?void 0:s.userId)||(null==a?void 0:a.userId),filterField:"chart_id",creationMethod:"charts",resourceId:i[t].id}))}else e(u({userId:a.userId,filterField:"dashboard_id",creationMethod:"dashboards",resourceId:r.id}))},h="ADD_REPORT",m=e=>t=>r.Z.post({endpoint:"/api/v1/report/",jsonPayload:e}).then((e=>{let{json:n}=e;t({type:h,json:n}),t((0,c.ws)((0,i.t)("The report has been created")))})),g="EDIT_REPORT",v=(e,t)=>n=>r.Z.put({endpoint:`/api/v1/report/${e}`,jsonPayload:t}).then((e=>{let{json:t}=e;n({type:g,json:t}),n((0,c.ws)((0,i.t)("Report updated")))}));function f(e,t){return function(n){return r.Z.put({endpoint:encodeURI(`/api/v1/report/${e.id}`),headers:{"Content-Type":"application/json"},body:JSON.stringify({active:t})}).catch((()=>{n((0,c.Gb)((0,i.t)("We were unable to active or deactivate this report.")))})).finally((()=>{n(p)}))}}function b(e){return function(t){return r.Z.delete({endpoint:encodeURI(`/api/v1/report/${e.id}`)}).catch((()=>{t((0,c.Gb)((0,i.t)("Your report could not be deleted")))})).finally((()=>{t(p),t((0,c.ws)((0,i.t)("Deleted: %s",e.name)))}))}}},16454:(e,t,n)=>{n.r(t),n.d(t,{TIME_RANGE:()=>he,default:()=>fe});var a=n(23279),o=n.n(a),r=n(78580),i=n.n(r),l=n(67294),s=n(45697),c=n.n(s),d=n(4065),u=n(5872),p=n.n(u),h=n(82492),m=n.n(h),g=n(48533),v=n(75912),f=n(95742),b=n(80454),y=n.n(b),_=n(51995),C=n(37789),Z=n(12766),E=n(320),T=n(74061),S=n(11965);function x(e){let{children:t,...n}=e;const{maxHeight:a,selectProps:o,theme:r,getStyles:i,cx:s,innerRef:c,isMulti:d,className:u}=n,{windowListRef:p,windowListInnerRef:h}=o,m=(0,l.useRef)(null),g=p||m;let{optionHeight:v}=o;v||(v=r?function(e){let{spacing:{baseUnit:t,lineHeight:n}}=e;return 4*t+n}(r):30);const f=v*t.length;return(0,l.useEffect)((()=>{const e=function(e){return Array.isArray(e)?e.findIndex((e=>{let{props:{isFocused:t=!1}={}}=e;return t}))||0:-1}(t);g.current&&e&&g.current.scrollToItem(e)}),[t,g]),(0,S.tZ)(T.t7,{css:i("menuList",n),className:s({"menu-list":!0,"menu-list--is-multi":d},u),ref:g,outerRef:c,innerRef:h,height:Math.min(f,a),width:"100%",itemData:t,itemCount:t.length,itemSize:v},(e=>{let{data:t,index:n,style:a}=e;return(0,S.tZ)("div",{style:a},t[n])}))}const{MenuList:w}=g.F,A=100;function R(e){let{children:t,...n}=e;const{windowThreshold:a=A}=n.selectProps;return Array.isArray(t)&&t.length>a?(0,S.tZ)(x,n,t):(0,S.tZ)(w,n,t)}function D(e){return(0,l.forwardRef)(((t,n)=>{const{components:a={},...o}=t,r={...a,MenuList:R};return(0,S.tZ)(e,p()({components:r,ref:n},o))}))}const O=D(C.ZP),M=D(Z.ZP),L=D(E.Z),N="Select",I="Select",k=e=>({primary:e.colors.success.base,danger:e.colors.error.base,warning:e.colors.warning.base,indicator:e.colors.info.base,almostBlack:e.colors.grayscale.dark1,grayDark:e.colors.grayscale.dark1,grayLight:e.colors.grayscale.light2,gray:e.colors.grayscale.light1,grayBg:e.colors.grayscale.light4,grayBgDarker:e.colors.grayscale.light3,grayBgDarkest:e.colors.grayscale.light2,grayHeading:e.colors.grayscale.light1,menuHover:e.colors.grayscale.light3,lightest:e.colors.grayscale.light5,darkest:e.colors.grayscale.dark2,grayBorder:e.colors.grayscale.light2,grayBorderLight:e.colors.grayscale.light3,grayBorderDark:e.colors.grayscale.light1,textDefault:e.colors.grayscale.dark1,textDarkest:e.colors.grayscale.dark2,dangerLight:e.colors.error.light1}),F={container:(e,t)=>{let{theme:{spacing:{minWidth:n}}}=t;return[e,S.iv`
      min-width: ${n};
    `]},placeholder:e=>[e,S.iv`
      white-space: nowrap;
    `],indicatorSeparator:()=>S.iv`
    display: none;
  `,indicatorsContainer:e=>[e,S.iv`
      i {
        width: 1em;
        display: inline-block;
      }
    `],clearIndicator:e=>[e,S.iv`
      padding: 4px 0 4px 6px;
    `],control:(e,t)=>{let{isFocused:n,menuIsOpen:a,theme:{borderRadius:o,colors:r}}=t;const i=n&&!a;let l=r.grayBorder;return(i||a)&&(l=r.grayBorderDark),[e,S.iv`
        border-color: ${l};
        box-shadow: ${i?"inset 0 1px 1px rgba(0,0,0,.075), 0 0 0 3px rgba(0,0,0,.1)":"none"};
        border-radius: ${a?`${o}px ${o}px 0 0`:`${o}px`};
        &:hover {
          border-color: ${l};
          box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
        }
        flex-wrap: nowrap;
        padding-left: 1px;
      `]},menu:(e,t)=>{let{theme:{zIndex:n}}=t;return[e,S.iv`
      padding-bottom: 2em;
      z-index: ${n}; /* override at least multi-page pagination */
      width: auto;
      min-width: 100%;
      max-width: 80vw;
      background: none;
      box-shadow: none;
      border: 0;
    `]},menuList:(e,t)=>{let{theme:{borderRadius:n,colors:a}}=t;return[e,S.iv`
      background: ${a.lightest};
      border-radius: 0 0 ${n}px ${n}px;
      border: 1px solid ${a.grayBorderDark};
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
      margin-top: -1px;
      border-top-color: ${a.grayBorderLight};
      min-width: 100%;
      width: auto;
      border-radius: 0 0 ${n}px ${n}px;
      padding-top: 0;
      padding-bottom: 0;
    `]},option:(e,t)=>{let{isDisabled:n,isFocused:a,isSelected:o,theme:{colors:r,spacing:{lineHeight:i,fontSize:l},weights:s}}=t,c=r.textDefault,d=r.lightest;return a?d=r.grayBgDarker:n&&(c="#ccc"),[e,S.iv`
        cursor: pointer;
        line-height: ${i}px;
        font-size: ${l}px;
        background-color: ${d};
        color: ${c};
        font-weight: ${o?s.bold:s.normal};
        white-space: nowrap;
        &:hover:active {
          background-color: ${r.grayBg};
        }
      `]},valueContainer:(e,t)=>{let{isMulti:n,hasValue:a,theme:{spacing:{baseUnit:o}}}=t;return[e,S.iv`
      padding-left: ${n&&a?1:3*o}px;
    `]},multiValueLabel:(e,t)=>{let{theme:{spacing:{baseUnit:n}}}=t;return{...e,paddingLeft:1.2*n,paddingRight:1.2*n}},input:(e,t)=>{var n;let{selectProps:a}=t;return[e,S.iv`
      margin-left: 0;
      vertical-align: middle;
      ${null!=a&&a.isMulti&&null!=a&&null!=(n=a.value)&&n.length?"padding: 0 6px; width: 100%":"padding: 0; flex: 1 1 auto;"};
    `]},menuPortal:e=>({...e,zIndex:1030})},P={background:"none",border:"none",outline:"none",padding:0},{ClearIndicator:$,DropdownIndicator:U,Option:V,Input:q,SelectContainer:j}=g.F,H={SelectContainer:e=>{let{children:t,...n}=e;const{selectProps:{assistiveText:a}}=n;return(0,S.tZ)("div",null,(0,S.tZ)(j,n,t),a&&(0,S.tZ)("span",{css:e=>({marginLeft:3,fontSize:e.typography.sizes.s,color:e.colors.grayscale.light1})},a))},Option:e=>{let{children:t,innerProps:n,data:a,...o}=e;return(0,S.tZ)(V,p()({},o,{data:a,css:null!=a&&a.style?a.style:null,innerProps:n}),t)},ClearIndicator:e=>(0,S.tZ)($,e,(0,S.tZ)("i",{className:"fa"},"")),DropdownIndicator:e=>(0,S.tZ)(U,e,(0,S.tZ)("i",{className:"fa fa-caret-"+(e.selectProps.menuIsOpen?"up":"down")})),Input:e=>{const{getStyles:t}=e;return(0,S.tZ)(q,p()({},e,{css:t("input",e),autoComplete:"chrome-off",inputStyle:P}))}},z={valueContainer:(e,t)=>{let{getValue:n,theme:{spacing:{baseUnit:a}},isMulti:o}=t;return{...e,paddingLeft:n().length>0?1:3*a,overflow:o&&n().length>0?"visible":"hidden"}},singleValue:(e,t)=>{const{getStyles:n}=t;return{...n("multiValue",t),".metric-option":n("multiValueLabel",t)}}};function B(e){const t=(0,f.JN)(e,{withRef:!0}),n=H;function a(a){let o;const{selectRef:r,labelKey:i="label",valueKey:l="value",themeConfig:s,stylesConfig:c={},optionRenderer:d,valueRenderer:u,valueRenderedAsLabel:h,onPaste:b,multi:C=!1,clearable:Z,sortable:E=!0,forceOverflow:T,className:x=N,classNamePrefix:w=I,options:A,value:R,components:D,isMulti:O,isClearable:L,minMenuHeight:P=100,maxMenuHeight:$=220,filterOption:U,ignoreAccents:V=!1,getOptionValue:q=(e=>"string"==typeof e?e:e[l]),getOptionLabel:j=(e=>"string"==typeof e?e:e[i]||e[l]),formatOptionLabel:H=((e,t)=>{let{context:n}=t;return"value"===n?u?u(e):j(e):d?d(e):j(e)}),...B}=a,G=function(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n="value"),null==e||""===e)return[];const a=Array.isArray((t[0]||{}).options)?t.flatMap((e=>e.options||[])):t;return(Array.isArray(e)?e:[e]).map((t=>{const o=(e||{}).hasOwnProperty(n)?t[n]:t;return a.find((e=>e===o||e[n]===o))||t}))}(R,A||[],l),W=void 0===O?C:O,K=void 0===L?Z:L,Y=W&&E&&Array.isArray(G)&&G.length>1,Q=Y?t:e,J={...n,...D};if(Y){J.MultiValue=(X=J.MultiValue||g.F.MultiValue,(0,f.W8)((e=>(0,S.tZ)(X,p()({},e,{innerProps:{onMouseDown:e=>{e.preventDefault(),e.stopPropagation()}}})))));const e={getHelperDimensions:e=>{let{node:t}=e;return t.getBoundingClientRect()},axis:"xy",onSortEnd:e=>{let{oldIndex:t,newIndex:n}=e;const a=y()(G,t,n);B.onChange&&B.onChange(a,{action:"set-value"})},distance:4};Object.assign(B,e)}var X;if((void 0===h?W:h)&&!c.valueContainer&&Object.assign(c,z),b){const e=J.Input||g.F.Input;J.Input=t=>(0,S.tZ)(e,p()({},t,{onPaste:b}))}e===M&&(B.getNewOptionData=(e,t)=>({label:t||e,[l]:e,isNew:!0})),T&&Object.assign(B,{closeMenuOnScroll:e=>{var t,n,a;const r=null==(t=o)||null==(n=t.state)?void 0:n.menuIsOpen,i=e.target;return r&&i&&!(null!=(a=i.classList)&&a.contains("Select__menu-list"))},menuPosition:"fixed"});const ee=(0,_.Fg)();return(0,S.tZ)(Q,p()({ref:e=>{o=Y&&e&&"refs"in e?e.refs.wrappedInstance:e,"function"==typeof r?r(o):r&&"current"in r&&(r.current=o)},className:x,classNamePrefix:w,isMulti:W,isClearable:K,options:A,value:G,minMenuHeight:P,maxMenuHeight:$,filterOption:void 0!==U?U:(0,v.c)({ignoreAccents:V}),styles:{...F,...c},theme:e=>m()(e,(e=>({borderRadius:e.borderRadius,zIndex:11,colors:k(e),spacing:{baseUnit:3,menuGutter:0,controlHeight:34,lineHeight:19,fontSize:14,minWidth:"6.5em"},weights:e.typography.weights}))(ee),s),formatOptionLabel:H,getOptionLabel:j,getOptionValue:q,components:J},B))}return l.memo(a)}const G=B(O),W=B(M),K=B(L);class Y extends l.Component{constructor(e){super(e),this.onPaste=this.onPaste.bind(this)}onPaste(e){if(!this.props.isMulti)return;e.preventDefault();const t=e.clipboardData.getData("Text");if(!t)return;const n=`[${this.props.separator}]+`,a=t.split(new RegExp(n)).map((e=>e.trim())),o=this.props.isValidNewOption,r=this.props.value||[],i={},l={};this.props.options.forEach((e=>{i[e[this.props.valueKey]]=1}));let s=[];r.forEach((e=>{s.push({[this.props.labelKey]:e,[this.props.valueKey]:e}),l[e]=1})),s=s.concat(a.filter((e=>{const t=!l[e];return l[e]=1,t&&(o?o({[this.props.labelKey]:e}):!!e)})).map((e=>{const t={[this.props.labelKey]:e,[this.props.valueKey]:e};return i[e]||this.props.options.unshift(t),t}))),s.length&&this.props.onChange&&this.props.onChange(s)}render(){const{selectWrap:e,...t}=this.props;return(0,S.tZ)(e,p()({},t,{onPaste:this.onPaste}))}}Y.propTypes={separator:c().array,selectWrap:c().elementType,selectRef:c().func,onChange:c().func.isRequired,valueKey:c().string,labelKey:c().string,options:c().array,isMulti:c().bool,value:c().any,isValidNewOption:c().func,noResultsText:c().string,forceOverflow:c().bool},Y.defaultProps={separator:[",","\n","\t",";"],selectWrap:G,valueKey:"value",labelKey:"label",options:[],isMulti:!1};var Q=n(64749);const J=(0,_.iK)((e=>(0,S.tZ)(Q.Z,p()({getPopupContainer:e=>e.parentNode},e))))`
  display: block;
`,X=(0,_.iK)(Q.Z)`
  &.ant-select-single {
    .ant-select-selector {
      height: 36px;
      padding: 0 11px;
      background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
      border: none;

      .ant-select-selection-search-input {
        height: 100%;
      }

      .ant-select-selection-item,
      .ant-select-selection-placeholder {
        line-height: 35px;
        color: ${e=>{let{theme:t}=e;return t.colors.grayscale.dark1}};
      }
    }
  }
`;Object.assign(J,{Option:Q.Z.Option}),Object.assign(X,{Option:Q.Z.Option});var ee=n(35932),te=n(55786),ne=n(31069),ae=n(55867),oe=n(68135),re=n(27600),ie=n(49238),le=n(1090),se=n(61357),ce=n(10488),de=n(92252),ue=n(12515),pe=n(69856);const he=pe.i2.time_range,me={chartId:c().number.isRequired,origSelectedValues:c().object,datasource:c().object.isRequired,instantFiltering:c().bool,filtersFields:c().arrayOf(c().shape({field:c().string,label:c().string})),filtersChoices:c().objectOf(c().arrayOf(c().shape({id:c().string,text:c().string,filter:c().string,metric:c().number}))),onChange:c().func,onFilterMenuOpen:c().func,onFilterMenuClose:c().func,showDateFilter:c().bool,showSqlaTimeGrain:c().bool,showSqlaTimeColumn:c().bool},ge=_.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    flex-direction: column;\n    margin-bottom: ${2*t.gridUnit+2}px;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    label {\n      display: flex;\n      font-weight: ${t.typography.weights.bold};\n    }\n\n    .filter-badge-container {\n      width: 30px;\n      padding-right: ${2*t.gridUnit+2}px;\n    }\n\n    .filter-badge-container + div {\n      width: 100%;\n    }\n  `}}
`;class ve extends l.PureComponent{constructor(e){super(e),this.onCloseDateFilterControl=()=>this.onFilterMenuClose(he),this.state={selectedValues:e.origSelectedValues,hasChanged:!1},this.debouncerCache={},this.maxValueCache={},this.changeFilter=this.changeFilter.bind(this),this.onFilterMenuOpen=this.onFilterMenuOpen.bind(this),this.onOpenDateFilterControl=this.onOpenDateFilterControl.bind(this),this.onFilterMenuClose=this.onFilterMenuClose.bind(this)}onFilterMenuOpen(e){return this.props.onFilterMenuOpen(this.props.chartId,e)}onFilterMenuClose(e){return this.props.onFilterMenuClose(this.props.chartId,e)}onOpenDateFilterControl(){return this.onFilterMenuOpen(he)}getControlData(e){const{selectedValues:t}=this.state,n={...de.ai[e],name:e,key:`control-${e}`,value:t[pe.i2[e]],actions:{setControlValue:this.changeFilter}},a=n.mapStateToProps;return a?{...n,...a(this.props)}:n}getKnownMax(e,t){return this.maxValueCache[e]=Math.max(this.maxValueCache[e]||0,(0,d.max)(t||this.props.filtersChoices[e]||[],(e=>e.metric))),this.maxValueCache[e]}clickApply(){const{selectedValues:e}=this.state;this.setState({hasChanged:!1},(()=>{this.props.onChange(e,!1)}))}changeFilter(e,t){const n=pe.i2[e]||e;let a=null;var o;if(null!==t)if(Array.isArray(t))a=t.map((e=>"string"==typeof e?e:e.value));else if(i()(o=Object.values(pe.i2)).call(o,n)){var r;a=null!=(r=t.value)?r:t}else{var l;a=(0,te.Z)(null!=(l=t.value)?l:t)}this.setState((e=>({selectedValues:{...e.selectedValues,[n]:a},hasChanged:!0})),(()=>{this.props.instantFiltering&&this.props.onChange({[n]:a},!1)}))}debounceLoadOptions(e){return e in this.debouncerCache||(this.debouncerCache[e]=o()(((t,n)=>{this.loadOptions(e,t).then(n)}),re.M$)),this.debouncerCache[e]}transformOptions(e,t){const n=void 0===t?(0,d.max)(e,(e=>e.metric)):t;return e.map((e=>{const t=Math.round(e.metric/n*100),a="lightgrey",o={backgroundImage:`linear-gradient(to right, ${a}, ${a} ${t}%, rgba(0,0,0,0) ${t}%`};let r=e.id;return!0===r?r=re.Ly:!1===r&&(r=re.gz),{value:e.id,label:r,style:o}}))}async loadOptions(e,t){var n;void 0===t&&(t="");const a=t.toLowerCase(),o=this.props.filtersFields.find((t=>t.key===e)).asc,r={...this.props.rawFormData,adhoc_filters:t?[{clause:"WHERE",expressionType:"SIMPLE",subject:e,operator:"ILIKE",comparator:`%${a}%`}]:null},{json:i}=await ne.Z.get({url:(0,ue.H6)({formData:r,endpointType:"json",method:"GET"})}),l=((null==i||null==(n=i.data)?void 0:n[e])||[]).filter((e=>e.id));return l&&0!==l.length?(a&&l.sort(((e,t)=>{const n=e.id.toLowerCase(),r=t.id.toLowerCase().startsWith(a)-n.startsWith(a);return 0===r?(e.metric-t.metric)*(o?1:-1):r})),this.transformOptions(l,this.getKnownMax(e,l))):[]}renderDateFilter(){const{showDateFilter:e}=this.props,t=pe.m_.time_range;return e?(0,S.tZ)("div",{className:"row space-1"},(0,S.tZ)("div",{className:"col-lg-12 col-xs-12"},(0,S.tZ)(le.ZP,{name:he,label:t,description:(0,ae.t)("Select start and end date"),onChange:e=>{this.changeFilter(he,e)},onOpenDateFilterControl:this.onOpenDateFilterControl,onCloseDateFilterControl:this.onCloseDateFilterControl,value:this.state.selectedValues[he]||"No filter",endpoints:["inclusive","exclusive"]}))):null}renderDatasourceFilters(){const{showSqlaTimeGrain:e,showSqlaTimeColumn:t}=this.props,n=[],a=[],o=[];return e&&a.push("time_grain_sqla"),t&&a.push("granularity_sqla"),a.length&&n.push((0,S.tZ)(se.Z,{key:"sqla-filters",controls:a.map((e=>(0,S.tZ)(ce.Z,this.getControlData(e))))})),o.length&&n.push((0,S.tZ)(se.Z,{key:"druid-filters",controls:o.map((e=>(0,S.tZ)(ce.Z,this.getControlData(e))))})),n}renderSelect(e){const{filtersChoices:t}=this.props,{selectedValues:n}=this.state;this.debouncerCache={},this.maxValueCache={},Object.keys(n).filter((e=>e in t)).forEach((e=>{if(!n[e])return;const a=t[e]||(t[e]=[]),o=new Set(a.map((e=>e.id)));(Array.isArray(n[e])?n[e]:[n[e]]).filter((e=>null!==e&&!o.has(e))).forEach((t=>{a.unshift({filter:e,id:t,text:t,metric:0})}))}));const{key:a,label:o,[pe.ft.MULTIPLE]:r,[pe.ft.DEFAULT_VALUE]:i,[pe.ft.CLEARABLE]:l,[pe.ft.SEARCH_ALL_OPTIONS]:s}=e,c=t[a]||[];let d=n[a]||null;return void 0===d&&i&&(d=r?i.split(";"):i),(0,S.tZ)(Y,{cacheOptions:!0,loadOptions:this.debounceLoadOptions(a),defaultOptions:this.transformOptions(c),key:a,placeholder:(0,ae.t)("Type or Select [%s]",o),isMulti:r,isClearable:l,value:d,options:this.transformOptions(c),onChange:e=>{e!==d&&this.changeFilter(a,e)},onMenuOpen:()=>this.onFilterMenuOpen(a),onBlur:()=>this.onFilterMenuClose(a),onMenuClose:()=>this.onFilterMenuClose(a),selectWrap:s&&c.length>=pe.cM?K:W,noResultsText:(0,ae.t)("No results found"),forceOverflow:!0})}renderFilters(){const{filtersFields:e=[]}=this.props;return e.map((e=>{const{label:t,key:n}=e;return(0,S.tZ)(ge,{key:n,className:"filter-container"},(0,S.tZ)(ie.lX,{htmlFor:`LABEL-${n}`},t),this.renderSelect(e))}))}render(){const{instantFiltering:e,width:t,height:n}=this.props,{zIndex:a,gridUnit:o}=this.props.theme;return(0,S.tZ)(l.Fragment,null,(0,S.tZ)(S.xB,{styles:S.iv`
            .dashboard .filter_box .slice_container > div:not(.alert) {
              padding-top: 0;
            }

            .filter_box {
              padding: ${2*o+2}px 0;
              overflow: visible !important;

              &:hover {
                z-index: ${a.max};
              }
            }
          `}),(0,S.tZ)("div",{style:{width:t,height:n,overflow:"auto"}},this.renderDateFilter(),this.renderDatasourceFilters(),this.renderFilters(),!e&&(0,S.tZ)(ee.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.clickApply.bind(this),disabled:!this.state.hasChanged},(0,ae.t)("Apply"))))}}ve.propTypes=me,ve.defaultProps={origSelectedValues:{},onChange:()=>{},onFilterMenuOpen:()=>{},onFilterMenuClose:()=>{},showDateFilter:!1,showSqlaTimeGrain:!1,showSqlaTimeColumn:!1,instantFiltering:!1};const fe=(0,oe.b)(ve)},61819:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(21804),o=n.n(a),r=(n(67294),n(51995)),i=n(55867),l=n(51776),s=n(11965);const c=r.iK.div`
  margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,d=function(e){let{certifiedBy:t,details:n,metricName:a}=e;const d=(0,r.Fg)();return(0,s.tZ)(l.Z,{id:`${o()(a)}-tooltip`,title:(0,s.tZ)("div",null,t&&(0,s.tZ)(c,null,(0,i.t)("Certified by %s",t)),(0,s.tZ)("div",null,n))},(0,s.tZ)("svg",{xmlns:"http://www.w3.org/2000/svg",enableBackground:"new 0 0 24 24",height:"14",viewBox:"0 0 24 24",width:"14"},(0,s.tZ)("g",null,(0,s.tZ)("path",{fill:d.colors.primary.base,d:"M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z"}))))}},65634:(e,t,n)=>{n.d(t,{E:()=>p});var a=n(67294),o=n(51995),r=n(11965),i=n(51776),l=n(63351),s=n(61819),c=n(71963),d=n(60605);const u=o.iK.span`
  display: flex;
  align-items: center;
  svg {
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`;function p(e){let{column:t,labelRef:n,showType:o=!1}=e;const{expression:p,column_name:h,type_generic:m}=t,g=p&&p!==h,v=g?"expression":m,[f,b]=(0,a.useState)(t.column_name);return(0,a.useLayoutEffect)((()=>{b((0,c.ZK)(t,n))}),[n,t]),(0,r.tZ)(u,null,o&&void 0!==v&&(0,r.tZ)(l.j,{type:v}),(0,r.tZ)(i.u,{id:"metric-name-tooltip",title:f},(0,r.tZ)("span",{className:"option-label column-option-label",css:e=>r.iv`
              margin-right: ${e.gridUnit}px;
            `,ref:n},(0,c.ok)(t))),g&&(0,r.tZ)(d.Z,{sqlExpression:p}),t.is_certified&&(0,r.tZ)(s.Z,{metricName:t.metric_name,certifiedBy:t.certified_by,details:t.certification_details}))}},63351:(e,t,n)=>{n.d(t,{j:()=>E,Z:()=>T});var a,o=n(67294),r=n(51995),i=n(11965),l=n(55867),s=n(88889),c=n(63270),d=n(78338);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u.apply(this,arguments)}const p=function(e){return o.createElement("svg",u({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a||(a=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.988 10.809l-1.031 4.84c-.184.867-.57 1.576-1.16 2.126-.59.551-1.197.827-1.822.827-.344 0-.597-.066-.76-.197a.61.61 0 01-.242-.495.7.7 0 01.152-.445c.102-.13.248-.194.44-.194.12 0 .227.028.319.082a.978.978 0 01.243.206c.055.066.116.156.185.27l.178.292c.301-.023.558-.226.77-.61.214-.382.398-.929.554-1.64l1.079-5.062H4.75l.123-.534h1.13l.083-.398c.094-.453.242-.861.445-1.225.203-.363.434-.672.692-.925.254-.25.542-.447.864-.59.322-.142.632-.213.929-.213.343 0 .596.065.758.196a.61.61 0 01.244.495.727.727 0 01-.144.446c-.096.128-.245.193-.448.193a.614.614 0 01-.317-.08.895.895 0 01-.24-.207 1.921 1.921 0 01-.187-.276 3.843 3.843 0 00-.176-.287c-.27.012-.508.19-.715.534-.207.343-.395.916-.562 1.716l-.13.621H8.57l-.123.534H6.988zm2.225 2.261c0-1.758.45-3.183 1.387-4.424h.713c-.694.89-1.236 2.774-1.236 4.424 0 1.66.537 3.54 1.236 4.429H10.6c-.938-1.24-1.387-2.666-1.387-4.429zm5.288.957h-.078l-1.25 1.988h-.952l1.802-2.632L12.2 10.75h1.001l1.25 1.958h.078l1.236-1.958h.952l-1.787 2.598 1.811 2.666h-.996l-1.245-1.988zm5.23-.952c0 1.758-.45 3.184-1.387 4.424h-.713c.693-.889 1.235-2.773 1.235-4.424 0-1.66-.537-3.54-1.235-4.429h.713c.937 1.24 1.386 2.666 1.386 4.43z",fill:"currentColor"})))};var h;function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m.apply(this,arguments)}const g=function(e){return o.createElement("svg",m({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),h||(h=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4h-1v16h1V4zm3.248 8.475c0 2.343.913 3.691 2.5 3.691 1.582 0 2.49-1.338 2.49-3.677 0-2.334-.923-3.7-2.49-3.7-1.577 0-2.5 1.361-2.5 3.686zM5.579 9.93V16h.879V8.954h-.874l-1.875 1.348v.928l1.792-1.3h.078zm12.169 5.468c1.04 0 1.607-1.035 1.607-2.924 0-1.87-.577-2.915-1.607-2.915s-1.616 1.054-1.616 2.915c0 1.884.576 2.924 1.616 2.924z",fill:"currentColor"})))};var v;function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},f.apply(this,arguments)}const b=function(e){return o.createElement("svg",f({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),v||(v=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.91 16.14c-1.14 0-2.047-.671-2.047-1.843 0-1.375 1.215-1.621 2.328-1.766 1.094-.14 1.547-.117 1.547-.562 0-.778-.41-1.235-1.265-1.235-.88 0-1.36.47-1.563.907l-.875-.313c.469-1.094 1.5-1.406 2.406-1.406.766 0 2.22.219 2.22 2.125V16h-.923v-.813h-.047c-.187.391-.734.954-1.78.954zm.14-.828c1.095 0 1.688-.734 1.688-1.484v-.844c-.156.188-1.203.297-1.593.344-.72.094-1.36.313-1.36 1.016 0 .64.531.969 1.266.969zM9.799 16V8h.921v2.953h.079c.203-.312.562-1.031 1.734-1.031 1.516 0 2.563 1.203 2.563 3.094 0 1.906-1.047 3.109-2.547 3.109-1.157 0-1.547-.719-1.75-1.047h-.11V16h-.89zm.906-3c0 1.36.61 2.297 1.719 2.297 1.156 0 1.75-1.016 1.75-2.297 0-1.266-.579-2.25-1.75-2.25-1.125 0-1.72.906-1.72 2.25zm7.684 3.125c-1.687 0-2.719-1.297-2.719-3.094 0-1.828 1.079-3.11 2.704-3.11 1.265 0 2.218.75 2.375 1.876h-.922c-.14-.547-.625-1.047-1.438-1.047-1.078 0-1.797.89-1.797 2.25 0 1.39.703 2.297 1.797 2.297.719 0 1.266-.39 1.438-1.047h.922c-.157 1.063-1.032 1.875-2.36 1.875z",fill:"currentColor"})))};var y;function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_.apply(this,arguments)}const C=function(e){return o.createElement("svg",_({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),y||(y=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 8h1v2h2V8h1v2h2v1h-2v2h2v1h-2v2h-1v-2h-2v2h-1v-2H8v-1h2v-2H8v-1h2V8zm3 5v-2h-2v2h2z",fill:"currentColor"})))},Z=r.iK.div`
  ${e=>{let{theme:t}=e;return i.iv`
    display: flex;
    justify-content: center;
    align-items: center;
    width: ${6*t.gridUnit}px;
    height: ${6*t.gridUnit}px;
    margin-right: ${t.gridUnit}px;

    && svg {
      margin-right: 0;
      margin-left: 0;
    }
  `}};
`;function E(e){let{type:t}=e,n=(0,i.tZ)(c.Z,{"aria-label":(0,l.t)("unknown type icon")});return""===t||"expression"===t?n=(0,i.tZ)(p,{"aria-label":(0,l.t)("function type icon")}):t===s.Z.STRING?n=(0,i.tZ)(b,{"aria-label":(0,l.t)("string type icon")}):t===s.Z.NUMERIC?n=(0,i.tZ)(C,{"aria-label":(0,l.t)("numeric type icon")}):t===s.Z.BOOLEAN?n=(0,i.tZ)(g,{"aria-label":(0,l.t)("boolean type icon")}):t===s.Z.TEMPORAL&&(n=(0,i.tZ)(d.Z,{"aria-label":(0,l.t)("temporal type icon")})),(0,i.tZ)(Z,null,n)}const T=E},51384:(e,t,n)=>{n.d(t,{m:()=>m});var a=n(67294),o=n(51995),r=n(11965),i=n(78186),l=n(9882),s=n(63351),c=n(61819),d=n(51776),u=n(71963),p=n(60605);const h=o.iK.div`
  align-items: center;
  display: flex;

  > svg {
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`;function m(e){let{metric:t,labelRef:n,openInNewWindow:o=!1,showFormula:m=!0,showType:g=!1,shouldShowTooltip:v=!0,url:f=""}=e;const b=t.verbose_name||t.metric_name||t.label,y=f?(0,r.tZ)("a",{href:f,target:o?"_blank":"",rel:"noreferrer"},b):b,_=(0,r.tZ)("span",{className:"option-label metric-option-label",css:e=>r.iv`
          margin-right: ${e.gridUnit}px;
        `,ref:n},y),C=t.warning_markdown||t.warning_text,[Z,E]=(0,a.useState)(t.metric_name);return(0,a.useLayoutEffect)((()=>{E((0,u.Lk)(t,n))}),[n,t]),(0,r.tZ)(h,{className:"metric-option"},g&&(0,r.tZ)(s.j,{type:"expression"}),v?(0,r.tZ)(d.Z,{id:"metric-name-tooltip",title:Z},_):_,m&&t.expression&&(0,r.tZ)(p.Z,{sqlExpression:t.expression}),t.is_certified&&(0,r.tZ)(c.Z,{metricName:t.metric_name,certifiedBy:t.certified_by,details:t.certification_details}),C&&(0,r.tZ)(l.Z,{className:"text-warning",icon:"warning",tooltip:(0,r.tZ)(i.Z,{source:C}),label:`warn-${t.metric_name}`,iconsStyle:{marginLeft:0}}))}},60605:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(5872),o=n.n(a),r=(n(67294),n(19181)),i=n(74981),l=n(85369),s=n(51995),c=n(11965),d=n(55867);n(89899);const u=(0,s.iK)(l.Z)`
  ${e=>{let{theme:t}=e;return c.iv`
    color: ${t.colors.grayscale.base};
    font-size: ${t.typography.sizes.s}px;
    & svg {
      margin-left: ${t.gridUnit}px;
      margin-right: ${t.gridUnit}px;
    }
  `}}
`,p=e=>{const t=(0,s.Fg)();return(0,c.tZ)(r.Z,o()({content:(0,c.tZ)(i.default,{mode:"sql",value:e.sqlExpression,editorProps:{$blockScrolling:!0},setOptions:{highlightActiveLine:!1,highlightGutterLine:!1},minLines:2,maxLines:6,readOnly:!0,wrapEnabled:!0,style:{border:`1px solid ${t.colors.grayscale.light2}`,background:t.colors.secondary.light5,maxWidth:100*t.gridUnit}}),placement:"bottomLeft",arrowPointAtCenter:!0,title:(0,d.t)("SQL expression")},e),(0,c.tZ)(u,null))}},71963:(e,t,n)=>{n.d(t,{ok:()=>u,ZK:()=>p,Lk:()=>h});var a=n(67294),o=n(51995),r=n(11965),i=n(55867);const l=o.iK.div`
  ${e=>{let{theme:t}=e;return r.iv`
    display: flex;
    flex-direction: column;
    font-size: ${t.typography.sizes.s}px;
    line-height: 1.2;

    &:not(:last-of-type) {
      margin-bottom: ${2*t.gridUnit}px;
    }
  `}}
`,s=o.iK.span`
  ${e=>{let{theme:t}=e;return r.iv`
    font-weight: ${t.typography.weights.bold};
  `}}
`,c=e=>{let{label:t,text:n}=e;return(0,r.tZ)(l,null,(0,r.tZ)(s,null,t),(0,r.tZ)("span",null,n))},d=e=>{var t,n;return!!((null==e||null==(t=e.current)?void 0:t.scrollWidth)>(null==e||null==(n=e.current)?void 0:n.clientWidth))},u=e=>e.verbose_name||e.column_name,p=(e,t)=>e.column_name&&e.verbose_name||e.description||d(t)?(0,r.tZ)(a.Fragment,null,e.column_name&&(0,r.tZ)(c,{label:(0,i.t)("Column name"),text:e.column_name}),e.verbose_name&&(0,r.tZ)(c,{label:(0,i.t)("Label"),text:e.verbose_name}),e.description&&(0,r.tZ)(c,{label:(0,i.t)("Description"),text:e.description})):null,h=(e,t)=>e.verbose_name||e.description||e.label||d(t)?(0,r.tZ)(a.Fragment,null,(0,r.tZ)(c,{label:(0,i.t)("Metric name"),text:e.metric_name}),(e.label||e.verbose_name)&&(0,r.tZ)(c,{label:(0,i.t)("Label"),text:e.label||e.verbose_name}),e.description&&(0,r.tZ)(c,{label:(0,i.t)("Description"),text:e.description})):null},35622:(e,t,n)=>{n.d(t,{m_:()=>s,DS:()=>c,LU:()=>d,CV:()=>u,cm:()=>p});var a=n(55867),o=n(5364),r=n(88889),i=n(46078),l=n(20620);const s={time_range:(0,a.t)("Time Range"),granularity_sqla:(0,a.t)("Time Column"),time_grain_sqla:(0,a.t)("Time Grain"),granularity:(0,a.t)("Time Granularity")},c={[o.W3]:(0,a.t)("Time")},d={verbose_name:c[o.W3],column_name:o.W3,type_generic:r.Z.TEMPORAL,description:(0,a.t)("A reference to the [Time] configuration, taking granularity into account")},u={name:o.W3,type:i.i9.Query,is_dttm:!1},p={[l.n.aggregate]:(0,a.t)("Aggregate"),[l.n.raw]:(0,a.t)("Raw records")}},356:(e,t,n)=>{n.d(t,{M:()=>Q,Z:()=>J});var a=n(11965),o=n(67294),r=n(51995),i=n(55867),l=n(9882),s=n(51776);function c(e){let{name:t,description:n,label:o,tooltipOnClick:r,onClick:c,warning:d,danger:u,leftNode:p,rightNode:h,validationErrors:m=[],renderTrigger:g=!1,hovered:v=!1,required:f=!1}=e;if(!o)return null;const b=m.length>0?"text-danger":"";return(0,a.tZ)("div",{className:"ControlHeader"},(0,a.tZ)("div",{className:"pull-left"},(0,a.tZ)("label",{className:"control-label",htmlFor:t},p&&(0,a.tZ)("span",null,p),(0,a.tZ)("span",{role:"button",tabIndex:0,onClick:c,className:b,style:{cursor:c?"pointer":""}},o)," ",d&&(0,a.tZ)("span",null,(0,a.tZ)(s.u,{id:"error-tooltip",placement:"top",title:d},(0,a.tZ)("i",{className:"fa fa-exclamation-circle text-warning"}))," "),u&&(0,a.tZ)("span",null,(0,a.tZ)(s.u,{id:"error-tooltip",placement:"top",title:u},(0,a.tZ)("i",{className:"fa fa-exclamation-circle text-danger"}))," "),m.length>0&&(0,a.tZ)("span",null,(0,a.tZ)(s.u,{id:"error-tooltip",placement:"top",title:m.join(" ")},(0,a.tZ)("i",{className:"fa fa-exclamation-circle text-danger"}))," "),v?(0,a.tZ)("span",null,n&&(0,a.tZ)("span",null,(0,a.tZ)(l.V,{label:(0,i.t)("description"),tooltip:n,placement:"top",onClick:r})," "),g&&(0,a.tZ)("span",null,(0,a.tZ)(l.V,{label:(0,i.t)("bolt"),tooltip:(0,i.t)("Changing this control takes effect instantly"),placement:"top",icon:"bolt"})," ")):null,f&&(0,a.tZ)("span",{className:"text-danger m-l-4"},(0,a.tZ)("strong",null,"*")))),h&&(0,a.tZ)("div",{className:"pull-right"},h),(0,a.tZ)("div",{className:"clearfix"}))}function d(e){let{value:t,options:n,onChange:o,...i}=e;const l=t||n[0][0],s=(0,r.Fg)();return(0,a.tZ)("div",{css:(0,a.iv)({".btn svg":{position:"relative",top:"0.2em"},".btn:focus":{outline:"none"},".control-label":{color:s.colors.grayscale.base,marginBottom:s.gridUnit},".control-label + .btn-group":{marginTop:"1px"},".btn-group .btn-default":{color:s.colors.grayscale.dark1},".btn-group .btn.active":{background:s.colors.grayscale.light4,fontWeight:s.typography.weights.bold,boxShadow:"none"}},"","")},(0,a.tZ)(c,i),(0,a.tZ)("div",{className:"btn-group btn-group-sm"},n.map((e=>{let[t,n]=e;return(0,a.tZ)("button",{key:JSON.stringify(t),type:"button",className:"btn btn-default "+(t===l?"active":""),onClick:()=>{o(t)}},n)}))))}var u=n(78580),p=n.n(u),h=n(19181),m=n(63351),g=n(5872),v=n.n(g),f=n(88889),b=n(23279),y=n.n(b),_=n(68122);function C(e){let{children:t}=e;const{gridUnit:n}=(0,r.Fg)();return(0,a.tZ)("div",{css:(0,a.iv)({display:"flex",flexWrap:"nowrap",margin:-2*n,marginBottom:n},"","")},t)}function Z(e){let{onChange:t,value:n,children:i}=e;const l=(0,r.Fg)(),s=(0,o.useMemo)((()=>({0:t,[_.o]:y()(t,_.o)})),[t]),c=o.Children.map(i,(e=>{if("children"in e.props){const a=Array.isArray(e.props.children)?100/e.props.children.length+"%":void 0;return o.cloneElement(e,{children:o.Children.map(e.props.children,(e=>{const{name:r,width:i,debounceDelay:l=_.o,onChange:c}=e.props;return o.cloneElement(e,{width:i||a,value:null==n?void 0:n[r],debounceDelay:void 0,onChange(e){c&&c(e),l in s||(s[l]=y()(t,l)),s[l]({...n,[r]:e})}})}))})}return e}));return(0,a.tZ)("div",{css:(0,a.iv)({label:{textTransform:"uppercase",color:l.colors.text.label,fontSize:l.typography.sizes.s}},"","")},c)}var E=n(31955),T=n(28205),S=n(4107),x=n(31059),w=n(64749);const{Option:A}=w.Z;function R(e){let{creatable:t,onSearch:n,dropdownMatchSelectWidth:r=!1,minWidth:i="100%",showSearch:l=!0,onChange:s,options:c,children:d,value:u,...p}=e;const[h,m]=(0,o.useState)(),g=l||t,f=g?e=>{t&&m(e),n&&n(e)}:void 0,b=null==c?void 0:c.some((e=>{let[t]=e;return t===h})),y=null==c?void 0:c.some((e=>{let[t]=e;return t===u})),_=g?(e,t)=>{m(""),s&&s(e,t)}:s;return(0,a.tZ)(w.Z,v()({dropdownMatchSelectWidth:r,showSearch:g,onSearch:f,onChange:_,value:u},p,{css:(0,a.iv)({minWidth:i},"","")}),null==c?void 0:c.map((e=>{let[t,n]=e;return(0,a.tZ)(A,{value:t},n)})),d,u&&!y&&(0,a.tZ)(A,{key:u,value:u},u),h&&!b&&(0,a.tZ)(A,{key:h,value:h},h))}R.Option=A;const D={Slider:E.Z,InputNumber:T.Z,Input:S.Z,Select:R,Checkbox:x.Z,RadioButtonControl:d};function O(e){let{name:t,label:n,description:i,width:s,validators:d,required:u,onChange:p,value:h,defaultValue:m,controlType:g,...f}=e;const{gridUnit:b}=(0,r.Fg)(),[y,_]=(0,o.useState)(!1),[C,Z]=(0,o.useState)(void 0===h?m:h),[E,T]=(0,o.useState)(),S=e=>{const t=e&&"object"==typeof e&&"target"in e?"checkbox"===e.target.type||"radio"===e.target.type?e.target.checked:e.target.value:e,n=(null==d?void 0:d.map((e=>!(!u&&function(e){return null==e||""===e}(t))&&e(t))).filter((e=>!!e)))||[];T(n),Z(t),0===n.length&&p&&p(t)},x=D[g];return(0,a.tZ)("div",{css:(0,a.iv)({margin:2*b,width:s},"",""),onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1)},"Checkbox"===g?(0,a.tZ)(D.Checkbox,{checked:C,onChange:S},n," ",y&&i&&(0,a.tZ)(l.Z,{tooltip:i})):(0,a.tZ)(o.Fragment,null,n&&(0,a.tZ)(c,{name:t,label:n,description:i,validationErrors:E,hovered:y,required:u}),(0,a.tZ)(x,v()({},f,{value:C,onChange:S}))))}var M=n(872),L=n(61437),N=n(38798),I=n(14031),k=n(58842);const F={controlType:"Select",label:(0,i.t)("D3 format"),description:k.YD,options:k.F6,defaultValue:k.F6[0][0],creatable:!0,minWidth:"14em",debounceDelay:500},P={controlType:"Select",label:(0,i.t)("D3 format"),description:k.oq,options:k.HC,defaultValue:k.HC[0][0],creatable:!0,minWidth:"10em",debounceDelay:500},$={controlType:"Slider",label:(0,i.t)("Fraction digits"),description:(0,i.t)("Number of decimal digits to round numbers to"),min:0,step:1,max:100,defaultValue:100},U={controlType:"InputNumber",label:(0,i.t)("Min Width"),description:(0,i.t)("Default minimal column width in pixels, actual width may still be larger than this if other columns don't need much space"),width:120,placeholder:(0,i.t)("auto"),debounceDelay:400,validators:[M.Z]},V={controlType:"RadioButtonControl",label:(0,i.t)("Text align"),description:(0,i.t)("Horizontal alignment"),width:130,debounceDelay:50,defaultValue:"left",options:[["left",(0,a.tZ)(L.E,{title:(0,i.t)("Left")})],["center",(0,a.tZ)(I.X,{title:(0,i.t)("Center")})],["right",(0,a.tZ)(N.l,{title:(0,i.t)("Right")})]]},q={controlType:"Checkbox",label:(0,i.t)("Show cell bars"),description:(0,i.t)("Whether to display a bar chart background in table columns"),defaultValue:!0,debounceDelay:200},j={controlType:"Checkbox",label:(0,i.t)("Align +/-"),description:(0,i.t)("Whether to align positive and negative values in cell bar chart at 0"),defaultValue:!1,debounceDelay:200},H={controlType:"Checkbox",label:(0,i.t)("Color +/-"),description:(0,i.t)("Whether to colorize numeric values by if they are positive or negative"),defaultValue:!1,debounceDelay:200},z={controlType:"Checkbox",label:(0,i.t)("Truncate Cells"),description:(0,i.t)('Truncate long cells to the "min width" set above'),defaultValue:!1,debounceDelay:400},B={d3NumberFormat:F,d3SmallNumberFormat:{...F,label:(0,i.t)("Small number format"),description:(0,i.t)("D3 number format for numbers between -1.0 and 1.0, useful when you want to have different significant digits for small and large numbers")},d3TimeFormat:P,fractionDigits:$,columnWidth:U,truncateLongCells:z,horizontalAlign:V,showCellBars:q,alignPositiveNegative:j,colorPositiveNegative:H},G={[f.Z.STRING]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}],["truncateLongCells"]],[f.Z.NUMERIC]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"right"}}],["d3NumberFormat"],["d3SmallNumberFormat"],["alignPositiveNegative","colorPositiveNegative"],["showCellBars"]],[f.Z.TEMPORAL]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}],["d3TimeFormat"]],[f.Z.BOOLEAN]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}]]};function W(e){let{column:t,configFormLayout:n,onChange:o}=e;return(0,a.tZ)(Z,{onChange:o,value:t.config},n[void 0===t.type?f.Z.STRING:t.type].map(((e,t)=>(0,a.tZ)(C,{key:t},e.map((e=>{const t="string"==typeof e?e:e.name,n="string"==typeof e?{}:"override"in e?e.override:e.config,o={...t in B?B[t]:void 0,...n};return(0,a.tZ)(O,v()({key:t,name:t},o))}))))))}const K=o.memo((function(e){let{column:t,onChange:n,configFormLayout:o}=e;const{colors:i,gridUnit:l}=(0,r.Fg)(),s=6*l;return(0,a.tZ)(h.Z,{title:t.name,content:()=>(0,a.tZ)(W,{column:t,onChange:n,configFormLayout:o}),trigger:"click",placement:"right"},(0,a.tZ)("div",{css:(0,a.iv)({display:"flex",alignItems:"center",cursor:"pointer",padding:`${l}px ${2*l}px`,borderBottom:`1px solid ${i.grayscale.light2}`,position:"relative",paddingRight:s,"&:last-child":{borderBottom:"none"},"&:hover":{background:i.grayscale.light4},"> .fa":{color:i.grayscale.light2},"&:hover > .fa":{color:i.grayscale.light1}},"")},(0,a.tZ)(m.Z,{type:t.type}),t.name,(0,a.tZ)("i",{className:"fa fa-caret-right",css:(0,a.iv)({position:"absolute",right:3*l,top:3*l},"")})))}));var Y=n(35622);const Q={},J={RadioButtonControl:d,ColumnConfigControl:function(e){let{queryResponse:t,appliedColumnNames:n=[],value:l,onChange:s,configFormLayout:d=G,...u}=e;const{colnames:h,coltypes:m}=t||{};let g=[],v=[];if(0===n.length)g=h||[],v=m||[];else{const e=new Set(n);null==h||h.forEach(((t,n)=>{e.has(t)&&(g.push(t),v.push(null==m?void 0:m[n]))}))}const f=(0,r.Fg)(),b=(0,o.useMemo)((()=>{var e;const t={};return null==(e=g)||e.forEach(((e,n)=>{var a;t[e]={name:Y.DS[e]||e,type:null==(a=v)?void 0:a[n],config:(null==l?void 0:l[e])||{}}})),t}),[l,g,v]),[y,_]=(0,o.useState)(!1),C=e=>b[e]||{};if(!g||0===g.length)return null;const Z=g.length>12,E=Z&&!y?g.slice(0,10):g;return(0,a.tZ)(o.Fragment,null,(0,a.tZ)(c,u),(0,a.tZ)("div",{css:(0,a.iv)({border:`1px solid ${f.colors.grayscale.light2}`,borderRadius:f.gridUnit},"","")},E.map((e=>(0,a.tZ)(K,{key:e,column:C(e),onChange:t=>((e,t)=>{if(s){const n=g&&l?Object.fromEntries(Object.entries(l).filter((e=>{let[t]=e;return p()(g).call(g,t)}))):{...l};s({...n,[e]:t})}})(e,t),configFormLayout:d}))),Z&&(0,a.tZ)("div",{role:"button",tabIndex:-1,css:(0,a.iv)({padding:2*f.gridUnit,textAlign:"center",cursor:"pointer",textTransform:"uppercase",fontSize:f.typography.sizes.xs,color:f.colors.text.label,":hover":{backgroundColor:f.colors.grayscale.light4}},"",""),onClick:()=>_(!y)},y?(0,a.tZ)(o.Fragment,null,(0,a.tZ)("i",{className:"fa fa-angle-up"}),"  ",(0,i.t)("Show less columns")):(0,a.tZ)(o.Fragment,null,(0,a.tZ)("i",{className:"fa fa-angle-down"})," ",(0,i.t)("Show all columns")))))}}},53769:(e,t,n)=>{n.d(t,{xM:()=>g,lC:()=>v,Z8:()=>f,QF:()=>b,RW:()=>y,ql:()=>_,iQ:()=>C,db:()=>Z,x$:()=>E,sH:()=>T,aG:()=>S,$c:()=>x,iR:()=>w,UQ:()=>A,Pi:()=>R,pO:()=>D});var a=n(78580),o=n.n(a),r=n(67294),i=n(55867),l=n(95826),s=n(93185),c=n(38575),d=n(35622),u=n(65634),p=n(19835),h=n(83389),m=n(11965);const g={type:"DndColumnSelect",label:(0,i.t)("Dimensions"),multi:!0,freeForm:!0,clearable:!0,default:[],includeTime:!1,description:(0,i.t)("One or many columns to group by. High cardinality groupings should include a sort by metric and series limit to limit the number of fetched and rendered series."),optionRenderer:e=>(0,m.tZ)(u.E,{showType:!0,column:e}),valueRenderer:e=>(0,m.tZ)(u.E,{column:e}),valueKey:"column_name",allowAll:!0,filterOption:(e,t)=>{var n,a,r,i;let{data:l}=e;return(null==(n=l.column_name)?void 0:o()(a=n.toLowerCase()).call(a,t.toLowerCase()))||(null==(r=l.verbose_name)?void 0:o()(i=r.toLowerCase()).call(i,t.toLowerCase()))||!1},promptTextCreator:e=>e,mapStateToProps(e,t){var n;const a={},{datasource:o}=e;if(null!=o&&null!=(n=o.columns[0])&&n.hasOwnProperty("groupby")){const e=o.columns.filter((e=>e.groupby));null!=t&&t.includeTime&&e.unshift(d.LU),a.options=e,a.savedMetrics=o.metrics||[]}else{const e=(null==o?void 0:o.columns)||[];null!=t&&t.includeTime&&e.unshift(d.CV),a.options=e}return a},commaChoosesOption:!1},v={...g,label:(0,i.t)("Columns"),description:(0,i.t)("One or many columns to pivot as columns")},f={...g,label:(0,i.t)("Dimension"),multi:!1,default:null,description:(0,i.t)("Defines the grouping of entities. Each series is shown as a specific color on the chart and has a legend toggle")},b={...g,label:(0,i.t)("Entity"),default:null,multi:!1,validators:[l.Z],description:(0,i.t)("This defines the element to be plotted on the chart")},y={type:"DndFilterSelect",label:(0,i.t)("Filters"),default:[],description:"",mapStateToProps:e=>{let{datasource:t,form_data:n}=e;return{columns:(0,c.It)(t)?t.columns.filter((e=>e.filterable)):(null==t?void 0:t.columns)||[],savedMetrics:(0,p.R)(t),selectedMetrics:n.metrics||(n.metric?[n.metric]:[]),datasource:t}},provideFormDataToProps:!0,...h.sy},_={type:"DndMetricSelect",multi:!0,label:(0,i.t)("Metrics"),validators:[l.Z],mapStateToProps:e=>{let{datasource:t}=e;return{columns:(null==t?void 0:t.columns)||[],savedMetrics:(0,p.R)(t),datasource:t,datasourceType:null==t?void 0:t.type}},description:(0,i.t)("One or many metrics to display")},C={..._,multi:!1,label:(0,i.t)("Metric"),description:(0,i.t)("Metric")},Z={...C,label:(0,i.t)("Right Axis Metric"),clearable:!0,description:(0,i.t)("Choose a metric for right axis")},E={type:"DndMetricSelect",label:(0,i.t)("Sort by"),default:null,description:(0,i.t)("Metric used to define how the top series are sorted if a series or row limit is present. If undefined reverts to the first metric (where appropriate)."),mapStateToProps:e=>{let{datasource:t}=e;return{columns:(null==t?void 0:t.columns)||[],savedMetrics:(0,p.R)(t),datasource:t,datasourceType:null==t?void 0:t.type}}},T={...C,label:(0,i.t)("Bubble Size"),description:(0,i.t)("Metric used to calculate bubble size"),default:null},S={...C,label:(0,i.t)("X Axis"),description:(0,i.t)("Metric assigned to the [X] axis"),default:null},x={...C,label:(0,i.t)("Y Axis"),description:(0,i.t)("Metric assigned to the [Y] axis"),default:null},w={...C,label:(0,i.t)("Color Metric"),default:null,validators:[],description:(0,i.t)("A metric to use for color")},A={...f,...h.V7,label:d.m_.granularity_sqla,description:(0,i.t)("The time column for the visualization. Note that you can define arbitrary expression that return a DATETIME column in the table. Also note that the filter below is applied against this column or expression"),default:e=>e.default,clearable:!1,canDelete:!1,ghostButtonText:(0,i.t)("Drop temporal column here"),clickEnabledGhostButtonText:(0,i.t)("Drop a temporal column here or click"),optionRenderer:e=>(0,m.tZ)(u.E,{showType:!0,column:e}),valueRenderer:e=>(0,m.tZ)(u.E,{column:e}),valueKey:"column_name"},R={...g,...h.P2};function D(e,t){return function(n){return(0,r.useMemo)((()=>(0,s.c)(s.T.ENABLE_EXPLORE_DRAG_AND_DROP)),[])?(0,m.tZ)(e,n):(0,m.tZ)(t,n)}}},83389:(e,t,n)=>{n.d(t,{P2:()=>d,V7:()=>u,sy:()=>p});var a=n(55867),o=n(95826),r=n(11146),i=n(55786),l=n(5364),s=n(45211);const c=e=>"horizontal"===(null==e?void 0:e.orientation)?{label:(0,a.t)("Y-axis"),description:(0,a.t)("Dimension to use on y-axis.")}:{label:(0,a.t)("X-axis"),description:(0,a.t)("Dimension to use on x-axis.")},d={label:e=>c(null==e?void 0:e.form_data).label,multi:!1,description:e=>c(null==e?void 0:e.form_data).description,validators:[o.Z],initialValue:(e,t)=>{var n,a;if(r.O6&&null!=t&&null!=(n=t.form_data)&&n.granularity_sqla&&(null==(a=t.form_data)||!a.x_axis)&&(null==e||!e.value))return t.form_data.granularity_sqla},default:void 0},u={mapStateToProps:e=>{let{datasource:t}=e;const n=(0,s.X)(t);return{options:n.temporalColumns,default:n.defaultTemporalColumn,isTemporal:!0}}},p={initialValue:(e,t)=>{var n,a;if(!r.O6||(0,i.Z)(e.value).findIndex((e=>"TEMPORAL_RANGE"===(null==e?void 0:e.operator)))>-1)return;if(null!=t&&null!=(n=t.form_data)&&n.granularity_sqla&&null!=t&&null!=(a=t.form_data)&&a.time_range)return[...(0,i.Z)(e.value),{clause:"WHERE",subject:t.form_data.granularity_sqla,operator:"TEMPORAL_RANGE",comparator:t.form_data.time_range,expressionType:"SIMPLE"}];const o=(null==t?void 0:t.datasource)&&(0,s.X)(t.datasource).defaultTemporalColumn;var c,d;return r.O6&&o?[...(0,i.Z)(e.value),{clause:"WHERE",subject:o,operator:"TEMPORAL_RANGE",comparator:(null==t||null==(c=t.common)||null==(d=c.conf)?void 0:d.DEFAULT_TIME_FILTER)||l.vM,expressionType:"SIMPLE"}]:void 0}}},39650:(e,t,n)=>{n.d(t,{ZP:()=>j});var a=n(41609),o=n.n(a),r=n(78580),i=n.n(r),l=n(81545),s=n(45511),c=n(55867),d=n(37731),u=n(11146),p=n(72813),h=n(5364),m=n(75294),g=n(62363),v=n(55786),f=n(6126),b=n(58842),y=n(35622),_=n(53769);const C=(0,l.Z)(),Z=(0,s.Z)(),E=[5,10,25,50,100,500],T=document.getElementById("app"),{user:S}=JSON.parse((null==T?void 0:T.getAttribute("data-bootstrap"))||"{}"),x={type:"DatasourceControl",label:(0,c.t)("Datasource"),default:null,description:null,mapStateToProps:e=>{let{datasource:t,form_data:n}=e;return{datasource:t,form_data:n,user:S}}},w={type:"VizTypeControl",label:(0,c.t)("Visualization Type"),default:"table",description:(0,c.t)("The type of visualization to display")},A={type:"ColorPickerControl",label:(0,c.t)("Fixed Color"),description:(0,c.t)("Use this to define a static color for all circles"),default:{r:0,g:122,b:135,a:1},renderTrigger:!0},R={type:"ColorSchemeControl",label:(0,c.t)("Linear Color Scheme"),choices:()=>Z.values().map((e=>[e.id,e.label])),default:Z.getDefaultKey(),clearable:!1,description:"",renderTrigger:!0,schemes:()=>Z.getMap(),isLinear:!0,mapStateToProps:e=>{var t;return{dashboardId:null==e||null==(t=e.form_data)?void 0:t.dashboardId}}},D={type:"SelectControl",freeForm:!0,label:y.m_.granularity,default:"one day",choices:[[null,(0,c.t)("all")],["PT5S",(0,c.t)("5 seconds")],["PT30S",(0,c.t)("30 seconds")],["PT1M",(0,c.t)("1 minute")],["PT5M",(0,c.t)("5 minutes")],["PT30M",(0,c.t)("30 minutes")],["PT1H",(0,c.t)("1 hour")],["PT6H",(0,c.t)("6 hour")],["P1D",(0,c.t)("1 day")],["P7D",(0,c.t)("7 days")],["P1W",(0,c.t)("week")],["week_starting_sunday",(0,c.t)("week starting Sunday")],["week_ending_saturday",(0,c.t)("week ending Saturday")],["P1M",(0,c.t)("month")],["P3M",(0,c.t)("quarter")],["P1Y",(0,c.t)("year")]],description:(0,c.t)("The time granularity for the visualization. Note that you can type and use simple natural language as in `10 seconds`, `1 day` or `56 weeks`")},O={type:"SelectControl",label:y.m_.time_grain_sqla,placeholder:(0,c.t)("None"),initialValue:(e,t)=>{var n,a;return(0,d.Z)(t)?null!=t&&t.metadata||"time_grain_sqla"in(null!=(n=null==t?void 0:t.form_data)?n:{})?null==t||null==(a=t.form_data)?void 0:a.time_grain_sqla:"P1D":e.value},description:(0,c.t)("The time granularity for the visualization. This applies a date transformation to alter your time column and defines a new time granularity. The options here are defined on a per database engine basis in the Superset source code."),mapStateToProps:e=>{let{datasource:t}=e;return{choices:(null==t?void 0:t.time_grain_sqla)||[]}},visibility:e=>{let{controls:t}=e;if(!u.O6)return!0;const n=null==t?void 0:t.x_axis,a=null==n?void 0:n.value;return!!(0,p.GA)(a)||!!(0,p.s9)(a)&&!(null==(o=(null!=(r=null==n?void 0:n.options)?r:[]).find((e=>(null==e?void 0:e.column_name)===a)))||!o.is_dttm);var o,r}},M={type:"DateFilterControl",freeForm:!0,label:y.m_.time_range,default:h.vM,description:(0,c.t)('The time range for the visualization. All relative times, e.g. "Last month", "Last 7 days", "now", etc. are evaluated on the server using the server\'s local time (sans timezone). All tooltips and placeholder times are expressed in UTC (sans timezone). The timestamps are then evaluated by the database using the engine\'s local timezone. Note one can explicitly set the timezone per the ISO 8601 format if specifying either the start and/or end time.')},L={type:"SelectControl",freeForm:!0,label:(0,c.t)("Row limit"),validators:[m.Z],default:1e4,choices:(0,f.m)([10,50,100,250,500,1e3,5e3,1e4,5e4]),description:(0,c.t)("Limits the number of rows that get displayed.")},N={type:"CheckboxControl",label:(0,c.t)("Sort Descending"),default:!0,description:(0,c.t)("Whether to sort descending or ascending"),visibility:e=>{let{controls:t}=e;return Boolean((null==t?void 0:t.timeseries_limit_metric.value)&&!o()(null==t?void 0:t.timeseries_limit_metric.value))}},I={type:"SelectControl",freeForm:!0,label:(0,c.t)("Series limit"),placeholder:(0,c.t)("None"),validators:[m.Z],choices:(0,f.m)(E),clearable:!0,description:(0,c.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},k={type:"SelectControl",freeForm:!0,label:(0,c.t)("Series limit"),placeholder:(0,c.t)("None"),validators:[m.Z],choices:(0,f.m)(E),description:(0,c.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},F={type:"SelectControl",freeForm:!0,label:(0,c.t)("Y Axis Format"),renderTrigger:!0,default:b.Ul,choices:b.F6,description:b.YD,tokenSeparators:["\n","\t",";"],filterOption:(e,t)=>{var n,a;let{data:o}=e;return i()(n=o.label).call(n,t)||i()(a=o.value).call(a,t)},mapStateToProps:e=>{var t,n;return{choices:(null==(t=e.controls)||null==(n=t.comparison_type)?void 0:n.value)===g.wj.Percentage?b.F6.filter((e=>{var t;return i()(t=e[0]).call(t,"%")})):b.F6}}},P={type:"SelectControl",freeForm:!0,label:(0,c.t)("Time format"),renderTrigger:!0,default:b._r,choices:b.HC,description:b.oq,filterOption:(e,t)=>{var n,a;let{data:o}=e;return i()(n=o.label).call(n,t)||i()(a=o.value).call(a,t)}},$={type:"ColorSchemeControl",label:(0,c.t)("Color Scheme"),default:C.getDefaultKey(),renderTrigger:!0,choices:()=>C.keys().map((e=>[e,e])),description:(0,c.t)("The color scheme for rendering chart"),schemes:()=>C.getMap(),mapStateToProps:e=>{var t;return{dashboardId:null==e||null==(t=e.form_data)?void 0:t.dashboardId}}},U={type:"CheckboxControl",label:(0,c.t)("Truncate Metric"),default:!0,description:(0,c.t)("Whether to truncate metrics")},V={type:"CheckboxControl",label:(0,c.t)("Show empty columns"),default:!0,description:(0,c.t)("Show empty columns")},q={type:"HiddenControl",initialValue:(e,t)=>{var n;return Object.fromEntries((0,v.Z)(null==t||null==(n=t.datasource)?void 0:n.columns).filter((e=>e.is_dttm)).map((e=>{var t;return[null!=(t=e.column_name)?t:e.name,e.is_dttm]})))}},j={metrics:_.ql,metric:_.iQ,datasource:x,viz_type:w,color_picker:A,metric_2:_.db,linear_color_scheme:R,secondary_metric:_.iR,groupby:_.xM,columns:_.lC,granularity:D,granularity_sqla:_.UQ,time_grain_sqla:O,time_range:M,row_limit:L,limit:I,timeseries_limit_metric:_.x$,orderby:_.x$,order_desc:N,series:_.Z8,entity:_.QF,x:_.aG,y:_.$c,size:_.sH,y_axis_format:F,x_axis_time_format:P,adhoc_filters:_.RW,color_scheme:$,series_columns:_.lC,series_limit:k,series_limit_metric:_.x$,legacy_order_by:_.x$,truncate_metric:U,x_axis:_.Pi,show_empty_columns:V,temporal_columns_lookup:q}},38575:(e,t,n)=>{n.d(t,{pp:()=>a,O9:()=>o,vD:()=>r,xN:()=>i,zy:()=>l,D_:()=>s,It:()=>c,JQ:()=>d});const a=e=>{var t,n;return(null==e||null==(t=e.standardizedFormData)?void 0:t.controls)&&(null==e||null==(n=e.standardizedFormData)?void 0:n.memorizedFormData)&&Array.isArray(e.standardizedFormData.controls.metrics)&&Array.isArray(e.standardizedFormData.controls.columns)};var o;!function(e){e.NONE="None",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_OR_EQUAL="",e.LESS_OR_EQUAL="",e.EQUAL="=",e.NOT_EQUAL="",e.BETWEEN="< x <",e.BETWEEN_OR_EQUAL=" x ",e.BETWEEN_OR_LEFT_EQUAL=" x <",e.BETWEEN_OR_RIGHT_EQUAL="< x "}(o||(o={}));const r=[o.BETWEEN,o.BETWEEN_OR_EQUAL,o.BETWEEN_OR_LEFT_EQUAL,o.BETWEEN_OR_RIGHT_EQUAL];function i(e){return!!e&&"column_name"in e}function l(e){return"column_name"in e&&"expression"in e&&!!e.expression}function s(e){return null!==e}function c(e){return!!e&&"columns"in e}function d(e){return!!e&&"results"in e&&"sql"in e}},58842:(e,t,n)=>{n.d(t,{YD:()=>i,pj:()=>l,u6:()=>s,F6:()=>c,oq:()=>d,HC:()=>u,Ul:()=>p,_r:()=>h});var a=n(55867),o=n(45636),r=n(78900);const i=(0,a.t)("D3 format syntax: https://github.com/d3/d3-format"),l=(0,a.t)('Only applies when "Label Type" is set to show values.'),s=(0,a.t)('Only applies when "Label Type" is not set to a percentage.'),c=[[o.Z.SMART_NUMBER,(0,a.t)("Adaptive formatting")],["~g",(0,a.t)("Original value")],[",d",",d (12345.432 => 12,345)"],[".1s",".1s (12345.432 => 10k)"],[".3s",".3s (12345.432 => 12.3k)"],[",.1%",",.1% (12345.432 => 1,234,543.2%)"],[".2%",".2% (12345.432 => 1234543.20%)"],[".3%",".3% (12345.432 => 1234543.200%)"],[".4r",".4r (12345.432 => 12350)"],[",.1f",",.1f (12345.432 => 12,345.4)"],[",.2f",",.2f (12345.432 => 12,345.43)"],[",.3f",",.3f (12345.432 => 12,345.432)"],["+,","+, (12345.432 => +12,345.432)"],["$,.2f","$,.2f (12345.432 => $12,345.43)"],["DURATION",(0,a.t)("Duration in ms (66000 => 1m 6s)")],["DURATION_SUB",(0,a.t)("Duration in ms (1.40008 => 1ms 400s 80ns)")]],d=(0,a.t)("D3 time format syntax: https://github.com/d3/d3-time-format"),u=[[r.Z.id,(0,a.t)("Adaptive formatting")],["%d/%m/%Y","%d/%m/%Y | 14/01/2019"],["%m/%d/%Y","%m/%d/%Y | 01/14/2019"],["%Y-%m-%d","%Y-%m-%d | 2019-01-14"],["%Y-%m-%d %H:%M:%S","%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10"],["%d-%m-%Y %H:%M:%S","%d-%m-%Y %H:%M:%S | 14-01-2019 01:32:10"],["%H:%M:%S","%H:%M:%S | 01:32:10"]],p=c[0][0],h=u[0][0]},19835:(e,t,n)=>{n.d(t,{R:()=>o});var a=n(46078);const o=e=>null!=e&&e.hasOwnProperty("metrics")?(null==e?void 0:e.metrics)||[]:a.BH},89368:(e,t,n)=>{n.d(t,{$:()=>i,q:()=>l});var a=n(67294),o=n(356),r=n(39650);function i(e){return"string"==typeof e&&e in o.Z?o.Z[e]:e}function l(e,t){if(void 0===t&&(t={}),"string"==typeof e&&e in r.ZP){const n=e;return{name:n,config:{...r.ZP[n],...t[n]}}}if(!e||"string"==typeof e||a.isValidElement(e))return e;if("name"in e&&"config"in e)return{...e,config:{...e.config,type:i(e.config.type)}};if("override"in e&&e.name in r.ZP){const{name:t,override:n}=e;return{name:t,config:{...r.ZP[t],...n}}}return null}},20002:(e,t,n)=>{n.d(t,{u:()=>r});var a=n(1875),o=n(38575);const r=(0,a.Z)(class{constructor(){this.controls=void 0,this.controls={metrics:[],columns:[]}}setStandardizedControls(e){if((0,o.pp)(e)){const{controls:t}=e.standardizedFormData;this.controls={metrics:t.metrics,columns:t.columns}}}shiftMetric(){return this.controls.metrics.shift()}shiftColumn(){return this.controls.columns.shift()}popAllMetrics(){return this.controls.metrics.splice(0,this.controls.metrics.length)}popAllColumns(){return this.controls.columns.splice(0,this.controls.columns.length)}clear(){this.controls={metrics:[],columns:[]}}})},45211:(e,t,n)=>{n.d(t,{X:()=>i,x:()=>l});var a=n(55786),o=n(37731),r=n(38575);function i(e){const t={temporalColumns:[],defaultTemporalColumn:void 0};var n,i,l;return(0,r.It)(e)&&(t.temporalColumns=(0,a.Z)(e.columns).filter((e=>e.is_dttm))),(0,r.JQ)(e)&&(t.temporalColumns=(0,a.Z)(e.columns).filter((e=>e.is_dttm))),(0,r.It)(e)&&(t.defaultTemporalColumn=e.main_dttm_col),(0,o.Z)(t.defaultTemporalColumn)||(t.defaultTemporalColumn=null!=(n=null==(i=t.temporalColumns[0])?void 0:i.column_name)?n:null==(l=t.temporalColumns[0])?void 0:l.name),t}function l(e,t){const n=i(t).temporalColumns;for(let t=0;t<n.length;t+=1)if(n[t].column_name===e)return!0;return!1}},6126:(e,t,n)=>{function a(e){return e.map((e=>Array.isArray(e)?e:[e,e.toString()]))}function o(e,t){const n=[];for(let a=e;a<=t;a+=1)n.push([a,a.toString()]);return n}n.d(t,{m:()=>a,B:()=>o})},37687:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(90537),o=n(1875);class r extends a.Z{constructor(){super({name:"ChartControlPanel"})}}const i=(0,o.Z)(r)},16355:(e,t,n)=>{var a,o,r;n.d(t,{cg:()=>a,Tr:()=>o,Df:()=>r,t$:()=>i,eH:()=>l,we:()=>s,ZP:()=>c}),function(e){e.INTERACTIVE_CHART="INTERACTIVE_CHART",e.NATIVE_FILTER="NATIVE_FILTER",e.DRILL_TO_DETAIL="DRILL_TO_DETAIL"}(a||(a={})),function(e){e.EXPLORE="EXPLORE",e.DASHBOARD="DASHBOARD",e.FILTER_BAR="FILTER_BAR",e.FILTER_CONFIG_MODAL="FILTER_CONFIG_MODAL",e.EMBEDDED="EMBEDDED"}(o||(o={})),function(e){e.DEPRECATED="DEPRECATED",e.FEATURED="FEATURED"}(r||(r={}));const i={[r.DEPRECATED]:"This chart uses features or modules which are no longer actively maintained. It will eventually be replaced or removed.",[r.FEATURED]:"This chart was tested and verified, so the overall experience should be stable."},l={[r.DEPRECATED]:{weight:-.1},[r.FEATURED]:{weight:.1}};var s;!function(e){e.category="category",e.value="value",e.time="time",e.log="log"}(s||(s={}));const c={}},28062:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i,DEFAULT_NAMESPACE:()=>s,getNamespace:()=>c,getColor:()=>d,getScale:()=>u});var a=n(97466),o=n(81545),r=n(86041);class i{constructor(e){this.name=void 0,this.forcedItems=void 0,this.scales=void 0,this.name=e,this.scales={},this.forcedItems={}}getScale(e){var t,n;const r=null!=(t=null!=e?e:(0,o.Z)().getDefaultKey())?t:"",i=(0,o.Z)().get(r);return new a.Z(null!=(n=null==i?void 0:i.colors)?n:[],this.forcedItems)}setColor(e,t){return this.forcedItems[(0,r.Z)(e)]=t,this}resetColors(){this.forcedItems={}}}const l={},s="GLOBAL";function c(e){void 0===e&&(e=s);const t=l[e];if(t)return t;const n=new i(e);return l[e]=n,n}function d(e,t,n){return c(n).getScale(t).getColor(e)}function u(e,t){return c(t).getScale(e)}},97466:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(99481),o=n(54732),r=n(86041),i=n(78161),l=n(25130),s=n(93185);class c extends o.Z{constructor(e,t){void 0===t&&(t={}),super(((e,t)=>this.getColor(e,t))),this.originColors=void 0,this.colors=void 0,this.scale=void 0,this.parentForcedColors=void 0,this.forcedColors=void 0,this.multiple=void 0,this.originColors=e,this.colors=e,this.scale=(0,a.Z)(),this.scale.range(e),this.parentForcedColors=t,this.forcedColors={},this.multiple=0}getColor(e,t){var n,a;const o=(0,r.Z)(e),c=(0,i.ZP)();let d=(null==(n=this.parentForcedColors)?void 0:n[o])||(null==(a=this.forcedColors)?void 0:a[o])||c.getColorMap().get(o);if((0,s.c)(s.T.USE_ANALAGOUS_COLORS)){const e=Math.floor(this.domain().length/this.originColors.length);if(e>this.multiple){this.multiple=e;const t=(0,l.Gh)(this.originColors,e);this.range(this.originColors.concat(t))}}const u=this.scale(o);return d||(d=u),c.addSlice(o,d,t),d}setColor(e,t){return this.forcedColors[(0,r.Z)(e)]=t,this}getColorMap(){const e={};return this.scale.domain().forEach((t=>{e[t.toString()]=this.scale(t)})),{...e,...this.forcedColors,...this.parentForcedColors}}copy(){const e=new c(this.scale.range(),this.parentForcedColors);return e.forcedColors={...this.forcedColors},e.domain(this.domain()),e.unknown(this.unknown()),e}domain(e){return void 0===e?this.scale.domain():(this.scale.domain(e),this)}range(e){return void 0===e?this.scale.range():(this.colors=e,this.scale.range(e),this)}unknown(e){return void 0===e?this.scale.unknown():(this.scale.unknown(e),this)}}const d=c},78161:(e,t,n)=>{n.d(t,{Ag:()=>a,Xs:()=>s,ZP:()=>c});var a,o=n(78580),r=n.n(o),i=n(28062),l=n(1875);!function(e){e[e.dashboard=0]="dashboard",e[e.explore=1]="explore"}(a||(a={}));class s{constructor(){this.sliceLabelMap=void 0,this.colorMap=void 0,this.source=void 0,this.sliceLabelMap=new Map,this.colorMap=new Map,this.source=a.dashboard}updateColorMap(e,t){const n=i.getNamespace(e),a=new Map;this.colorMap.clear(),this.sliceLabelMap.forEach((e=>{const o=n.getScale(t);e.forEach((e=>{const t=o(e);a.set(e,t)}))})),this.colorMap=a}getColorMap(){return this.colorMap}addSlice(e,t,n){if(this.source!==a.dashboard||void 0===n)return;const o=this.sliceLabelMap.get(n)||[];r()(o).call(o,e)||(o.push(e),this.sliceLabelMap.set(n,o)),this.colorMap.set(e,t)}removeSlice(e){if(this.source!==a.dashboard)return;this.sliceLabelMap.delete(e);const t=new Map;this.sliceLabelMap.forEach((e=>{e.forEach((e=>{t.set(e,this.colorMap.get(e))}))})),this.colorMap=t}reset(){new Map(this.colorMap).forEach(((e,t)=>{this.colorMap.set(t,"")}))}clear(){this.sliceLabelMap.clear(),this.colorMap.clear()}}const c=(0,l.Z)(s)},86041:(e,t,n)=>{function a(e){return String(e).trim()}n.d(t,{Z:()=>a})},25130:(e,t,n)=>{n.d(t,{Qg:()=>i,Gh:()=>l,Zf:()=>s});var a=n(17621),o=n.n(a);const r=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/;function i(e,t){void 0===t&&(t=186);let n=0,a=0,o=0;if(e.length>7){const t=r.exec(e);if(!t)throw new Error(`Invalid color: ${e}`);n=parseInt(t[1],10),a=parseInt(t[2],10),o=parseInt(t[3],10)}else{let t=e;if(t.startsWith("#")&&(t=t.substring(1)),3===t.length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]].join("")),6!==t.length)throw new Error(`Invalid color: ${e}`);n=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),o=parseInt(t.slice(4,6),16)}return.299*n+.587*a+.114*o>t?"#000":"#FFF"}function l(e,t){const n=[],a=e.map((e=>o()(e).analogous(t+3).slice(3)));for(;null!=(r=a[a.length-1])&&r.length;){var r;a.forEach((e=>{const t=e.shift();n.push(t.toHexString())}))}return n}function s(e,t){if(t>1||t<0)throw new Error(`The opacity should between 0 and 1, but got: ${t}`);return`${e}${`0${Math.round(255*t).toString(16).toUpperCase()}`.slice(-2)}`}},68122:(e,t,n)=>{n.d(t,{o:()=>a,M:()=>o});const a=250,o=500},81847:(e,t,n)=>{n.d(t,{vO:()=>r,YW:()=>i,mc:()=>l});const a={},o=e=>`__superset__/${e}`;async function r(e,t){const n=o(e);if(!window[n]&&!a[e]){const o=t();a[e]=o,window[n]=await o}return a[e]}async function i(e){return Promise.all(Object.entries(e).map((e=>{let[t,n]=e;return r(t,n)})))}function l(){Object.keys(a).forEach((e=>{delete window[o(e)],delete a[e]}))}},53652:(e,t,n)=>{n.d(t,{Z:()=>a});const a=class{constructor(e){this.name="TypedRegistry",this.records=void 0,this.records=e}get(e){return this.records[e]}set(e,t){this.records[e]=t}}},62363:(e,t,n)=>{var a,o;n.d(t,{su:()=>a,wj:()=>o,ZP:()=>r}),function(e){e.Mean="mean",e.Sum="sum",e.Std="std",e.Cumsum="cumsum"}(a||(a={})),function(e){e.Values="values",e.Difference="difference",e.Percentage="percentage",e.Ratio="ratio"}(o||(o={}));const r={}},10916:(e,t,n)=>{var a,o;function r(e){return e.type===a.NATIVE_FILTER}function i(e){var t,n;return r(e)&&(null==(t=e.dataMask)||null==(n=t.filterState)?void 0:n.value)}function l(e){return e.type===a.DIVIDER}n.d(t,{BE:()=>a,gT:()=>o,kI:()=>r,S0:()=>i,nY:()=>l,ZP:()=>s}),function(e){e.NATIVE_FILTER="NATIVE_FILTER",e.DIVIDER="DIVIDER"}(a||(a={})),function(e){e.NativeFilters="nativeFilters",e.CrossFilters="crossFilters"}(o||(o={}));const s={}},88889:(e,t,n)=>{var a;n.d(t,{Z:()=>a,C:()=>o}),function(e){e[e.NUMERIC=0]="NUMERIC",e[e.STRING=1]="STRING",e[e.TEMPORAL=2]="TEMPORAL",e[e.BOOLEAN=3]="BOOLEAN"}(a||(a={}));const o={}},75049:(e,t,n)=>{n.d(t,{I:()=>i,_:()=>l});var a=n(53652),o=n(1875);class r extends a.Z{constructor(){super(...arguments),this.name="ExtensionsRegistry"}}const i=(0,o.Z)(r,{}),l=i},1111:(e,t,n)=>{function a(e,t){return e===t||!e&&!t||!!(e&&t&&e.length===t.length&&e.every(((e,n)=>e===t[n])))}n.d(t,{Z:()=>a})},75294:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(55867);function o(e){return!(!e||!Number.isNaN(Number(e))&&parseInt(e,10)===Number(e))&&(0,a.t)("is expected to be an integer")}},99298:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(55867);function o(e){return!(!e||!Number.isNaN(Number(e)))&&(0,a.t)("is expected to be a number")}},95826:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(55867);function o(e){return!!(null==e||""===e||Array.isArray(e)&&0===e.length)&&(0,a.t)("cannot be empty")}},872:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(55867);function o(e){return!("string"==typeof e&&e.trim().length>0&&Number.isFinite(Number(e.trim()))||"number"==typeof e&&Number.isFinite(e))&&(0,a.t)("is expected to be a number")}},37863:(e,t,n)=>{n.d(t,{u:()=>d,Z:()=>u});var a=n(55867),o=n(4305),r=n(50810),i=n(10331),l=n(76445),s=n(44814),c=n(52256);const d={id:0,chartAlert:null,chartStatus:"loading",chartStackTrace:null,chartUpdateEndTime:null,chartUpdateStartTime:0,latestQueryFormData:{},sliceFormData:null,queryController:null,queriesResponse:null,triggerQuery:!0,lastRendered:0};function u(e,t){void 0===e&&(e={});const n={[c.ADD_CHART]:()=>({...d,...t.chart}),[c.CHART_UPDATE_SUCCEEDED]:e=>({...e,chartStatus:"success",chartAlert:null,queriesResponse:t.queriesResponse,chartUpdateEndTime:(0,s.zO)()}),[c.CHART_UPDATE_STARTED]:e=>({...e,chartStatus:"loading",chartStackTrace:null,chartAlert:null,chartUpdateEndTime:null,chartUpdateStartTime:(0,s.zO)(),queryController:t.queryController}),[c.CHART_UPDATE_STOPPED]:e=>({...e,chartStatus:"stopped",chartAlert:(0,a.t)("Updating chart was stopped"),chartUpdateEndTime:(0,s.zO)()}),[c.CHART_RENDERING_SUCCEEDED]:e=>({...e,chartStatus:"rendered",chartUpdateEndTime:(0,s.zO)()}),[c.CHART_RENDERING_FAILED]:e=>({...e,chartStatus:"failed",chartStackTrace:t.stackTrace,chartAlert:(0,a.t)("An error occurred while rendering the visualization: %s",t.error)}),[c.CHART_UPDATE_FAILED](e){var n,o,r,i;return{...e,chartStatus:"failed",chartAlert:t.queriesResponse?null==(n=t.queriesResponse)||null==(o=n[0])?void 0:o.error:(0,a.t)("Network error."),chartUpdateEndTime:(0,s.zO)(),queriesResponse:t.queriesResponse,chartStackTrace:t.queriesResponse?null==(r=t.queriesResponse)||null==(i=r[0])?void 0:i.stacktrace:null}},[c.DYNAMIC_PLUGIN_CONTROLS_READY]:e=>({...e,sliceFormData:(0,i.Hu)(t.controlsState)}),[c.TRIGGER_QUERY]:e=>({...e,triggerQuery:t.value,chartStatus:"loading"}),[c.RENDER_TRIGGERED]:e=>({...e,lastRendered:t.value}),[c.UPDATE_QUERY_FORM_DATA]:e=>({...e,latestQueryFormData:t.value}),[c.ANNOTATION_QUERY_STARTED](e){var n;null!=(n=e.annotationQuery)&&n[t.annotation.name]&&e.annotationQuery[t.annotation.name].abort();const a={...e.annotationQuery,[t.annotation.name]:t.queryController};return{...e,annotationQuery:a}},[c.ANNOTATION_QUERY_SUCCESS](e){const n={...e.annotationData,[t.annotation.name]:t.queryResponse.data},a={...e.annotationError};delete a[t.annotation.name];const o={...e.annotationQuery};return delete o[t.annotation.name],{...e,annotationData:n,annotationError:a,annotationQuery:o}},[c.ANNOTATION_QUERY_FAILED](e){const n={...e.annotationData};delete n[t.annotation.name];const o={...e.annotationError,[t.annotation.name]:t.queryResponse?t.queryResponse.error:(0,a.t)("Network error.")},r={...e.annotationQuery};return delete r[t.annotation.name],{...e,annotationData:n,annotationError:o,annotationQuery:r}}};if(t.type===c.REMOVE_CHART)return delete e[t.key],e;if(t.type===c.UPDATE_CHART_ID){const{newId:n,key:a}=t;return e[n]={...e[a],id:n},delete e[a],e}return t.type===o.$||t.type===l._?{...t.data.charts}:t.type===r.Rn.SET_DATASOURCES?Object.fromEntries(Object.entries(e).map((e=>{let[t,n]=e;return[t,"failed"===n.chartStatus&&n.chartStackTrace?{...n,chartStatus:"",chartStackTrace:null,chartAlert:null}:n]}))):t.type in n?{...e,[t.key]:n[t.type](e[t.key])}:e}},13842:(e,t,n)=>{n.d(t,{lU:()=>r,dc:()=>i,zq:()=>l}),n(67294);var a=n(51995),o=n(11965);const r=()=>{const e=(0,a.Fg)();return(0,o.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.tZ)("path",{d:"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z",fill:e.colors.primary.base}),(0,o.tZ)("path",{d:"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z",fill:"white"}))},i=()=>{const e=(0,a.Fg)();return(0,o.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light1}),(0,o.tZ)("path",{d:"M14 10H4V8H14V10Z",fill:"white"}))},l=()=>{const e=(0,a.Fg)();return(0,o.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light2}),(0,o.tZ)("path",{d:"M16 2V16H2V2H16V2Z",fill:"white"}))}},87253:(e,t,n)=>{n.d(t,{lU:()=>l.lU,zq:()=>l.zq,ZP:()=>i}),n(67294);var a=n(51995),o=n(11965);const r=a.iK.span`
  &,
  & svg {
    vertical-align: top;
  }
`;function i(e){let{checked:t,onChange:n,style:a,className:i}=e;return(0,o.tZ)(r,{style:a,onClick:()=>{n(!t)},role:"checkbox",tabIndex:0,"aria-checked":t,"aria-label":"Checkbox",className:i||""},t?(0,o.tZ)(l.lU,null):(0,o.tZ)(l.zq,null))}var l=n(13842)},77775:(e,t,n)=>{n.d(t,{Q:()=>x,W:()=>L});var a=n(67294),o=n(29487),r=n(55867),i=n(51995),l=n(31069),s=n(76962),c=n(74069),d=n(35932),u=n(34858),p=n(12515),h=n(27600),m=n(98286),g=n(38703),v=n(9875),f=n(52389),b=n(14114),y=n(34581),_=n(11965);const C=(0,r.t)("Warning! Changing the dataset may break the chart if the metadata does not exist."),Z=(0,r.t)("Changing the dataset may break the chart if the chart relies on columns or metadata that does not exist in the target dataset"),E=(0,i.iK)(c.Z)`
  .ant-modal-body {
    display: flex;
    flex-direction: column;
  }
`,T=i.iK.div`
  .btn-container {
    display: flex;
    justify-content: flex-end;
    padding: 0px 15px;
    margin: 10px 0 0 0;
  }

  .confirm-modal-container {
    margin: 9px;
  }
`,S=i.iK.span`
  cursor: pointer;
  color: ${e=>{let{theme:t}=e;return t.colors.primary.dark1}};
  &: hover {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.dark2}};
  }
`,x=(0,b.ZP)((e=>{let{addDangerToast:t,addSuccessToast:n,onChange:i,onDatasourceSave:c,onHide:b,show:x}=e;const[w,A]=(0,a.useState)(void 0),[R,D]=(0,a.useState)(0),[O,M]=(0,a.useState)(f.dY),[L,N]=(0,a.useState)(!1),[I,k]=(0,a.useState)(),F=(0,a.useRef)(null),{state:{loading:P,resourceCollection:$,resourceCount:U},fetchData:V}=(0,u.Yi)("dataset",(0,r.t)("dataset"),t),q=(0,a.useCallback)((e=>{N(!0),k(e)}),[]),j={pageIndex:R,pageSize:f.IV,filters:[],sortBy:O};(0,p.bX)((()=>{V({...j,...w&&{filters:[{id:"table_name",operator:"ct",value:w}]}})}),h.M$,[w,R,O]),(0,a.useEffect)((()=>{x&&(async()=>{setTimeout((()=>{var e;return null==F||null==(e=F.current)?void 0:e.focus()}),200)})()}),[t,V,i,c,b,q,x]);const H=[{Cell:e=>{let{row:{original:t}}=e;return(0,_.tZ)(S,{role:"button",tabIndex:0,onClick:()=>q({type:"table",...t})},null==t?void 0:t.table_name)},Header:(0,r.t)("Name"),accessor:"table_name"},{Header:(0,r.t)("Type"),accessor:"kind",disableSortBy:!0},{Header:(0,r.t)("Schema"),accessor:"schema"},{Header:(0,r.t)("Connection"),accessor:"database.database_name",disableSortBy:!0},{Cell:e=>{let{row:{original:{owners:t=[]}}}=e;return(0,_.tZ)(y.Z,{users:t})},Header:(0,r.t)("Owners"),id:"owners",disableSortBy:!0}];return(0,_.tZ)(E,{show:x,onHide:b,responsive:!0,title:(0,r.t)("Swap dataset"),width:L?"432px":"",height:L?"auto":"540px",hideFooter:!L,footer:(0,_.tZ)(a.Fragment,null,L&&(0,_.tZ)(T,null,(0,_.tZ)("div",{className:"btn-container"},(0,_.tZ)(d.Z,{onClick:()=>{N(!1)}},(0,r.t)("Cancel")),(0,_.tZ)(d.Z,{className:"proceed-btn",buttonStyle:"primary",onClick:()=>{l.Z.get({endpoint:`/datasource/get/${null==I?void 0:I.type}/${null==I?void 0:I.id}/`}).then((e=>{let{json:t}=e;c(t),i(`${null==I?void 0:I.id}__table`)})).catch((e=>{(0,m.O$)(e).then((e=>{let{error:n,message:a}=e;const o=n?n.error||n.statusText||n:a;t(o)}))})),b(),n((0,r.t)("Successfully changed dataset!"))}},(0,r.t)("Proceed")))))},(0,_.tZ)(a.Fragment,null,!L&&(0,_.tZ)(a.Fragment,null,(0,_.tZ)(o.Z,{roomBelow:!0,type:"warning",css:e=>({marginBottom:4*e.gridUnit}),message:(0,_.tZ)(a.Fragment,null,(0,_.tZ)("strong",null,(0,r.t)("Warning!"))," ",Z)}),(0,_.tZ)(v.II,{ref:F,type:"text",value:w,placeholder:(0,r.t)("Search / Filter"),onChange:e=>{var t;const n=null!=(t=e.target.value)?t:"";A(n),D(0)}}),P&&(0,_.tZ)(g.Z,null),!P&&(0,_.tZ)(s.Z,{columns:H,data:$,pageSize:f.IV,initialPageIndex:R,initialSortBy:O,totalCount:U,onServerPagination:e=>{D(e.pageIndex),e.sortBy&&M(e.sortBy.length>0?e.sortBy:f.dY)},className:"table-condensed",emptyWrapperType:s.u.Small,serverPagination:!0,isPaginationSticky:!0,scrollTable:!0})),L&&(0,_.tZ)(a.Fragment,null,C)))}));var w=n(67913),A=n(91877),R=n(93185);const D=(0,w.Z)((()=>Promise.all([n.e(1216),n.e(8767),n.e(6217),n.e(1128)]).then(n.bind(n,81128)))),O=(0,i.iK)(c.Z)`
  .modal-content {
    height: 900px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .modal-header {
    flex: 0 1 auto;
  }
  .modal-body {
    flex: 1 1 auto;
    overflow: auto;
  }

  .modal-footer {
    flex: 0 1 auto;
  }
`;function M(e){const t=null!=e&&e.certified_by||null!=e&&e.certification_details?{certified_by:null==e?void 0:e.certified_by,details:null==e?void 0:e.certification_details}:void 0;return JSON.stringify({certification:t,warning_markdown:null==e?void 0:e.warning_markdown})}const L=(0,b.ZP)((e=>{let{addSuccessToast:t,datasource:n,onDatasourceSave:i,onHide:s,show:u}=e;const[p,h]=(0,a.useState)(n),[g,v]=(0,a.useState)([]),[f,b]=(0,a.useState)(!1),[y,C]=(0,a.useState)(!1),Z=(0,a.useRef)(null),[E,T]=c.Z.useModal(),S=()=>{var e,n,a,o;const c=(null==(e=p.tableSelector)?void 0:e.schema)||(null==(n=p.databaseSelector)?void 0:n.schema)||p.schema;b(!0),l.Z.post({endpoint:"/datasource/save/",postPayload:{data:{...p,schema:c,metrics:null==p||null==(a=p.metrics)?void 0:a.map((e=>({...e,extra:M(e)}))),columns:null==p||null==(o=p.columns)?void 0:o.map((e=>({...e,extra:M(e)}))),type:p.type||p.datasource_type,owners:p.owners.map((e=>e.value||e.id))}}}).then((e=>{let{json:n}=e;t((0,r.t)("The dataset has been saved")),i({...n,owners:p.owners}),s()})).catch((e=>{b(!1),(0,m.O$)(e).then((e=>{let{error:t}=e;E.error({title:(0,r.t)("Error"),content:t||(0,r.t)("An error has occurred"),okButtonProps:{danger:!0,className:"btn-danger"}})}))}))},x=!(0,A.cr)(R.T.DISABLE_LEGACY_DATASOURCE_EDITOR);return(0,_.tZ)(O,{show:u,onHide:s,title:(0,_.tZ)("span",null,(0,r.t)("Edit Dataset "),(0,_.tZ)("strong",null,p.table_name)),maskClosable:!y,footer:(0,_.tZ)(a.Fragment,null,x&&(0,_.tZ)(d.Z,{buttonSize:"small",buttonStyle:"default",className:"m-r-5",onClick:()=>{window.location.href=p.edit_url||p.url}},(0,r.t)("Use legacy datasource editor")),(0,_.tZ)(d.Z,{buttonSize:"small",className:"m-r-5",onClick:s},(0,r.t)("Cancel")),(0,_.tZ)(d.Z,{buttonSize:"small",buttonStyle:"primary",onClick:()=>{Z.current=E.confirm({title:(0,r.t)("Confirm save"),content:(0,_.tZ)("div",null,(0,_.tZ)(o.Z,{css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),type:"warning",showIcon:!0,message:(0,r.t)("The dataset configuration exposed here\n                affects all the charts using this dataset.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways.")}),(0,r.t)("Are you sure you want to save and apply changes?")),onOk:S,icon:null,okText:(0,r.t)("OK"),cancelText:(0,r.t)("Cancel")})},disabled:f||g.length>0||p.is_managed_externally,tooltip:p.is_managed_externally?(0,r.t)("This dataset is managed externally, and can't be edited in Superset"):""},(0,r.t)("Save"))),responsive:!0},(0,_.tZ)(D,{showLoadingForImport:!0,height:500,datasource:p,onChange:(e,t)=>{h({...e,metrics:null==e?void 0:e.metrics.map((e=>({...e,is_certified:(null==e?void 0:e.certified_by)||(null==e?void 0:e.certification_details)})))}),v(t)},setIsEditing:C}),T)}))},62276:(e,t,n)=>{n.d(t,{S:()=>i,M:()=>l});var a=n(1511),o=n(51995);const r=a.Z.RangePicker,i=(0,o.iK)(r)`
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,l=a.Z},14278:(e,t,n)=>{n.d(t,{Zn:()=>g,gp:()=>v,EM:()=>C});var a=n(14176),o=n.n(a),r=n(67294),i=n(11064),l=n(22102),s=n(81847),c=n(68492),d=n(91877),u=n(93185),p=n(11965);const h=(0,i.Z)(),m={loading:!0,dynamicPlugins:{},keys:[],mountedPluginMetadata:{},fetchAll:()=>{}},g=r.createContext(m),v=()=>(0,r.useContext)(g);function f(){return{keys:h.keys(),mountedPluginMetadata:o()(h.getMap(),(e=>void 0===e))}}function b(e,t){switch(t.type){case"begin":{const n={...e.dynamicPlugins};return t.keys.forEach((e=>{n[e]={key:e,error:null,mounting:!0}})),{...e,loading:t.keys.length>0,dynamicPlugins:n}}case"complete":return{...e,loading:Object.values(e.dynamicPlugins).some((e=>e.mounting&&e.key!==t.key)),dynamicPlugins:{...e.dynamicPlugins,[t.key]:{key:t.key,mounting:!1,error:t.error}}};case"changed keys":return{...e,...f()};default:return e}}const y=(0,l.Z)({method:"GET",endpoint:"/dynamic-plugins/api/read"}),_={react:()=>Promise.resolve().then(n.t.bind(n,67294,19)),lodash:()=>n.e(6486).then(n.t.bind(n,96486,23)),"react-dom":()=>Promise.resolve().then(n.t.bind(n,90731,19)),"@superset-ui/chart-controls":()=>n.e(8989).then(n.bind(n,48989)),"@superset-ui/core":()=>Promise.all([n.e(1216),n.e(2087),n.e(2907),n.e(6377),n.e(8274),n.e(9772),n.e(9471)]).then(n.bind(n,16477))},C=e=>{let{children:t}=e;const[n,a]=(0,r.useReducer)(b,m,(e=>({...e,...f(),fetchAll:o,loading:(0,d.cr)(u.T.DYNAMIC_PLUGINS)})));async function o(){try{await(0,s.YW)(_);const{result:e}=await y({});a({type:"begin",keys:e.map((e=>e.key))}),await Promise.all(e.map((async e=>{let t=null;try{await import(e.bundle_url)}catch(n){c.Z.error(`Failed to load plugin ${e.key} with the following error:`,n.stack),t=n}a({type:"complete",key:e.key,error:t})})))}catch(e){c.Z.error("Failed to load dynamic plugins",e.stack||e)}}return(0,r.useEffect)((()=>{(0,d.cr)(u.T.DYNAMIC_PLUGINS)&&o();const e=()=>{a({type:"changed keys"})};return h.addListener(e),()=>{h.removeListener(e)}}),[]),(0,p.tZ)(g.Provider,{value:n},t)}},34581:(e,t,n)=>{n.d(t,{Z:()=>m}),n(67294);var a=n(81545),o=n(51995),r=n(58593),i=n(4715);var l,s,c=n(11965);const d=null!=(l=null==(s=(0,a.Z)().get())?void 0:s.colors)?l:[],u=e=>`\n  width: ${6*e.gridUnit}px;\n  height: ${6*e.gridUnit}px;\n  line-height: ${6*e.gridUnit}px;\n  font-size: ${e.typography.sizes.m}px;\n`,p=(0,o.iK)(i.qE)`
  ${e=>{let{theme:t}=e;return u(t)}}
`,h=(0,o.iK)(i.qE.Group)`
  .ant-avatar {
    ${e=>{let{theme:t}=e;return u(t)}}
  }
`;function m(e){let{users:t,maxCount:n=4}=e;return(0,c.tZ)(h,{maxCount:n},t.map((e=>{var t,n;let{first_name:a,last_name:o,id:i}=e;const l=`${a} ${o}`,s=function(e,t){return e?t[function(e,t){const n=[...e].map((e=>e.charCodeAt(0))),a=n.length,o=a%(t-1)+1,r=n.reduce(((e,t)=>e+t))%t;let i=n[0]%t;return[...new Array(a)].forEach((()=>{i=(o*i+r)%t})),i}(e,t.length)]:"transparent"}(`${i}-${a}-${o}`,d);return(0,c.tZ)(r.u,{key:l,title:l,placement:"top"},(0,c.tZ)(p,{key:l,style:{backgroundColor:s,borderColor:s}},null==a||null==(t=a[0])?void 0:t.toLocaleUpperCase(),null==o||null==(n=o[0])?void 0:n.toLocaleUpperCase()))})))}},76697:(e,t,n)=>{n.d(t,{ZP:()=>a});const a=n(19181).Z},83734:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(11965),o=(n(67294),n(51995)),r=n(58593),i=n(70163);function l(e){let{title:t,isSelected:n,children:l,onSelect:s,info:c}=e;const d=(0,o.Fg)();return(0,a.tZ)("div",{css:(0,a.iv)({paddingBottom:2*d.gridUnit,opacity:n?1:d.opacity.mediumHeavy},"","")},(0,a.tZ)("div",{role:"button",tabIndex:0,onClick:s,css:(0,a.iv)({display:"flex",alignItems:"center",cursor:s?"pointer":"default"},"","")},(0,a.tZ)("strong",null,t),c&&(0,a.tZ)(r.u,{title:c,css:(0,a.iv)({marginLeft:d.gridUnit},"","")},(0,a.tZ)(i.Z.InfoSolidSmall,{role:"img",width:14,height:14,iconColor:d.colors.grayscale.light1})),(0,a.tZ)(i.Z.Check,{role:"img",iconColor:n?d.colors.primary.base:d.colors.grayscale.base})),(0,a.tZ)("div",{css:(0,a.iv)({marginLeft:d.gridUnit,marginTop:d.gridUnit},"","")},l))}},29147:(e,t,n)=>{n.d(t,{fG:()=>s,DG:()=>c});var a=n(67294),o=n(27600),r=n(23525),i=n(11965);const l=(0,a.createContext)({hideTitle:!1,hideTab:!1,hideNav:!1,hideChartControls:!1}),s=()=>(0,a.useContext)(l),c=e=>{let{children:t}=e;const n=(0,r.eY)(o.KD.uiConfig)||0,[s]=(0,a.useState)({hideTitle:0!=(1&n),hideTab:0!=(2&n),hideNav:0!=(4&n),hideChartControls:0!=(8&n)});return(0,i.tZ)(l.Provider,{value:s},t)}},41295:(e,t,n)=>{n.d(t,{$A:()=>d,fO:()=>u,a8:()=>p,t$:()=>h,Aw:()=>m,nH:()=>g,Fl:()=>v,Mn:()=>f,C6:()=>b});var a=n(47037),o=n.n(a),r=n(28062),i=n(22102),l=n(98286),s=n(72570),c=n(9467);const d="DASHBOARD_INFO_UPDATED";function u(e,t){const n=r.getNamespace(null==e?void 0:e.color_namespace),a=o()(t)?JSON.parse(t):t;Object.keys(a).forEach((e=>{n.setColor(e,a[e])}))}function p(e){const{metadata:t}=e;return r.getNamespace(null==t?void 0:t.color_namespace).resetColors(),null!=t&&t.shared_label_colors&&u(t,null==t?void 0:t.shared_label_colors),null!=t&&t.label_colors&&u(t,null==t?void 0:t.label_colors),{type:d,newInfo:e}}const h="SET_CHART_CONFIG_COMPLETE",m=e=>async(t,n)=>{t({type:"SET_CHART_CONFIG_BEGIN",chartConfiguration:e});const{id:a,metadata:o}=n().dashboardInfo,r=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${a}`});try{const n=await r({json_metadata:JSON.stringify({...o,chart_configuration:e})});t(p({metadata:JSON.parse(n.result.json_metadata)})),t({type:h,chartConfiguration:e})}catch(n){t({type:"SET_CHART_CONFIG_FAIL",chartConfiguration:e})}},g="SET_FILTER_BAR_ORIENTATION",v="SET_CROSS_FILTERS_ENABLED";function f(e){return async(t,n)=>{const{id:a,metadata:o}=n().dashboardInfo,r=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${a}`});try{const n=await r({json_metadata:JSON.stringify({...o,filter_bar_orientation:e})}),a=n.result,i=n.last_modified_time;if(a.json_metadata){const e=JSON.parse(a.json_metadata);e.filter_bar_orientation&&t((d=e.filter_bar_orientation,{type:g,filterBarOrientation:d}))}i&&t((0,c.Vv)(i))}catch(e){const n=await(0,l.HR)(e,"dashboard");throw t((0,s.Gb)(n)),e}var d}}function b(e){return async(t,n)=>{const{id:a,metadata:o}=n().dashboardInfo,r=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${a}`});try{const n=await r({json_metadata:JSON.stringify({...o,cross_filters_enabled:e})}),a=n.result,i=n.last_modified_time;a.json_metadata&&t(function(e){return{type:v,crossFiltersEnabled:e}}(JSON.parse(a.json_metadata).cross_filters_enabled)),i&&t((0,c.Vv)(i))}catch(e){const n=await(0,l.HR)(e,"dashboard");throw t((0,s.Gb)(n)),e}}}},50810:(e,t,n)=>{n.d(t,{Rn:()=>a,Fy:()=>r,QR:()=>l});var a,o=n(31069);function r(e){return{type:a.SET_DATASOURCES,datasources:e}}function i(e,t){return{type:a.SET_DATASOURCE,key:t,datasource:e}}function l(e){return(t,n)=>{const{datasources:a}=n(),r=a[e];return r?t(i(r,e)):o.Z.get({endpoint:`/superset/fetch_datasource_metadata?datasourceKey=${e}`}).then((n=>{let{json:a}=n;return t(i(a,e))}))}}!function(e){e.SET_DATASOURCES="SET_DATASOURCES",e.SET_DATASOURCE="SET_DATASOURCE"}(a||(a={}))},52794:(e,t,n)=>{n.d(t,{qe:()=>i,kN:()=>l,Zp:()=>s,RY:()=>c,xk:()=>d,pi:()=>u,xQ:()=>p,ql:()=>h,$l:()=>m,X8:()=>g,T6:()=>v,$7:()=>f,Up:()=>b,jE:()=>y,TT:()=>_,qN:()=>C,DU:()=>Z});var a=n(22102),o=n(74599),r=n(41295);const i="SET_FILTER_CONFIG_COMPLETE",l="SET_IN_SCOPE_STATUS_OF_FILTERS",s="SET_FILTER_SETS_COMPLETE",c=e=>async(t,n)=>{var l;t({type:"SET_FILTER_CONFIG_BEGIN",filterConfig:e});const{id:s,metadata:c}=n().dashboardInfo,d=null==(l=n().nativeFilters)?void 0:l.filters,u=(0,a.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${s}`}),p=e.map((e=>{const t=d[e.id];return t?{...t,...e}:e}));try{const e=await u({json_metadata:JSON.stringify({...c,native_filter_configuration:p})});t((0,r.a8)({metadata:JSON.parse(e.result.json_metadata)})),t({type:i,filterConfig:p}),t((0,o.Ft)(p,d))}catch(e){t({type:"SET_FILTER_CONFIG_FAIL",filterConfig:p}),t({type:o.u3,filterConfig:p})}},d=e=>async(t,n)=>{var a;const o=null==(a=n().nativeFilters)?void 0:a.filters,i=e.map((e=>({...o[e.filterId],chartsInScope:e.chartsInScope,tabsInScope:e.tabsInScope})));t({type:l,filterConfig:i});const{metadata:s}=n().dashboardInfo,c=s.native_filter_configuration.map((e=>{const t=i.find((t=>t.id===e.id));return t?{...t,...e}:e}));s.native_filter_configuration=c,t((0,r.a8)({metadata:s}))},u=e=>async t=>{const n=(0,a.Z)({method:"GET",endpoint:`/api/v1/dashboard/${e}/filtersets`});t({type:"SET_FILTER_SETS_BEGIN"});const o=await n(null);t({type:s,filterSets:o.ids.map(((e,t)=>({...o.result[t].params,id:e,name:o.result[t].name})))})},p=e=>async(t,n)=>{const o=n().dashboardInfo.id,r=(0,a.Z)({method:"POST",endpoint:`/api/v1/dashboard/${o}/filtersets`});t({type:"CREATE_FILTER_SET_BEGIN"});const i={...e};delete i.name,await r({name:e.name,owner_type:"Dashboard",owner_id:o,json_metadata:JSON.stringify(i)}),t({type:"CREATE_FILTER_SET_COMPLETE"}),t(u(o))},h=e=>async(t,n)=>{const o=n().dashboardInfo.id,r=(0,a.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${o}/filtersets/${e.id}`});t({type:"UPDATE_FILTER_SET_BEGIN"});const i={...e};delete i.id,delete i.name,await r({name:e.name,json_metadata:JSON.stringify(i)}),t({type:"UPDATE_FILTER_SET_COMPLETE"}),t(u(o))},m=e=>async(t,n)=>{const o=n().dashboardInfo.id,r=(0,a.Z)({method:"DELETE",endpoint:`/api/v1/dashboard/${o}/filtersets/${e}`});t({type:"DELETE_FILTER_SET_BEGIN"}),await r({}),t({type:"DELETE_FILTER_SET_COMPLETE"}),t(u(o))},g="SET_FOCUSED_NATIVE_FILTER",v="UNSET_FOCUSED_NATIVE_FILTER";function f(e){return{type:g,id:e}}function b(){return{type:v}}const y="SET_HOVERED_NATIVE_FILTER",_="UNSET_HOVERED_NATIVE_FILTER";function C(e){return{type:y,id:e}}function Z(){return{type:_}}},92242:(e,t,n)=>{n.d(t,{uh:()=>u,G$:()=>p,GA:()=>h,EJ:()=>m,rW:()=>g,Ky:()=>v,W6:()=>f,QN:()=>b});var a=n(78580),o=n.n(a),r=n(14670),i=n.n(r),l=n(8868),s=n(68492),c=n(10916),d=n(80621);const u=function(e,t,n){if(void 0===n&&(n=[]),o()(n).call(n,t))return!0;const a=e.get(t);return!!a&&a.some((a=>u(e,a,[...n,t])))},p=async(e,t,n)=>{try{let t;try{t=await e.validateFields()}catch(e){var a;if(null!=e&&null!=(a=e.errorFields)&&a.length||null==e||!e.outOfDate)throw e;t=e.values}return t}catch(e){if(s.Z.warn("Filter configuration failed:",e),!e.errorFields||!e.errorFields.length)return null;const a=e.errorFields;if(!a.some((e=>e.name[1]===t))){const e=a.find((e=>"filters"===e.name[0]));e&&n(e.name[1])}return null}},h=(e,t,n,a,o)=>async()=>{const r=t.filter((e=>!n[e])).map((t=>{var n,a,r,i;const s=null==(n=o.filters)?void 0:n[t];if(!s)return e[t];if(s.type===c.BE.DIVIDER)return{id:t,type:c.BE.DIVIDER,scope:{rootPath:[d._4],excluded:[]},title:s.title,description:s.description};const u={};return s.dataset&&(u.datasetId=s.dataset.value),s.dataset&&s.column&&(u.column={name:s.column}),{id:t,adhoc_filters:s.adhoc_filters,time_range:s.time_range,controlValues:null!=(a=s.controlValues)?a:{},granularity_sqla:s.granularity_sqla,requiredFirst:Object.values(null!=(r=s.requiredFirst)?r:{}).find((e=>e)),name:s.name,filterType:s.filterType,targets:[u],defaultDataMask:null!=(i=s.defaultDataMask)?i:(0,l.H)(),cascadeParentIds:s.dependencies||[],scope:s.scope,sortMetric:s.sortMetric,type:s.type,description:(s.description||"").trim()}}));await a(r)},m=(e,t,n)=>a=>{const o=window.setTimeout((()=>{(n=>{e((e=>({...e,[n]:{isPending:!1}}))),t((e=>e.filter((e=>e!==n))))})(a)}),5e3);e((e=>({...e,[a]:{isPending:!0,timerId:o}}))),n(!1)},g="NATIVE_FILTER-",v="NATIVE_FILTER_DIVIDER-",f=e=>`${e===c.BE.NATIVE_FILTER?g:v}${i().generate()}`,b=e=>e.map((e=>e.id))},1510:(e,t,n)=>{n.d(t,{zi:()=>p,on:()=>h,vk:()=>m,X3:()=>g,Rz:()=>b});var a=n(78580),o=n.n(a),r=n(5364),i=n(16355),l=n(93185),s=n(70400),c=n(91877),d=n(81255),u=n(80621);const p=e=>{var t;let{datasetId:n,dependencies:a={},groupby:o,defaultDataMask:r,controlValues:i,filterType:l,sortMetric:c,adhoc_filters:d,time_range:u,granularity_sqla:p,type:h}=e;const m={};return n&&(m.datasource=`${n}__table`),o&&(m.groupby=[o]),c&&(m.sortMetric=c),{...i,...m,adhoc_filters:null!=d?d:[],extra_filters:[],extra_form_data:a,granularity_sqla:p,metrics:["count"],row_limit:1e3,showSearch:!0,defaultValue:null==r||null==(t=r.filterState)?void 0:t.value,time_range:u,url_params:(0,s.Z)("regular"),inView:!0,viz_type:l,type:h}};function h(e,t){void 0===e&&(e={}),void 0===t&&(t={});const n={};return r.Ci.forEach((a=>{const o=[...e[a]||[],...t[a]||[]];o.length&&(n[a]=o)})),r.Ay.forEach((a=>{const o=e[a];void 0!==o&&(n[a]=o);const r=t[a];void 0!==r&&(n[a]=r)})),n}function m(e,t){let n={};return t.forEach((t=>{var a,o;n=h(n,null!=(a=null==(o=e[t])?void 0:o.extraFormData)?a:{})})),n}function g(e){return!o()(e).call(e,i.cg.NATIVE_FILTER)||(0,c.cr)(l.T.DASHBOARD_FILTERS_EXPERIMENTAL)&&(0,c.cr)(l.T.DASHBOARD_CROSS_FILTERS)&&o()(e).call(e,i.cg.INTERACTIVE_CHART)}const v=(e,t)=>{var n;return(null==e||null==(n=e[t])?void 0:n.type)===d.gn},f=(e,t,n,a,r)=>{var i,l,s,c,u,p;(null==e||null==(i=e[n])?void 0:i.type)===d.dW&&o()(t).call(t,null==(l=e[n])||null==(s=l.meta)?void 0:s.chartId)&&a.forEach(r.add,r),0===(null==e||null==(c=e[n])||null==(u=c.children)?void 0:u.length)||v(e,n)&&r.has(n)||null==(p=e[n])||p.children.forEach((n=>f(e,t,n,v(e,n)?[...a,n]:a,r)))},b=(e,t)=>{const n=e[u._4].children[0],a=n!==u.PV,o=new Set;var r,i;return a?null==(r=e[n])||null==(i=r.children)||i.forEach((n=>f(e,t,n,[n],o))):Object.values(e).filter((e=>(null==e?void 0:e.type)===d.gn)).forEach((n=>f(e,t,n.id,[n.id],o))),o}},9531:(e,t,n)=>{n.d(t,{tw:()=>a,Ky:()=>o,gz:()=>r,I6:()=>i,aF:()=>l,UN:()=>s,a7:()=>c,XX:()=>d,yT:()=>u});const a={id:0,type:n(46078).i9.Table,uid:"_placeholder_",datasource_name:"",table_name:"",columns:[],column_types:[],metrics:[],column_format:{},verbose_map:{},main_dttm_col:"",description:""},o=53,r=32,i=260,l=550,s=80,c=46,d=374,u=["css","json_metadata.filter_scopes"]},39759:(e,t,n)=>{n.d(t,{a:()=>r,Z:()=>i});var a=n(52794),o=n(4305);function r(e){let{filterSetsConfig:t,filterConfig:n,state:a}=e;const o={},r={};var i;if(n?(n.forEach((e=>{const{id:t}=e;r[t]=e})),o.filters=r):o.filters=null!=(i=null==a?void 0:a.filters)?i:{},t){const e={};t.forEach((t=>{const{id:n}=t;e[n]=t})),o.filterSets=e}else{var l;o.filterSets=null!=(l=null==a?void 0:a.filterSets)?l:{}}return o.focusedFilterId=void 0,o}function i(e,t){switch(void 0===e&&(e={filters:{},filterSets:{}}),t.type){case o.$:return{filters:t.data.nativeFilters.filters,filterSets:t.data.nativeFilters.filterSets};case a.qe:case a.kN:return r({filterConfig:t.filterConfig,state:e});case a.Zp:return r({filterSetsConfig:t.filterSets,state:e});case a.X8:return{...e,focusedFilterId:t.id};case a.T6:return{...e,focusedFilterId:void 0};case a.jE:return{...e,hoveredFilterId:t.id};case a.TT:return{...e,hoveredFilterId:void 0};default:return e}}},52004:(e,t,n)=>{var a;n.d(t,{B:()=>a}),function(e){e.VERTICAL="VERTICAL",e.HORIZONTAL="HORIZONTAL"}(a||(a={}))},81255:(e,t,n)=>{n.d(t,{dW:()=>a,BA:()=>o,Vl:()=>r,BG:()=>i,U0:()=>l,hE:()=>s,Nc:()=>c,xh:()=>d,F0:()=>u,Os:()=>p,yR:()=>h,gn:()=>m,t:()=>g,ZP:()=>v});const a="CHART",o="COLUMN",r="HEADER",i="GRID",l="ROOT",s="DIVIDER",c="HEADER",d="MARKDOWN",u="NEW_COMPONENT_SOURCE",p="ROW",h="TABS",m="TAB",g="DYNAMIC",v={CHART_TYPE:a,COLUMN_TYPE:o,DASHBOARD_HEADER_TYPE:r,DASHBOARD_GRID_TYPE:i,DASHBOARD_ROOT_TYPE:l,DIVIDER_TYPE:s,HEADER_TYPE:c,MARKDOWN_TYPE:d,NEW_COMPONENT_SOURCE_TYPE:u,ROW_TYPE:p,TABS_TYPE:h,TAB_TYPE:m,DYNAMIC_TYPE:g}},52838:(e,t,n)=>{n.d(t,{U:()=>o});var a=n(93185);const o=e=>(0,a.c)(a.T.DASHBOARD_CROSS_FILTERS)&&(void 0===e||e)},70400:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(17563);const o=new Set(["standalone","edit"]);function r(e){const t=a.parse(window.location.search);return Object.entries(t).reduce(((t,n)=>{let[a,r]=n;return"regular"===e&&o.has(a)||"reserved"===e&&!o.has(a)?t:Array.isArray(r)?{...t,[a]:r[0]}:{...t,[a]:r}}),{})}},95173:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(78580),o=n.n(a);const r={};function i(e){let t=null;if(e){const{childId:a,layout:i={}}=e;if(r[a]){var n;const e=(null==i?void 0:i[r[a]])||{};if(null!=e&&e.children&&null!=e&&null!=(n=e.children)&&null!=o()(n)&&o()(n).call(n,a))return e.id}t=function(e){let t=null;if(e){const{childId:a,layout:r={}}=e;if(r){const e=Object.keys(r);for(let i=0;i<=e.length-1;i+=1){var n;const l=e[i],s=r[l]||{};if(l!==a&&null!=s&&null!=(n=s.children)&&null!=o()(n)&&o()(n).call(n,a)){t=l;break}}}}return t}({childId:a,layout:i}),r[a]=t}return t}},32873:(e,t,n)=>{n.d(t,{Q:()=>i});var a=n(78580),o=n.n(a),r=n(81255);function i(e,t,n){const a=Object.values(n);return Object.values(t).filter((t=>{var n,i,l;return!o()(n=e.excluded).call(n,t.id)&&(null==(i=a.find((e=>{var n;return(null==e?void 0:e.type)===r.dW&&(null==(n=e.meta)?void 0:n.chartId)===t.id})))||null==(l=i.parents)?void 0:l.some((t=>{var n;return o()(n=e.rootPath).call(n,t)})))})).map((e=>e.id))}},20194:(e,t,n)=>{function a(e){let{chartId:t,column:n}=e;return`${t}_${n}`}n.d(t,{w:()=>a,_:()=>r});const o=/^([0-9]+)_(.*)$/;function r(e){const t=o.exec(e);if(!t)throw new Error("Cannot parse invalid filter key");return{chartId:parseInt(t[1],10),column:t[2]}}},56967:(e,t,n)=>{function a(){return(window.location.hash||"#").substring(1)}n.d(t,{Z:()=>a})},22318:(e,t,n)=>{n.d(t,{yI:()=>c,Ms:()=>s,i5:()=>l});var a=n(68630),o=n.n(a);function r(e){return function(e){return o()(e)&&"username"in e}(e)&&"permissions"in e&&"roles"in e}var i=n(12617);const l=e=>r(e)&&Object.keys(e.roles||{}).some((e=>"admin"===e.toLowerCase())),s=(e,t)=>r(t)&&(l(t)||((e,t)=>r(t)&&e.owners.some((e=>e.username===t.username)))(e,t))&&(0,i.R)("can_write","Dashboard",t.roles);function c(e){return l(e)||r(e)&&Object.keys(e.roles||{}).some((e=>"sql_lab"===e.toLowerCase()))}},74599:(e,t,n)=>{n.d(t,{Ch:()=>i,A:()=>l,mO:()=>s,u3:()=>c,Ft:()=>d,eG:()=>u,ze:()=>p,sh:()=>h});var a=n(91877),o=n(93185),r=n(8868);const i="CLEAR_DATA_MASK_STATE",l="UPDATE_DATA_MASK",s="SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE",c="SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL";function d(e,t){return{type:s,filterConfig:e,filters:t}}function u(e,t){const n=(0,a.cr)(o.T.DASHBOARD_NATIVE_FILTERS)||(0,a.cr)(o.T.DASHBOARD_CROSS_FILTERS);return{type:l,filterId:e,dataMask:n?t:{}}}function p(e){return u(e,(0,r.H)(e))}function h(){return{type:i}}},8868:(e,t,n)=>{n.d(t,{H:()=>d,Z:()=>p});var a=n(18172),o=n(93185),r=n(92242),i=n(4305),l=n(91877),s=n(74599),c=n(99543);function d(e,t){void 0===t&&(t={});let n={};return e&&(n={id:e}),{...n,extraFormData:{},filterState:{},ownState:{},...t}}function u(e,t,n,a,o){e.forEach((e=>{var n;const r=a||{};t[e.id]={...d(e.id),...e.defaultDataMask,...r[e.id]},o&&!(0,c.JB)(e.defaultDataMask,null==(n=o[e.id])?void 0:n.defaultDataMask,{ignoreUndefined:!0})&&(t[e.id]={...t[e.id],...e.defaultDataMask})})),Object.values(n).forEach((e=>{String(null==e?void 0:e.id).startsWith(r.rW)||(t[null==e?void 0:e.id]=e)}))}const p=(0,a.ZP)(((e,t)=>{var n,a,r,c;const p={};switch(t.type){case s.Ch:return p;case s.A:return e[t.filterId]={...d(t.filterId),...e[t.filterId],...t.dataMask},e;case i.$:var h,m;return(0,l.cr)(o.T.DASHBOARD_CROSS_FILTERS)&&Object.keys(null==(h=t.data.dashboardInfo)||null==(m=h.metadata)?void 0:m.chart_configuration).forEach((e=>{p[e]={...d(e)}})),u(null!=(n=null==(a=t.data.dashboardInfo)||null==(r=a.metadata)?void 0:r.native_filter_configuration)?n:[],p,e,t.data.dataMask),p;case s.mO:return u(null!=(c=t.filterConfig)?c:[],p,e,t.filters),p;default:return e}}),{})},76445:(e,t,n)=>{n.d(t,{_:()=>f,u:()=>b});var a,o=n(78580),r=n.n(o),i=n(12515),l=n(35854),s=n(5364),c=n(81545),d=n(45511),u=n(55786),p=n(10331),h=n(42313),m=n(23525),g=n(27600),v=n(12617);!function(e){e.CATEGORICAL="CATEGORICAL",e.SEQUENTIAL="SEQUENTIAL"}(a||(a={}));const f="HYDRATE_EXPLORE",b=e=>{let{form_data:t,slice:n,dataset:o,metadata:b,saveAction:y=null}=e;return(e,_)=>{var C,Z;const{user:E,datasources:T,charts:S,sliceEntities:x,common:w,explore:A}=_(),R=(0,m.eY)(g.KD.sliceId),D=(0,m.eY)(g.KD.dashboardId),O=R?null==x||null==(C=x.slices)?void 0:C[R]:null,M=null!=n?n:O,L=null!=t?t:null==M?void 0:M.form_data;if(!L.viz_type){const e=(null==w?void 0:w.conf.DEFAULT_VIZ_TYPE)||"table";L.viz_type=(0,m.eY)(g.KD.vizType)||e}var N;L.time_range||(L.time_range=(null==w||null==(N=w.conf)?void 0:N.DEFAULT_TIME_FILTER)||s.vM),D&&(L.dashboardId=D);const I=o,k={form_data:L,slice:M,datasource:I},F=(0,l.R3)(k,L),P=F.color_scheme&&"color_scheme",$=F.linear_color_scheme&&"linear_color_scheme",U=e=>{const t="CATEGORICAL"===e?(0,c.Z)():(0,d.Z)(),n="CATEGORICAL"===e?P:$,a=t.defaultKey,o="CATEGORICAL"===e?"supersetColors":"superset_seq_1",r=L[n],i=!!t.get(r,!0);r&&!i&&(F[n].value=a||o)};P&&U(a.CATEGORICAL),$&&U(a.SEQUENTIAL);const V={can_add:(0,v.R)("can_write","Chart",null==E?void 0:E.roles),can_download:(0,v.R)("can_csv","Superset",null==E?void 0:E.roles),can_overwrite:r()(Z=(0,u.Z)(null==n?void 0:n.owners)).call(Z,null==E?void 0:E.userId),isDatasourceMetaLoading:!1,isStarred:!1,triggerRender:!1,datasource:I,controls:F,form_data:L,slice:M,controlsTransferred:A.controlsTransferred,standalone:(0,m.eY)(g.KD.standalone),force:(0,m.eY)(g.KD.force),metadata:b,saveAction:y,common:w};Object.entries(V.controls).forEach((e=>{let[t,n]=e;V.controls[t]=(0,p.RO)(n,V)}));const q=M?(0,p.Hu)(F):null,j=(0,i.Jp)(k),H={id:j,chartAlert:null,chartStatus:null,chartStackTrace:null,chartUpdateEndTime:null,chartUpdateStartTime:0,latestQueryFormData:(0,p.Hu)(V.controls),sliceFormData:q,queryController:null,queriesResponse:null,triggerQuery:!1,lastRendered:0};return e({type:f,data:{charts:{...S,[j]:H},datasources:{...T,[(0,h.T)(I)]:I},saveModal:{dashboards:[],saveModalAlert:null,isVisible:!1},explore:V}})}}},10488:(e,t,n)=>{n.d(t,{Z:()=>za});var a=n(5872),o=n.n(a),r=n(18446),i=n.n(r),l=n(67294),s=n(51995),c=n(60812),d=n(57902),u=n(356),p=n(78580),h=n.n(p),m=n(45697),g=n.n(m),v=n(4715),f=n(28216),b=n(55867),y=n(68135),_=n(9882),C=n(67913),Z=n(12515),E=n(52256),T=n(11965);function S(e){const{selectable:t,children:n,...a}=e,r=(0,s.Fg)(),i={"&.ant-list-item":{padding:`${r.gridUnit+2}px ${3*r.gridUnit}px`,":first-of-type":{borderTopLeftRadius:r.gridUnit,borderTopRightRadius:r.gridUnit},":last-of-type":{borderBottomLeftRadius:r.gridUnit,borderBottomRightRadius:r.gridUnit}}};return t&&(i["&:hover"]={cursor:"pointer",backgroundColor:r.colors.grayscale.light4}),(0,T.tZ)(v.aV.Item,o()({},a,{css:i}),n)}var x=n(27845);const w=(0,C.Z)((()=>Promise.all([n.e(2087),n.e(5094)]).then(n.bind(n,25094))),(()=>(0,T.tZ)("div",{style:{width:450,height:368}}))),A={colorScheme:g().string.isRequired,annotationError:g().object,annotationQuery:g().object,vizType:g().string,validationErrors:g().array,name:g().string.isRequired,actions:g().object,value:g().arrayOf(g().object),onChange:g().func,refreshAnnotationData:g().func};class R extends l.PureComponent{constructor(e){super(e),this.state={popoverVisible:{},addedAnnotationIndex:null},this.addAnnotationLayer=this.addAnnotationLayer.bind(this),this.removeAnnotationLayer=this.removeAnnotationLayer.bind(this),this.handleVisibleChange=this.handleVisibleChange.bind(this)}componentDidMount(){w.preload()}UNSAFE_componentWillReceiveProps(e){const{name:t,annotationError:n,validationErrors:a,value:o}=e;Object.keys(n).length&&!a.length&&this.props.actions.setControlValue(t,o,Object.keys(n)),!Object.keys(n).length&&a.length&&this.props.actions.setControlValue(t,o,[])}addAnnotationLayer(e,t){let n=this.props.value;h()(n).call(n,e)?n=n.map((n=>n===e?t:n)):(n=[...n,t],this.setState({addedAnnotationIndex:n.length-1})),this.props.refreshAnnotationData({annotation:t,force:!0}),this.props.onChange(n)}handleVisibleChange(e,t){this.setState((n=>({popoverVisible:{...n.popoverVisible,[t]:e}})))}removeAnnotationLayer(e){const t=this.props.value.filter((t=>t!==e)),n=(0,x.j)();n&&n.style.setProperty("overflow-y","auto","important"),this.props.onChange(t)}renderPopover(e,t,n){const a=(null==t?void 0:t.name)||"_new";return(0,T.tZ)("div",{id:`annotation-pop-${a}`},(0,T.tZ)(w,o()({},t,{error:n,colorScheme:this.props.colorScheme,vizType:this.props.vizType,addAnnotationLayer:e=>this.addAnnotationLayer(t,e),removeAnnotationLayer:()=>this.removeAnnotationLayer(t),close:()=>{this.handleVisibleChange(!1,e),this.setState({addedAnnotationIndex:null})}})))}renderInfo(e){const{annotationError:t,annotationQuery:n,theme:a}=this.props;return n[e.name]?(0,T.tZ)("i",{className:"fa fa-refresh",style:{color:a.colors.primary.base},"aria-hidden":!0}):t[e.name]?(0,T.tZ)(_.V,{label:"validation-errors",bsStyle:"danger",tooltip:t[e.name]}):e.show?"":(0,T.tZ)("span",{style:{color:a.colors.error.base}}," Hidden ")}render(){const{addedAnnotationIndex:e}=this.state,t=this.props.value[e],n=this.props.value.map(((e,t)=>(0,T.tZ)(x.Z,{key:t,trigger:"click",title:(0,b.t)("Edit annotation layer"),css:e=>({"&:hover":{cursor:"pointer",backgroundColor:e.colors.grayscale.light4}}),content:this.renderPopover(t,e,this.props.annotationError[e.name]),visible:this.state.popoverVisible[t],onVisibleChange:e=>this.handleVisibleChange(e,t)},(0,T.tZ)(S,{selectable:!0},(0,T.tZ)("span",null,e.name),(0,T.tZ)("span",{style:{float:"right"}},this.renderInfo(e))))));return(0,T.tZ)("div",null,(0,T.tZ)(v.aV,{bordered:!0,css:e=>({borderRadius:e.gridUnit})},n,(0,T.tZ)(x.Z,{trigger:"click",content:this.renderPopover("add",t),title:(0,b.t)("Add annotation layer"),visible:this.state.popoverVisible.add,destroyTooltipOnHide:!0,onVisibleChange:e=>this.handleVisibleChange(e,"add")},(0,T.tZ)(S,{selectable:!0},(0,T.tZ)("i",{className:"fa fa-plus"})," "," ",(0,b.t)("Add annotation layer")))))}}R.propTypes=A,R.defaultProps={vizType:"",value:[],annotationError:{},annotationQuery:{},onChange:()=>{}};const D=(0,y.b)(R),O=(0,f.$j)((function(e){var t,n;let{charts:a,explore:o}=e;const r=a[(0,Z.Jp)(o)]||a[0]||{};return{colorScheme:null==(t=o.controls)||null==(n=t.color_scheme)?void 0:n.value,annotationError:r.annotationError,annotationQuery:r.annotationQuery,vizType:o.controls.viz_type.value}}),(function(e){return{refreshAnnotationData:t=>e((0,E.runAnnotationQuery)(t))}}))(D);var M=n(23279),L=n.n(M),N=n(9875),I=n(82342);const k=s.iK.div`
  display: flex;
`,F=(0,s.iK)(N.Rn)`
  flex: 1;
  margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,P=(0,s.iK)(N.Rn)`
  flex: 1;
  margin-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,$=e=>null===e||Number.isNaN(Number(e))?null:Number(e);function U(e){let{onChange:t=(()=>{}),value:n=[null,null],...a}=e;const[o,r]=(0,l.useState)([$(n[0]),$(n[1])]),i=n[0],s=n[1],c=(0,l.useRef)(L()(t,300)).current,d=e=>{r(e),c([void 0===e[0]?null:e[0],void 0===e[1]?null:e[1]])};return(0,l.useEffect)((()=>{r([$(i),$(s)])}),[i,s]),(0,T.tZ)("div",null,(0,T.tZ)(I.Z,a),(0,T.tZ)(k,null,(0,T.tZ)(F,{placeholder:(0,b.t)("Min"),onChange:e=>{d([$(e),o[1]])},value:null===o[0]?void 0:o[0]}),(0,T.tZ)(P,{placeholder:(0,b.t)("Max"),onChange:e=>{d([o[0],$(e)])},value:null===o[1]?void 0:o[1]})))}var V=n(79069),q=n(14670),j=n.n(q),H=n(95742),z=n(70163),B=n(33334);const G={name:g().string.isRequired,label:g().string,description:g().string,placeholder:g().string,addTooltip:g().string,itemGenerator:g().func,keyAccessor:g().func,onChange:g().func,value:g().oneOfType([g().array]),isFloat:g().bool,isInt:g().bool,controlName:g().string.isRequired},W={label:null,description:null,onChange:()=>{},placeholder:(0,b.t)("Empty collection"),itemGenerator:()=>({key:j().generate()}),keyAccessor:e=>e.key,value:[],addTooltip:(0,b.t)("Add an item")},K=(0,H.W8)(S),Y=(0,H.JN)(v.aV),Q=(0,H.W6)((()=>(0,T.tZ)("i",{role:"img","aria-label":"drag",className:"fa fa-bars text-primary",style:{cursor:"ns-resize"}})));var J={name:"11g6mpt",styles:"justify-content:flex-start"};class X extends l.Component{constructor(e){super(e),this.onAdd=this.onAdd.bind(this)}onChange(e,t){const n=[...this.props.value];n[e]={...this.props.value[e],...t},this.props.onChange(n)}onAdd(){this.props.onChange(this.props.value.concat([this.props.itemGenerator()]))}onSortEnd(e){let{oldIndex:t,newIndex:n}=e;this.props.onChange((0,H.Rp)(this.props.value,t,n))}removeItem(e){this.props.onChange(this.props.value.filter(((t,n)=>e!==n)))}renderList(){if(0===this.props.value.length)return(0,T.tZ)("div",{className:"text-muted"},this.props.placeholder);const e=ja[this.props.controlName];return(0,T.tZ)(Y,{useDragHandle:!0,lockAxis:"y",onSortEnd:this.onSortEnd.bind(this),bordered:!0,css:e=>({borderRadius:e.gridUnit})},this.props.value.map(((t,n)=>{const{label:a,...r}=this.props;return(0,T.tZ)(K,{className:"clearfix",css:J,key:this.props.keyAccessor(t),index:n},(0,T.tZ)(Q,null),(0,T.tZ)("div",{css:e=>({flex:1,marginLeft:2*e.gridUnit,marginRight:2*e.gridUnit})},(0,T.tZ)(e,o()({},r,t,{onChange:this.onChange.bind(this,n)}))),(0,T.tZ)(_.V,{icon:"times",label:"remove-item",tooltip:(0,b.t)("Remove item"),bsStyle:"primary",onClick:this.removeItem.bind(this,n)}))})))}render(){const{theme:e}=this.props;return(0,T.tZ)("div",{className:"CollectionControl"},(0,T.tZ)(B.gM,null,(0,T.tZ)(I.Z,this.props),(0,T.tZ)(B.IG,{onClick:this.onAdd},(0,T.tZ)(z.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5}))),this.renderList())}}X.propTypes=G,X.defaultProps=W;const ee=(0,y.b)(X);var te=n(24198),ne=n(81545),ae=n(76697);const oe={onChange:g().func,value:g().object},re={position:"absolute",width:"50px",height:"20px",top:"0px",left:"0px",right:"0px",bottom:"0px"},ie=s.iK.div`
  ${e=>{let{theme:t}=e;return`\n      width: 50px;\n      height: 20px;\n      position: relative;\n      padding: ${t.gridUnit}px;\n      borderRadius: ${t.borderRadius}px;\n      display: inline-block;\n      cursor: pointer;\n    `}}
`,le={color:{...re,borderRadius:"2px"},checkerboard:{...re,background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==") left center'}};class se extends l.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){this.props.onChange(e.rgb)}renderPopover(){const e=(0,ne.Z)().get().colors.filter(((e,t)=>t<7));return(0,T.tZ)("div",{id:"filter-popover",className:"color-popover"},(0,T.tZ)(te.xS,{color:this.props.value,onChange:this.onChange,presetColors:e}))}render(){const e=this.props.value||{r:0,g:0,b:0,a:0},t={...le.color,background:`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`};return(0,T.tZ)("div",null,(0,T.tZ)(I.Z,this.props),(0,T.tZ)(ae.ZP,{trigger:"click",placement:"right",content:this.renderPopover()},(0,T.tZ)(ie,null,(0,T.tZ)("div",{style:le.checkerboard}),(0,T.tZ)("div",{style:t}))))}}se.propTypes=oe,se.defaultProps={onChange:()=>{}};var ce=n(76787),de=n(47037),ue=n.n(de),pe=n(46078),he=n(31069),me=n(45211),ge=n(23525),ve=n(83862),fe=n(58593),be=n(77775),ye=n(35932),_e=n(91178),Ce=n(86057),Ze=n(27600),Ee=n(79217),Te=n(22318),Se=n(1304),xe=n(13218),we=n.n(xe);const Ae=(0,b.t)("Close"),Re=(0,b.t)("Save as Dataset"),De=(0,b.t)("Open in SQL Lab"),Oe=e=>(0,T.tZ)("div",null,(0,T.tZ)(ye.Z,{onClick:()=>{null==e||null==e.closeModal||e.closeModal(),null==e||null==e.changeDatasource||e.changeDatasource()}},Re),(0,T.tZ)(ye.Z,{onClick:()=>(()=>{const{datasource:t}=e;if(we()(t)){const{id:e,type:n,sql:a}=t;((e,t,n)=>{const a={datasourceKey:`${e}__${t}`,sql:n};he.Z.postForm("/superset/sqllab/",a)})(e,n,a)}})()},De),(0,T.tZ)(ye.Z,{buttonStyle:"primary",onClick:()=>{null==e||null==e.closeModal||e.closeModal()}},Ae));var Me=n(85626),Le=n(47710),Ne=n(9679);const Ie={actions:g().object.isRequired,onChange:g().func,value:g().string,datasource:g().object.isRequired,form_data:g().object.isRequired,isEditable:g().bool,onDatasourceSave:g().func},ke=s.iK.div`
  .data-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
    padding-right: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }
  .error-alert {
    margin: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }
  .ant-dropdown-trigger {
    margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    box-shadow: none;
    &:active {
      box-shadow: none;
    }
  }
  .btn-group .open .dropdown-toggle {
    box-shadow: none;
    &.button-default {
      background: none;
    }
  }
  i.angle {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }
  svg.datasource-modal-trigger {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
    cursor: pointer;
  }
  .title-select {
    flex: 1 1 100%;
    display: inline-block;
    background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
    padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}}px;
    text-align: center;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }
  .datasource-svg {
    margin-right: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    flex: none;
  }
  span[aria-label='dataset-physical'] {
    color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  }
  span[aria-label='more-vert'] {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }
`,Fe="change_dataset",Pe="view_in_sql_lab",$e="edit_dataset",Ue="save_as_dataset",Ve={[pe.i9.Query]:(0,T.tZ)(z.Z.ConsoleSqlOutlined,{className:"datasource-svg"}),[pe.i9.Table]:(0,T.tZ)(z.Z.DatasetPhysical,{className:"datasource-svg"})};class qe extends l.PureComponent{constructor(e){super(e),this.onDatasourceSave=e=>{var t,n,a;this.props.actions.changeDatasource(e);const{temporalColumns:o,defaultTemporalColumn:r}=(0,me.X)(e),{columns:i}=e,l=null==(t=this.props.form_data)?void 0:t.granularity_sqla,s=null==(n=i.find((e=>{let{column_name:t}=e;return t===l})))?void 0:n.is_dttm,c=null==(a=i.find((e=>{let{column_name:t}=e;return t===r})))?void 0:a.is_dttm;if("table"===e.type&&!s){const e=c?r:null==o?void 0:o[0];this.props.actions.setControlValue("granularity_sqla",e||null)}this.props.onDatasourceSave&&this.props.onDatasourceSave(e)},this.toggleShowDatasource=()=>{this.setState((e=>{let{showDatasource:t}=e;return{showDatasource:!t}}))},this.toggleChangeDatasourceModal=()=>{this.setState((e=>{let{showChangeDatasourceModal:t}=e;return{showChangeDatasourceModal:!t}}))},this.toggleEditDatasourceModal=()=>{this.setState((e=>{let{showEditDatasourceModal:t}=e;return{showEditDatasourceModal:!t}}))},this.toggleSaveDatasetModal=()=>{this.setState((e=>{let{showSaveDatasetModal:t}=e;return{showSaveDatasetModal:!t}}))},this.handleMenuItemClick=e=>{let{key:t}=e;switch(t){case Fe:this.toggleChangeDatasourceModal();break;case $e:this.toggleEditDatasourceModal();break;case Pe:{const{datasource:e}=this.props,t={datasourceKey:`${e.id}__${e.type}`,sql:e.sql};he.Z.postForm("/superset/sqllab/",{form_data:(0,Ne.o)(t)})}break;case Ue:this.toggleSaveDatasetModal()}},this.state={showEditDatasourceModal:!1,showChangeDatasourceModal:!1,showSaveDatasetModal:!1}}render(){var e,t,n;const{showChangeDatasourceModal:a,showEditDatasourceModal:o,showSaveDatasetModal:r}=this.state,{datasource:i,onChange:s,theme:c}=this.props,d=!(null!=i&&i.id);let u=!1;if(d){const e=(0,ge.eY)(Ze.KD.datasourceId),t=(0,ge.eY)(Ze.KD.sliceId);e||t||(u=!0)}const{user:p}=this.props,m=(null==(e=i.owners)?void 0:h()(t=e.map((e=>e.id||e.value))).call(t,p.userId))||(0,Te.i5)(p),g=(0,Te.yI)(p),f=(0,b.t)("Edit dataset"),y=(0,T.tZ)(ve.v,{onClick:this.handleMenuItemClick},this.props.isEditable&&!d&&(0,T.tZ)(ve.v.Item,{key:$e,disabled:!m},m?f:(0,T.tZ)(fe.u,{title:(0,b.t)("You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access.")},f)),(0,T.tZ)(ve.v.Item,{key:Fe},(0,b.t)("Swap dataset")),!d&&g&&(0,T.tZ)(ve.v.Item,{key:Pe},(0,b.t)("View in SQL Lab"))),_=(0,T.tZ)(ve.v,{onClick:this.handleMenuItemClick},(0,T.tZ)(ve.v.Item,{key:"query_preview"},(0,T.tZ)(Se.Z,{triggerNode:(0,T.tZ)("span",null,(0,b.t)("Query preview")),modalTitle:(0,b.t)("Query preview"),modalBody:(0,T.tZ)(Me.Z,{sql:(null==i?void 0:i.sql)||(null==i?void 0:i.select_star)||""}),modalFooter:(0,T.tZ)(Oe,{changeDatasource:this.toggleSaveDatasetModal,datasource:i}),draggable:!1,resizable:!1,responsive:!0})),g&&(0,T.tZ)(ve.v.Item,{key:Pe},(0,b.t)("View in SQL Lab")),(0,T.tZ)(ve.v.Item,{key:Ue},(0,b.t)("Save as dataset"))),{health_check_message:C}=i;let Z;if(null!=i&&i.extra)if(ue()(i.extra))try{Z=JSON.parse(i.extra)}catch{}else Z=i.extra;const E=d?(0,b.t)("Missing dataset"):(e=>"query"===(null==e?void 0:e.type)?null==e?void 0:e.sql:(null==e?void 0:e.name)||"")(i),S=E;return(0,T.tZ)(ke,{className:"DatasourceControl"},(0,T.tZ)("div",{className:"data-container"},Ve[null==i?void 0:i.type],((e,t)=>(null==e?void 0:e.length)>25?(0,T.tZ)(fe.u,{title:t},(0,T.tZ)("span",{className:"title-select"},e)):(0,T.tZ)("span",{title:t,className:"title-select"},e))(E,S),C&&(0,T.tZ)(fe.u,{title:C},(0,T.tZ)(z.Z.AlertSolid,{iconColor:c.colors.warning.base})),(null==(n=Z)?void 0:n.warning_markdown)&&(0,T.tZ)(Ce.Z,{warningMarkdown:Z.warning_markdown}),(0,T.tZ)(v.Gj,{overlay:i.type===pe.i9.Query?_:y,trigger:["click"]},(0,T.tZ)(z.Z.MoreVert,{className:"datasource-modal-trigger"}))),d&&u&&(0,T.tZ)("div",{className:"error-alert"},(0,T.tZ)(_e.Z,{level:"warning",title:(0,b.t)("Missing URL parameters"),source:"explore",subtitle:(0,T.tZ)(l.Fragment,null,(0,T.tZ)("p",null,(0,b.t)("The URL is missing the dataset_id or slice_id parameters.")))})),d&&!u&&(0,T.tZ)("div",{className:"error-alert"},(0,T.tZ)(_e.Z,{level:"warning",title:(0,b.t)("Missing dataset"),source:"explore",subtitle:(0,T.tZ)(l.Fragment,null,(0,T.tZ)("p",null,(0,b.t)("The dataset linked to this chart may have been deleted.")),(0,T.tZ)("p",null,(0,T.tZ)(ye.Z,{buttonStyle:"primary",onClick:()=>this.handleMenuItemClick({key:Fe})},(0,b.t)("Swap dataset"))))})),o&&(0,T.tZ)(be.W,{datasource:i,show:o,onDatasourceSave:this.onDatasourceSave,onHide:this.toggleEditDatasourceModal}),a&&(0,T.tZ)(be.Q,{onDatasourceSave:this.onDatasourceSave,onHide:this.toggleChangeDatasourceModal,show:a,onChange:s}),r&&(0,T.tZ)(Le.W,{visible:r,onHide:this.toggleSaveDatasetModal,buttonTextOnSave:(0,b.t)("Save"),buttonTextOnOverwrite:(0,b.t)("Overwrite"),modalDescription:(0,b.t)("Save this query as a virtual dataset to continue exploring"),datasource:(0,Ee.z)(i),openWindow:!1,formData:this.props.form_data}))}}qe.propTypes=Ie,qe.defaultProps={onChange:()=>{},onDatasourceSave:null,value:null,isEditable:!0};const je=(0,y.b)(qe);var He=n(1090),ze=n(37921),Be=n(43700),Ge=n(79684),We=n(55786),Ke=n(34087),Ye=n(42753),Qe=n(19113),Je=n(27130);const Xe=s.iK.span`
  display: inline-block;
  padding: 2px 0;
`,et=(0,s.iK)(N.II)`
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}};
  height: 26px;
  padding-left: ${e=>{let{theme:t}=e;return 2.5*t.gridUnit}}px;
`,tt=e=>{let{title:t,isEditDisabled:n,onChange:a}=e;const[o,r]=(0,l.useState)(!1),[i,s]=(0,l.useState)(!1),c=(0,b.t)("My metric"),d=(0,l.useCallback)((()=>r(!0)),[]),u=(0,l.useCallback)((()=>r(!1)),[]),p=(0,l.useCallback)((()=>s(!0)),[]),h=(0,l.useCallback)((()=>s(!1)),[]),m=(0,l.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),h())}),[h]),g=(0,l.useCallback)((e=>{""===e.target.value&&a(e),h()}),[a,h]);return n?(0,T.tZ)("span",null,(null==t?void 0:t.label)||c):i?(0,T.tZ)(et,{type:"text",placeholder:null==t?void 0:t.label,value:null!=t&&t.hasCustomLabel?t.label:"",autoFocus:!0,onChange:a,onBlur:g,onKeyPress:m}):(0,T.tZ)(fe.u,{placement:"top",title:(0,b.t)("Click to edit label")},(0,T.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable",onMouseOver:d,onMouseOut:u,onClick:p,onBlur:h,role:"button",tabIndex:0},(0,T.tZ)(Xe,null,(null==t?void 0:t.label)||c),"",(0,T.tZ)("i",{className:"fa fa-pencil",style:{color:o?"black":"grey"}})))};var nt=n(63325),at=n(37731),ot=n(71262),rt=n(94301),it=n(49238),lt=n(94670),st=n(33313),ct=n(54076),dt=n(69856),ut=n(99963);const pt={onChange:g().func.isRequired,onClose:g().func.isRequired,onResize:g().func.isRequired,getCurrentTab:g().func,getCurrentLabel:g().func,adhocMetric:g().instanceOf(Qe.Z).isRequired,columns:g().arrayOf(Ke.Z),savedMetricsOptions:g().arrayOf(Je.Z),savedMetric:Je.Z,datasource:g().object,isNewMetric:g().bool,isLabelModified:g().bool},ht={columns:[],getCurrentTab:ct.EI,isNewMetric:!1},mt=(0,s.iK)(v.Ph)`
  .metric-option {
    & > svg {
      min-width: ${e=>{let{theme:t}=e;return 4*t.gridUnit+"px"}};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,gt="SAVED";class vt extends l.PureComponent{constructor(e){super(e),this.defaultActiveTabKey=this.getDefaultTab(),this.onSave=this.onSave.bind(this),this.onResetStateAndClose=this.onResetStateAndClose.bind(this),this.onColumnChange=this.onColumnChange.bind(this),this.onAggregateChange=this.onAggregateChange.bind(this),this.onSavedMetricChange=this.onSavedMetricChange.bind(this),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTabChange=this.onTabChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.refreshAceEditor=this.refreshAceEditor.bind(this),this.getDefaultTab=this.getDefaultTab.bind(this),this.state={adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric,width:dt.kc,height:dt.H7},document.addEventListener("mouseup",this.onMouseUp)}componentDidMount(){this.props.getCurrentTab(this.defaultActiveTabKey)}componentDidUpdate(e,t){var n,a,o,r,i,l,s,c,d,u,p,h,m;(null==(n=t.adhocMetric)?void 0:n.sqlExpression)===(null==(a=this.state.adhocMetric)?void 0:a.sqlExpression)&&(null==(o=t.adhocMetric)?void 0:o.aggregate)===(null==(r=this.state.adhocMetric)?void 0:r.aggregate)&&(null==(i=t.adhocMetric)||null==(l=i.column)?void 0:l.column_name)===(null==(s=this.state.adhocMetric)||null==(c=s.column)?void 0:c.column_name)&&(null==(d=t.savedMetric)?void 0:d.metric_name)===(null==(u=this.state.savedMetric)?void 0:u.metric_name)||this.props.getCurrentLabel({savedMetricLabel:(null==(p=this.state.savedMetric)?void 0:p.verbose_name)||(null==(h=this.state.savedMetric)?void 0:h.metric_name),adhocMetricLabel:null==(m=this.state.adhocMetric)?void 0:m.getDefaultLabel()})}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}getDefaultTab(){const{adhocMetric:e,savedMetric:t,savedMetricsOptions:n,isNewMetric:a}=this.props;return(0,at.Z)(e.column)||(0,at.Z)(e.sqlExpression)?e.expressionType:(a||t.metric_name)&&Array.isArray(n)&&n.length>0?gt:e.expressionType}onSave(){var e;const{adhocMetric:t,savedMetric:n}=this.state,a=null!=n&&n.metric_name?n:t,o=null!=(e=this.props.savedMetric)&&e.metric_name?this.props.savedMetric:this.props.adhocMetric;this.props.onChange({...a},o),this.props.onClose()}onResetStateAndClose(){this.setState({adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric},this.props.onClose)}onColumnChange(e){const t=this.props.columns.find((t=>t.column_name===e));this.setState((e=>({adhocMetric:e.adhocMetric.duplicateWith({column:t,expressionType:Qe.v.SIMPLE}),savedMetric:void 0})))}onAggregateChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({aggregate:e,expressionType:Qe.v.SIMPLE}),savedMetric:void 0})))}onSavedMetricChange(e){const t=this.props.savedMetricsOptions.find((t=>t.metric_name===e));this.setState((e=>({savedMetric:t,adhocMetric:e.adhocMetric.duplicateWith({column:void 0,aggregate:void 0,sqlExpression:void 0,expressionType:Qe.v.SIMPLE})})))}onSqlExpressionChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({sqlExpression:e,expressionType:Qe.v.SQL}),savedMetric:void 0})))}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),dt.kc),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),dt.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.refreshAceEditor(),this.props.getCurrentTab(e)}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}refreshAceEditor(){setTimeout((()=>{this.aceEditorRef&&this.aceEditorRef.editor.resize()}),0)}renderColumnOption(e){const t={...e};return t.metric_name&&!t.verbose_name&&(t.verbose_name=t.metric_name),(0,T.tZ)(ut.l,{column:t,showType:!0})}renderMetricOption(e){return(0,T.tZ)(ut.B,{metric:e,showType:!0})}render(){var e;const{adhocMetric:t,savedMetric:n,columns:a,savedMetricsOptions:r,onChange:i,onClose:s,onResize:c,datasource:d,isNewMetric:u,isLabelModified:p,...h}=this.props,{adhocMetric:m,savedMetric:g}=this.state,f=st.Z.concat(a.map((e=>({name:e.column_name,value:e.column_name,score:50,meta:"column"})))),y=m.column&&m.column.column_name||m.inferSqlExpressionColumn(),_={ariaLabel:(0,b.t)("Select column"),placeholder:(0,b.t)("%s column(s)",a.length),value:y,onChange:this.onColumnChange,allowClear:!0,autoFocus:!y},C={ariaLabel:(0,b.t)("Select aggregate options"),placeholder:(0,b.t)("%s aggregates(s)",dt.Ps.length),value:m.aggregate||m.inferSqlExpressionAggregate(),onChange:this.onAggregateChange,allowClear:!0,autoFocus:!!y},Z={ariaLabel:(0,b.t)("Select saved metrics"),placeholder:(0,b.t)("%s saved metric(s)",null!=(e=null==r?void 0:r.length)?e:0),value:null==g?void 0:g.metric_name,onChange:this.onSavedMetricChange,allowClear:!0,autoFocus:!0},E=m.isValid()||(null==g?void 0:g.metric_name),S=p||u||!m.equals(t)||!(void 0===(null==g?void 0:g.metric_name)&&void 0===(null==n?void 0:n.metric_name))&&(null==g?void 0:g.metric_name)!==(null==n?void 0:n.metric_name);let x={};if(null!=d&&d.extra)try{x=JSON.parse(d.extra)}catch{}return(0,T.tZ)(it.l0,o()({layout:"vertical",id:"metrics-edit-popover"},h),(0,T.tZ)(ot.ZP,{id:"adhoc-metric-edit-tabs",defaultActiveKey:this.defaultActiveTabKey,className:"adhoc-metric-edit-tabs",style:{height:this.state.height,width:this.state.width},onChange:this.onTabChange,allowOverflow:!0},(0,T.tZ)(ot.ZP.TabPane,{key:gt,tab:(0,b.t)("Saved")},(0,We.Z)(r).length>0?(0,T.tZ)(it.xJ,{label:(0,b.t)("Saved metric")},(0,T.tZ)(mt,o()({options:(0,We.Z)(r).map((e=>({value:e.metric_name,label:e.metric_name,customLabel:this.renderMetricOption(e),key:e.id})))},Z))):d.type===pe.i9.Table?(0,T.tZ)(rt.Tc,{image:"empty.svg",title:(0,b.t)("No saved metrics found"),description:(0,b.t)('Add metrics to dataset in "Edit datasource" modal')}):(0,T.tZ)(rt.Tc,{image:"empty.svg",title:(0,b.t)("No saved metrics found"),description:(0,T.tZ)(l.Fragment,null,(0,T.tZ)("span",{tabIndex:0,role:"button",onClick:()=>{this.props.handleDatasetModal(!0),this.props.onClose()}},(0,b.t)("Create a dataset")),(0,b.t)(" to add metrics"))})),(0,T.tZ)(ot.ZP.TabPane,{key:Qe.v.SIMPLE,tab:x.disallow_adhoc_metrics?(0,T.tZ)(fe.u,{title:(0,b.t)("Simple ad-hoc metrics are not enabled for this dataset")},(0,b.t)("Simple")):(0,b.t)("Simple"),disabled:x.disallow_adhoc_metrics},(0,T.tZ)(it.xJ,{label:(0,b.t)("column")},(0,T.tZ)(v.Ph,o()({options:a.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,key:e.id,customLabel:this.renderColumnOption(e)})))},_))),(0,T.tZ)(it.xJ,{label:(0,b.t)("aggregate")},(0,T.tZ)(v.Ph,o()({options:dt.Ps.map((e=>({value:e,label:e,key:e})))},C)))),(0,T.tZ)(ot.ZP.TabPane,{key:Qe.v.SQL,tab:x.disallow_adhoc_metrics?(0,T.tZ)(fe.u,{title:(0,b.t)("Custom SQL ad-hoc metrics are not enabled for this dataset")},(0,b.t)("Custom SQL")):(0,b.t)("Custom SQL"),disabled:x.disallow_adhoc_metrics},(0,T.tZ)(lt.iO,{showLoadingForImport:!0,ref:this.handleAceEditorRef,keywords:f,height:this.state.height-80+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:m.sqlExpression||m.translateToSql({transformCountDistinct:!0}),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0}))),(0,T.tZ)("div",null,(0,T.tZ)(ye.Z,{buttonSize:"small",onClick:this.onResetStateAndClose,cta:!0},(0,b.t)("Close")),(0,T.tZ)(ye.Z,{disabled:!E||!S,buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0},(0,b.t)("Save")),(0,T.tZ)("i",{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}vt.propTypes=pt,vt.defaultProps=ht;class ft extends l.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.onLabelChange=this.onLabelChange.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.getCurrentTab=this.getCurrentTab.bind(this),this.getCurrentLabel=this.getCurrentLabel.bind(this),this.onChange=this.onChange.bind(this),this.handleDatasetModal=this.handleDatasetModal.bind(this),this.state={adhocMetric:e.adhocMetric,popoverVisible:!1,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1,isTitleEditDisabled:!1,showSaveDatasetModal:!1}}static getDerivedStateFromProps(e,t){return t.adhocMetric.optionName!==e.adhocMetric.optionName?{adhocMetric:e.adhocMetric,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1}:{adhocMetric:e.adhocMetric}}onLabelChange(e){var t;const{verbose_name:n,metric_name:a}=this.props.savedMetric,o=null==(t=this.props.adhocMetric)?void 0:t.getDefaultLabel(),r=e.target.value;this.setState((e=>({title:{label:r||e.currentLabel||n||a||o,hasCustomLabel:!!r},labelModified:!0})))}onPopoverResize(){this.forceUpdate()}handleDatasetModal(e){this.setState({showSaveDatasetModal:e})}closePopover(){this.togglePopover(!1),this.setState({labelModified:!1})}togglePopover(e){this.setState({popoverVisible:e})}getCurrentTab(e){this.setState({isTitleEditDisabled:e===gt})}getCurrentLabel(e){let{savedMetricLabel:t,adhocMetricLabel:n}=e;const a=t||n;this.setState({currentLabel:a,labelModified:!0}),!t&&this.state.title.hasCustomLabel||this.setState({title:{label:a,hasCustomLabel:!1}})}onChange(e,t){this.props.onMetricEdit({...e,...this.state.title},t)}render(){const{adhocMetric:e,savedMetric:t,columns:n,savedMetricsOptions:a,datasource:o,isControlledComponent:r}=this.props,{verbose_name:i,metric_name:s}=t,{hasCustomLabel:c,label:d}=e,u=c?d:e.getDefaultLabel(),p=this.state.labelModified?this.state.title:{label:i||s||u,hasCustomLabel:c},{visible:h,togglePopover:m,closePopover:g}=r?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},v=(0,T.tZ)(nt.b,null,(0,T.tZ)(vt,{adhocMetric:e,columns:n,savedMetricsOptions:a,savedMetric:t,datasource:o,handleDatasetModal:this.handleDatasetModal,onResize:this.onPopoverResize,onClose:g,onChange:this.onChange,getCurrentTab:this.getCurrentTab,getCurrentLabel:this.getCurrentLabel,isNewMetric:this.props.isNew,isLabelModified:this.state.labelModified&&u!==this.state.title.label})),f=(0,T.tZ)(tt,{title:p,onChange:this.onLabelChange,isEditDisabled:this.state.isTitleEditDisabled});return(0,T.tZ)(l.Fragment,null,this.state.showSaveDatasetModal&&(0,T.tZ)(Le.W,{visible:this.state.showSaveDatasetModal,onHide:()=>this.handleDatasetModal(!1),buttonTextOnSave:(0,b.t)("Save"),buttonTextOnOverwrite:(0,b.t)("Overwrite"),modalDescription:(0,b.t)("Save this query as a virtual dataset to continue exploring"),datasource:o}),(0,T.tZ)(x.Z,{placement:"right",trigger:"click",content:v,defaultVisible:h,visible:h,onVisibleChange:m,title:f,destroyTooltipOnHide:!0},this.props.children))}}const bt=ft,yt={adhocMetric:g().instanceOf(Qe.Z),onMetricEdit:g().func.isRequired,onRemoveMetric:g().func,columns:g().arrayOf(Ke.Z),savedMetricsOptions:g().arrayOf(Je.Z),savedMetric:Je.Z,datasource:g().object,onMoveLabel:g().func,onDropLabel:g().func,index:g().number,type:g().string,multi:g().bool,datasourceWarningMessage:g().string};class _t extends l.PureComponent{constructor(e){super(e),this.onRemoveMetric=this.onRemoveMetric.bind(this)}onRemoveMetric(e){e.stopPropagation(),this.props.onRemoveMetric(this.props.index)}render(){const{adhocMetric:e,onMetricEdit:t,columns:n,savedMetricsOptions:a,savedMetric:o,datasource:r,onMoveLabel:i,onDropLabel:l,index:s,type:c,multi:d,datasourceWarningMessage:u}=this.props;return(0,T.tZ)(bt,{adhocMetric:e,onMetricEdit:t,columns:n,savedMetricsOptions:a,savedMetric:o,datasource:r},(0,T.tZ)(B.yz,{savedMetric:o,adhocMetric:e,label:e.label,onRemove:this.onRemoveMetric,onMoveLabel:i,onDropLabel:l,index:s,type:null!=c?c:Ye.g.AdhocMetricOption,withCaret:!0,isFunction:!0,multi:d,datasourceWarningMessage:u}))}}const Ct=_t;_t.propTypes=yt;const Zt={option:g().oneOfType([g().object,g().string]).isRequired,index:g().number.isRequired,onMetricEdit:g().func,onRemoveMetric:g().func,onMoveLabel:g().func,onDropLabel:g().func,columns:g().arrayOf(Ke.Z),savedMetrics:g().arrayOf(Je.Z),savedMetricsOptions:g().arrayOf(Je.Z),multi:g().bool,datasource:g().object,datasourceWarningMessage:g().string};function Et(e){let t,{option:n,onMetricEdit:a,onRemoveMetric:o,columns:r,savedMetrics:i,savedMetricsOptions:l,datasource:s,onMoveLabel:c,onDropLabel:d,index:u,type:p,multi:h,datasourceWarningMessage:m}=e;var g;if("string"==typeof n?(g=n,t=i.find((e=>e.metric_name===g))):n.metric_name&&(t=n),n instanceof Qe.Z||t){var v;const e={onMetricEdit:a,onRemoveMetric:o,columns:r,savedMetricsOptions:l,datasource:s,adhocMetric:n instanceof Qe.Z?n:new Qe.Z({}),onMoveLabel:c,onDropLabel:d,index:u,savedMetric:null!=(v=t)?v:{},type:p,multi:h,datasourceWarningMessage:m};return(0,T.tZ)(Ct,e)}return null}Et.propTypes=Zt;var Tt=n(17536);const St={name:g().string.isRequired,onChange:g().func,value:g().oneOfType([g().arrayOf(g().oneOfType([g().string,Tt.Z])),g().oneOfType([g().string,Tt.Z])]),columns:g().arrayOf(Ke.Z),savedMetrics:g().arrayOf(Je.Z),isLoading:g().bool,multi:g().bool,clearable:g().bool,datasource:g().object};function xt(e,t,n){var a;return null!=(a=null==e?void 0:e.filter((e=>Array.isArray(t)?!h()(t).call(t,e.metric_name)||e.metric_name===n:e)))?a:[]}function wt(e){return e&&!(e instanceof Qe.Z)&&e.expressionType}function At(e){return e?Array.isArray(e)?e.map((e=>wt(e)?new Qe.Z(e):e)):wt(e)?[new Qe.Z(e)]:[e]:[]}const Rt={metric_name:"",expression:""},Dt=e=>{let{onChange:t,multi:n,value:a,columns:o,savedMetrics:r,datasource:d,...u}=e;const[p,h]=(0,l.useState)(At(a)),m=(0,s.Fg)(),g=(0,c.D)(o),v=(0,c.D)(r),f=(0,l.useCallback)((e=>{if(null===e)return void t(null);const a=(0,We.Z)(e).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));t(n?a:a[0])}),[n,t]),y=(0,l.useCallback)((e=>{const t=[...p,e];h(t),f(t)}),[f,p]),_=(0,l.useCallback)(((e,t)=>{const n=p.map((n=>n!==t.metric_name&&void 0===n.optionName||n.optionName!==t.optionName?n:e));h(n),f(n)}),[f,p]),C=(0,l.useCallback)((e=>{if(!Array.isArray(p))return;const t=[...p];t.splice(e,1),h(t),f(t)}),[f,p]),Z=(0,l.useCallback)(((e,t)=>{const n=[...p];[n[t],n[e]]=[n[e],n[t]],h(n)}),[p]),E=(0,l.useCallback)((()=>!n&&p.length>0),[n,p.length]),S=(0,l.useMemo)((()=>xt(r,a,null)),[a,r]),x=(0,l.useMemo)((()=>new Qe.Z({})),[p]),w=(0,l.useCallback)((e=>E()?e:(0,T.tZ)(bt,{adhocMetric:x,onMetricEdit:y,columns:o,savedMetricsOptions:S,savedMetric:Rt,datasource:d,isNew:!0},e)),[o,d,E,x,y,S]);(0,l.useEffect)((()=>{if(a&&(!i()(g,o)||!i()(v,r))){const e=((e,t,n)=>(0,We.Z)(e).filter((e=>"string"==typeof e||e.metric_name?null==n?void 0:n.some((t=>t.metric_name===e||t.metric_name===e.metric_name)):null==t?void 0:t.some((t=>!e.column||e.column.column_name===t.column_name)))))(a,o,r);i()(e,a)||f(e)}}),[o,f,r]),(0,l.useEffect)((()=>{h(At(a))}),[a]);const A=(0,l.useCallback)((()=>f(p)),[f,p]),R=(0,l.useCallback)(((e,t)=>(0,T.tZ)(Et,{key:t,index:t,option:e,onMetricEdit:_,onRemoveMetric:C,columns:o,datasource:d,savedMetrics:r,savedMetricsOptions:xt(r,p,null==p?void 0:p[t]),onMoveLabel:Z,onDropLabel:A,multi:n})),[o,d,Z,n,A,_,C,r,p]);return(0,T.tZ)("div",{className:"metrics-select"},(0,T.tZ)(B.gM,null,(0,T.tZ)(I.Z,u),w((0,T.tZ)(B.IG,{disabled:E()},(0,T.tZ)(z.Z.PlusLarge,{iconSize:"s",iconColor:m.colors.grayscale.light5})))),(0,T.tZ)(B.yj,null,p.length>0?p.map(((e,t)=>R(e,t))):w((0,T.tZ)(B.SW,null,(0,T.tZ)(z.Z.PlusSmall,{iconColor:m.colors.grayscale.light1}),(0,b.t)("Add metric")))))};Dt.propTypes=St,Dt.defaultProps={onChange:()=>{},clearable:!0,savedMetrics:[],columns:[]};const Ot=Dt;var Mt=n(83734);const Lt="fix",Nt="metric",It={onChange:g().func,value:g().object,isFloat:g().bool,datasource:g().object.isRequired,default:g().shape({type:g().oneOf(["fix","metric"]),value:g().oneOfType([g().string,g().number])})},kt={onChange:()=>{},default:{type:Lt,value:5}};class Ft extends l.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this),this.setType=this.setType.bind(this),this.setFixedValue=this.setFixedValue.bind(this),this.setMetric=this.setMetric.bind(this);const t=(e.value?e.value.type:e.default.type)||Lt,n=(e.value?e.value.value:e.default.value)||"100";this.state={type:t,fixedValue:t===Lt?n:"",metricValue:t===Nt?n:null}}onChange(){this.props.onChange({type:this.state.type,value:this.state.type===Lt?this.state.fixedValue:this.state.metricValue})}setType(e){this.setState({type:e},this.onChange)}setFixedValue(e){this.setState({fixedValue:e},this.onChange)}setMetric(e){this.setState({metricValue:e},this.onChange)}render(){const e=(this.props.value||this.props.default).type||Lt,t=this.props.datasource?this.props.datasource.columns:null,n=this.props.datasource?this.props.datasource.metrics:null;return(0,T.tZ)("div",null,(0,T.tZ)(I.Z,this.props),(0,T.tZ)(Be.Z,{ghost:!0,css:e=>(0,T.iv)("&.ant-collapse>.ant-collapse-item.ant-collapse-no-arrow>.ant-collapse-header{border:0px;padding:0px 0px ",2*e.gridUnit,"px 0px;display:inline-block;}&.ant-collapse-ghost>.ant-collapse-item>.ant-collapse-content>.ant-collapse-content-box{padding:0px;& .well{margin-bottom:0px;padding:",2*e.gridUnit,"px;}}","")},(0,T.tZ)(Be.Z.Panel,{showArrow:!1,header:(0,T.tZ)(ze.Z,{onClick:()=>{}},this.state.type===Lt&&(0,T.tZ)("span",null,this.state.fixedValue),this.state.type===Nt&&(0,T.tZ)("span",null,(0,T.tZ)("span",null,(0,b.t)("metric"),": "),(0,T.tZ)("strong",null,this.state.metricValue?this.state.metricValue.label:null)))},(0,T.tZ)("div",{className:"well"},(0,T.tZ)(Mt.Z,{title:(0,b.t)("Fixed"),isSelected:e===Lt,onSelect:()=>{this.setType(Lt)}},(0,T.tZ)(Ge.Z,{isFloat:!0,onChange:this.setFixedValue,onFocus:()=>{this.setType(Lt)},value:this.state.fixedValue})),(0,T.tZ)(Mt.Z,{title:(0,b.t)("Based on a metric"),isSelected:e===Nt,onSelect:()=>{this.setType(Nt)}},(0,T.tZ)(Ot,{name:"metric",columns:t,savedMetrics:n,multi:!1,onFocus:()=>{this.setType(Nt)},onChange:this.setMetric,value:this.state.metricValue,datasource:this.props.datasource}))))))}}Ft.propTypes=It,Ft.defaultProps=kt;var Pt=n(14114),$t=n(98286);function Ut(e){return void 0!==e.value}const Vt=(0,Pt.ZP)((e=>{let{addDangerToast:t,allowClear:n=!0,ariaLabel:a,dataEndpoint:o,multi:r=!0,mutator:i,onChange:s,placeholder:c,value:d,...u}=e;const[p,h]=(0,l.useState)([]);return(0,l.useEffect)((()=>{he.Z.get({endpoint:o}).then((e=>{const t=i?i(e.json):e.json.result;h(t)})).catch((e=>(0,$t.O$)(e).then((e=>{const{error:n}=e;t((0,b.t)("Error while fetching data: %s",n))}))))}),[t,o,i]),(0,T.tZ)(v.Ph,{allowClear:n,ariaLabel:a||(0,b.t)("Select ..."),value:(()=>{const e=d||(void 0!==u.default?u.default:void 0);if(null!==e||p.find((e=>null===e.value)))return e})(),header:(0,T.tZ)(I.Z,u),mode:r?"multiple":"single",onChange:e=>{let t=e;Array.isArray(e)&&(t=e.map((e=>Ut(e)?e.value:e))),Ut(e)&&(t=e.value),s(t)},options:p,placeholder:c})}));var qt=n(82199),jt=n(36155),Ht={name:"mlsake",styles:"margin-left:0;margin-right:0"};function zt(e){return(0,T.tZ)(jt.Z,o()({},e,{css:Ht}))}var Bt=n(665),Gt=n(42878);const Wt={label:g().string,tooltip:g().string,colType:g().string,width:g().string,height:g().string,timeLag:g().oneOfType([g().string,g().number]),timeRatio:g().string,comparisonType:g().string,showYAxis:g().bool,yAxisBounds:g().array,bounds:g().array,d3format:g().string,dateFormat:g().string,onChange:g().func},Kt={label:(0,b.t)("Time series columns"),tooltip:"",colType:"",width:"",height:"",timeLag:"",timeRatio:"",comparisonType:"",showYAxis:!1,yAxisBounds:[null,null],bounds:[null,null],d3format:"",dateFormat:""},Yt=[{value:"value",label:(0,b.t)("Actual value"),key:"value"},{value:"diff",label:(0,b.t)("Difference"),key:"diff"},{value:"perc",label:(0,b.t)("Percentage"),key:"perc"},{value:"perc_change",label:(0,b.t)("Percentage change"),key:"perc_change"}],Qt=[{value:"time",label:(0,b.t)("Time comparison"),key:"time"},{value:"contrib",label:(0,b.t)("Contribution"),key:"contrib"},{value:"spark",label:(0,b.t)("Sparkline"),key:"spark"},{value:"avg",label:(0,b.t)("Period average"),key:"avg"}],Jt=(0,s.iK)(v.X2)`
  margin-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  display: flex;
  align-items: center;
`,Xt=(0,s.iK)(v.JX)`
  display: flex;
  align-items: center;
`,en=(0,s.iK)(_.V)`
  margin-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
`,tn=s.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 5*t.gridUnit}}px;
  display: flex;
  justify-content: center;
`;class nn extends l.Component{constructor(e){super(e),this.onSave=this.onSave.bind(this),this.onClose=this.onClose.bind(this),this.resetState=this.resetState.bind(this),this.initialState=this.initialState.bind(this),this.onPopoverVisibleChange=this.onPopoverVisibleChange.bind(this),this.state=this.initialState()}initialState(){return{label:this.props.label,tooltip:this.props.tooltip,colType:this.props.colType,width:this.props.width,height:this.props.height,timeLag:this.props.timeLag||0,timeRatio:this.props.timeRatio,comparisonType:this.props.comparisonType,showYAxis:this.props.showYAxis,yAxisBounds:this.props.yAxisBounds,bounds:this.props.bounds,d3format:this.props.d3format,dateFormat:this.props.dateFormat,popoverVisible:!1}}resetState(){const e=this.initialState();this.setState({...e})}onSave(){this.props.onChange(this.state),this.setState({popoverVisible:!1})}onClose(){this.resetState()}onSelectChange(e,t){this.setState({[e]:t})}onTextInputChange(e,t){this.setState({[e]:t.target.value})}onCheckboxChange(e,t){this.setState({[e]:t})}onBoundsChange(e){this.setState({bounds:e})}onPopoverVisibleChange(e){e?this.setState({popoverVisible:e}):this.resetState()}onYAxisBoundsChange(e){this.setState({yAxisBounds:e})}textSummary(){return`${this.props.label}`}formRow(e,t,n,a){return(0,T.tZ)(Jt,null,(0,T.tZ)(Xt,{xs:24,md:11},e,(0,T.tZ)(en,{placement:"top",tooltip:t,label:n})),(0,T.tZ)(v.JX,{xs:24,md:13},a))}renderPopover(){return(0,T.tZ)("div",{id:"ts-col-popo",style:{width:320}},this.formRow((0,b.t)("Label"),(0,b.t)("The column header label"),"time-lag",(0,T.tZ)(N.II,{value:this.state.label,onChange:this.onTextInputChange.bind(this,"label"),placeholder:(0,b.t)("Label")})),this.formRow((0,b.t)("Tooltip"),(0,b.t)("Column header tooltip"),"col-tooltip",(0,T.tZ)(N.II,{value:this.state.tooltip,onChange:this.onTextInputChange.bind(this,"tooltip"),placeholder:(0,b.t)("Tooltip")})),this.formRow((0,b.t)("Type"),(0,b.t)("Type of comparison, value difference or percentage"),"col-type",(0,T.tZ)(v.Ph,{ariaLabel:(0,b.t)("Type"),value:this.state.colType||void 0,onChange:this.onSelectChange.bind(this,"colType"),options:Qt})),(0,T.tZ)("hr",null),"spark"===this.state.colType&&this.formRow((0,b.t)("Width"),(0,b.t)("Width of the sparkline"),"spark-width",(0,T.tZ)(N.II,{value:this.state.width,onChange:this.onTextInputChange.bind(this,"width"),placeholder:(0,b.t)("Width")})),"spark"===this.state.colType&&this.formRow((0,b.t)("Height"),(0,b.t)("Height of the sparkline"),"spark-width",(0,T.tZ)(N.II,{value:this.state.height,onChange:this.onTextInputChange.bind(this,"height"),placeholder:(0,b.t)("Height")})),["time","avg"].indexOf(this.state.colType)>=0&&this.formRow((0,b.t)("Time lag"),(0,b.t)("Number of periods to compare against"),"time-lag",(0,T.tZ)(N.II,{value:this.state.timeLag,onChange:this.onTextInputChange.bind(this,"timeLag"),placeholder:(0,b.t)("Time Lag")})),["spark"].indexOf(this.state.colType)>=0&&this.formRow((0,b.t)("Time ratio"),(0,b.t)("Number of periods to ratio against"),"time-ratio",(0,T.tZ)(N.II,{value:this.state.timeRatio,onChange:this.onTextInputChange.bind(this,"timeRatio"),placeholder:(0,b.t)("Time Ratio")})),"time"===this.state.colType&&this.formRow((0,b.t)("Type"),(0,b.t)("Type of comparison, value difference or percentage"),"comp-type",(0,T.tZ)(v.Ph,{ariaLabel:(0,b.t)("Type"),value:this.state.comparisonType||void 0,onChange:this.onSelectChange.bind(this,"comparisonType"),options:Yt})),"spark"===this.state.colType&&this.formRow((0,b.t)("Show Y-axis"),(0,b.t)("Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise."),"show-y-axis-bounds",(0,T.tZ)(V.Z,{value:this.state.showYAxis,onChange:this.onCheckboxChange.bind(this,"showYAxis")})),"spark"===this.state.colType&&this.formRow((0,b.t)("Y-axis bounds"),(0,b.t)("Manually set min/max values for the y-axis."),"y-axis-bounds",(0,T.tZ)(U,{value:this.state.yAxisBounds,onChange:this.onYAxisBoundsChange.bind(this)})),"spark"!==this.state.colType&&this.formRow((0,b.t)("Color bounds"),(0,b.t)("Number bounds used for color encoding from red to blue.\n               Reverse the numbers for blue to red. To get pure red or blue,\n               you can enter either only min or max."),"bounds",(0,T.tZ)(U,{value:this.state.bounds,onChange:this.onBoundsChange.bind(this)})),this.formRow((0,b.t)("Number format"),(0,b.t)("Optional d3 number format string"),"d3-format",(0,T.tZ)(N.II,{value:this.state.d3format,onChange:this.onTextInputChange.bind(this,"d3format"),placeholder:(0,b.t)("Number format string")})),"spark"===this.state.colType&&this.formRow((0,b.t)("Date format"),(0,b.t)("Optional d3 date format string"),"date-format",(0,T.tZ)(N.II,{value:this.state.dateFormat,onChange:this.onTextInputChange.bind(this,"dateFormat"),placeholder:(0,b.t)("Date format string")})),(0,T.tZ)(tn,null,(0,T.tZ)(ye.Z,{buttonSize:"small",onClick:this.onClose,cta:!0},(0,b.t)("Close")),(0,T.tZ)(ye.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0},(0,b.t)("Save"))))}render(){return(0,T.tZ)("span",null,this.textSummary()," ",(0,T.tZ)(x.Z,{trigger:"click",content:this.renderPopover(),title:(0,b.t)("Column Configuration"),visible:this.state.popoverVisible,onVisibleChange:this.onPopoverVisibleChange},(0,T.tZ)(_.V,{icon:"edit",className:"text-primary",label:"edit-ts-column"})))}}nn.propTypes=Wt,nn.defaultProps=Kt;var an=n(79512);const on=["longitude","latitude","zoom","bearing","pitch"],rn={onChange:g().func,value:g().shape({longitude:g().number,latitude:g().number,zoom:g().number,bearing:g().number,pitch:g().number}),default:g().object,name:g().string.isRequired};class ln extends l.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e,t){this.props.onChange({...this.props.value,[e]:t})}renderTextControl(e){return(0,T.tZ)("div",{key:e},(0,T.tZ)(it.lX,null,e),(0,T.tZ)(Ge.Z,{value:this.props.value[e],onChange:this.onChange.bind(this,e),isFloat:!0}))}renderPopover(){return(0,T.tZ)("div",{id:`filter-popover-${this.props.name}`},on.map((e=>this.renderTextControl(e))))}renderLabel(){return this.props.value.longitude&&this.props.value.latitude?`${(0,an.decimal2sexagesimal)(this.props.value.longitude)} | ${(0,an.decimal2sexagesimal)(this.props.value.latitude)}`:"N/A"}render(){return(0,T.tZ)("div",null,(0,T.tZ)(I.Z,this.props),(0,T.tZ)(ae.ZP,{container:document.body,trigger:"click",placement:"right",content:this.renderPopover(),title:(0,b.t)("Viewport")},(0,T.tZ)(ze.Z,{className:"pointer"},this.renderLabel())))}}ln.propTypes=rn,ln.defaultProps={onChange:()=>{},default:{type:"fix",value:5},value:{longitude:6.85236157047845,latitude:31.222656842808707,zoom:1,bearing:0,pitch:0}};var sn=n(11064),cn=n(14278),dn=n(74069),un=n(20292),pn=n(13284);const hn=[{name:"echarts_timeseries_line",icon:(0,T.tZ)(z.Z.LineChartTile,null)},{name:"echarts_timeseries_bar",icon:(0,T.tZ)(z.Z.BarChartTile,null)},{name:"echarts_area",icon:(0,T.tZ)(z.Z.AreaChartTile,null)},{name:"table",icon:(0,T.tZ)(z.Z.TableChartTile,null)},{name:"big_number_total",icon:(0,T.tZ)(z.Z.BigNumberChartTile,null)},{name:"pie",icon:(0,T.tZ)(z.Z.PieChartTile,null)}],mn={iconSize:"l",css:e=>T.iv`
    padding: ${e.gridUnit}px;
    & > * {
      line-height: 0;
    }
  `},gn=e=>{var t;let{isActive:n,isRendered:a,vizMeta:r,onTileClick:i}=e;const{mountedPluginMetadata:c}=(0,cn.gp)(),d=(0,l.useRef)(null),u=(0,s.Fg)(),p=2*u.transitionTiming,[h,m]=(0,l.useState)(!1),[g,v]=(0,l.useState)(!1),[f,y]=(0,l.useState)(!1),_=r.name?(null==(t=c[r.name])?void 0:t.name)||`${r.name}`:(0,b.t)("Select Viz Type"),C=(0,l.useCallback)((()=>{i(r.name),v(!0),m(!1),setTimeout((()=>{v(!1)}),1e3*p)}),[i,p,r.name]);(0,l.useEffect)((()=>{y(Boolean(!g&&(!n||d.current&&d.current.scrollWidth>d.current.clientWidth)))}),[n,g]);const Z=(0,l.useMemo)((()=>n?{}:{role:"button",tabIndex:0,onClick:C}),[C,n]);let E=null;return f&&(E=a?(0,b.t)("Currently rendered: %s",_):_),(0,T.tZ)(fe.u,{title:E,onVisibleChange:e=>m(e),visible:h&&!g,placement:"top",mouseEnterDelay:.4},(0,T.tZ)("div",o()({},Z,{css:T.iv`
          display: flex;
          align-items: center;
          text-transform: uppercase;

          color: ${u.colors.grayscale.base};
          font-weight: ${u.typography.weights.bold};
          border-radius: 6px;
          white-space: nowrap;
          overflow: hidden;
          max-width: fit-content;

          ${!n&&T.iv`
            flex-shrink: 0;
            width: ${6*u.gridUnit}px;
            background-color: transparent;
            transition: none;
            &:hover svg path {
              fill: ${u.colors.primary.base};
              transition: fill ${u.transitionTiming}s ease-out;
            }
          `}

          ${n&&T.iv`
            width: 100%;
            background-color: ${u.colors.grayscale.light4};
            transition: width ${p}s ease-out,
              background-color ${p}s ease-out;
            cursor: default;
            svg path {
              fill: ${u.colors.primary.base};
            }
          `}
        `}),r.icon," ",(0,T.tZ)("span",{css:T.iv`
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            padding-right: ${u.gridUnit}px;
          `,ref:d},_)))},vn=l.memo((e=>{let{currentSelection:t,onChange:n}=e;const a=(0,f.v9)((e=>{var t,n,a;return null==(t=e.charts)||null==(n=t[(0,Z.Jp)(e.explore)])||null==(a=n.latestQueryFormData)?void 0:a.viz_type})),r=(0,l.useMemo)((()=>{const e=[...hn];return t&&hn.every((e=>e.name!==t))&&t!==a&&e.unshift({name:t,icon:(0,T.tZ)(z.Z.MonitorOutlined,o()({},mn,{"aria-label":"monitor"}))}),a&&hn.every((e=>e.name!==a))&&e.unshift({name:a,icon:(0,T.tZ)(z.Z.CheckSquareOutlined,o()({},mn,{"aria-label":"check-square"}))}),e}),[t,a]);return(0,T.tZ)("div",{css:e=>T.iv`
          display: flex;
          justify-content: space-between;
          column-gap: ${e.gridUnit}px;
        `},r.map((e=>(0,T.tZ)(gn,{vizMeta:e,isActive:t===e.name,isRendered:a===e.name,onTileClick:n,key:e.name}))))})),fn=(0,un.Z)().common.conf.VIZ_TYPE_DENYLIST||[],bn=(0,sn.Z)();function yn(e){let{vizType:t}=e;return(0,cn.gp)().loading||bn.has(t)?null:(0,T.tZ)("div",{className:"text-danger",css:e=>T.iv`
          margin-top: ${e.gridUnit}px;
        `},(0,T.tZ)("i",{className:"fa fa-exclamation-circle text-danger"})," ",(0,T.tZ)("small",null,(0,b.t)("This visualization type is not supported.")))}const _n=(0,s.iK)(dn.Z)`
  .ant-modal-body {
    padding: 0;
  }
`;var Cn=n(61890);const Zn={marginTop:"5px",minHeight:"30px"},En={textAlign:"right"},Tn={label:g().string.isRequired,tooltip:g().string,control:g().node.isRequired,isCheckbox:g().bool};function Sn(e){let{label:t,tooltip:n,control:a,isCheckbox:o}=e;const r=(0,T.tZ)("span",null,t," ",n&&(0,T.tZ)(_.V,{placement:"top",label:t,tooltip:n}));return o?(0,T.tZ)(v.X2,{style:Zn,gutter:16},(0,T.tZ)(v.JX,{xs:24,md:8,style:En},a),(0,T.tZ)(v.JX,{xs:24,md:16},r)):(0,T.tZ)(v.X2,{style:Zn,gutter:16},(0,T.tZ)(v.JX,{xs:24,md:8,style:En},r),(0,T.tZ)(v.JX,{xs:24,md:16},a))}Sn.propTypes=Tn,Sn.defaultProps={tooltip:null,isCheckbox:!1};const xn=new Set(["TINYINT","SMALLINT","INT","INTEGER","BIGINT","LONG"]),wn=new Set(["FLOAT","DOUBLE","REAL","NUMERIC","DECIMAL","MONEY"]),An={datasource:g().object.isRequired,onChange:g().func,asc:g().bool,clearable:g().bool,multiple:g().bool,column:g().string,label:g().string,metric:g().string,searchAllOptions:g().bool,defaultValue:g().string},Rn={width:350};class Dn extends l.Component{constructor(e){super(e);const{column:t,metric:n,asc:a,clearable:o,multiple:r,searchAllOptions:i,label:l,defaultValue:s}=e;this.state={column:t,metric:n,label:l,asc:a,clearable:o,multiple:r,searchAllOptions:i,defaultValue:s},this.onChange=this.onChange.bind(this),this.onControlChange=this.onControlChange.bind(this)}onChange(){this.props.onChange(this.state)}onControlChange(e,t){let n=t;const{column:a,multiple:o}=this.state;if(t&&!o&&e===dt.ft.DEFAULT_VALUE){const{datasource:e}=this.props,o=e.columns.find((e=>e.column_name===a));if(o&&o.type){const e=o.type.toUpperCase();"BOOLEAN"===e?n="true"===t:xn.has(e)?n=Number.isNaN(Number(t))?null:parseInt(t,10):wn.has(e)&&(n=Number.isNaN(Number(t))?null:parseFloat(t))}}this.setState({[e]:n},this.onChange)}setType(){}textSummary(){return this.state.column||"N/A"}renderForm(){return(0,T.tZ)("div",null,(0,T.tZ)(Sn,{label:(0,b.t)("Column"),control:(0,T.tZ)(v.Ph,{ariaLabel:(0,b.t)("Column"),value:this.state.column,name:"column",options:this.props.datasource.columns.filter((e=>e.column_name!==this.state.column)).map((e=>({value:e.column_name,label:e.column_name}))).concat([{value:this.state.column,label:this.state.column}]),onChange:e=>this.onControlChange("column",e)})}),(0,T.tZ)(Sn,{label:(0,b.t)("Label"),control:(0,T.tZ)(Ge.Z,{value:this.state.label,name:"label",onChange:e=>this.onControlChange("label",e)})}),(0,T.tZ)(Sn,{label:(0,b.t)("Default"),tooltip:(0,b.t)("(optional) default value for the filter, when using the multiple option, you can use a semicolon-delimited list of options."),control:(0,T.tZ)(Ge.Z,{value:this.state.defaultValue,name:"defaultValue",onChange:e=>this.onControlChange(dt.ft.DEFAULT_VALUE,e)})}),(0,T.tZ)(Sn,{label:(0,b.t)("Sort metric"),tooltip:(0,b.t)("Metric to sort the results by"),control:(0,T.tZ)(v.Ph,{ariaLabel:(0,b.t)("Sort metric"),value:this.state.metric,name:"column",options:this.props.datasource.metrics.filter((e=>e.metric_name!==this.state.metric)).map((e=>({value:e.metric_name,label:e.metric_name}))).concat([{value:this.state.metric,label:this.state.metric}]),onChange:e=>this.onControlChange("metric",e)})}),(0,T.tZ)(Sn,{label:(0,b.t)("Sort ascending"),tooltip:(0,b.t)("Check for sorting ascending"),isCheckbox:!0,control:(0,T.tZ)(V.Z,{value:this.state.asc,onChange:e=>this.onControlChange("asc",e)})}),(0,T.tZ)(Sn,{label:(0,b.t)("Allow multiple selections"),isCheckbox:!0,tooltip:(0,b.t)("Multiple selections allowed, otherwise filter is limited to a single value"),control:(0,T.tZ)(V.Z,{value:this.state.multiple,onChange:e=>this.onControlChange(dt.ft.MULTIPLE,e)})}),(0,T.tZ)(Sn,{label:(0,b.t)("Search all filter options"),tooltip:(0,b.t)("By default, each filter loads at most 1000 choices at the initial page load. Check this box if you have more than 1000 filter values and want to enable dynamically searching that loads filter values as users type (may add stress to your database)."),isCheckbox:!0,control:(0,T.tZ)(V.Z,{value:this.state.searchAllOptions,onChange:e=>this.onControlChange(dt.ft.SEARCH_ALL_OPTIONS,e)})}),(0,T.tZ)(Sn,{label:(0,b.t)("Required"),tooltip:(0,b.t)("User must select a value for this filter"),isCheckbox:!0,control:(0,T.tZ)(V.Z,{value:!this.state.clearable,onChange:e=>this.onControlChange("clearable",!e)})}))}renderPopover(){return(0,T.tZ)("div",{id:"ts-col-popo",style:Rn},this.renderForm())}render(){return(0,T.tZ)("span",null,this.textSummary()," ",(0,T.tZ)(x.Z,{trigger:"click",content:this.renderPopover(),title:(0,b.t)("Filter configuration")},(0,T.tZ)(_.V,{icon:"edit",className:"text-primary",label:"edit-ts-column"})))}}Dn.propTypes=An,Dn.defaultProps={onChange:()=>{},asc:!0,clearable:!0,multiple:!0,searchAllOptions:!1};var On,Mn=n(65013),Ln=n(81315);!function(e){e.NONE="None",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_OR_EQUAL="",e.LESS_OR_EQUAL="",e.EQUAL="=",e.NOT_EQUAL="",e.BETWEEN="< x <",e.BETWEEN_OR_EQUAL=" x ",e.BETWEEN_OR_LEFT_EQUAL=" x <",e.BETWEEN_OR_RIGHT_EQUAL="< x "}(On||(On={}));const Nn=[On.BETWEEN,On.BETWEEN_OR_EQUAL,On.BETWEEN_OR_LEFT_EQUAL,On.BETWEEN_OR_RIGHT_EQUAL],In=(0,s.iK)(N.Rn)`
  width: 100%;
`,kn=s.iK.div`
  display: flex;
  justify-content: flex-end;
`,Fn=[{value:On.NONE,label:(0,b.t)("None")},{value:On.GREATER_THAN,label:">"},{value:On.LESS_THAN,label:"<"},{value:On.GREATER_OR_EQUAL,label:""},{value:On.LESS_OR_EQUAL,label:""},{value:On.EQUAL,label:"="},{value:On.NOT_EQUAL,label:""},{value:On.BETWEEN,label:"< x <"},{value:On.BETWEEN_OR_EQUAL,label:" x "},{value:On.BETWEEN_OR_LEFT_EQUAL,label:" x <"},{value:On.BETWEEN_OR_RIGHT_EQUAL,label:"< x "}],Pn=(e,t)=>n=>(a,o)=>n&&o&&!e(Number(n),Number(o))?Promise.reject(new Error(t)):Promise.resolve(),$n=Pn(((e,t)=>e>t),(0,b.t)("This value should be smaller than the right target value")),Un=Pn(((e,t)=>e<t),(0,b.t)("This value should be greater than the left target value")),Vn=e=>e&&h()(Nn).call(Nn,e),qn=e=>!e||e===On.NONE,jn=[{required:!0,message:(0,b.t)("Required")}],Hn=[{required:!0,message:(0,b.t)("Required")},e=>{let{getFieldValue:t}=e;return{validator:$n(t("targetValueRight"))}}],zn=[{required:!0,message:(0,b.t)("Required")},e=>{let{getFieldValue:t}=e;return{validator:Un(t("targetValueLeft"))}}],Bn=["targetValueRight"],Gn=["targetValueLeft"],Wn=(e,t)=>qn(e.operator)!==qn(t.operator)||Vn(e.operator)!==Vn(t.operator),Kn=(0,T.tZ)(it.xJ,{name:"operator",label:(0,b.t)("Operator"),rules:jn,initialValue:Fn[0].value},(0,T.tZ)(Ln.Z,{ariaLabel:(0,b.t)("Operator"),options:Fn})),Yn=e=>{let{getFieldValue:t}=e;return qn(t("operator"))?(0,T.tZ)(v.X2,{gutter:12},(0,T.tZ)(v.JX,{span:6},Kn)):Vn(t("operator"))?(0,T.tZ)(v.X2,{gutter:12},(0,T.tZ)(v.JX,{span:9},(0,T.tZ)(it.xJ,{name:"targetValueLeft",label:(0,b.t)("Left value"),rules:Hn,dependencies:Bn,validateTrigger:"onBlur",trigger:"onBlur"},(0,T.tZ)(In,null))),(0,T.tZ)(v.JX,{span:6},Kn),(0,T.tZ)(v.JX,{span:9},(0,T.tZ)(it.xJ,{name:"targetValueRight",label:(0,b.t)("Right value"),rules:zn,dependencies:Gn,validateTrigger:"onBlur",trigger:"onBlur"},(0,T.tZ)(In,null)))):(0,T.tZ)(v.X2,{gutter:12},(0,T.tZ)(v.JX,{span:6},Kn),(0,T.tZ)(v.JX,{span:18},(0,T.tZ)(it.xJ,{name:"targetValue",label:(0,b.t)("Target value"),rules:jn},(0,T.tZ)(In,null))))},Qn=e=>{var t;let{config:n,onChange:a,columns:o=[]}=e;const r=[{value:(i=(0,s.Fg)()).colors.success.light1,label:(0,b.t)("green")},{value:i.colors.alert.light1,label:(0,b.t)("yellow")},{value:i.colors.error.light1,label:(0,b.t)("red")}];var i;return(0,T.tZ)(it.l0,{onFinish:a,initialValues:n,requiredMark:"optional",layout:"vertical"},(0,T.tZ)(v.X2,{gutter:12},(0,T.tZ)(v.JX,{span:12},(0,T.tZ)(it.xJ,{name:"column",label:(0,b.t)("Column"),rules:jn,initialValue:null==(t=o[0])?void 0:t.value},(0,T.tZ)(Ln.Z,{ariaLabel:(0,b.t)("Select column"),options:o}))),(0,T.tZ)(v.JX,{span:12},(0,T.tZ)(it.xJ,{name:"colorScheme",label:(0,b.t)("Color scheme"),rules:jn,initialValue:r[0].value},(0,T.tZ)(Ln.Z,{ariaLabel:(0,b.t)("Color scheme"),options:r})))),(0,T.tZ)(it.xJ,{noStyle:!0,shouldUpdate:Wn},Yn),(0,T.tZ)(it.xJ,null,(0,T.tZ)(kn,null,(0,T.tZ)(ye.Z,{htmlType:"submit",buttonStyle:"primary"},(0,b.t)("Apply")))))},Jn=e=>{let{title:t,columns:n,onChange:a,config:r,children:i,...s}=e;const[c,d]=(0,l.useState)(!1),u=(0,l.useCallback)((e=>{d(!1),a(e)}),[a]);return(0,T.tZ)(ae.ZP,o()({title:t,content:(0,T.tZ)(Qn,{onChange:u,config:r,columns:n}),visible:c,onVisibleChange:d,trigger:["click"],overlayStyle:{width:"450px"}},s),i)},Xn=s.iK.div`
  ${e=>{let{theme:t}=e;return T.iv`
    padding: ${t.gridUnit}px;
    border: solid 1px ${t.colors.grayscale.light2};
    border-radius: ${t.gridUnit}px;
  `}}
`,ea=(0,s.iK)(B.EQ)`
  &,
  & > div {
    margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    :last-child {
      margin-bottom: 0;
    }
  }
`,ta=s.iK.button`
  ${e=>{let{theme:t}=e;return T.iv`
    color: ${t.colors.grayscale.light1};
    height: 100%;
    width: ${6*t.gridUnit}px;
    border: none;
    border-right: solid 1px ${t.colors.grayscale.dark2}0C;
    padding: 0;
    outline: none;
    border-bottom-left-radius: 3px;
    border-top-left-radius: 3px;
  `}}
`;var na=n(22068);function aa(e){let{displayGhostButton:t=!0,accept:n,valuesRenderer:a,...o}=e;const r=(0,s.Fg)(),[{isOver:i,canDrop:c},d]=(0,na.L)({accept:n,drop:e=>{o.onDrop(e),null==o.onDropValue||o.onDropValue(e.value)},canDrop:e=>{var t;return o.canDrop(e)&&(null==(t=null==o.canDropValue?void 0:o.canDropValue(e.value))||t)},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop(),type:e.getItemType()})}),u=(0,l.useMemo)((()=>a()),[a]);return(0,T.tZ)("div",{ref:d},(0,T.tZ)(B.gM,null,(0,T.tZ)(I.Z,o)),(0,T.tZ)(B.H$,{canDrop:c,isOver:i},u,t&&(0,T.tZ)(B.SW,{cancelHover:!o.onClickGhostButton,onClick:o.onClickGhostButton},(0,T.tZ)(z.Z.PlusSmall,{iconColor:r.colors.grayscale.light1}),(0,b.t)(o.ghostButtonText||"Drop columns here"))))}var oa=n(41609),ra=n.n(oa),ia=n(93185),la=n(72813),sa=n(38575),ca=n(53769),da=n(27034);const ua=(0,s.iK)(_.V)`
  margin: 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`;function pa(e){let{children:t,index:n,clickClose:a,withCaret:o,isExtra:r,datasourceWarningMessage:i,canDelete:c=!0}=e;const d=(0,s.Fg)(),u=(0,l.useCallback)((e=>{e.stopPropagation(),a(n)}),[a,n]);return(0,T.tZ)(B.EQ,{withCaret:o},c&&(0,T.tZ)(B.gu,{role:"button",onClick:u},(0,T.tZ)(z.Z.XSmall,{iconColor:d.colors.grayscale.light1})),(0,T.tZ)(B.__,null,t),(!!i||r)&&(0,T.tZ)(ua,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:i||(0,b.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),o&&(0,T.tZ)(B.Ne,null,(0,T.tZ)(z.Z.CaretRight,{iconColor:d.colors.grayscale.light1})))}const ha=s.iK.div`
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`;function ma(e){const{index:t,label:n,tooltipTitle:a,column:r,type:i,onShiftOptions:s,clickClose:c,withCaret:d,isExtra:u,datasourceWarningMessage:p,canDelete:h=!0,...m}=e,g=(0,l.useRef)(null),v=(0,l.useRef)(null),[{isDragging:f},b]=(0,da.c)({item:{type:i,dragIndex:t},collect:e=>({isDragging:e.isDragging()})}),[,y]=(0,na.L)({accept:i,hover:(e,n)=>{var a;if(!g.current)return;const{dragIndex:o}=e,r=t;if(o===r)return;const i=null==(a=g.current)?void 0:a.getBoundingClientRect(),l=(i.bottom-i.top)/2,c=n.getClientOffset(),d=c?c.y-i.top:0;o<r&&d<l||o>r&&d>l||(s(o,r),e.dragIndex=r)}}),_=!f&&a&&n&&a!==n||!f&&v&&v.current&&v.current.scrollWidth>v.current.clientWidth,C=()=>_?(0,T.tZ)(fe.u,{title:a||n},(0,T.tZ)("span",null,n)):(0,T.tZ)("span",null,n),Z=()=>{const e=r&&(0,la.GA)(r)?{verbose_name:r.label,expression:r.sqlExpression}:r;return(0,T.tZ)(ut.l,{column:e,labelRef:v,showType:!0})};return b(y(g)),(0,T.tZ)(B.a7,o()({ref:g},m),(0,T.tZ)(pa,{index:t,clickClose:c,withCaret:d,isExtra:u,datasourceWarningMessage:p,canDelete:h},(0,T.tZ)((()=>n?(0,T.tZ)(ha,{ref:v},(0,T.tZ)(C,null)):r?(0,T.tZ)(ha,null,(0,T.tZ)(Z,null)):null),null)))}const ga=e=>(0,sa.xN)(e)?e.column_name:e;class va{constructor(e,t,n){this.values=void 0,this.options=void 0,this.multi=void 0,this.options=e,this.multi=t,this.values=(0,We.Z)(n).map((t=>t&&(0,la.s9)(t)&&t in e?e[t]:(0,la.s9)(t)?null:t)).filter(Boolean)}add(e){(0,la.s9)(e)&&e in this.options?this.values.push(this.options[e]):(0,la.s9)(e)||this.values.push(e)}del(e){this.values.splice(e,1)}replace(e,t){this.values[e]&&(this.values[e]=(0,la.s9)(t)?this.options[t]:t)}swap(e,t){[this.values[e],this.values[t]]=[this.values[t],this.values[e]]}has(e){return this.values.some((t=>(0,la.s9)(e)?t.column_name===e||t.label===e:t.column_name===e.label||t.label===e.label))}getValues(){return this.multi?this.values.map(ga):this.values.length>0?ga(this.values[0]):void 0}}const fa=(0,s.iK)(v.Ph)`
  .metric-option {
    & > svg {
      min-width: ${e=>{let{theme:t}=e;return 4*t.gridUnit+"px"}};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,ba=e=>{let{columns:t,editedColumn:n,onChange:a,onClose:o,setDatasetModal:r,setLabel:i,getCurrentTab:s,label:c,isTemporal:d}=e;const u=(0,f.v9)((e=>e.explore.datasource.type)),[p]=(0,l.useState)(c),[h,m,g]=(e=>e?(0,la.GA)(e)?[e,void 0,void 0]:(0,sa.zy)(e)?[void 0,e,void 0]:[void 0,void 0,e]:[void 0,void 0,void 0])(n),[y,_]=(0,l.useState)(h),[C,Z]=(0,l.useState)(m),[E,S]=(0,l.useState)(g),x=(0,l.useRef)(null),[w,A]=(0,l.useMemo)((()=>null==t?void 0:t.reduce(((e,t)=>(t.expression?e[0].push(t):e[1].push(t),e)),[[],[]])),[t]),R=(0,l.useCallback)((e=>{_({label:c,sqlExpression:e,expressionType:"SQL"}),S(void 0),Z(void 0)}),[c]),D=(0,l.useCallback)((e=>{const t=w.find((t=>t.column_name===e));Z(t),S(void 0),_(void 0),i((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||"")}),[w,i]),O=(0,l.useCallback)((e=>{const t=A.find((t=>t.column_name===e));Z(void 0),S(t),_(void 0),i((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||"")}),[i,A]),M=h?"sqlExpression":g||0===w.length?"simple":"saved";(0,l.useEffect)((()=>{s(M)}),[M,s]);const L=(0,l.useCallback)((()=>{y&&y.label!==c&&(y.label=c);const e=y||C||E;e&&(a(e),o())}),[y,c,a,o,C,E]),N=(0,l.useCallback)((()=>{Z(m),S(g),_(h),o()}),[h,m,g,o]),I=(0,l.useCallback)((e=>{var t;s(e),null==(t=x.current)||t.editor.focus()}),[s]),k=(0,l.useCallback)((()=>{var e;null==(e=x.current)||e.editor.resize()}),[]),F=()=>{r&&r(!0),o()},P=y||C||E,$=p!==c||(null==C?void 0:C.column_name)!==(null==m?void 0:m.column_name)||(null==E?void 0:E.column_name)!==(null==g?void 0:g.column_name)||(null==y?void 0:y.sqlExpression)!==(null==h?void 0:h.sqlExpression),U=(0,b.t)("Saved expressions"),V=(0,b.t)("Column");return(0,T.tZ)(it.l0,{layout:"vertical",id:"metrics-edit-popover"},(0,T.tZ)(ot.ZP,{id:"adhoc-metric-edit-tabs",defaultActiveKey:M,onChange:I,className:"adhoc-metric-edit-tabs",allowOverflow:!0,css:T.iv`
          height: ${dt.H7}px;
          width: ${dt.vK}px;
        `},(0,T.tZ)(ot.ZP.TabPane,{key:"saved",tab:(0,b.t)("Saved")},w.length>0?(0,T.tZ)(it.xJ,{label:U},(0,T.tZ)(fa,{ariaLabel:U,value:null==C?void 0:C.column_name,onChange:D,allowClear:!0,autoFocus:!C,placeholder:(0,b.t)("%s column(s)",w.length),options:w.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,T.tZ)(ut.l,{column:e,showType:!0}),key:e.column_name})))})):u===pe.i9.Table?(0,T.tZ)(rt.Tc,{image:"empty.svg",title:d?(0,b.t)("No temporal columns found"):(0,b.t)("No saved expressions found"),description:d?(0,b.t)('Add calculated temporal columns to dataset in "Edit datasource" modal'):(0,b.t)('Add calculated columns to dataset in "Edit datasource" modal')}):(0,T.tZ)(rt.Tc,{image:"empty.svg",title:d?(0,b.t)("No temporal columns found"):(0,b.t)("No saved expressions found"),description:d?(0,T.tZ)(l.Fragment,null,(0,T.tZ)("span",{role:"button",tabIndex:0,onClick:F},(0,b.t)("Create a dataset"))," ",(0,b.t)(" to mark a column as a time column")):(0,T.tZ)(l.Fragment,null,(0,T.tZ)("span",{role:"button",tabIndex:0,onClick:F},(0,b.t)("Create a dataset"))," ",(0,b.t)(" to add calculated columns"))})),(0,T.tZ)(ot.ZP.TabPane,{key:"simple",tab:(0,b.t)("Simple")},d&&0===A.length?(0,T.tZ)(rt.Tc,{image:"empty.svg",title:(0,b.t)("No temporal columns found"),description:u===pe.i9.Table?(0,b.t)('Mark a column as temporal in "Edit datasource" modal'):(0,T.tZ)(l.Fragment,null,(0,T.tZ)("span",{role:"button",tabIndex:0,onClick:F},(0,b.t)("Create a dataset"))," ",(0,b.t)(" to mark a column as a time column"))}):(0,T.tZ)(it.xJ,{label:V},(0,T.tZ)(v.Ph,{ariaLabel:V,value:null==E?void 0:E.column_name,onChange:O,allowClear:!0,autoFocus:!E,placeholder:(0,b.t)("%s column(s)",A.length),options:A.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,T.tZ)(ut.l,{column:e,showType:!0}),key:e.column_name})))}))),(0,T.tZ)(ot.ZP.TabPane,{key:"sqlExpression",tab:(0,b.t)("Custom SQL")},(0,T.tZ)(lt.iO,{value:(null==y?void 0:y.sqlExpression)||(null==E?void 0:E.column_name)||(null==C?void 0:C.expression),onFocus:k,showLoadingForImport:!0,onChange:R,width:"100%",height:dt.H7-80+"px",showGutter:!1,editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0,ref:x}))),(0,T.tZ)("div",null,(0,T.tZ)(ye.Z,{buttonSize:"small",onClick:N,cta:!0},(0,b.t)("Close")),(0,T.tZ)(ye.Z,{disabled:!P||!$,buttonStyle:"primary",buttonSize:"small",onClick:L,cta:!0},(0,b.t)("Save"))))},ya=(0,s.iK)(N.II)`
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}};
  height: 26px;
  padding-left: ${e=>{let{theme:t}=e;return 2.5*t.gridUnit}}px;
`,_a=e=>{let{title:t,onChange:n,isEditDisabled:a,hasCustomLabel:o}=e;const[r,i]=(0,l.useState)(!1),[s,c]=(0,l.useState)(!1),d=(0,l.useCallback)((()=>{i(!0)}),[]),u=(0,l.useCallback)((()=>{i(!1)}),[]),p=(0,l.useCallback)((()=>{c(!0)}),[]),h=(0,l.useCallback)((()=>{c(!1)}),[]),m=(0,l.useCallback)((e=>{""===e.target.value&&n(e),h()}),[h,n]),g=(0,b.t)("My column");return a?(0,T.tZ)("span",null,t||g):s?(0,T.tZ)(ya,{type:"text",placeholder:t,value:o?t:"",autoFocus:!0,onChange:n,onBlur:m}):(0,T.tZ)(fe.u,{placement:"top",title:(0,b.t)("Click to edit label")},(0,T.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable",onMouseOver:d,onMouseOut:u,onClick:p,onBlur:h,role:"button",tabIndex:0},t||g,"",(0,T.tZ)("i",{className:"fa fa-pencil",style:{color:r?"black":"grey"}})))},Ca=(0,b.t)("My column"),Za=e=>{let{columns:t,editedColumn:n,onColumnEdit:a,isControlledComponent:o,children:r,isTemporal:i,...s}=e;const c=(0,f.v9)((e=>e.explore.datasource)),[d,u]=(0,l.useState)(Ca),[p,h]=(0,l.useState)(!1),[m,g]=(0,l.useState)(!0),[v,y]=(0,l.useState)(!1),[_,C]=(0,l.useState)(!1);let Z=Ca;n&&(0,sa.xN)(n)?Z=n.verbose_name||n.column_name:n&&(0,la.GA)(n)&&(Z=n.label||Ca),(0,l.useEffect)((()=>{u(Z)}),[Z,p]);const E=(0,l.useCallback)((e=>{h(e)}),[]),S=(0,l.useCallback)((()=>{h(!1)}),[]),{visible:w,handleTogglePopover:A,handleClosePopover:R}=o?{visible:s.visible,handleTogglePopover:s.togglePopover,handleClosePopover:s.closePopover}:{visible:p,handleTogglePopover:E,handleClosePopover:S},D=(0,l.useCallback)((e=>{g("sqlExpression"!==e)}),[]),O=(0,l.useMemo)((()=>(0,T.tZ)(nt.b,null,(0,T.tZ)(ba,{editedColumn:n,columns:t,setDatasetModal:C,onClose:R,onChange:a,label:d,setLabel:u,getCurrentTab:D,isTemporal:i}))),[t,n,D,R,i,a,d]),M=(0,l.useCallback)((e=>{u(e.target.value),y(!0)}),[]),L=(0,l.useMemo)((()=>(0,T.tZ)(_a,{title:d,onChange:M,isEditDisabled:m,hasCustomLabel:v})),[v,m,M,d]);return(0,T.tZ)(l.Fragment,null,_&&(0,T.tZ)(Le.W,{visible:_,onHide:()=>C(!1),buttonTextOnSave:(0,b.t)("Save"),buttonTextOnOverwrite:(0,b.t)("Overwrite"),modalDescription:(0,b.t)("Save this query as a virtual dataset to continue exploring"),datasource:c}),(0,T.tZ)(x.Z,{trigger:"click",content:O,defaultVisible:w,visible:w,onVisibleChange:A,title:L,destroyTooltipOnHide:!0},r))},Ea=(0,ca.pO)((function(e){const{value:t,options:n,multi:a=!0,onChange:r,canDelete:i=!0,ghostButtonText:s,clickEnabledGhostButtonText:c,name:d,label:u,isTemporal:p}=e,[h,m]=(0,l.useState)(!1),g=(0,l.useMemo)((()=>{const e=Object.fromEntries(n.map((e=>[e.column_name,e])));return new va(e,a,t)}),[a,n,t]),v=(0,l.useCallback)((e=>{const t=e.value;g.multi||ra()(g.values)?g.add(t.column_name):g.replace(0,t.column_name),r(g.getValues())}),[r,g]),f=(0,l.useCallback)((e=>{const t=e.value.column_name;return t in g.options&&!g.has(t)}),[g]),y=(0,l.useCallback)((e=>{g.del(e),r(g.getValues())}),[r,g]),_=(0,l.useCallback)(((e,t)=>{g.swap(e,t),r(g.getValues())}),[r,g]),C=(0,l.useMemo)((()=>(0,ia.c)(ia.T.ENABLE_DND_WITH_CLICK_UX)),[]),Z=(0,l.useCallback)((()=>g.values.map(((e,t)=>{const a=(0,la.GA)(e)&&e.datasourceWarning?(0,b.t)("This column might be incompatible with current dataset"):void 0;return C?(0,T.tZ)(Za,{key:t,columns:n,onColumnEdit:e=>{(0,sa.xN)(e)?g.replace(t,e.column_name):g.replace(t,e),r(g.getValues())},editedColumn:e,isTemporal:p},(0,T.tZ)(ma,{key:t,index:t,clickClose:y,onShiftOptions:_,type:`${Ye.g.ColumnOption}_${d}_${u}`,canDelete:i,column:e,datasourceWarningMessage:a,withCaret:!0})):(0,T.tZ)(ma,{key:t,index:t,clickClose:y,onShiftOptions:_,type:`${Ye.g.ColumnOption}_${d}_${u}`,canDelete:i,column:e,datasourceWarningMessage:a})}))),[i,C,p,u,d,r,y,_,g,n]),E=(0,l.useCallback)((e=>{(0,sa.xN)(e)?g.add(e.column_name):g.add(e),r(g.getValues())}),[r,g]),S=(0,l.useCallback)((e=>{m(e)}),[]),x=(0,l.useCallback)((()=>{S(!1)}),[S]),w=(0,l.useCallback)((()=>{S(!0)}),[S]),A=(0,l.useMemo)((()=>{var e;return C?null!=(e=null!=c?c:s)?e:(0,b.tn)("Drop a column here or click","Drop columns here or click",a?2:1):null!=s?s:(0,b.tn)("Drop column here","Drop columns here",a?2:1)}),[C,c,s,a]);return(0,T.tZ)("div",null,(0,T.tZ)(aa,o()({onDrop:v,canDrop:f,valuesRenderer:Z,accept:Ye.g.Column,displayGhostButton:a||0===g.values.length,ghostButtonText:A,onClickGhostButton:C?w:void 0},e)),(0,T.tZ)(Za,{columns:n,onColumnEdit:E,isControlledComponent:!0,togglePopover:S,closePopover:x,visible:h,isTemporal:p},(0,T.tZ)("div",null)))}),qt.Z);var Ta=n(68492),Sa=n(11146),xa=n(96055),wa=n(28543),Aa=n(7848);function Ra(e){let{adhocFilter:t,options:n,datasource:a,onFilterEdit:o,onShiftOptions:r,onClickClose:i,partitionColumn:l,index:s}=e;const{actualTimeRange:c,title:d}=(0,Aa.w)(t);return(0,T.tZ)(xa.Z,{key:s,adhocFilter:t,options:n,datasource:a,onFilterEdit:o,partitionColumn:l},(0,T.tZ)(ma,{key:s,index:s,label:null!=c?c:t.getDefaultLabel(),tooltipTitle:null!=d?d:t.getTooltipTitle(),clickClose:i,onShiftOptions:r,type:Ye.g.FilterOption,withCaret:!0,isExtra:t.isExtra,datasourceWarningMessage:t.datasourceWarning?(0,b.t)("This filter might be incompatible with current dataset"):void 0}))}var Da=n(61314);const{warning:Oa}=dn.Z,Ma=[Ye.g.Column,Ye.g.Metric,Ye.g.MetricOption,Ye.g.AdhocMetricOption],La=e=>!(e instanceof wa.ZP)&&(null==e?void 0:e.expressionType),Na=(0,ca.pO)((e=>{var t;const{datasource:n,onChange:a=(()=>{}),name:r,canDelete:i}=e,s=Array.from(null!=(t=e.value)?t:[]),[c,d]=(0,l.useState)(s.map((e=>La(e)?new wa.ZP(e):e))),[u,p]=(0,l.useState)(void 0),[h,m]=(0,l.useState)(!1),[g,v]=(0,l.useState)({}),f=(e,t)=>[...e,...[...(null==t?void 0:t.metrics)||[],null==t?void 0:t.metric].map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new Qe.Z(e))))].filter((e=>e)).reduce(((e,t)=>("saved_metric_name"in t&&t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):"column_name"in t&&t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof Qe.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>{var n,a;return null!=(n=null==(a=e.saved_metric_name||e.column_name||e.label)?void 0:a.localeCompare(t.saved_metric_name||t.column_name||t.label||""))?n:0})),[y,_]=(0,l.useState)(f(e.columns,e.formData));(0,l.useEffect)((()=>{if(n&&"table"===n.type){var e;const t=null==(e=n.database)?void 0:e.id,{datasource_name:a,schema:o,is_sqllab_view:r}=n;!r&&t&&a&&o&&he.Z.get({endpoint:`/api/v1/database/${t}/table_extra/${a}/${o}/`}).then((e=>{let{json:t}=e;if(null!=t&&t.partitions){const{partitions:e}=t;null!=e&&e.cols&&1===Object.keys(e.cols).length&&p(e.cols[0])}})).catch((e=>{Ta.Z.error("fetch extra_table_metadata:",e.statusText)}))}}),[n]),(0,l.useEffect)((()=>{_(f(e.columns,e.formData))}),[e.columns,e.formData]),(0,l.useEffect)((()=>{d((e.value||[]).map((e=>La(e)?new wa.ZP(e):e)))}),[e.value]);const C=(0,l.useCallback)((e=>{const t=[...c];t.splice(e,1),d(t),a(t)}),[a,c]),Z=(0,l.useCallback)((e=>{const t=null==i?void 0:i(c[e],c);"string"!=typeof t?C(e):Oa({title:(0,b.t)("Warning"),content:t})}),[i,C,c]),E=(0,l.useCallback)(((e,t)=>{const n=[...c];[n[t],n[e]]=[n[e],n[t]],d(n)}),[c]),S=(0,l.useCallback)((t=>{var n;return null==(n=e.savedMetrics.find((e=>e.metric_name===t)))?void 0:n.expression}),[e.savedMetrics]),x=(0,l.useCallback)((e=>{if(e instanceof wa.ZP)return e;const t=e;return t.saved_metric_name?new wa.ZP({expressionType:wa.vq.SQL,subject:S(t.saved_metric_name),operator:dt.LT[dt.d.GREATER_THAN].operation,operatorId:dt.d.GREATER_THAN,comparator:0,clause:wa.Pr.HAVING}):t.label?new wa.ZP({expressionType:wa.vq.SQL,subject:new Qe.Z(e).translateToSql(),operator:dt.LT[dt.d.GREATER_THAN].operation,operatorId:dt.d.GREATER_THAN,comparator:0,clause:wa.Pr.HAVING}):t.column_name?new wa.ZP({expressionType:wa.vq.SIMPLE,subject:t.column_name,operator:dt.LT[dt.d.EQUALS].operation,operatorId:dt.d.EQUALS,comparator:"",clause:wa.Pr.WHERE,isNew:!0}):null}),[n.type,S]),w=(0,l.useCallback)((e=>{a(c.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}),[a,c]),A=(0,l.useCallback)((e=>{const t=x(e);if(t){const e=[...c,t];d(e),a(e)}}),[x,a,c]),R=(0,l.useCallback)((e=>{m(e)}),[]),D=(0,l.useCallback)((()=>{R(!1)}),[R]),O=(0,l.useCallback)((()=>c.map(((e,t)=>(0,T.tZ)(Ra,{index:t,adhocFilter:e,options:y,datasource:n,onFilterEdit:w,partitionColumn:u,onClickClose:Z,onShiftOptions:E})))),[Z,w,E,y,u,n,c]),M=(0,l.useCallback)((()=>{v({}),R(!0)}),[R]),L=(0,Da.Ct)(),N=(0,l.useMemo)((()=>{if(null==(t=g)?void 0:t.metric_name)return new wa.ZP({expressionType:wa.vq.SQL,clause:wa.Pr.HAVING,sqlExpression:null==g?void 0:g.expression});var t;if(g instanceof Qe.Z)return new wa.ZP({expressionType:wa.vq.SQL,clause:wa.Pr.HAVING,sqlExpression:null==g?void 0:g.translateToSql()});const n={subject:null==g?void 0:g.column_name};return n.subject&&(0,ia.c)(ia.T.UX_BETA)&&(n.operator=dt.LT[dt.d.IN].operation,n.operatorId=dt.d.IN),Sa.O6&&(0,sa.xN)(g)&&(0,me.x)(null==g?void 0:g.column_name,e.datasource)&&(n.operator=dt.d.TEMPORAL_RANGE,n.operatorId=dt.d.TEMPORAL_RANGE,n.comparator=L),new wa.ZP(n)}),[g]),I=(0,l.useCallback)((()=>!0),[]),k=(0,l.useCallback)((e=>{v(e.value),R(!0)}),[r,R]),F=(0,ia.c)(ia.T.ENABLE_DND_WITH_CLICK_UX)?(0,b.t)("Drop columns/metrics here or click"):(0,b.t)("Drop columns or metrics here");return(0,T.tZ)(l.Fragment,null,(0,T.tZ)(aa,o()({onDrop:k,canDrop:I,valuesRenderer:O,accept:Ma,ghostButtonText:F,onClickGhostButton:(0,ia.c)(ia.T.ENABLE_DND_WITH_CLICK_UX)?M:void 0},e)),(0,T.tZ)(xa.Z,{adhocFilter:N,options:y,datasource:n,onFilterEdit:A,partitionColumn:u,isControlledComponent:!0,visible:h,togglePopover:R,closePopover:D,requireSave:!!g}))}),Cn.Z);var Ia=n(62446),ka=n(88889);const Fa={},Pa=[Ye.g.Column,Ye.g.Metric],$a=(e,t,n)=>e?(0,We.Z)(e).filter((e=>(0,Ia.AG)(e)?t.some((t=>t.metric_name===e)):!(0,Ia.nX)(e)||n.some((t=>t.column_name===e.column.column_name)))).map((e=>{if(!(t=e)||t instanceof Qe.Z||"string"==typeof t||!t.expressionType)return e;var t;if((0,Ia.nX)(e)){const t=n.find((t=>t.column_name===e.column.column_name));if(t)return new Qe.Z({...e,column:t})}return new Qe.Z(e)})):[],Ua=(e,t,n)=>{var a;return null!=(a=null==e?void 0:e.filter((e=>{var a;return Array.isArray(t)?!h()(t).call(t,null!=(a=e.metric_name)?a:"")||e.metric_name===n:e})))?a:[]},Va=(0,ca.pO)((e=>{const{onChange:t,multi:n}=e,a=(0,l.useCallback)((e=>{if(null===e)return void t(null);const a=(0,We.Z)(e).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));t(n?a:a[0])}),[n,t]),[r,i]=(0,l.useState)($a(e.value,e.savedMetrics,e.columns)),[s,c]=(0,l.useState)({}),[d,u]=(0,l.useState)(!1);(0,l.useEffect)((()=>{i($a(e.value,e.savedMetrics,e.columns))}),[JSON.stringify(e.value),JSON.stringify(e.savedMetrics),JSON.stringify(e.columns)]);const p=(0,l.useCallback)((e=>!("metric"===e.type&&h()(r).call(r,e.value.metric_name))),[r]),m=(0,l.useCallback)((t=>{const n=e.multi?[...r,t]:[t];i(n),a(n)}),[a,e.multi,r]),g=(0,l.useCallback)(((e,t)=>{if(t instanceof Qe.Z&&t.equals(e))return;const n=r.map((n=>("metric_name"in t&&n===t.metric_name||void 0!==n.optionName)&&n.optionName===t.optionName?e:n));i(n),a(n)}),[a,r]),v=(0,l.useCallback)((e=>{if(!Array.isArray(r))return;const t=[...r];t.splice(e,1),i(t),a(t)}),[a,r]),f=(0,l.useCallback)(((e,t)=>{const n=[...r];[n[t],n[e]]=[n[e],n[t]],i(n)}),[r]),y=(0,l.useMemo)((()=>Ua(e.savedMetrics,e.value)),[e.savedMetrics,e.value]),_=(0,l.useCallback)((t=>{var n;return Ua(e.savedMetrics,e.value,null==(n=e.value)?void 0:n[t])}),[e.savedMetrics,e.value]),C=(0,l.useCallback)((()=>t(n?r:r[0])),[n,t,r]),Z=(0,l.useCallback)(((t,a)=>(0,T.tZ)(Et,{key:a,index:a,option:t,onMetricEdit:g,onRemoveMetric:v,columns:e.columns,savedMetrics:e.savedMetrics,savedMetricsOptions:_(a),datasource:e.datasource,onMoveLabel:f,onDropLabel:C,type:`${Ye.g.AdhocMetricOption}_${e.name}_${e.label}`,multi:n,datasourceWarningMessage:t instanceof Qe.Z&&t.datasourceWarning?(0,b.t)("This metric might be incompatible with current dataset"):void 0})),[_,C,f,n,g,v,e.columns,e.datasource,e.label,e.name,e.savedMetrics]),E=(0,l.useCallback)((()=>r.map(((e,t)=>Z(e,t)))),[r,Z]),S=(0,l.useCallback)((e=>{u(e)}),[]),x=(0,l.useCallback)((()=>{S(!1)}),[S]),w=(0,l.useCallback)((e=>{e.type===Ye.g.Metric&&m(e.value),e.type===Ye.g.Column&&(c(e),S(!0))}),[m,S]),A=(0,l.useCallback)((()=>{c({}),S(!0)}),[S]),R=(0,l.useMemo)((()=>{if((null==(e=s)?void 0:e.value)&&(null==e?void 0:e.type)&&s.type===Ye.g.Column){const e=s.value,t={column:e};return(0,ia.c)(ia.T.UX_BETA)&&(e.type_generic===ka.Z.NUMERIC?t.aggregate=dt.YY.SUM:e.type_generic!==ka.Z.STRING&&e.type_generic!==ka.Z.BOOLEAN&&e.type_generic!==ka.Z.TEMPORAL||(t.aggregate=dt.YY.COUNT_DISTINCT)),new Qe.Z(t)}var e;return new Qe.Z({})}),[s]),D=(0,ia.c)(ia.T.ENABLE_DND_WITH_CLICK_UX)?(0,b.tn)("Drop a column/metric here or click","Drop columns/metrics here or click",n?2:1):(0,b.tn)("Drop column or metric here","Drop columns or metrics here",n?2:1);return(0,T.tZ)("div",{className:"metrics-select"},(0,T.tZ)(aa,o()({onDrop:w,canDrop:p,valuesRenderer:E,accept:Pa,ghostButtonText:D,displayGhostButton:n||0===r.length,onClickGhostButton:(0,ia.c)(ia.T.ENABLE_DND_WITH_CLICK_UX)?A:void 0},e)),(0,T.tZ)(bt,{adhocMetric:R,onMetricEdit:m,columns:e.columns,savedMetricsOptions:y,savedMetric:Fa,datasource:e.datasource,isControlledComponent:!0,visible:d,togglePopover:S,closePopover:x,isNew:!0},(0,T.tZ)("div",null)))}),Ot),qa={AnnotationLayerControl:O,BoundsControl:U,CheckboxControl:V.Z,CollectionControl:ee,ColorPickerControl:se,ColorSchemeControl:ce.Z,DatasourceControl:je,DateFilterControl:He.ZP,DndColumnSelectControl:aa,DndColumnSelect:Ea,DndFilterSelect:Na,DndMetricSelect:Va,FixedOrMetricControl:Ft,HiddenControl:function(e){return(0,T.tZ)(N.II,{type:"hidden",value:e.value})},SelectAsyncControl:Vt,SelectControl:qt.Z,SliderControl:function(e){let{default:t,name:n,label:a,description:r,renderTrigger:i,rightNode:s,leftNode:c,validationErrors:d,hovered:u,warning:p,danger:h,onClick:m,tooltipOnClick:g,onChange:v=(()=>{}),...f}=e;const b={name:n,label:a,description:r,renderTrigger:i,rightNode:s,leftNode:c,validationErrors:d,onClick:m,hovered:u,tooltipOnClick:g,warning:p,danger:h};return(0,T.tZ)(l.Fragment,null,(0,T.tZ)(I.Z,b),(0,T.tZ)(zt,o()({},f,{onChange:v,defaultValue:t})))},SpatialControl:Bt.Z,TextAreaControl:Gt.Z,TextControl:Ge.Z,TimeSeriesColumnControl:nn,ViewportControl:ln,VizTypeControl:e=>{let{value:t,onChange:n=ct.EI,isModalOpenInit:a}=e;const[o,r]=(0,l.useState)(!!a),[i,s]=(0,l.useState)(0),[c,d]=(0,l.useState)(t),u=(0,l.useCallback)((()=>{r(!0)}),[]),p=(0,l.useCallback)((()=>{n(c),r(!1)}),[c,n]),h=(0,l.useCallback)((()=>{r(!1),s((e=>e+1)),d(t)}),[t]);return(0,T.tZ)(l.Fragment,null,(0,T.tZ)("div",{css:e=>T.iv`
          min-width: ${72*e.gridUnit}px;
          max-width: fit-content;
        `},(0,T.tZ)(vn,{onChange:n,currentSelection:t}),t&&(0,T.tZ)(yn,{vizType:t})),(0,T.tZ)("div",{css:e=>T.iv`
            display: flex;
            justify-content: flex-end;
            margin-top: ${3*e.gridUnit}px;
            color: ${e.colors.grayscale.base};
            text-decoration: underline;
          `},(0,T.tZ)("span",{role:"button",tabIndex:0,onClick:u},(0,b.t)("View all charts"))),(0,T.tZ)(_n,{show:o,onHide:h,title:(0,b.t)("Select a visualization type"),primaryButtonName:(0,b.t)("Select"),disablePrimaryButton:!c,onHandledPrimaryAction:p,maxWidth:`${pn.UB}px`,responsive:!0},(0,T.tZ)(pn.ZP,{key:i,selectedViz:c,onChange:d,onDoubleClick:p,denyList:fn})))},MetricsControl:Ot,AdhocFilterControl:Cn.Z,FilterBoxItemControl:Dn,ConditionalFormattingControl:e=>{let{value:t,onChange:n,columnOptions:a,verboseMap:o,...r}=e;const i=(0,s.Fg)(),[c,d]=(0,l.useState)(null!=t?t:[]);(0,l.useEffect)((()=>{n&&n(c)}),[c,n]);const u=(0,l.useCallback)((()=>{const e=c.filter((e=>a.some((t=>(null==t?void 0:t.value)===(null==e?void 0:e.column)))));e.length!==c.length&&n&&(d(e),n(e))}),[JSON.stringify(a)]);return(0,Mn.d)(u),(0,T.tZ)("div",null,(0,T.tZ)(I.Z,r),(0,T.tZ)(Xn,null,c.map(((e,t)=>(0,T.tZ)(ea,{key:t},(0,T.tZ)(ta,{onClick:()=>(e=>{d((t=>t.filter(((t,n)=>n!==e))))})(t)},(0,T.tZ)(z.Z.XSmall,{iconColor:i.colors.grayscale.light1})),(0,T.tZ)(Jn,{title:(0,b.t)("Edit formatter"),config:e,columns:a,onChange:e=>((e,t)=>{const n=[...c];n.splice(t,1,e),d(n)})(e,t),destroyTooltipOnHide:!0},(0,T.tZ)(B.EQ,{withCaret:!0},(0,T.tZ)(B.__,null,(e=>{var t;let{column:n,operator:a,targetValue:r,targetValueLeft:i,targetValueRight:l}=e;const s=null!=(t=n&&(null==o?void 0:o[n]))?t:n;switch(a){case On.NONE:return`${s}`;case On.BETWEEN:return`${i} ${On.LESS_THAN} ${s} ${On.LESS_THAN} ${l}`;case On.BETWEEN_OR_EQUAL:return`${i} ${On.LESS_OR_EQUAL} ${s} ${On.LESS_OR_EQUAL} ${l}`;case On.BETWEEN_OR_LEFT_EQUAL:return`${i} ${On.LESS_OR_EQUAL} ${s} ${On.LESS_THAN} ${l}`;case On.BETWEEN_OR_RIGHT_EQUAL:return`${i} ${On.LESS_THAN} ${s} ${On.LESS_OR_EQUAL} ${l}`;default:return`${s} ${a} ${r}`}})(e)),(0,T.tZ)(B.Ne,null,(0,T.tZ)(z.Z.CaretRight,{iconColor:i.colors.grayscale.light1}))))))),(0,T.tZ)(Jn,{title:(0,b.t)("Add new formatter"),columns:a,onChange:e=>{d((t=>[...t,e]))},destroyTooltipOnHide:!0},(0,T.tZ)(B.SW,null,(0,T.tZ)(z.Z.PlusSmall,{iconColor:i.colors.grayscale.light1}),(0,b.t)("Add new color formatter")))))},XAxisSortControl:function(e){const[t,n]=(0,l.useState)(e.value);return(0,l.useEffect)((()=>{e.shouldReset&&(e.onChange(void 0),n(null))}),[e.shouldReset,e.value]),(0,T.tZ)(qt.Z,o()({},e,{value:t}))},...u.Z},ja=qa,Ha=s.iK.div`
  padding-bottom: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`;function za(e){const{actions:{setControlValue:t},name:n,type:a,hidden:r,isVisible:s,resetOnHide:u=!0}=e,[p,h]=(0,l.useState)(!1),m=(0,c.D)(s),g=(0,l.useCallback)(((e,a)=>t(n,e,a)),[n,t]);if((0,l.useEffect)((()=>{!0===m&&!1===s&&void 0!==e.default&&!i()(e.value,e.default)&&u&&(null==t||t(n,e.default))}),[n,m,s,t,e.value,e.default]),!a||!1===s)return null;const v="string"==typeof a?ja[a]:a;return v?(0,T.tZ)(Ha,{className:"Control",style:r?{display:"none"}:void 0,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)},(0,T.tZ)(d.Z,null,(0,T.tZ)(v,o()({onChange:g,hovered:p},e)))):(console.warn(`Unknown controlType: ${a}`),null)}},82342:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(67294),o=n(11965),r=n(51995),i=n(55867),l=n(9882),s=n(58593),c=n(49238),d=n(70163);const u=o.iv`
  &.anticon {
    font-size: unset;
    .anticon {
      line-height: unset;
      vertical-align: unset;
    }
  }
`,p=e=>{let{name:t,label:n,description:p,validationErrors:h=[],renderTrigger:m=!1,rightNode:g,leftNode:v,onClick:f,hovered:b=!1,tooltipOnClick:y=(()=>{}),warning:_,danger:C}=e;const{gridUnit:Z,colors:E}=(0,r.Fg)(),T=(0,a.useRef)(!1),S=(0,a.useMemo)((()=>(h.length||(T.current=!0),T.current?h.length?E.error.base:"unset":E.alert.base)),[E.error.base,E.alert.base,h.length]);return n?(0,o.tZ)("div",{className:"ControlHeader"},(0,o.tZ)("div",{className:"pull-left"},(0,o.tZ)(c.lX,{css:e=>o.iv`
              margin-bottom: ${.5*e.gridUnit}px;
              position: relative;
            `},v&&(0,o.tZ)("span",null,v),(0,o.tZ)("span",{role:"button",tabIndex:0,onClick:f,style:{cursor:f?"pointer":""}},n)," ",_&&(0,o.tZ)("span",null,(0,o.tZ)(s.u,{id:"error-tooltip",placement:"top",title:_},(0,o.tZ)(d.Z.AlertSolid,{iconColor:E.alert.base,iconSize:"s"}))," "),C&&(0,o.tZ)("span",null,(0,o.tZ)(s.u,{id:"error-tooltip",placement:"top",title:C},(0,o.tZ)(d.Z.ErrorSolid,{iconColor:E.error.base,iconSize:"s"}))," "),(null==h?void 0:h.length)>0&&(0,o.tZ)("span",null,(0,o.tZ)(s.u,{id:"error-tooltip",placement:"top",title:null==h?void 0:h.join(" ")},(0,o.tZ)(d.Z.ExclamationCircleOutlined,{css:o.iv`
                    ${u}
                    color: ${S};
                  `}))," "),b?(0,o.tZ)("span",{css:()=>o.iv`
          position: absolute;
          top: 50%;
          right: 0;
          padding-left: ${Z}px;
          transform: translate(100%, -50%);
          white-space: nowrap;
        `},p&&(0,o.tZ)("span",null,(0,o.tZ)(s.u,{id:"description-tooltip",title:p,placement:"top"},(0,o.tZ)(d.Z.InfoCircleOutlined,{css:u,onClick:y}))," "),m&&(0,o.tZ)("span",null,(0,o.tZ)(l.V,{label:(0,i.t)("bolt"),tooltip:(0,i.t)("Changing this control takes effect instantly"),placement:"top",icon:"bolt"})," ")):null)),g&&(0,o.tZ)("div",{className:"pull-right"},g),(0,o.tZ)("div",{className:"clearfix"})):null}},61357:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294),o=n(11965);function r(e){let{controls:t}=e;const n=(0,a.useCallback)((e=>"HiddenControl"===(null==e?void 0:e.props.type)||!1===(null==e?void 0:e.props.isVisible)),[]),r=t.filter((e=>!n(e))),i=r.length?12/r.length:12;return(0,o.tZ)("div",{className:"row"},t.map(((e,t)=>(0,o.tZ)("div",{className:`col-lg-${i} col-xs-12`,style:{display:n(e)?"none":"block"},key:t},e))))}},50909:(e,t,n)=>{n.d(t,{qi:()=>x,m:()=>w,HS:()=>A,uy:()=>R,C4:()=>I,_q:()=>F});var a=n(11965),o=n(78580),r=n.n(o),i=n(67294),l=n(51995),s=n(55867),c=n(51115),d=n(42846),u=n(88889),p=n(23279),h=n.n(p),m=n(4715),g=n(9875),v=n(27600),f=n(87183),b=n(70163),y=n(35932),_=n(76697),C=n(54076),Z=n(13433),E=n(89555),T=n(61587);const S=(0,l.iK)("span")`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
`,x=(0,l.iK)(y.Z)`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;

  // needed to override button's first-of-type margin: 0
  && {
    margin: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }

  i {
    padding: 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,w=e=>{let{data:t,columns:n}=e;const o=(0,l.Fg)();return(0,a.tZ)(Z.Z,{text:t&&n?(0,C.Mv)(t,n):"",wrapped:!1,copyNode:(0,a.tZ)(b.Z.CopyOutlined,{iconColor:o.colors.grayscale.base,iconSize:"l","aria-label":(0,s.t)("Copy"),role:"button",css:a.iv`
            &.anticon > * {
              line-height: 0;
            }
          `})})},A=e=>{let{onChangeHandler:t}=e;const n=(0,l.Fg)(),o=h()(t,v.M$);return(0,a.tZ)(g.II,{prefix:(0,a.tZ)(b.Z.Search,{iconColor:n.colors.grayscale.base}),placeholder:(0,s.t)("Search"),onChange:e=>{const t=e.target.value;o(t)},css:a.iv`
        width: 200px;
        margin-right: ${2*n.gridUnit}px;
      `})},R=e=>{var t;let{data:n,loading:o}=e;return(0,a.tZ)(E.Z,{rowcount:null!=(t=null==n?void 0:n.length)?t:0,loading:o})};var D;!function(e){e.Formatted="formatted",e.Original="original"}(D||(D={}));const O=e=>{let{onChange:t,value:n}=e;return(0,a.tZ)(f.Y.Group,{value:n,onChange:t},(0,a.tZ)(m.T,{direction:"vertical"},(0,a.tZ)(f.Y,{value:D.Formatted},(0,s.t)("Formatted date")),(0,a.tZ)(f.Y,{value:D.Original},(0,s.t)("Original value"))))},M=l.iK.div`
  display: flex;
  flex-direction: column;

  padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit+"px"}};
`,L=l.iK.span`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  text-transform: uppercase;
`,N=e=>{let{columnName:t,onTimeColumnChange:n,datasourceId:o,isOriginalTimeColumn:r}=e;const c=(0,l.Fg)(),d=e=>{n(t,e.target.value)},u=(0,i.useMemo)((()=>o?(0,a.tZ)(M,{onClick:e=>e.stopPropagation()},(0,a.tZ)(a.xB,{styles:a.iv`
              .column-formatting-popover .ant-popover-inner-content {
                padding: 0;
              }
            `}),(0,a.tZ)(L,null,(0,s.t)("Column Formatting")),(0,a.tZ)(O,{onChange:d,value:r?D.Original:D.Formatted})):null),[o,r]);return o?(0,a.tZ)("span",null,(0,a.tZ)(_.ZP,{overlayClassName:"column-formatting-popover",trigger:"click",content:u,placement:"bottomLeft",arrowPointAtCenter:!0},(0,a.tZ)(b.Z.SettingOutlined,{iconSize:"m",iconColor:c.colors.grayscale.light1,css:(0,a.iv)({marginRight:`${c.gridUnit}px`},"",""),onClick:e=>e.stopPropagation()})),t):(0,a.tZ)("span",null,t)},I=(e,t)=>{const n=(0,i.useMemo)((()=>{var e;return null!=(e=null==t?void 0:t.map((e=>Object.values(e).map((e=>e?e.toString().toLowerCase():(0,s.t)("N/A"))))))?e:[]}),[t]);return(0,i.useMemo)((()=>null!=t&&t.length?t.filter(((t,a)=>n[a].some((t=>null==t?void 0:r()(t).call(t,e.toLowerCase()))))):[]),[t,e,n])},k=(0,c.bt)(d.Z.DATABASE_DATETIME),F=(e,t,n,o,l,s)=>{const[c,d]=(0,i.useState)((0,T.W)(o)),p=(e,t)=>{if(o)if(t!==D.Original||r()(c).call(c,e)){if(t===D.Formatted&&r()(c).call(c,e)){const t=(0,T.W)(o);t.splice(t.indexOf(e),1),(0,T.e)(o,t),d(t)}}else{const t=(0,T.W)(o);t.push(e),(0,T.e)(o,t),d(t)}};return(0,i.useEffect)((()=>{l&&d((0,T.W)(o))}),[o,l]),(0,i.useMemo)((()=>e&&null!=n&&n.length?e.filter((e=>{var t;return r()(t=Object.keys(n[0])).call(t,e)})).map(((e,i)=>{const l=null==t?void 0:t[i],d=n[0][e],h=l===u.Z.TEMPORAL?c.indexOf(e):-1,m=r()(c).call(c,e);return{id:e||i,accessor:t=>t[e],Header:l===u.Z.TEMPORAL&&"string"!=typeof d?(0,a.tZ)(N,{columnName:e,datasourceId:o,onTimeColumnChange:p,isOriginalTimeColumn:m}):e,Cell:e=>{let{value:t}=e;return!0===t?v.Ly:!1===t?v.gz:null===t?(0,a.tZ)(S,null,v.Wq):l===u.Z.TEMPORAL&&-1===h&&"number"==typeof t?k(t):String(t)},...null==s?void 0:s[e]}})):[]),[e,n,t,o,s,c])}},61587:(e,t,n)=>{n.d(t,{W:()=>r,e:()=>i});var a=n(55786),o=n(61337);const r=e=>{const t=(0,o.rV)(o.dR.explore__data_table_original_formatted_time_columns,{});return void 0===e?[]:(0,a.Z)(t[e])},i=(e,t)=>{const n=(0,o.rV)(o.dR.explore__data_table_original_formatted_time_columns,{});(0,o.LS)(o.dR.explore__data_table_original_formatted_time_columns,{...n,[e]:t})}},42753:(e,t,n)=>{var a;n.d(t,{g:()=>a}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(a||(a={}))},63325:(e,t,n)=>{n.d(t,{b:()=>a});const a=n(51995).iK.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
    margin-right: ${e=>{let{theme:t}=e;return-2*t.gridUnit}}px;
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}} solid thin;
  }
`},89555:(e,t,n)=>{n.d(t,{Z:()=>s}),n(67294);var a=n(67190),o=n(55867),r=n(37921),i=n(58593),l=n(11965);function s(e){const{rowcount:t=0,limit:n,loading:s}=e,c=t===n,d=c||0===t&&!s?"danger":"default",u=(0,a.JB)()(t),p=(0,l.tZ)(r.Z,{type:d},s?(0,o.t)("Loading..."):(0,l.tZ)("span",null,(0,o.tn)("%s row","%s rows",t,u)));return c?(0,l.tZ)(i.u,{id:"tt-rowcount-tooltip",title:(0,l.tZ)("span",null,(0,o.t)("Limit reached"))},p):p}},76787:(e,t,n)=>{n.d(t,{Z:()=>Z});var a=n(5872),o=n.n(a),r=n(23560),i=n.n(r),l=n(78580),s=n.n(l),c=n(67294),d=n(51995),u=n(55867),p=n(4715),h=n(82342),m=n(58593),g=n(70163),v=n(11965);function f(e){const{id:t,label:n,colors:a}=e,[o,r]=(0,c.useState)(!1),i=(0,c.useRef)(null),l=(0,c.useRef)(null),s=()=>a.map(((e,n)=>(0,v.tZ)("span",{key:`${t}-${n}`,css:t=>v.iv`
          padding-left: ${t.gridUnit/2}px;
          :before {
            content: '';
            display: inline-block;
            background-color: ${e};
            border: 1px solid ${"white"===e?"black":e};
            width: 9px;
            height: 10px;
          }
        `})));return(0,v.tZ)(m.u,{"data-testid":"tooltip",overlayClassName:"color-scheme-tooltip",title:()=>(0,v.tZ)(c.Fragment,null,(0,v.tZ)("span",null,n),(0,v.tZ)("div",null,s())),key:t,visible:o},(0,v.tZ)("span",{className:"color-scheme-option",onMouseEnter:()=>{const e=i.current,t=l.current;e&&t&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight||t.scrollWidth>t.offsetWidth||t.scrollHeight>t.offsetHeight)&&r(!0)},onMouseLeave:()=>{r(!1)},css:v.iv`
          display: flex;
          align-items: center;
          justify-content: flex-start;
        `},(0,v.tZ)("span",{className:"color-scheme-label",ref:i,css:e=>v.iv`
            min-width: 125px;
            padding-right: ${2*e.gridUnit}px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
          `},n),(0,v.tZ)("span",{ref:l,css:e=>v.iv`
            flex: 100%;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            padding-right: ${e.gridUnit}px;
          `},s())))}const b=(0,d.iK)(g.Z.AlertSolid)`
  color: ${e=>{let{theme:t}=e;return t.colors.alert.base}};
`,y=(0,u.t)("This color scheme is being overridden by custom label colors.\n    Check the JSON metadata in the Advanced settings"),_=(0,u.t)("The color scheme is determined by the related dashboard.\n        Edit the color scheme in the dashboard properties."),C=e=>{let{label:t,hasCustomLabelColors:n,dashboardId:a}=e;if(n||a){const e=n?y:_;return(0,v.tZ)(c.Fragment,null,t," ",(0,v.tZ)(m.u,{title:e},(0,v.tZ)(b,{iconSize:"s"})))}return(0,v.tZ)(c.Fragment,null,t)},Z=e=>{let{hasCustomLabelColors:t=!1,dashboardId:n,label:a=(0,u.t)("Color scheme"),name:r,onChange:l=(()=>{}),value:d,clearable:g=!1,defaultScheme:b,choices:y=[],schemes:Z={},isLinear:E,...T}=e;const S=(0,c.useMemo)((()=>{if(n)return"dashboard";let e=d||b;if("SUPERSET_DEFAULT"===e){var t;const n=i()(Z)?Z():Z;e=null==n||null==(t=n.SUPERSET_DEFAULT)?void 0:t.id}return e}),[n,b,Z,d]),x=(0,c.useMemo)((()=>{if(n)return[{value:"dashboard",label:(0,u.t)("dashboard"),customLabel:(0,v.tZ)(m.u,{title:_},(0,u.t)("Dashboard scheme"))}];const e=i()(Z)?Z():Z,t=i()(y)?y():y,a=[];return t.filter((e=>{const t=e[0],n="SUPERSET_DEFAULT"!==t&&!s()(a).call(a,t);return a.push(t),n})).map((t=>{var n;let[a]=t;const o=e[a];let r=[];return o&&(r=E?o.getColors(10):o.colors),{customLabel:(0,v.tZ)(f,{id:o.id,label:o.label,colors:r}),label:(null==e||null==(n=e[a])?void 0:n.label)||a,value:a}}))}),[y,n,E,Z]);return(0,v.tZ)(p.Ph,{header:(0,v.tZ)(h.Z,o()({},T,{label:(0,v.tZ)(C,{label:a,hasCustomLabelColors:t,dashboardId:n})})),ariaLabel:(0,u.t)("Select color scheme"),allowClear:g,disabled:!!n,name:`select-${r}`,onChange:e=>l(e),options:x,placeholder:(0,u.t)("Select scheme"),value:S})}},27845:(e,t,n)=>{n.d(t,{j:()=>s,Z:()=>d});var a=n(5872),o=n.n(a),r=n(67294),i=n(76697),l=n(11965);const s=()=>{var e;return null==(e=document.getElementById("controlSections"))?void 0:e.lastElementChild},c=e=>{var t,n;const a=null==(t=window)?void 0:t.innerHeight,o=null==e||null==(n=e.getBoundingClientRect())?void 0:n.top;return a&&o?o/a:0},d=e=>{let{getPopupContainer:t,getVisibilityRatio:n=c,visible:a,destroyTooltipOnHide:d=!1,...u}=e;const p=(0,r.useRef)(),[h,m]=(0,r.useState)(void 0===a?u.defaultVisible:a),[g,v]=r.useState("right"),f=(0,r.useCallback)((()=>{const e=n(p.current);v(e<.35&&"rightTop"!==g?"rightTop":e>.65&&"rightBottom"!==g?"rightBottom":"right")}),[n]),b=(0,r.useCallback)((e=>{const t=s();t&&t.style.setProperty("overflow-y",e?"hidden":"auto","important")}),[f]),y=(0,r.useCallback)((e=>(p.current=e,(null==t?void 0:t(e))||document.body)),[f,t]),_=(0,r.useCallback)((e=>{void 0===e&&b(e),m(!!e),null==u.onVisibleChange||u.onVisibleChange(!!e)}),[u,b]),C=(0,r.useCallback)((e=>{"Escape"===e.key&&(m(!1),null==u.onVisibleChange||u.onVisibleChange(!1))}),[u]);return(0,r.useEffect)((()=>{void 0!==a&&m(!!a)}),[a]),(0,r.useEffect)((()=>{void 0!==h&&b(h)}),[h,b]),(0,r.useEffect)((()=>(h&&document.addEventListener("keydown",C),()=>{document.removeEventListener("keydown",C)})),[C,h]),(0,r.useEffect)((()=>{h&&f()}),[h,f]),(0,l.tZ)(i.ZP,o()({},u,{visible:h,arrowPointAtCenter:!0,placement:g,onVisibleChange:_,getPopupContainer:y,destroyTooltipOnHide:d}))}},74092:(e,t,n)=>{n.d(t,{Z:()=>K});var a=n(67294),o=n(51995),r=n(11965),i=n(5364),l=n(55867),s=n(35932),c=n(82342),d=n(74069),u=n(4715),p=n(70163),h=n(81315),m=n(58593),g=n(12515),v=n(27600),f=n(54076),b=n(63279),y=n(27845),_=n(61314),C=n(87183);function Z(e){let t="Last week";return _.bk.has(e.value)?t=e.value:e.onChange(t),(0,r.tZ)(a.Fragment,null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Configure Time Range: Last...")),(0,r.tZ)(C.Y.Group,{value:t,onChange:t=>e.onChange(t.target.value)},_.Sm.map((e=>{let{value:t,label:n}=e;return(0,r.tZ)(C.Y,{key:t,value:t,className:"vertical-radio"},n)}))))}var E=n(31209);function T(e){let{onChange:t,value:n}=e;return(0,a.useEffect)((()=>{_.LY.has(n)||t(E.gT)}),[t,n]),_.LY.has(n)?(0,r.tZ)(a.Fragment,null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Configure Time Range: Previous...")),(0,r.tZ)(C.Y.Group,{value:n,onChange:e=>t(e.target.value)},_._S.map((e=>{let{value:t,label:n}=e;return(0,r.tZ)(C.Y,{key:t,value:t,className:"vertical-radio"},n)})))):null}var S=n(93754),x=n.n(S),w=n(28216),A=n(58146),R=n(9875),D=n(62276),O=n(9882);function M(e){var t;const{customRange:n,matchedFlag:a}=(0,_.c_)(e.value);a||e.onChange((0,_.jK)(n));const{sinceDatetime:o,sinceMode:i,sinceGrain:s,sinceGrainValue:c,untilDatetime:d,untilMode:p,untilGrain:m,untilGrainValue:g,anchorValue:v,anchorMode:f}={...n};function b(t,a){e.onChange((0,_.jK)({...n,[t]:a}))}function y(t,a){x()(a)&&a>0&&e.onChange((0,_.jK)({...n,[t]:a}))}const Z=(0,w.v9)((e=>{var t;return null==e||null==(t=e.common)?void 0:t.locale})),E=null==(t=A.locales[_.ZU[Z]])?void 0:t.DatePicker;return(0,r.tZ)("div",null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Configure custom time range")),(0,r.tZ)(u.X2,{gutter:24},(0,r.tZ)(u.JX,{span:12},(0,r.tZ)("div",{className:"control-label"},(0,l.t)("START (INCLUSIVE)")," ",(0,r.tZ)(O.V,{tooltip:(0,l.t)("Start date included in time range"),placement:"right"})),(0,r.tZ)(h.Z,{ariaLabel:(0,l.t)("START (INCLUSIVE)"),options:_._d,value:i,onChange:e=>b("sinceMode",e)}),"specific"===i&&(0,r.tZ)(u.X2,null,(0,r.tZ)(D.M,{showTime:!0,defaultValue:(0,_.DL)(o),onChange:e=>b("sinceDatetime",e.format(_.KZ)),allowClear:!1,locale:E})),"relative"===i&&(0,r.tZ)(u.X2,{gutter:8},(0,r.tZ)(u.JX,{span:11},(0,r.tZ)(R.Rn,{placeholder:(0,l.t)("Relative quantity"),value:Math.abs(c),min:1,defaultValue:1,onChange:e=>y("sinceGrainValue",e||1),onStep:e=>y("sinceGrainValue",e||1)})),(0,r.tZ)(u.JX,{span:13},(0,r.tZ)(h.Z,{ariaLabel:(0,l.t)("Relative period"),options:_.kj,value:s,onChange:e=>b("sinceGrain",e)})))),(0,r.tZ)(u.JX,{span:12},(0,r.tZ)("div",{className:"control-label"},(0,l.t)("END (EXCLUSIVE)")," ",(0,r.tZ)(O.V,{tooltip:(0,l.t)("End date excluded from time range"),placement:"right"})),(0,r.tZ)(h.Z,{ariaLabel:(0,l.t)("END (EXCLUSIVE)"),options:_.hj,value:p,onChange:e=>b("untilMode",e)}),"specific"===p&&(0,r.tZ)(u.X2,null,(0,r.tZ)(D.M,{showTime:!0,defaultValue:(0,_.DL)(d),onChange:e=>b("untilDatetime",e.format(_.KZ)),allowClear:!1,locale:E})),"relative"===p&&(0,r.tZ)(u.X2,{gutter:8},(0,r.tZ)(u.JX,{span:11},(0,r.tZ)(R.Rn,{placeholder:(0,l.t)("Relative quantity"),value:g,min:1,defaultValue:1,onChange:e=>y("untilGrainValue",e||1),onStep:e=>y("untilGrainValue",e||1)})),(0,r.tZ)(u.JX,{span:13},(0,r.tZ)(h.Z,{ariaLabel:(0,l.t)("Relative period"),options:_.Ae,value:m,onChange:e=>b("untilGrain",e)}))))),"relative"===i&&"relative"===p&&(0,r.tZ)("div",{className:"control-anchor-to"},(0,r.tZ)("div",{className:"control-label"},(0,l.t)("Anchor to")),(0,r.tZ)(u.X2,{align:"middle"},(0,r.tZ)(u.JX,null,(0,r.tZ)(C.Y.Group,{onChange:function(t){const a=t.target.value;"now"===a?e.onChange((0,_.jK)({...n,anchorValue:"now",anchorMode:a})):e.onChange((0,_.jK)({...n,anchorValue:_.V7,anchorMode:a}))},defaultValue:"now",value:f},(0,r.tZ)(C.Y,{key:"now",value:"now"},(0,l.t)("NOW")),(0,r.tZ)(C.Y,{key:"specific",value:"specific"},(0,l.t)("Date/Time")))),"now"!==f&&(0,r.tZ)(u.JX,null,(0,r.tZ)(D.M,{showTime:!0,defaultValue:(0,_.DL)(v),onChange:e=>b("anchorValue",e.format(_.KZ)),allowClear:!1,className:"control-anchor-to-datetime",locale:E})))))}var L=n(78580),N=n.n(L),I=n(5872),k=n.n(I);const F=(0,r.tZ)(a.Fragment,null,(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"DATETIME"),(0,r.tZ)("p",null,(0,l.t)("Return to specific datetime.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"datetime([string])")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'datetime("2020-03-01 12:00:00")\ndatetime("now")\ndatetime("last year")'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"DATEADD"),(0,r.tZ)("p",null,(0,l.t)("Moves the given set of dates by a specified interval.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"dateadd([datetime], [integer], [dateunit])\ndateunit = (year | quarter | month | week | day | hour | minute | second)")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'dateadd(datetime("today"), -13, day)\ndateadd(datetime("2020-03-01"), 2, day)'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"DATETRUNC"),(0,r.tZ)("p",null,(0,l.t)("Truncates the specified date to the accuracy specified by the date unit.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"datetrunc([datetime], [dateunit])\ndateunit = (year | quarter | month | week)")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'datetrunc(datetime("2020-03-01"), week)\ndatetrunc(datetime("2020-03-01"), month)'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"LASTDAY"),(0,r.tZ)("p",null,(0,l.t)("Get the last date by the date unit.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"lastday([datetime], [dateunit])\ndateunit = (year | month | week)")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'lastday(datetime("today"), month)'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"HOLIDAY"),(0,r.tZ)("p",null,(0,l.t)("Get the specify date for the holiday")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"holiday([string])\nholiday([holiday string], [datetime])\nholiday([holiday string], [datetime], [country name])")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'holiday("new year")\nholiday("christmas", datetime("2019"))\nholiday("christmas", dateadd(datetime("2019"), 1, year))\nholiday("christmas", datetime("2 years ago"))\nholiday("Easter Monday", datetime("2019"), "UK")')))),P=e=>{const t=(0,o.Fg)();return(0,r.tZ)(r.ms,null,(n=>{let{css:a}=n;return(0,r.tZ)(m.u,k()({overlayClassName:a`
            .ant-tooltip-content {
              min-width: ${125*t.gridUnit}px;
              max-height: 410px;
              overflow-y: scroll;

              .ant-tooltip-inner {
                max-width: ${125*t.gridUnit}px;
                h3 {
                  font-size: ${t.typography.sizes.m}px;
                  font-weight: ${t.typography.weights.bold};
                }
                h4 {
                  font-size: ${t.typography.sizes.m}px;
                  font-weight: ${t.typography.weights.bold};
                }
                pre {
                  border: none;
                  text-align: left;
                  word-break: break-word;
                  font-size: ${t.typography.sizes.s}px;
                }
              }
            }
          `},e))}))};function $(e){return(0,r.tZ)(P,k()({title:F},e))}function U(e){return N()(e).call(e,_.UD)?e:e.startsWith("Last")?[e,""].join(_.UD):e.startsWith("Next")?["",e].join(_.UD):_.UD}function V(e){const t=U(e.value||""),[n,o]=t.split(_.UD);function i(t,a){"since"===t?e.onChange(`${a}${_.UD}${o}`):e.onChange(`${n}${_.UD}${a}`)}return t!==e.value&&e.onChange(U(e.value||"")),(0,r.tZ)(a.Fragment,null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Configure Advanced Time Range "),(0,r.tZ)($,{placement:"rightBottom"},(0,r.tZ)("i",{className:"fa fa-info-circle text-muted"}))),(0,r.tZ)("div",{className:"control-label"},(0,l.t)("START (INCLUSIVE)")," ",(0,r.tZ)(O.V,{tooltip:(0,l.t)("Start date included in time range"),placement:"right"})),(0,r.tZ)(R.II,{key:"since",value:n,onChange:e=>i("since",e.target.value)}),(0,r.tZ)("div",{className:"control-label"},(0,l.t)("END (EXCLUSIVE)")," ",(0,r.tZ)(O.V,{tooltip:(0,l.t)("End date excluded from time range"),placement:"right"})),(0,r.tZ)(R.II,{key:"until",value:o,onChange:e=>i("until",e.target.value)}))}const q="#45BED6",j=o.iK.div`
  ${e=>{let{theme:t,isActive:n,isPlaceholder:a}=e;return r.iv`
    width: 100%;
    height: ${8*t.gridUnit}px;

    display: flex;
    align-items: center;
    flex-wrap: nowrap;

    padding: 0 ${3*t.gridUnit}px;

    background-color: ${t.colors.grayscale.light5};

    border: 1px solid
      ${n?q:t.colors.grayscale.light2};
    border-radius: ${t.borderRadius}px;

    cursor: pointer;

    transition: border-color 0.3s cubic-bezier(0.65, 0.05, 0.36, 1);
    :hover,
    :focus {
      border-color: ${q};
    }

    .date-label-content {
      color: ${a?t.colors.grayscale.light1:t.colors.grayscale.dark1};
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
      flex-shrink: 1;
      white-space: nowrap;
    }

    span[role='img'] {
      margin-left: auto;
      padding-left: ${t.gridUnit}px;

      & > span[role='img'] {
        line-height: 0;
      }
    }
  `}}
`,H=(0,a.forwardRef)(((e,t)=>{const n=(0,o.Fg)();return(0,r.tZ)(j,k()({},e,{tabIndex:0}),(0,r.tZ)("span",{className:"date-label-content",ref:t},e.label),(0,r.tZ)(p.Z.CalendarOutlined,{iconSize:"s",iconColor:n.colors.grayscale.base}))})),z=(0,o.iK)(h.Z)`
  width: 272px;
`,B=o.iK.div`
  ${e=>{let{theme:t}=e;return r.iv`
    .ant-row {
      margin-top: 8px;
    }

    .ant-input-number {
      width: 100%;
    }

    .ant-picker {
      padding: 4px 17px 4px;
      border-radius: 4px;
      width: 100%;
    }

    .ant-divider-horizontal {
      margin: 16px 0;
    }

    .control-label {
      font-size: 11px;
      font-weight: ${t.typography.weights.medium};
      color: ${t.colors.grayscale.light2};
      line-height: 16px;
      text-transform: uppercase;
      margin: 8px 0;
    }

    .vertical-radio {
      display: block;
      height: 40px;
      line-height: 40px;
    }

    .section-title {
      font-style: normal;
      font-weight: ${t.typography.weights.bold};
      font-size: 15px;
      line-height: 24px;
      margin-bottom: 8px;
    }

    .control-anchor-to {
      margin-top: 16px;
    }

    .control-anchor-to-datetime {
      width: 217px;
    }

    .footer {
      text-align: right;
    }
  `}}
`,G=o.iK.span`
  span {
    margin-right: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    vertical-align: middle;
  }
  .text {
    vertical-align: middle;
  }
  .error {
    color: ${e=>{let{theme:t}=e;return t.colors.error.base}};
  }
`,W=(e,t,n)=>e?(0,r.tZ)("div",null,t&&(0,r.tZ)("strong",null,t),n&&(0,r.tZ)("div",{css:e=>r.iv`
            margin-top: ${e.gridUnit}px;
          `},n)):n||null;function K(e){var t;const{onChange:n,onOpenPopover:h=f.EI,onClosePopover:C=f.EI,overlayStyle:E="Popover",isOverflowingFilterBar:S=!1}=e,x=(0,_.Ct)(),w=null!=(t=e.value)?t:x,[A,R]=(0,a.useState)(w),[D,O]=(0,a.useState)(!1),L=(0,a.useMemo)((()=>(0,_.X0)(w)),[w]),[N,I]=(0,a.useState)(L),[k,F]=(0,a.useState)(w),[P,$]=(0,a.useState)(w),[U,q]=(0,a.useState)(!1),[j,K]=(0,a.useState)(w),[Y,Q]=(0,a.useState)(w),J=(0,o.Fg)(),[X,ee]=(0,b.cB)();function te(){$(w),I(L),O(!1),C()}(0,a.useEffect)((()=>{if(w===i.vM)return R(i.vM),Q(null),void q(!0);(0,_.z1)(w).then((e=>{let{value:t,error:n}=e;n?(K(n||""),q(!1),Q(w||null)):("Common"===L||"Calendar"===L||"No filter"===L?(R(w),Q(W(ee,w,t))):(R(t||""),Q(W(ee,t,w))),q(!0)),F(w),K(t||w)}))}),[L,ee,X,w]),(0,g.bX)((()=>{if(P===i.vM)return K(i.vM),F(i.vM),void q(!0);k!==P&&(0,_.z1)(P).then((e=>{let{value:t,error:n}=e;n?(K(n||""),q(!1)):(K(t||""),q(!0)),F(P)}))}),v.M$,[P]);const ne=()=>{D?te():($(w),I(L),O(!0),h())},ae=(0,r.tZ)(B,null,(0,r.tZ)("div",{className:"control-label"},(0,l.t)("RANGE TYPE")),(0,r.tZ)(z,{ariaLabel:(0,l.t)("RANGE TYPE"),options:_.un,value:N,onChange:function(e){e===i.vM&&$(i.vM),I(e)}}),"No filter"!==N&&(0,r.tZ)(u.iz,null),"Common"===N&&(0,r.tZ)(Z,{value:P,onChange:$}),"Calendar"===N&&(0,r.tZ)(T,{value:P,onChange:$}),"Advanced"===N&&(0,r.tZ)(V,{value:P,onChange:$}),"Custom"===N&&(0,r.tZ)(M,{value:P,onChange:$}),"No filter"===N&&(0,r.tZ)("div",null),(0,r.tZ)(u.iz,null),(0,r.tZ)("div",null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Actual time range")),U&&(0,r.tZ)("div",null,j),!U&&(0,r.tZ)(G,{className:"warning"},(0,r.tZ)(p.Z.ErrorSolidSmall,{iconColor:J.colors.error.base}),(0,r.tZ)("span",{className:"text error"},j))),(0,r.tZ)(u.iz,null),(0,r.tZ)("div",{className:"footer"},(0,r.tZ)(s.Z,{buttonStyle:"secondary",cta:!0,key:"cancel",onClick:te},(0,l.t)("CANCEL")),(0,r.tZ)(s.Z,{buttonStyle:"primary",cta:!0,disabled:!U,key:"apply",onClick:function(){n(P),O(!1),C()}},(0,l.t)("APPLY")))),oe=(0,r.tZ)(G,null,(0,r.tZ)(p.Z.EditAlt,{iconColor:J.colors.grayscale.base}),(0,r.tZ)("span",{className:"text"},(0,l.t)("Edit time range"))),re=(0,r.tZ)(y.Z,{placement:"right",trigger:"click",content:ae,title:oe,defaultVisible:D,visible:D,onVisibleChange:ne,overlayStyle:{width:"600px"},getPopupContainer:e=>S?e.parentNode:document.body,destroyTooltipOnHide:!0},(0,r.tZ)(m.u,{placement:"top",title:Y},(0,r.tZ)(H,{label:A,isActive:D,isPlaceholder:A===i.vM,ref:X}))),ie=(0,r.tZ)(a.Fragment,null,(0,r.tZ)(m.u,{placement:"top",title:Y},(0,r.tZ)(H,{onClick:ne,label:A,isActive:D,isPlaceholder:A===i.vM,ref:X})),(0,r.tZ)(d.Z,{title:oe,show:D,onHide:ne,width:"600px",hideFooter:!0,zIndex:1030},ae));return(0,r.tZ)(a.Fragment,null,(0,r.tZ)(c.Z,e),"Modal"===E?ie:re)}},1090:(e,t,n)=>{n.d(t,{ZP:()=>a.Z,z1:()=>o.z1});var a=n(74092),o=n(61314)},31209:(e,t,n)=>{n.d(t,{gT:()=>a,MZ:()=>o,po:()=>r});const a="previous calendar week",o="previous calendar month",r="previous calendar year"},61314:(e,t,n)=>{n.d(t,{_S:()=>T,LY:()=>M,gn:()=>S,Sm:()=>Z,bk:()=>O,MI:()=>E,un:()=>C,ZU:()=>k,V7:()=>I,KZ:()=>L,UD:()=>h,kj:()=>w,_d:()=>R,Ae:()=>A,hj:()=>D,c_:()=>K,jK:()=>Y,DL:()=>G,z1:()=>f,X0:()=>v,Ct:()=>b});var a=n(78580),o=n.n(a),r=n(30381),i=n.n(r),l=n(15926),s=n.n(l),c=n(5364),d=n(31069),u=n(98286),p=n(28216);const h=" : ",m=(e,t)=>e.replace("T00:00:00","")||(t?"-":""),g=function(e,t){void 0===t&&(t="col");const n=e.split(h);return 1===n.length?e:`${m(n[0],!0)}  ${t} < ${m(n[1])}`},v=e=>E.has(e)?"Common":S.has(e)?"Calendar":e===c.vM?"No filter":K(e).matchedFlag?"Custom":"Advanced",f=async function(e,t){void 0===t&&(t="col");const n=`/api/v1/time_range/?q=${s().encode_uri(e)}`;try{var a,o,r,i;const e=await d.Z.get({endpoint:n}),s=(l=(null==e||null==(a=e.json)||null==(o=a.result)?void 0:o.since)||"",c=(null==e||null==(r=e.json)||null==(i=r.result)?void 0:i.until)||"",`${l}${h}${c}`);return{value:g(s,t)}}catch(e){const t=await(0,u.O$)(e);return{error:t.message||t.error||e.statusText}}var l,c};function b(){var e;return null!=(e=(0,p.v9)((e=>{var t,n;return null==e||null==(t=e.common)||null==(n=t.conf)?void 0:n.DEFAULT_TIME_FILTER})))?e:c.vM}var y=n(55867),_=n(31209);const C=[{value:"Common",label:(0,y.t)("Last")},{value:"Calendar",label:(0,y.t)("Previous")},{value:"Custom",label:(0,y.t)("Custom")},{value:"Advanced",label:(0,y.t)("Advanced")},{value:"No filter",label:(0,y.t)("No filter")}],Z=[{value:"Last day",label:(0,y.t)("last day")},{value:"Last week",label:(0,y.t)("last week")},{value:"Last month",label:(0,y.t)("last month")},{value:"Last quarter",label:(0,y.t)("last quarter")},{value:"Last year",label:(0,y.t)("last year")}],E=new Set(Z.map((e=>{let{value:t}=e;return t}))),T=[{value:_.gT,label:(0,y.t)("previous calendar week")},{value:_.MZ,label:(0,y.t)("previous calendar month")},{value:_.po,label:(0,y.t)("previous calendar year")}],S=new Set(T.map((e=>{let{value:t}=e;return t}))),x=[{value:"second",label:e=>(0,y.t)("Seconds %s",e)},{value:"minute",label:e=>(0,y.t)("Minutes %s",e)},{value:"hour",label:e=>(0,y.t)("Hours %s",e)},{value:"day",label:e=>(0,y.t)("Days %s",e)},{value:"week",label:e=>(0,y.t)("Weeks %s",e)},{value:"month",label:e=>(0,y.t)("Months %s",e)},{value:"quarter",label:e=>(0,y.t)("Quarters %s",e)},{value:"year",label:e=>(0,y.t)("Years %s",e)}],w=x.map((e=>({value:e.value,label:e.label((0,y.t)("Before"))}))),A=x.map((e=>({value:e.value,label:e.label((0,y.t)("After"))}))),R=[{value:"specific",label:(0,y.t)("Specific Date/Time")},{value:"relative",label:(0,y.t)("Relative Date/Time")},{value:"now",label:(0,y.t)("Now")},{value:"today",label:(0,y.t)("Midnight")}],D=R.slice(),O=new Set(["Last day","Last week","Last month","Last quarter","Last year"]),M=new Set([_.gT,_.MZ,_.po]),L="YYYY-MM-DD[T]HH:mm:ss",N=i()().utc().startOf("day").subtract(7,"days").format(L),I=i()().utc().startOf("day").format(L),k={en:"en_US",fr:"fr_FR",es:"es_ES",it:"it_IT",zh:"zh_CN",ja:"ja_JP",de:"de_DE",pt:"pt_PT",pt_BR:"pt_BR",ru:"ru_RU",ko:"ko_KR",sk:"sk_SK",sl:"sl_SI",nl:"nl_NL"};var F;!function(e){e.commonFrame="common-frame",e.modalOverlay="modal-overlay",e.popoverOverlay="time-range-trigger",e.noFilter="no-filter",e.cancelButton="cancel-button",e.applyButton="date-filter-control__apply-button"}(F||(F={}));const P=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,$=String.raw`(?:TODAY|NOW)`,U=String.raw`[+-]?[1-9][0-9]*`,V=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,q=RegExp(String.raw`^DATEADD\(DATETIME\("(${P}|${$})"\),\s(${U}),\s(${V})\)$`,"i"),j=RegExp(String.raw`^${P}$|^${$}$`,"i"),H=["now","today"],z={sinceDatetime:N,sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:I,untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},B=["specific","today","now"],G=e=>"now"===e?i()().utc().startOf("second"):"today"===e?i()().utc().startOf("day"):i()(e),W=e=>G(e).format(L),K=e=>{const t=e.split(h);if(2===t.length){const[e,n]=t;if(j.test(e)&&j.test(n)){const t=o()(H).call(H,e)?e:"specific",a=o()(H).call(H,n)?n:"specific";return{customRange:{...z,sinceDatetime:e,untilDatetime:n,sinceMode:t,untilMode:a},matchedFlag:!0}}const a=e.match(q);if(a&&j.test(n)&&o()(e).call(e,n)){const[e,t,r]=a.slice(1),i=o()(H).call(H,n)?n:"specific";return{customRange:{...z,sinceGrain:r,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:i},matchedFlag:!0}}const r=n.match(q);if(j.test(e)&&r&&o()(n).call(n,e)){const[t,n,a]=[...r.slice(1)],i=o()(H).call(H,e)?e:"specific";return{customRange:{...z,untilGrain:a,untilGrainValue:parseInt(n,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:i},matchedFlag:!0}}if(a&&r){const[e,t,n]=[...a.slice(1)],[o,i,l]=[...r.slice(1)];if(e===o)return{customRange:{...z,sinceGrain:n,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:l,untilGrainValue:parseInt(i,10),untilDatetime:o,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:z,matchedFlag:!1}},Y=e=>{const{sinceDatetime:t,sinceMode:n,sinceGrain:a,sinceGrainValue:r,untilDatetime:i,untilMode:l,untilGrain:s,untilGrainValue:c,anchorValue:d}={...e};if(o()(B).call(B,n)&&o()(B).call(B,l))return`${"specific"===n?W(t):n} : ${"specific"===l?W(i):l}`;if(o()(B).call(B,n)&&"relative"===l){const e="specific"===n?W(t):n;return`${e} : DATEADD(DATETIME("${e}"), ${c}, ${s})`}if("relative"===n&&o()(B).call(B,l)){const e="specific"===l?W(i):l;return`DATEADD(DATETIME("${e}"), ${-Math.abs(r)}, ${a}) : ${e}`}return`DATEADD(DATETIME("${d}"), ${-Math.abs(r)}, ${a}) : DATEADD(DATETIME("${d}"), ${c}, ${s})`}},96055:(e,t,n)=>{n.d(t,{Z:()=>te});var a=n(67294),o=n(5872),r=n.n(o),i=n(45697),l=n.n(i),s=n(35932),c=n(51995),d=n(55867),u=n(57902),p=n(71262),h=n(17536),m=n(28543),g=n(78580),v=n.n(g),f=(n(4591),n(4715)),b=n(37731),y=n(11146),_=n(31069),C=n(69856),Z=n(40266),E=n(58593),T=n(9875),S=n(54076),x=n(91877),w=n(93185),A=n(45211),R=n(23279),D=n.n(R),O=n(55786),M=n(15926),L=n.n(M);const N={parsedAdvancedDataType:"",advancedDataTypeOperatorList:[],errorMessage:""};var I=n(7848),k=n(61314),F=n(11965);const P=(0,c.iK)(T.II)`
  margin-bottom: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,$=(0,c.iK)(f.Ph)`
  .ant-select-selector::after {
    content: ${e=>{let{labelText:t}=e;return t||"\\A0"}};
    display: inline-block;
    white-space: nowrap;
    color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
    width: max-content;
  }
`,U=e=>{var t,n;const{onSubjectChange:o,onOperatorChange:i,isOperatorRelevant:l,onComparatorChange:s,onDatePickerChange:c}=(e=>{const t=(0,k.Ct)(),n=(t,n)=>{var a;const o=null==(a=e.datasource.columns)?void 0:a.find((e=>e.column_name===n)),r=!!o&&("BOOL"===o.type||"BOOLEAN"===o.type),i=!!o&&("INT"===o.type||"INTEGER"===o.type),l=!!o&&!!o.expression;if(t&&t===C.d.LATEST_PARTITION){const{partitionColumn:t}=e;return t&&n&&n===t}return(!t||t!==C.d.TEMPORAL_RANGE)&&(t===C.d.IS_TRUE||t===C.d.IS_FALSE?r||i||l:r?t===C.d.IS_NULL||t===C.d.IS_NOT_NULL:e.adhocFilter.clause!==m.Pr.HAVING||-1!==C.Ak.indexOf(t))};return{onSubjectChange:a=>{const o=e.options.find((e=>"column_name"in e&&e.column_name===a||"optionName"in e&&e.optionName===a));let r,i="";o&&"column_name"in o?(i=o.column_name,r=m.Pr.WHERE):o&&"saved_metric_name"in o?(i=o.saved_metric_name,r=m.Pr.HAVING):null!=o&&o.label&&(i=o.label,r=m.Pr.HAVING);let{operator:l,operatorId:s,comparator:c}=e.adhocFilter;l=l&&s&&n(s,i)?C.LT[s].operation:null,(0,b.Z)(l)||(l=C.d.IN,s=C.d.IN,c=void 0),y.O6&&(0,A.x)(a,e.datasource)&&(i=a,l=C.d.TEMPORAL_RANGE,s=C.d.TEMPORAL_RANGE,c=t),e.onChange(e.adhocFilter.duplicateWith({subject:i,clause:r,operator:l,expressionType:m.vq.SIMPLE,operatorId:s,comparator:c}))},onOperatorChange:t=>{const n=e.adhocFilter.comparator;let a;a=C.qK.has(t)?Array.isArray(n)?n:[n].filter((e=>e)):Array.isArray(n)?n[0]:n,t!==C.d.IS_TRUE&&t!==C.d.IS_FALSE||(a=C.d.IS_TRUE===t),t&&C.qB.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:m.Pr.WHERE,operatorId:t,operator:C.LT[t].operation,expressionType:m.vq.SQL,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:C.LT[t].operation,comparator:a,expressionType:m.vq.SIMPLE}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:m.vq.SIMPLE}))},isOperatorRelevant:n,clearOperator:()=>{e.onChange(e.adhocFilter.duplicateWith({operatorId:void 0,operator:void 0}))},onDatePickerChange:(t,n)=>{e.onChange(e.adhocFilter.duplicateWith({subject:t,operator:C.d.TEMPORAL_RANGE,comparator:n,expressionType:m.vq.SIMPLE}))}}})(e),[u,p]=(0,a.useState)([]),[h,g]=(0,a.useState)(e.adhocFilter.comparator),[T,R]=(0,a.useState)(!1),{advancedDataTypesState:M,subjectAdvancedDataType:U,fetchAdvancedDataTypeValueCallback:V,fetchSubjectAdvancedDataType:q}=(e=>{const[t,n]=(0,a.useState)(N),[o,r]=(0,a.useState)(),i=(0,a.useCallback)(((t,a,o)=>{const r=(0,O.Z)(t);o?D()((()=>{const t=`/api/v1/advanced_data_type/convert?q=${L().encode({type:o,values:r})}`;_.Z.get({endpoint:t}).then((t=>{let{json:a}=t;n({parsedAdvancedDataType:a.result.display_value,advancedDataTypeOperatorList:a.result.valid_filter_operators,errorMessage:a.result.error_message}),e(!a.result.error_message)})).catch((()=>{n({parsedAdvancedDataType:"",advancedDataTypeOperatorList:a.advancedDataTypeOperatorList,errorMessage:(0,d.t)("Failed to retrieve advanced type")}),e(!1)}))}),600)():n(N)}),[e]);return{advancedDataTypesState:t,subjectAdvancedDataType:o,setAdvancedDataTypesState:n,fetchAdvancedDataTypeValueCallback:i,fetchSubjectAdvancedDataType:e=>{const t=e.options.find((t=>"column_name"in t&&t.column_name===e.adhocFilter.subject||"optionName"in t&&t.optionName===e.adhocFilter.subject));t&&"advanced_data_type"in t?r(t.advanced_data_type):e.validHandler(!0)}}})(e.validHandler),j=(e,t)=>{var n;return U?l(e,t)&&v()(n=M.advancedDataTypeOperatorList).call(n,e):l(e,t)},H=()=>{const e=(()=>{var e;const t=Array.isArray(h)?h.filter((e=>v()(u).call(u,e))).length:0;return null!=(e=(null==u?void 0:u.length)-t)?e:0})(),t=(0,d.t)("%s option(s)",e);return e?t:""};let z=e.options;const{subject:B,operator:G,operatorId:W}=e.adhocFilter,K={ariaLabel:(0,d.t)("Select subject"),value:null!=B?B:void 0,onChange:e=>{g(void 0),o(e)},notFoundContent:(0,d.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!B,placeholder:""};K.placeholder=e.adhocFilter.clause===m.Pr.WHERE?(0,d.t)("%s column(s)",z.length):(0,d.t)("To filter on a metric, use Custom SQL tab."),z=e.options.filter((e=>"column_name"in e&&e.column_name));const Y={placeholder:(0,d.t)("%s operator(s)",(null!=(t=e.operators)?t:C.GS).filter((e=>j(e,B))).length),value:W,onChange:i,autoFocus:!!K.value&&!G,ariaLabel:(0,d.t)("Select operator")},Q=!!K.value&&!!Y.value,J={allowClear:!0,allowNewOptions:!0,ariaLabel:(0,d.t)("Comparator option"),mode:C.qK.has(W)?"multiple":"single",loading:T,value:h,onChange:s,notFoundContent:(0,d.t)("Type a value here"),disabled:v()(C.yi).call(C.yi,W),placeholder:H(),autoFocus:Q},X=h&&h.length>0&&H(),ee=(0,I.v)({columnName:e.adhocFilter.subject,timeRange:e.adhocFilter.operator===C.d.TEMPORAL_RANGE?e.adhocFilter.comparator:void 0,datasource:e.datasource,onChange:c});(0,a.useEffect)((()=>{ee||(()=>{const{datasource:t}=e,n=e.adhocFilter.subject,a=e.adhocFilter.clause===m.Pr.HAVING;if(n&&t&&t.filter_select&&!a){const e=new AbortController,{signal:a}=e;T&&e.abort(),R(!0),_.Z.get({signal:a,endpoint:`/api/v1/datasource/${t.type}/${t.id}/column/${n}/values/`}).then((e=>{let{json:t}=e;p(t.result.map((e=>({value:e,label:(0,S.lo)(e)})))),R(!1)})).catch((()=>{p([]),R(!1)}))}})()}),[e.adhocFilter.subject]),(0,a.useEffect)((()=>{(0,x.cr)(w.T.ENABLE_ADVANCED_DATA_TYPES)&&q(e)}),[e.adhocFilter.subject]),(0,a.useEffect)((()=>{(0,x.cr)(w.T.ENABLE_ADVANCED_DATA_TYPES)&&V(void 0===h?"":h,M,U)}),[h,U,V]),(0,a.useEffect)((()=>{(0,x.cr)(w.T.ENABLE_ADVANCED_DATA_TYPES)&&g(e.adhocFilter.comparator)}),[e.adhocFilter.comparator]);const te=(0,F.tZ)(f.Ph,r()({css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),options:z.map((e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",label:"saved_metric_name"in e&&e.saved_metric_name||"column_name"in e&&e.column_name||"label"in e&&e.label,key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,customLabel:(t=e,(0,F.tZ)(Z.Z,{option:t}))};var t}))},K)),ne=(0,F.tZ)(a.Fragment,null,(0,F.tZ)(f.Ph,r()({css:e=>({marginBottom:4*e.gridUnit}),options:(null!=(n=e.operators)?n:C.GS).filter((e=>j(e,B))).map(((e,t)=>({value:e,label:C.LT[e].display,key:e,order:t})))},Y)),C.qK.has(W)||u.length>0?(0,F.tZ)(E.u,{title:M.errorMessage||M.parsedAdvancedDataType},(0,F.tZ)($,r()({labelText:X,options:u},J))):(0,F.tZ)(E.u,{title:M.errorMessage||M.parsedAdvancedDataType},(0,F.tZ)(P,{name:"filter-value",ref:e=>{e&&Q&&e.focus()},onChange:e=>{const{value:t}=e.target;g(t),s(t)},value:h,placeholder:(0,d.t)("Filter value (case sensitive)"),disabled:v()(C.yi).call(C.yi,W)})));return(0,F.tZ)(a.Fragment,null,te,null!=ee?ee:ne)};var V=n(94670),q=n(33313),j=n(72201);const H={adhocFilter:l().instanceOf(m.ZP).isRequired,onChange:l().func.isRequired,options:l().arrayOf(l().oneOfType([j.Z,l().shape({saved_metric_name:l().string.isRequired}),h.Z])).isRequired,height:l().number.isRequired,activeKey:l().string.isRequired},z=(0,c.iK)(f.Ph)`
  ${e=>{let{theme:t}=e;return`\n    width: ${30*t.gridUnit}px;\n    marginRight: ${t.gridUnit}px;\n  `}}
`;class B extends a.Component{constructor(e){super(e),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onSqlExpressionClauseChange=this.onSqlExpressionClauseChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.selectProps={ariaLabel:(0,d.t)("Select column")}}componentDidUpdate(){this.aceEditorRef&&this.aceEditorRef.editor.resize()}onSqlExpressionClauseChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({clause:e,expressionType:m.vq.SQL}))}onSqlExpressionChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({sqlExpression:e,expressionType:m.vq.SQL}))}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}render(){const{adhocFilter:e,height:t,options:n}=this.props,a={placeholder:(0,d.t)("choose WHERE or HAVING..."),value:e.clause,onChange:this.onSqlExpressionClauseChange},o=q.Z.concat(n.map((e=>e.column_name?{name:e.column_name,value:e.column_name,score:50,meta:"option"}:null)).filter(Boolean)),i=Object.keys(m.Pr).map((e=>({label:e,value:e})));return(0,F.tZ)("span",null,(0,F.tZ)("div",{className:"filter-edit-clause-section"},(0,F.tZ)(z,r()({options:i},this.selectProps,a)),(0,F.tZ)("span",{className:"filter-edit-clause-info"},(0,F.tZ)("strong",null,"WHERE")," ",(0,d.t)("Filters by columns"),(0,F.tZ)("br",null),(0,F.tZ)("strong",null,"HAVING")," ",(0,d.t)("Filters by metrics"))),(0,F.tZ)("div",{css:e=>({marginTop:4*e.gridUnit})},(0,F.tZ)(V.iO,{ref:this.handleAceEditorRef,keywords:o,height:t-130+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0})))}}B.propTypes=H;const G={adhocFilter:l().instanceOf(m.ZP).isRequired,onChange:l().func.isRequired,onClose:l().func.isRequired,onResize:l().func.isRequired,options:l().arrayOf(l().oneOfType([j.Z,l().shape({saved_metric_name:l().string.isRequired}),h.Z])).isRequired,datasource:l().object,partitionColumn:l().string,theme:l().object,sections:l().arrayOf(l().string),operators:l().arrayOf(l().string),requireSave:l().bool},W=c.iK.i`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,K=c.iK.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;

    & > li > a {
      padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.xs}}px;
    padding-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }

  .filter-edit-clause-section {
    display: inline-flex;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${e=>{let{theme:t}=e;return 5*t.gridUnit}}px;
  }
`,Y=c.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`;class Q extends a.Component{constructor(e){var t,n;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.setSimpleTabIsValid=this.setSimpleTabIsValid.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:C.kc,height:C.H7,activeKey:(null==(t=this.props)||null==(n=t.adhocFilter)?void 0:n.expressionType)||"SIMPLE",isSimpleTabValid:!0},this.popoverContentRef=a.createRef()}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}setSimpleTabIsValid(e){this.setState({isSimpleTabValid:e})}onSave(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),C.kc),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),C.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState((t=>({height:t.height+e})))}render(){const{adhocFilter:e,options:t,onChange:n,onClose:a,onResize:o,datasource:i,partitionColumn:l,theme:c,operators:h,requireSave:g,...v}=this.props,{adhocFilter:f}=this.state,b=f.isValid(),y=g||!f.equals(e);return(0,F.tZ)(K,r()({id:"filter-edit-popover"},v,{ref:this.popoverContentRef}),(0,F.tZ)(p.ZP,{id:"adhoc-filter-edit-tabs",defaultActiveKey:f.expressionType,className:"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange},(0,F.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:m.vq.SIMPLE,tab:(0,d.t)("Simple")},(0,F.tZ)(u.Z,null,(0,F.tZ)(U,{operators:h,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:i,onHeightChange:this.adjustHeight,partitionColumn:l,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid}))),(0,F.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:m.vq.SQL,tab:(0,d.t)("Custom SQL")},(0,F.tZ)(u.Z,null,(0,F.tZ)(B,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey})))),(0,F.tZ)(Y,null,(0,F.tZ)(s.Z,{buttonSize:"small",onClick:this.props.onClose,cta:!0},(0,d.t)("Close")),(0,F.tZ)(s.Z,{disabled:!b||!this.state.isSimpleTabValid||!y,buttonStyle:"primary",buttonSize:"small",className:"m-r-5",onClick:this.onSave,cta:!0},(0,d.t)("Save")),(0,F.tZ)(W,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}Q.propTypes=G;var J=n(63325),X=n(27845);class ee extends a.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{visible:n,togglePopover:a,closePopover:o}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},r=(0,F.tZ)(J.b,null,(0,F.tZ)(Q,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:o,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit,requireSave:this.props.requireSave}));return(0,F.tZ)(X.Z,{trigger:"click",content:r,defaultVisible:n,visible:n,onVisibleChange:a,destroyTooltipOnHide:!0},this.props.children)}}const te=ee},7848:(e,t,n)=>{n.d(t,{v:()=>g,w:()=>s});var a=n(67294),o=n(5364),r=n(1090),i=n(69856),l=n(28543);const s=e=>{const[t,n]=(0,a.useState)({});return(0,a.useEffect)((()=>{e.operator===i.d.TEMPORAL_RANGE&&e.expressionType===l.vq.SIMPLE||n({}),e.operator===i.d.TEMPORAL_RANGE&&e.comparator===o.vM&&n({actualTimeRange:`${e.subject} (${o.vM})`,title:o.vM}),e.operator===i.d.TEMPORAL_RANGE&&e.expressionType===l.vq.SIMPLE&&e.comparator!==o.vM&&t.title!==e.comparator&&(0,r.z1)(e.comparator,e.subject).then((t=>{let{value:a,error:o}=t;n(o?{actualTimeRange:`${e.subject} (${e.comparator})`,title:o}:{actualTimeRange:null!=a?a:"",title:e.comparator})}))}),[e]),t};var c=n(11146),d=n(55867),u=n(45211),p=n(74092),h=n(82342),m=n(11965);const g=e=>{let{columnName:t,timeRange:n,datasource:o,onChange:r}=e;return c.O6&&(0,u.x)(t,o)?(0,m.tZ)(a.Fragment,null,(0,m.tZ)(h.Z,{label:(0,d.t)("Time Range")}),(0,m.tZ)(p.Z,{value:n,name:"time_range",onChange:e=>r(t,e),overlayStyle:"Modal"})):void 0}},33334:(e,t,n)=>{n.d(t,{a7:()=>g,EQ:()=>v,__:()=>f,Ne:()=>y,gu:()=>_,gM:()=>Z,yj:()=>E,H$:()=>T,SW:()=>S,IG:()=>x,yz:()=>w});var a=n(5872),o=n.n(a),r=n(67294),i=n(22068),l=n(27034),s=n(51995),c=n(55867),d=n(9882),u=n(58593),p=n(70163),h=n(99963),m=n(11965);const g=s.iK.div`
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  :last-child {
    margin-bottom: 0;
  }
`,v=s.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
  border-radius: 3px;
  cursor: ${e=>{let{withCaret:t}=e;return t?"pointer":"default"}};
`,f=s.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${t.gridUnit}px;\n    svg {\n      margin-right: ${t.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*t.gridUnit}px;\n      margin-left: ${t.gridUnit}px;\n      font-weight: ${t.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}}
`,b=s.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,y=s.iK.div`
  height: 100%;
  border-left: solid 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.dark2}}0C;
  margin-left: auto;
`,_=s.iK.div`
  height: 100%;
  width: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  border-right: solid 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.dark2}}0C;
  cursor: pointer;
`,C=(0,s.iK)(d.V)`
  margin: 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,Z=s.iK.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,E=s.iK.div`
  padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  border: solid 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,T=s.iK.div`
  padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  border: ${e=>{let{canDrop:t,isOver:n,theme:a}=e;return t?`dashed 1px ${a.colors.info.dark1}`:n&&!t?`dashed 1px ${a.colors.error.dark1}`:`solid 1px ${a.colors.grayscale.light2}`}};
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,S=s.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  padding-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
  border: dashed 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  cursor: ${e=>{let{cancelHover:t}=e;return t?"inherit":"pointer"}};

  :hover {
    background-color: ${e=>{let{cancelHover:t,theme:n}=e;return t?"inherit":n.colors.grayscale.light4}};
  }

  :active {
    background-color: ${e=>{let{cancelHover:t,theme:n}=e;return t?"inherit":n.colors.grayscale.light3}};
  }
`,x=s.iK.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  width: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  padding: 0;
  background-color: ${e=>{let{theme:t}=e;return t.colors.primary.dark1}};
  border: none;
  border-radius: 2px;

  :disabled {
    cursor: not-allowed;
    background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
  }
`,w=e=>{let{label:t,savedMetric:n,adhocMetric:a,onRemove:d,onMoveLabel:Z,onDropLabel:E,withCaret:T,isFunction:S,type:x,index:w,isExtra:A,datasourceWarningMessage:R,tooltipTitle:D,multi:O=!0,...M}=e;const L=(0,s.Fg)(),N=(0,r.useRef)(null),I=(0,r.useRef)(null),k=null==n?void 0:n.metric_name,[,F]=(0,i.L)({accept:x,drop(){O&&(null==E||E())},hover(e,t){var n;if(!O)return;if(!N.current)return;const a=e.index,o=w;if(a===o)return;const r=null==(n=N.current)?void 0:n.getBoundingClientRect(),i=(r.bottom-r.top)/2,l=t.getClientOffset(),s=null!=l&&l.y?(null==l?void 0:l.y)-r.top:0;a<o&&s<i||a>o&&s>i||(null==Z||Z(a,o),e.index=o)}}),[{isDragging:P},$]=(0,l.c)({item:{type:x,index:w,value:null!=n&&n.metric_name?n:a},collect:e=>({isDragging:e.isDragging()})});return $(F(N)),(0,m.tZ)(g,{ref:N},(0,m.tZ)(v,o()({withCaret:T},M),(0,m.tZ)(_,{role:"button",onClick:d},(0,m.tZ)(p.Z.XSmall,{iconColor:L.colors.grayscale.light1})),(0,m.tZ)(f,null,S&&(0,m.tZ)(p.Z.FieldDerived,null),(()=>{const e=!P&&"string"==typeof t&&D&&t&&D!==t||!P&&I&&I.current&&I.current.scrollWidth>I.current.clientWidth;return n&&k?(0,m.tZ)(h.B,{metric:n,labelRef:I,shouldShowTooltip:!P}):e?(0,m.tZ)(u.u,{title:D||t},(0,m.tZ)(b,{ref:I},t)):(0,m.tZ)(b,{ref:I},t)})()),(!!R||A)&&(0,m.tZ)(C,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:R||(0,c.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),T&&(0,m.tZ)(y,null,(0,m.tZ)(p.Z.CaretRight,{iconColor:L.colors.grayscale.light1}))))}},79684:(e,t,n)=>{n.d(t,{Z:()=>h});var a=n(67294),o=n(99298),r=n(75294),i=n(23279),l=n.n(i),s=n(27600),c=n(82342),d=n(9875),u=n(11965);const p=e=>null==e?"":String(e);class h extends a.Component{constructor(e){super(e),this.initialValue=void 0,this.onChange=e=>{var t,n;let a=e;const i=[];if(""!==e&&this.props.isFloat){const t=(0,o.Z)(e);t?i.push(t):a=e.match(/.*([.0])$/g)?e:parseFloat(e)}if(""!==e&&this.props.isInt){const t=(0,r.Z)(e);t?i.push(t):a=parseInt(e,10)}null==(t=(n=this.props).onChange)||t.call(n,a,i)},this.debouncedOnChange=l()((e=>{this.onChange(e)}),s.oP),this.onChangeWrapper=e=>{const{value:t}=e.target;this.setState({value:t},(()=>{this.debouncedOnChange(t)}))},this.initialValue=e.value,this.state={value:p(this.initialValue)}}render(){let{value:e}=this.state;return this.initialValue!==this.props.value&&(this.initialValue=this.props.value,e=p(this.props.value)),(0,u.tZ)("div",null,(0,u.tZ)(c.Z,this.props),(0,u.tZ)(d.II,{type:"text",placeholder:this.props.placeholder,onChange:this.onChangeWrapper,onFocus:this.props.onFocus,value:e,disabled:this.props.disabled,"aria-label":this.props.label}))}}},85626:(e,t,n)=>{n.d(t,{Z:()=>v}),n(67294);var a=n(51995),o=n(42110),r=n(120),i=n(13433),l=n(50909),s=n(53459),c=n(49889),d=n(33743),u=n(22489),p=n(11965);const h=(0,a.iK)(l.qi)`
  && {
    margin: 0 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`;o.Z.registerLanguage("markdown",s.Z),o.Z.registerLanguage("html",c.Z),o.Z.registerLanguage("sql",d.Z),o.Z.registerLanguage("json",u.Z);const m=a.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,g=(0,a.iK)(o.Z)`
  flex: 1;
`,v=e=>{const{sql:t,language:n="sql"}=e;return(0,p.tZ)(m,{key:t},(0,p.tZ)(i.Z,{text:t,shouldShowText:!1,copyNode:(0,p.tZ)(h,{buttonSize:"xsmall"},(0,p.tZ)("i",{className:"fa fa-clipboard"}))}),(0,p.tZ)(g,{language:n,style:r.Z},t))}},13284:(e,t,n)=>{n.d(t,{UB:()=>x,ZP:()=>Q});var a,o=n(5872),r=n.n(o),i=n(78580),l=n.n(i),s=n(67294),c=n(74221),d=n(94184),u=n.n(d),p=n(55867),h=n(51995),m=n(11965),g=n(16355),v=n(4715),f=n(58593),b=n(9875),y=n(37921),_=n(14278),C=n(70163),Z=n(1510),E=n(64239);!function(e){e.ALL_CHARTS="ALL_CHARTS",e.CATEGORY="CATEGORY",e.TAGS="TAGS",e.RECOMMENDED_TAGS="RECOMMENDED_TAGS"}(a||(a={}));const T=["line","big_number","big_number_total","table","pivot_table_v2","echarts_timeseries_line","echarts_area","echarts_timeseries_bar","echarts_timeseries_scatter","pie","mixed_timeseries","filter_box","dist_bar","area","bar","deck_polygon","time_table","histogram","deck_scatter","deck_hex","time_pivot","deck_arc","heatmap","deck_grid","dual_line","deck_screengrid","line_multi","treemap","box_plot","sunburst","sankey","word_cloud","mapbox","kepler","cal_heatmap","rose","bubble","deck_geojson","horizon","deck_multi","compare","partition","event_flow","deck_path","graph_chart","world_map","paired_ttest","para","country_map"],S=new Set(T),x=1090,w=(0,p.t)("Other"),A=(0,p.t)("All charts"),R=[(0,p.t)("Popular"),(0,p.t)("ECharts"),(0,p.t)("Advanced-Analytics")],D=h.iK.div`
  ${e=>{let{isSelectedVizMetadata:t}=e;return`\n    display: grid;\n    grid-template-rows: ${t?"auto minmax(100px, 1fr) minmax(200px, 35%)":"auto minmax(100px, 1fr)"};\n    // em is used here because the sidebar should be sized to fit the longest standard tag\n    grid-template-columns: minmax(14em, auto) 5fr;\n    grid-template-areas:\n      'sidebar search'\n      'sidebar main'\n      'details details';\n    height: 70vh;\n    overflow: auto;\n  `}}
`,O=h.iK.h3`
  margin-top: 0;
  margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.l}}px;
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
  line-height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
`,M=h.iK.div`
  grid-area: sidebar;
  display: flex;
  flex-direction: column;
  border-right: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  overflow: auto;

  .ant-collapse .ant-collapse-item {
    .ant-collapse-header {
      font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
      color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
      padding-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
      padding-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    }
    .ant-collapse-content .ant-collapse-content-box {
      display: flex;
      flex-direction: column;
      padding: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    }
  }
`,L=h.iK.div`
  grid-area: main;
  overflow-y: auto;
`,N=h.iK.div`
  ${e=>{let{theme:t}=e;return`\n    grid-area: search;\n    margin-top: ${3*t.gridUnit}px;\n    margin-bottom: ${t.gridUnit}px;\n    margin-left: ${3*t.gridUnit}px;\n    margin-right: ${3*t.gridUnit}px;\n    .ant-input-affix-wrapper {\n      padding-left: ${2*t.gridUnit}px;\n    }\n  `}}
`,I=h.iK.div`
  display: flex;
  justify-content: center;
  align-items: center;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,k=h.iK.button`
  ${e=>{let{theme:t}=e;return`\n    all: unset; // remove default button styles\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    margin: ${t.gridUnit}px 0;\n    padding: 0 ${t.gridUnit}px;\n    border-radius: ${t.borderRadius}px;\n    line-height: 2em;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    position: relative;\n\n    &:focus {\n      outline: initial;\n    }\n\n    &.selected {\n      background-color: ${t.colors.primary.base};\n      color: ${t.colors.primary.light5};\n\n      svg {\n        color: ${t.colors.primary.light5};\n      }\n\n      &:hover {\n        .cancel {\n          visibility: visible;\n        }\n      }\n    }\n\n    & span:first-of-type svg {\n      margin-top: ${1.5*t.gridUnit}px;\n    }\n\n    .cancel {\n      visibility: hidden;\n    }\n  `}}
`,F=h.iK.div`
  overflow: auto;
  display: grid;
  grid-template-columns: repeat(
    auto-fill,
    ${e=>{let{theme:t}=e;return 24*t.gridUnit}}px
  );
  grid-auto-rows: max-content;
  justify-content: space-evenly;
  grid-gap: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  justify-items: center;
  // for some reason this padding doesn't seem to apply at the bottom of the container. Why is a mystery.
  padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,P=e=>m.iv`
  grid-area: details;
  border-top: 1px solid ${e.colors.grayscale.light2};
`,$=e=>m.iv`
  padding: ${4*e.gridUnit}px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto auto 1fr;
  grid-template-areas:
    'viz-name examples-header'
    'viz-tags examples'
    'description examples';
`,U=h.iK.div`
  grid-area: viz-tags;
  width: ${e=>{let{theme:t}=e;return 120*t.gridUnit}}px;
  padding-right: ${e=>{let{theme:t}=e;return 14*t.gridUnit}}px;
  padding-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,V=h.iK.p`
  grid-area: description;
  overflow: auto;
  padding-right: ${e=>{let{theme:t}=e;return 14*t.gridUnit}}px;
  margin: 0;
`,q=h.iK.div`
  grid-area: examples;
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  overflow: auto;
  gap: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;

  img {
    height: 100%;
    border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    border: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  }
`,j=e=>m.iv`
  cursor: pointer;
  width: ${24*e.gridUnit}px;
  position: relative;

  img {
    min-width: ${24*e.gridUnit}px;
    min-height: ${24*e.gridUnit}px;
    border: 1px solid ${e.colors.grayscale.light2};
    border-radius: ${e.gridUnit}px;
    transition: border-color ${e.transitionTiming};
  }

  &.selected img {
    border: 2px solid ${e.colors.primary.light2};
  }

  &:hover:not(.selected) img {
    border: 1px solid ${e.colors.grayscale.light1};
  }

  .viztype-label {
    margin-top: ${2*e.gridUnit}px;
    text-align: center;
  }
`,H=h.iK.div`
  ${e=>{let{theme:t}=e;return`\n    border: 1px solid ${t.colors.primary.dark1};\n    box-sizing: border-box;\n    border-radius: ${t.gridUnit}px;\n    background: ${t.colors.grayscale.light5};\n    line-height: ${2.5*t.gridUnit}px;\n    color: ${t.colors.primary.dark1};\n    font-size: ${t.typography.sizes.s}px;\n    font-weight: ${t.typography.weights.bold};\n    text-align: center;\n    padding: ${.5*t.gridUnit}px ${t.gridUnit}px;\n    text-transform: uppercase;\n    cursor: pointer;\n\n    div {\n      transform: scale(0.83,0.83);\n    }\n  `}}
`,z=h.iK.div`
  position: absolute;
  right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  top: ${e=>{let{theme:t}=e;return 19*t.gridUnit}}px;
`,B=h.iK.div`
  display: inline-block !important;
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`;function G(e){return S.has(e.key)?T.indexOf(e.key):T.length}const W=e=>{let{entry:t,selectedViz:n,setSelectedViz:a,onDoubleClick:o}=e;const r=(0,h.Fg)(),{key:i,value:l}=t,s=n===t.key;return(0,m.tZ)("div",{role:"button",css:j(r),tabIndex:0,className:s?"selected":"",onClick:()=>a(i),onDoubleClick:o},(0,m.tZ)("img",{alt:l.name,width:"100%",className:"viztype-selector "+(s?"selected":""),src:l.thumbnail}),(0,m.tZ)("div",{className:"viztype-label"},l.name),l.label&&(0,m.tZ)(z,null,(0,m.tZ)(H,null,(0,m.tZ)("div",null,(0,p.t)(l.label)))))},K=e=>{let{vizEntries:t,...n}=e;return(0,m.tZ)(F,null,t.map((e=>(0,m.tZ)(W,r()({key:e.key},n,{entry:e})))))},Y=e=>{let{selector:t,sectionId:n,icon:a,isSelected:o,onClick:r,className:i}=e;const l=(0,s.useRef)(null);return(0,s.useEffect)((()=>{o&&queueMicrotask((()=>(0,E.default)(l.current,{behavior:"smooth",scrollMode:"if-needed"})))}),[]),(0,m.tZ)(k,{ref:l,key:t,name:t,className:u()(i,o&&"selected"),onClick:()=>r(t,n)},a,t)};function Q(e){var t,n;const{selectedViz:o,onChange:r,onDoubleClick:i,className:d}=e,{mountedPluginMetadata:u}=(0,_.gp)(),h=(0,s.useRef)(),[E,T]=(0,s.useState)(""),[S,x]=(0,s.useState)(!0),k=S&&!!E,F=o?u[o]:null,j=(0,s.useMemo)((()=>{const t=Object.entries(u).map((e=>{let[t,n]=e;return{key:t,value:n}})).filter((t=>{var n;let{key:a}=t;return!l()(n=e.denyList).call(n,a)})).filter((e=>{let{value:t}=e;return(0,Z.X3)(t.behaviors||[])&&!t.deprecated}));return t.sort(((e,t)=>G(e)-G(t))),t}),[u]),z=(0,s.useMemo)((()=>{const e={};return j.forEach((t=>{const n=t.value.category||w;e[n]||(e[n]=[]),e[n].push(t)})),e}),[j]),W=(0,s.useMemo)((()=>Object.keys(z).sort(((e,t)=>e===w?1:t===w?-1:e.localeCompare(t)))),[z]),Q=(0,s.useMemo)((()=>{const e={};return j.forEach((t=>{(t.value.tags||[]).forEach((n=>{e[n]||(e[n]=[]),e[n].push(t)}))})),e}),[j]),J=(0,s.useMemo)((()=>Object.keys(Q).sort(((e,t)=>e.localeCompare(t))).filter((e=>-1===R.indexOf(e)))),[Q]),X=(0,s.useMemo)((()=>j.sort(((e,t)=>e.key.localeCompare(t.key)))),[j]),[ee,te]=(0,s.useState)((()=>(null==F?void 0:F.category)||R[0])),[ne,ae]=(0,s.useState)((()=>null!=F&&F.category?a.CATEGORY:a.RECOMMENDED_TAGS)),oe=(0,s.useMemo)((()=>new c.Z(j,{ignoreLocation:!0,threshold:.3,keys:[{name:"value.name",weight:4},{name:"value.tags",weight:2},"value.description"]})),[j]),re=(0,s.useMemo)((()=>""===E.trim()?[]:oe.search(E).map((e=>e.item)).sort(((e,t)=>{var n,a;const o=null==(n=e.value)?void 0:n.label,r=null==(a=t.value)?void 0:a.label,i=o&&g.eH[o]?g.eH[o].weight:0;return(r&&g.eH[r]?g.eH[r].weight:0)-i}))),[E,oe]),ie=(0,s.useCallback)((()=>{x(!0)}),[]),le=(0,s.useCallback)((e=>T(e.target.value)),[]),se=(0,s.useCallback)((()=>{x(!1),T(""),h.current.blur()}),[]),ce=(0,s.useCallback)(((e,t)=>{S&&se(),te(e),ae(t);const n=F&&((e,t)=>t===e.category||t===w&&null==e.category||(e.tags||[]).indexOf(t)>-1)(F,e);e===ee||n||r(null)}),[se,S,ee,F,r]),de=(0,s.useMemo)((()=>({[a.RECOMMENDED_TAGS]:{title:(0,p.t)("Recommended tags"),icon:(0,m.tZ)(C.Z.Tags,null),selectors:R},[a.CATEGORY]:{title:(0,p.t)("Category"),icon:(0,m.tZ)(C.Z.Category,null),selectors:W},[a.TAGS]:{title:(0,p.t)("Tags"),icon:(0,m.tZ)(C.Z.Tags,null),selectors:J}})),[W,J]);return(0,m.tZ)(D,{className:d,isSelectedVizMetadata:Boolean(F)},(0,m.tZ)(M,null,(0,m.tZ)(Y,{css:e=>{let{gridUnit:t}=e;return m.iv`
              margin: ${2*t}px;
              margin-bottom: 0;
            `},sectionId:a.ALL_CHARTS,selector:A,icon:(0,m.tZ)(C.Z.Ballot,null),isSelected:!k&&A===ee&&a.ALL_CHARTS===ne,onClick:ce}),(0,m.tZ)(v.Ol,{expandIconPosition:"right",ghost:!0,defaultActiveKey:Object.keys(de)},Object.keys(de).map((e=>{const t=de[e];return(0,m.tZ)(v.Ol.Panel,{header:(0,m.tZ)("span",{className:"header"},t.title),key:e},t.selectors.map((n=>(0,m.tZ)(Y,{key:n,selector:n,sectionId:e,icon:t.icon,isSelected:!k&&n===ee&&e===ne,onClick:ce}))))})))),(0,m.tZ)(N,null,(0,m.tZ)(b.II,{type:"text",ref:h,value:E,placeholder:(0,p.t)("Search all charts"),onChange:le,onFocus:ie,prefix:(0,m.tZ)(I,null,(0,m.tZ)(C.Z.Search,{iconSize:"m"})),suffix:(0,m.tZ)(I,null,E&&(0,m.tZ)(C.Z.XLarge,{iconSize:"m",onClick:se}))})),(0,m.tZ)(L,null,(0,m.tZ)(K,{vizEntries:k?re:ee===A&&ne===a.ALL_CHARTS?X:ne===a.CATEGORY&&z[ee]?z[ee]:ne!==a.TAGS&&ne!==a.RECOMMENDED_TAGS||!Q[ee]?[]:Q[ee],selectedViz:o,setSelectedViz:r,onDoubleClick:i})),F?(0,m.tZ)("div",{css:e=>[P(e),$(e)]},(0,m.tZ)(s.Fragment,null,(0,m.tZ)(O,{css:m.iv`
                grid-area: viz-name;
                position: relative;
              `},null==F?void 0:F.name,(null==F?void 0:F.label)&&(0,m.tZ)(f.u,{id:"viz-badge-tooltip",placement:"top",title:null!=(t=F.labelExplanation)?t:g.t$[F.label]},(0,m.tZ)(B,null,(0,m.tZ)(H,null,(0,m.tZ)("div",null,(0,p.t)(F.label)))))),(0,m.tZ)(U,null,null==F?void 0:F.tags.map((e=>(0,m.tZ)(y.Z,{key:e},e)))),(0,m.tZ)(V,null,(null==F?void 0:F.description)||(0,p.t)("No description available.")),(0,m.tZ)(O,{css:m.iv`
                grid-area: examples-header;
              `},!(null==F||null==(n=F.exampleGallery)||!n.length)&&(0,p.t)("Examples")),(0,m.tZ)(q,null,((null==F?void 0:F.exampleGallery)||[]).map((e=>(0,m.tZ)("img",{src:e.url,alt:e.caption,title:e.caption})))))):null)}},99963:(e,t,n)=>{n.d(t,{B:()=>s,l:()=>c}),n(67294);var a=n(51995),o=n(51384),r=n(65634),i=n(11965);const l=a.iK.div`
  width: 100%;
  > span {
    display: flex;
    align-items: center;
  }

  .option-label {
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    & ~ i {
      margin-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    }
  }
  .type-label {
    margin-right: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
    width: ${e=>{let{theme:t}=e;return 7*t.gridUnit}}px;
    display: inline-block;
    text-align: center;
    font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
  }
`,s=e=>(0,i.tZ)(l,null,(0,i.tZ)(o.m,e)),c=e=>(0,i.tZ)(l,null,(0,i.tZ)(r.E,e))},10331:(e,t,n)=>{n.d(t,{os:()=>P,RO:()=>E,mi:()=>S,Bx:()=>C,vP:()=>T,YY:()=>D,Hu:()=>x,Bq:()=>y});var a={};n.r(a),n.d(a,{NVD3TimeSeries:()=>f,annotations:()=>v,colorScheme:()=>m,datasourceAndVizType:()=>h,sqlaTimeSeries:()=>g});var o=n(78580),r=n.n(o),i=n(30845),l=n(46078),s=n(37687),c=n(38575),d=n(89368),u=(n(67294),n(55867)),p=n(11965);const h={controlSetRows:[["datasource"],["viz_type"],[{name:"slice_id",config:{type:"HiddenControl",label:(0,u.t)("Chart ID"),hidden:!0,description:(0,u.t)("The id of the active chart")}},{name:"cache_timeout",config:{type:"HiddenControl",label:(0,u.t)("Cache Timeout (seconds)"),hidden:!0,description:(0,u.t)("The number of seconds before expiring the cache")}},{name:"url_params",config:{type:"HiddenControl",label:(0,u.t)("URL parameters"),hidden:!0,description:(0,u.t)("Extra parameters for use in jinja templated queries")}}]]},m={label:(0,u.t)("Color scheme"),controlSetRows:[["color_scheme"]]},g={label:(0,u.t)("Time"),description:(0,u.t)("Time related form attributes"),expanded:!0,controlSetRows:[["granularity_sqla"],["time_range"]]},v={label:(0,u.t)("Annotations and layers"),tabOverride:"data",expanded:!0,controlSetRows:[[{name:"annotation_layers",config:{type:"AnnotationLayerControl",label:"",default:[],description:(0,u.t)("Annotation layers"),renderTrigger:!0,tabOverride:"data"}}]]},f=[{label:(0,u.t)("Query"),expanded:!0,controlSetRows:[["metrics"],["adhoc_filters"],["groupby"],["limit","timeseries_limit_metric"],["order_desc"],[{name:"contribution",config:{type:"CheckboxControl",label:(0,u.t)("Contribution"),default:!1,description:(0,u.t)("Compute the contribution to the total")}}],["row_limit",null]]},{label:(0,u.t)("Advanced analytics"),tabOverride:"data",description:(0,u.t)("This section contains options that allow for advanced analytical post processing of query results"),controlSetRows:[[(0,p.tZ)("div",{className:"section-header"},(0,u.t)("Rolling window"))],[{name:"rolling_type",config:{type:"SelectControl",label:(0,u.t)("Rolling function"),default:"None",choices:[["None",(0,u.t)("None")],["mean",(0,u.t)("mean")],["sum",(0,u.t)("sum")],["std",(0,u.t)("std")],["cumsum",(0,u.t)("cumsum")]],description:(0,u.t)("Defines a rolling window function to apply, works along with the [Periods] text box")}},{name:"rolling_periods",config:{type:"TextControl",label:(0,u.t)("Periods"),isInt:!0,description:(0,u.t)("Defines the size of the rolling window function, relative to the time granularity selected")}},{name:"min_periods",config:{type:"TextControl",label:(0,u.t)("Min periods"),isInt:!0,description:(0,u.t)('The minimum number of rolling periods required to show a value. For instance if you do a cumulative sum on 7 days you may want your "Min Period" to be 7, so that all data points shown are the total of 7 periods. This will hide the "ramp up" taking place over the first 7 periods')}}],[(0,p.tZ)("div",{className:"section-header"},(0,u.t)("Time comparison"))],[{name:"time_compare",config:{type:"SelectControl",multi:!0,freeForm:!0,label:(0,u.t)("Time shift"),choices:[["1 day",(0,u.t)("1 day")],["1 week",(0,u.t)("1 week")],["28 days",(0,u.t)("28 days")],["30 days",(0,u.t)("30 days")],["52 weeks",(0,u.t)("52 weeks")],["1 year",(0,u.t)("1 year")],["104 weeks",(0,u.t)("104 weeks")],["2 years",(0,u.t)("2 years")],["156 weeks",(0,u.t)("156 weeks")],["3 years",(0,u.t)("3 years")]],description:(0,u.t)("Overlay one or more timeseries from a relative time period. Expects relative time deltas in natural language (example: 24 hours, 7 days, 52 weeks, 365 days). Free text is supported.")}},{name:"comparison_type",config:{type:"SelectControl",label:(0,u.t)("Calculation type"),default:"values",choices:[["values",(0,u.t)("Actual values")],["absolute",(0,u.t)("Difference")],["percentage",(0,u.t)("Percentage change")],["ratio",(0,u.t)("Ratio")]],description:(0,u.t)("How to display time shifts: as individual lines; as the difference between the main time series and each time shift; as the percentage change; or as the ratio between series and time shifts.")}}],[(0,p.tZ)("div",{className:"section-header"},(0,u.t)("Resample"))],[{name:"resample_rule",config:{type:"SelectControl",freeForm:!0,label:(0,u.t)("Rule"),default:null,choices:[["1T",(0,u.t)("1T")],["1H",(0,u.t)("1H")],["1D",(0,u.t)("1D")],["7D",(0,u.t)("7D")],["1M",(0,u.t)("1M")],["1AS",(0,u.t)("1AS")]],description:(0,u.t)("Pandas resample rule")}},{name:"resample_method",config:{type:"SelectControl",freeForm:!0,label:(0,u.t)("Method"),default:null,choices:[["asfreq",(0,u.t)("asfreq")],["bfill",(0,u.t)("bfill")],["ffill",(0,u.t)("ffill")],["median",(0,u.t)("median")],["mean",(0,u.t)("mean")],["sum",(0,u.t)("sum")]],description:(0,u.t)("Pandas resample method")}}]]}],b=(0,i.Z)(((e,t)=>{const{sectionOverrides:n={},controlOverrides:o,controlPanelSections:i=[]}=t,s={...a};Object.entries(n).forEach((e=>{let[t,n]=e;"object"==typeof n&&n.constructor===Object?s[t]={...s[t],...n}:s[t]=n}));const{datasourceAndVizType:u}=s,p=[l.i9.Query,l.i9.Table],h=r()(p).call(p,e)?["granularity"]:["granularity_sqla","time_grain_sqla"];return[u].concat(i.filter(c.D_)).map((e=>{const{controlSetRows:t}=e;return{...e,controlSetRows:(null==t?void 0:t.map((e=>e.filter((e=>"string"!=typeof e||!r()(h).call(h,e))).map((e=>(0,d.q)(e,o))))))||[]}}))}));function y(e,t){const n=(0,s.Z)().get(e)||{};return b(t,n)}const _=(0,i.Z)(((e,t)=>{const{controlOverrides:n={},controlPanelSections:a=[]}=t,o=(0,d.q)(function(e,t){var n;return null!=(n=e.filter(c.D_).map((e=>e.controlSetRows)).flat(2).find((e=>t===e||null!==e&&"object"==typeof e&&"name"in e&&e.name===t)))?n:null}(a,e),n);return o&&"config"in o?o.config:o})),C=function(e,t){const n=(0,s.Z)().get(t)||{};return _(e,n)};var Z=n(55786);function E(e,t){const{mapStateToProps:n}=e;let a={...e},{value:o}=a;return n&&t&&(a={...e,...n.call(e,t,e)},o=o||a.value),"function"==typeof a.initialValue&&(a.initialValue=a.initialValue(a,t),"function"==typeof a.initialValue&&delete a.initialValue),a.initialValue&&(o=a.initialValue,delete a.initialValue),"function"==typeof a.default&&(a.default=a.default(a,t),"function"==typeof a.default&&delete a.default),a.default&&void 0===o&&(o=a.default),o&&a.multi&&!Array.isArray(o)&&(o=[o]),a.value=o,function(e,t){const n=e.validators,{externalValidationErrors:a=[]}=e,o=[];n&&n.length>0&&n.forEach((n=>{const a=n.call(e,e.value,t);a&&o.push(a)}));const r=[...o,...a];return{...e,validationErrors:r}}(function(e){if("SelectControl"===e.type&&!e.freeForm&&e.choices&&e.value){const t={...e},n=e.choices,a=(0,Z.Z)(e.value),o=n.map((e=>e[0]));if(e.multi&&a.length>0)return t.value=a.filter((e=>r()(o).call(o,e))),t;if(!e.multi&&!r()(o).call(o,a[0]))return t.value=null,t}return e}(a),a)}function T(e,t,n){if(!e)return null;const a={...e,value:n};return null!=t&&t.controls||null===t?E(a,t):a}function S(e,t,n,a){const o={};return y(e,t).forEach((e=>e.controlSetRows.forEach((e=>e.forEach((e=>{if(null!=e&&e.config&&e.name){const{config:t,name:r}=e;o[r]=T(t,n,a[r])}})))))),o}function x(e){const t={};return Object.keys(e).forEach((n=>{const a=e[n];t[n]=a.value})),t}var w=n(62446),A=n(46306);const R=(e,t,n)=>t.options&&"string"==typeof n&&t.options.some((e=>Array.isArray(e)?e[0]===n:e.column_name===n))?e.columns.some((e=>e.column_name===n)):t.savedMetrics&&(0,w.AG)(n)&&t.savedMetrics.some((e=>e.metric_name===n))?e.metrics.some((e=>e.metric_name===n)):t.columns&&((0,w.nX)(n)||(0,A.Ki)(n))&&t.columns.some((e=>{var t;return e.column_name===(null==(t=n.column)?void 0:t.column_name)||e.column_name===n.subject}))?e.columns.some((e=>{var t;return e.column_name===(null==(t=n.column)?void 0:t.column_name)||e.column_name===n.subject})):!!(0,w.q5)(n)&&(Object.assign(n,{datasourceWarning:!0}),!0),D=(e,t,n)=>{if(null!=n){if(Array.isArray(n)){const a=n.filter((n=>R(e,t,n)));return a.length>0?a:t.default}return R(e,t,n)?n:t.default}};var O=n(57557),M=n.n(O),L=n(20002),N=n(35854);const I=["metric","metrics","metric_2","size","x","y","secondary_metric"],k=["groupby","columns","groupbyColumns","groupbyRows","entity","series","series_columns"],F=["granularity_sqla","time_grain_sqla","time_range","adhoc_filters","limit","timeseries_limit_metric","series_limit_metric","order_desc","row_limit","x_axis","rolling_type","rolling_periods","min_periods","time_compare","comparison_type","resample_rule","resample_method"];class P{constructor(e){var t,n;this.sfd=void 0;const a=Object.freeze(e),o=null==a||null==(t=a.standardizedFormData)?void 0:t.memorizedFormData,r=a.viz_type;let i,l=new Map;if(Array.isArray(o)&&o.length>0&&a.datasource===(null==(n=o.slice(-1)[0][1])?void 0:n.datasource))l=new Map(a.standardizedFormData.memorizedFormData),l.has(r)&&l.delete(r),l.set(r,a),i=P.getStandardizedControls(a);else{const e=M()(a,"standardizedFormData");l.set(r,e),i=P.getStandardizedControls(e)}this.sfd={controls:i,memorizedFormData:l}}static getStandardizedControls(e){const t={metrics:[],columns:[]};if(Object.entries(e).forEach((e=>{let[n,a]=e;r()(I).call(I,n)&&t.metrics.push(...(0,Z.Z)(a)),r()(k).call(k,n)&&t.columns.push(...(0,Z.Z)(a))})),(0,c.pp)(e)){const{metrics:n,columns:a}=e.standardizedFormData.controls;t.metrics.push(...n),t.columns.push(...a)}return t}getLatestFormData(e){return this.has(e)?this.get(e):this.memorizedFormData.slice(-1)[0][1]}get standardizedControls(){return this.sfd.controls}get memorizedFormData(){return Array.from(this.sfd.memorizedFormData.entries())}serialize(){return{controls:this.standardizedControls,memorizedFormData:this.memorizedFormData}}has(e){return this.sfd.memorizedFormData.has(e)}get(e){return this.sfd.memorizedFormData.get(e)}transform(e,t){const n=this.getLatestFormData(e),a={};F.forEach((e=>{e in t.form_data&&(a[e]=t.form_data[e])}));const o=(0,N.R3)(t,{...n,...a,viz_type:e}),r={...x(o),standardizedFormData:this.serialize()};let i={formData:r,controlsState:o};const l=(0,s.Z)().get(e);if(null!=l&&l.formDataOverrides){(0,L.u)().setStandardizedControls(r);const e={...l.formDataOverrides(r),standardizedFormData:{controls:{...(0,L.u)().controls},memorizedFormData:this.memorizedFormData}};(0,L.u)().clear(),i={formData:e,controlsState:(0,N.R3)(t,e)}}return i.controlsState=(0,N.R3)({...t,controls:i.controlsState},i.formData),i}}},65013:(e,t,n)=>{n.d(t,{d:()=>o});var a=n(67294);const o=e=>{const t=(0,a.useRef)(!1);(0,a.useEffect)((()=>{t.current?e():t.current=!0}),[e])}},77997:(e,t,n)=>{n.d(t,{YJ:()=>_});var a=n(31069),o=n(55786),r=n(68492),i=n(22102),l=n(20292),s=n(91877),c=n(93185),d=n(98286);const u="polling",p="last_async_event_id";let h,m,g,v,f,b,y;const _=async e=>new Promise(((t,n)=>{const i=e.job_id;var l;l=async e=>{switch(e.status){case"done":{let{data:r,status:i}=await(async e=>{let t,n="success";try{const{json:n}=await a.Z.get({endpoint:String(e.result_url)});t="result"in n?n.result:n}catch(e){n="error",t=await(0,d.O$)(e)}return{status:n,data:t}})(e);r=(0,o.Z)(r),"success"===i?t(r):n(r);break}case"error":{const t=(0,d.MV)(e);n(t);break}default:r.Z.warn("received event with status",e.status)}var l;f[l=i]&&delete f[l]},f[i]=l})),C=(0,i.Z)({method:"GET",endpoint:"/api/v1/async_event/"}),Z=async e=>{e.forEach((e=>{const t=e.job_id,n=f[t];n?(n(e),delete b[t]):(b[t]||(b[t]=0),b[t]+=1,b[t]<=6?setTimeout((()=>{Z([e])}),100*b[t]):(delete b[t],r.Z.warn("listener not found for job_id",e.job_id))),(e=>{y=e.id;try{localStorage.setItem(p,y)}catch(e){r.Z.warn("Error saving event Id to localStorage",e)}})(e)}))},E=async()=>{const e=y?{last_id:y}:{};if(Object.keys(f).length)try{const{result:t}=await C(e);null!=t&&t.length&&await Z(t)}catch(e){r.Z.warn(e)}m===u&&(v=window.setTimeout(E,g))};let T,S,x=0;const w=()=>{let e=h.GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL;y&&(e+=`?last_id=${y}`),S=new WebSocket(e),S.addEventListener("open",(()=>{r.Z.log("WebSocket connected"),clearTimeout(T),x=0})),S.addEventListener("close",(()=>{T=setTimeout((()=>{x+=1,x<=6?w():(r.Z.warn("WebSocket not available, falling back to async polling"),E())}),2500)})),S.addEventListener("error",(()=>{S.readyState<2&&S.close()})),S.addEventListener("message",(async e=>{let t=[];try{t=[JSON.parse(e.data)],await Z(t)}catch(e){r.Z.warn(e)}}))};(e=>{if((0,s.cr)(c.T.GLOBAL_ASYNC_QUERIES)){v&&clearTimeout(v),f={},b={},y=null,h=(0,l.Z)().common.conf,m=h.GLOBAL_ASYNC_QUERIES_TRANSPORT||u,g=h.GLOBAL_ASYNC_QUERIES_POLLING_DELAY||500;try{y=localStorage.getItem(p)}catch(e){r.Z.warn("Failed to fetch last event Id from localStorage")}m===u&&E(),"ws"===m&&w()}})()},12617:(e,t,n)=>{n.d(t,{R:()=>a});const a=(0,n(30845).Z)(((e,t,n)=>!!n&&Object.values(n).some((n=>n.some((n=>{let[a,o]=n;return a===e&&o===t}))))))},42313:(e,t,n)=>{n.d(t,{T:()=>a});const a=e=>{var t,n;return null!=(t=e.uid)?t:`${null!=(n=e.id)?n:"None"}__${e.type}`}},8911:(e,t,n)=>{n.d(t,{Z:()=>a});const a=(()=>{let e;try{e=n(Object(function(){var e=new Error("Cannot find module '../../../superset_text'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(t){e={}}return e})()},23525:(e,t,n)=>{n.d(t,{eY:()=>m,YE:()=>_,Nm:()=>C,TO:()=>E,en:()=>T});var a=n(41609),o=n.n(a),r=n(78580),i=n.n(r),l=n(31069),s=n(37731),c=n(15926),d=n.n(c),u=n(27600),p=n(43399),h=n(11370);function m(e){let{name:t,type:n}=e;const a=new URLSearchParams(window.location.search).get(t);switch(n){case"number":return a?"true"===a.toLowerCase()?1:"false"===a.toLowerCase()?0:Number.isNaN(Number(a))?null:Number(a):null;case"object":return a?JSON.parse(a):null;case"boolean":return a?"false"!==a.toLowerCase()&&"0"!==a:null;case"rison":if(!a)return null;try{return d().decode(a)}catch{return a}default:return a}}function g(e){const t=new URLSearchParams;return new URLSearchParams(window.location.search).forEach(((n,a)=>{i()(e).call(e,a)||t.append(a,n)})),t}function v(e){const t=[];return e.forEach(((e,n)=>t.push([n,e]))),t}function f(e){const t=e||u.$O,n=g(t),a=(0,p.De)();return o()(a)||i()(t).call(t,u.KD.preselectFilters.name)||n.append(u.KD.preselectFilters.name,JSON.stringify((0,h.Z)((0,p.De)()))),v(n)}function b(){const e=g(u.Rv),t=(0,p.De)();return o()(t)||e.append(u.KD.preselectFilters.name,JSON.stringify((0,h.Z)((0,p.De)()))),v(e)}function y(e,t){return l.Z.post({endpoint:e,jsonPayload:t}).then((e=>e.json.url))}function _(e,t){return y("/api/v1/explore/permalink",{formData:e,urlParams:f(t)})}function C(e){let{dashboardId:t,dataMask:n,activeTabs:a,anchor:o}=e;return y(`/api/v1/dashboard/${t}/permalink`,{urlParams:b(),dataMask:n,activeTabs:a,anchor:o})}const Z=/^([^:/?#]+:)?(?:(\/\/)?([^/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/;function E(e){const t=e.match(Z)||[];return"string"==typeof t[1]&&t[1].length>0||"//"===t[2]||"string"==typeof t[3]&&t[3].length>0}function T(e){const t=e.match(Z)||[];return!E(e)||(0,s.Z)(t[1])||e.startsWith("//")?e:`//${e}`}},52389:(e,t,n)=>{n.d(t,{IV:()=>o,dY:()=>r,iX:()=>i,mI:()=>l});var a=n(55867);const o=25,r=[{id:"changed_on_delta_humanized",desc:!0}],i=(0,a.t)('The passwords for the databases below are needed in order to import them together with the datasets. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),l=(0,a.t)("You are importing one or more datasets that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?")},34858:(e,t,n)=>{n.d(t,{Yi:()=>v,LE:()=>f,PW:()=>b,NE:()=>C,fF:()=>Z,bR:()=>E,rM:()=>T,jb:()=>S,z:()=>x,xx:()=>w,cb:()=>A,h1:()=>R,_l:()=>D});var a=n(78580),o=n.n(a),r=n(15926),i=n.n(r),l=n(67294),s=n(31069),c=n(55867),d=n(22102),u=n(40768),p=n(10222),h=n(98286),m=n(8911);const g=e=>"string"==typeof e?e:Object.entries(e).map((e=>{let[t,n]=e;return Array.isArray(n)?`(${t}) ${n.join(", ")}`:`(${t}) ${n}`})).join("\n");function v(e,t,n,a,o,r,d){void 0===a&&(a=!0),void 0===o&&(o=[]),void 0===d&&(d=!0);const[p,h]=(0,l.useState)({count:0,collection:o,loading:d,lastFetchDataConfig:null,permissions:[],bulkSelectEnabled:!1});function m(e){h((t=>({...t,...e})))}(0,l.useEffect)((()=>{a&&s.Z.get({endpoint:`/api/v1/${e}/_info?q=${i().encode({keys:["permissions"]})}`}).then((e=>{let{json:t={}}=e;m({permissions:t.permissions})}),(0,u.v$)((e=>n((0,c.t)("An error occurred while fetching %s info: %s",t,e)))))}),[]);const g=(0,l.useCallback)((a=>{let{pageIndex:o,pageSize:l,sortBy:d,filters:p}=a;m({lastFetchDataConfig:{filters:p,pageIndex:o,pageSize:l,sortBy:d},loading:!0});const h=(r||[]).concat(p).map((e=>{let{id:t,operator:n,value:a}=e;return{col:t,opr:n,value:a&&"object"==typeof a&&"value"in a?a.value:a}})),g=i().encode_uri({order_column:d[0].id,order_direction:d[0].desc?"desc":"asc",page:o,page_size:l,...h.length?{filters:h}:{}});return s.Z.get({endpoint:`/api/v1/${e}/?q=${g}`}).then((e=>{let{json:t={}}=e;m({collection:t.result,count:t.count,lastFetched:(new Date).toISOString()})}),(0,u.v$)((e=>n((0,c.t)("An error occurred while fetching %ss: %s",t,e))))).finally((()=>{m({loading:!1})}))}),[r]);return{state:{loading:p.loading,resourceCount:p.count,resourceCollection:p.collection,bulkSelectEnabled:p.bulkSelectEnabled,lastFetched:p.lastFetched},setResourceCollection:e=>m({collection:e}),hasPerm:function(e){return!!p.permissions.length&&Boolean(p.permissions.find((t=>t===e)))},fetchData:g,toggleBulkSelect:function(){m({bulkSelectEnabled:!p.bulkSelectEnabled})},refreshData:e=>p.lastFetchDataConfig?g(p.lastFetchDataConfig):e?g(e):null}}function f(e,t,n){const[a,o]=(0,l.useState)({loading:!1,resource:null,error:null});function r(e){o((t=>({...t,...e})))}return{state:a,setResource:e=>r({resource:e}),fetchResource:(0,l.useCallback)((a=>(r({loading:!0}),s.Z.get({endpoint:`/api/v1/${e}/${a}`}).then((e=>{let{json:t={}}=e;return r({resource:t.result,error:null}),t.result}),(0,u.v$)((e=>{n((0,c.t)("An error occurred while fetching %ss: %s",t,g(e))),r({error:e})}))).finally((()=>{r({loading:!1})})))),[n,e,t]),createResource:(0,l.useCallback)((function(a,o){return void 0===o&&(o=!1),r({loading:!0}),s.Z.post({endpoint:`/api/v1/${e}/`,body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((e=>{let{json:t={}}=e;return r({resource:{id:t.id,...t.result},error:null}),t.id}),(0,u.v$)((e=>{o||n((0,c.t)("An error occurred while creating %ss: %s",t,g(e))),r({error:e})}))).finally((()=>{r({loading:!1})}))}),[n,e,t]),updateResource:(0,l.useCallback)((function(a,o,i,l){return void 0===i&&(i=!1),void 0===l&&(l=!0),l&&r({loading:!0}),s.Z.put({endpoint:`/api/v1/${e}/${a}`,body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((e=>{let{json:t={}}=e;return r({resource:{...t.result,id:t.id},error:null}),t.result}),(0,u.v$)((e=>(i||n((0,c.t)("An error occurred while fetching %ss: %s",t,JSON.stringify(e))),r({error:e}),e)))).finally((()=>{l&&r({loading:!1})}))}),[n,e,t]),clearError:()=>r({error:null})}}function b(e,t,n){const[a,o]=(0,l.useState)({loading:!1,passwordsNeeded:[],alreadyExists:[],failed:!1});function r(e){o((t=>({...t,...e})))}return{state:a,importResource:(0,l.useCallback)((function(a,o,i){void 0===o&&(o={}),void 0===i&&(i=!1),r({loading:!0,failed:!1});const l=new FormData;l.append("formData",a);const d=(0,c.t)("Please re-export your file and try importing again");return o&&l.append("passwords",JSON.stringify(o)),i&&l.append("overwrite","true"),s.Z.post({endpoint:`/api/v1/${e}/import/`,body:l,headers:{Accept:"application/json"}}).then((()=>(r({passwordsNeeded:[],alreadyExists:[],failed:!1}),!0))).catch((e=>(0,h.O$)(e).then((e=>(r({failed:!0}),e.errors?((0,u.Er)(e.errors)?n((0,c.t)("An error occurred while importing %s: %s",t,[...e.errors.map((e=>e.message)),d].join(".\n"))):r({passwordsNeeded:(0,u.$u)(e.errors),alreadyExists:(0,u.cE)(e.errors)}),!1):(n((0,c.t)("An error occurred while importing %s: %s",t,e.message||e.error)),!1)))))).finally((()=>{r({loading:!1})}))}),[])}}var y;!function(e){e.CHART="slice",e.DASHBOARD="Dashboard"}(y||(y={}));const _={chart:(0,d.Z)({requestType:"rison",method:"GET",endpoint:"/api/v1/chart/favorite_status/"}),dashboard:(0,d.Z)({requestType:"rison",method:"GET",endpoint:"/api/v1/dashboard/favorite_status/"})};function C(e,t,n){const[a,o]=(0,l.useState)({}),r=e=>o((t=>({...t,...e})));return(0,l.useEffect)((()=>{t.length&&_[e](t).then((e=>{let{result:t}=e;const n=t.reduce(((e,t)=>(e[t.id]=t.value,e)),{});r(n)}),(0,u.v$)((e=>n((0,c.t)("There was an error fetching the favorite status: %s",e)))))}),[t,e,n]),[(0,l.useCallback)(((t,a)=>{const o=a?"unselect":"select";s.Z.get({endpoint:`/superset/favstar/${"chart"===e?y.CHART:y.DASHBOARD}/${t}/${o}/`}).then((e=>{let{json:n}=e;r({[t]:(null==n?void 0:n.count)>0})}),(0,u.v$)((e=>n((0,c.t)("There was an error saving the favorite status: %s",e)))))}),[e]),a]}const Z=(e,t)=>{const[n,a]=(0,l.useState)(null);return{sliceCurrentlyEditing:n,handleChartUpdated:function(n){const a=t.map((e=>e.id===n.id?{...e,...n}:e));e(a)},openChartEditModal:function(e){a({slice_id:e.id,slice_name:e.slice_name,description:e.description,cache_timeout:e.cache_timeout,certified_by:e.certified_by,certification_details:e.certification_details,is_managed_externally:e.is_managed_externally})},closeChartEditModal:function(){a(null)}}},E=(e,t,n)=>{(0,p.Z)((()=>Promise.resolve(`${window.location.origin}/superset/sqllab?savedQueryId=${e}`))).then((()=>{n((0,c.t)("Link Copied!"))})).catch((()=>{t((0,c.t)("Sorry, your browser does not support copying."))}))},T=()=>m.Z.DB_IMAGES,S=()=>m.Z.DB_CONNECTION_ALERTS,x=()=>m.Z.DB_CONNECTION_DOC_LINKS,w=(e,t,n)=>{s.Z.post({endpoint:"api/v1/database/test_connection/",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((()=>{n((0,c.t)("Connection looks good!"))}),(0,u.v$)((e=>{t((0,c.t)("ERROR: %s",g(e)))})))};function A(){const[e,t]=(0,l.useState)(null);return[e,(0,l.useCallback)((()=>{s.Z.get({endpoint:"/api/v1/database/available/"}).then((e=>{let{json:n}=e;t(n)}))}),[t])]}function R(){const[e,t]=(0,l.useState)(null);return[e,(0,l.useCallback)((function(e,n){return void 0===n&&(n=!1),s.Z.post({endpoint:"/api/v1/database/validate_parameters/",body:JSON.stringify((a=e,a&&Array.isArray(null==a?void 0:a.catalog)?{...a,catalog:Object.assign({},...a.catalog.map((e=>({[e.name]:e.value}))))}:a)),headers:{"Content-Type":"application/json"}}).then((()=>{t(null)})).catch((e=>{if("function"==typeof e.json)return e.json().then((e=>{let{errors:a=[]}=e;const r=a.filter((e=>{var t;return!o()(t=["CONNECTION_MISSING_PARAMETERS_ERROR","CONNECTION_ACCESS_DENIED_ERROR"]).call(t,e.error_type)||n})).reduce(((e,t)=>{var n;let{error_type:a,extra:o,message:r}=t;return o.catalog?o.catalog.name?{...e,error_type:a,[o.catalog.idx]:{name:r}}:o.catalog.url?{...e,error_type:a,[o.catalog.idx]:{url:r}}:{...e,error_type:a,[o.catalog.idx]:{name:r,url:r}}:o.invalid?{...e,[o.invalid[0]]:r,error_type:a}:o.missing?{...e,error_type:a,...Object.assign({},...o.missing.map((e=>({[e]:"This is a required field"}))))}:null!=(n=o.issue_codes)&&n.length?{...e,error_type:a,description:r||(null==(i=o.issue_codes[0])?void 0:i.message)}:e;var i}),{});return t(r),r}));console.error(e)}));var a}),[t]),t]}const D=(e,t,n)=>{var a;return n?null==(a=e.reports[t])?void 0:a[n]:{}}},12:(e,t,n)=>{var a,o;n.d(t,{F:()=>a,J:()=>o}),function(e){e.Favorite="Favorite",e.Mine="Mine",e.Other="Other",e.Viewed="Viewed",e.Created="Created",e.Edited="Edited"}(a||(a={})),function(e){e.id="id",e.changed_on="changed_on",e.database="database",e.database_name="database.database_name",e.schema="schema",e.sql="sql",e.executed_sql="executed_sql",e.sql_tables="sql_tables",e.status="status",e.tab_name="tab_name",e.user="user",e.user_first_name="user.first_name",e.start_time="start_time",e.end_time="end_time",e.rows="rows",e.tmp_table_name="tmp_table_name",e.tracking_url="tracking_url"}(o||(o={}))},40768:(e,t,n)=>{n.d(t,{eX:()=>y,IV:()=>C,Ld:()=>E,B1:()=>T,xF:()=>S,tm:()=>x,wk:()=>w,v$:()=>A,Gm:()=>R,Iu:()=>D,IB:()=>O,iv:()=>M,mq:()=>L,_L:()=>N,ZB:()=>I,xL:()=>k,$u:()=>$,cE:()=>U,Er:()=>V,Mc:()=>j,if:()=>H});var a=n(25325),o=n.n(a),r=n(78580),i=n.n(r),l=n(51995),s=n(31069),c=n(55867),d=n(68492),u=n(11965),p=n(15926),h=n.n(p),m=n(98286),g=n(8911),v=n(12617),f=n(12),b=n(81568);(()=>{const e=h(),t=[];for(let e=0;e<16;e+=1)for(let n=0;n<16;n+=1){if(e+n===0)continue;const a=String.fromCharCode(16*e+n);/\w|[-_./~]/.test(a)||t.push(`\\u00${e.toString(16)}${n.toString(16)}`)}e.not_idchar=t.join(""),e.not_idstart="-0123456789";const n=`[^${e.not_idstart}${e.not_idchar}][^${e.not_idchar}]*`;e.id_ok=new RegExp(`^${n}$`),e.next_id=new RegExp(n,"g")})();const y=l.iK.div`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,_=e=>(t,n,a,o)=>async function(a,r,i){var l;void 0===a&&(a="");const c=`/api/v1/${t}/${e}/${n}`,d=h().encode_uri({filter:a,page:r,page_size:i}),{json:u={}}=await s.Z.get({endpoint:`${c}?q=${d}`});let p=!1;const m=o?{label:`${o.firstName} ${o.lastName}`,value:o.userId}:void 0,g=[];return null==u||null==(l=u.result)||l.filter((e=>{let{text:t}=e;return t.trim().length>0})).forEach((e=>{let{text:t,value:n}=e;m&&n===m.value&&t===m.label?p=!0:g.push({label:t,value:n})})),!m||a&&!p||g.unshift(m),{data:g,totalCount:null==u?void 0:u.count}},C=5,Z=e=>{const t={order_column:"changed_on_delta_humanized",order_direction:"desc",page:0,page_size:C,filters:e};return e||delete t.filters,h().encode(t)},E=e=>{const t={edited:[{col:"changed_by",opr:"rel_o_m",value:`${e}`}]},n=[s.Z.get({endpoint:`/api/v1/dashboard/?q=${Z(t.edited)}`}),s.Z.get({endpoint:`/api/v1/chart/?q=${Z(t.edited)}`})];return Promise.all(n).then((e=>{var t,n;let[a,o]=e;return{editedDash:null==(t=o.json)?void 0:t.result.slice(0,3),editedChart:null==(n=a.json)?void 0:n.result.slice(0,3)}})).catch((e=>e))},T=function(e,t,n){return void 0===n&&(n=[{col:"owners",opr:"rel_m_m",value:`${e}`}]),s.Z.get({endpoint:`/api/v1/${t}/?q=${Z(n)}`}).then((e=>{var t;return null==(t=e.json)?void 0:t.result}))},S=(e,t,n,a)=>s.Z.get({endpoint:t}).then((e=>{const t={},o=[s.Z.get({endpoint:`/api/v1/chart/?q=${Z(a)}`}),s.Z.get({endpoint:`/api/v1/dashboard/?q=${Z(a)}`})];return Promise.all(o).then((n=>{let[a,o]=n;return t.other=[...a.json.result,...o.json.result],t.viewed=e.json.result,t})).catch((e=>n((0,c.t)("There was an error fetching your recent activity:"),e)))})),x=_("related"),w=_("distinct");function A(e){return async t=>{const n=await(0,m.O$)(t),a=null==n?void 0:n.errors,o=await g.Z;null!=a&&a.length&&null!=o&&o.ERRORS&&a[0].error_type in o.ERRORS&&(n.message=o.ERRORS[a[0].error_type]),d.Z.error(t),e(n.message||n.error)}}function R(e,t,n,a,o,r){let{id:i,slice_name:l}=e;const d={pageIndex:0,pageSize:C,sortBy:[{id:"changed_on_delta_humanized",desc:!0}],filters:[{id:"created_by",operator:"rel_o_m",value:`${r}`}]};s.Z.delete({endpoint:`/api/v1/chart/${i}`}).then((()=>{"Mine"===o?a(d):a(),t((0,c.t)("Deleted: %s",l))}),(()=>{n((0,c.t)("There was an issue deleting: %s",l))}))}function D(e,t,n,a,o,r){let{id:i,dashboard_title:l}=e;return s.Z.delete({endpoint:`/api/v1/dashboard/${i}`}).then((()=>{"Mine"===o?t({pageIndex:0,pageSize:C,sortBy:[{id:"changed_on_delta_humanized",desc:!0}],filters:[{id:"owners",operator:"rel_m_m",value:`${r}`}]}):t(),n((0,c.t)("Deleted: %s",l))}),A((e=>a((0,c.t)("There was an issue deleting %s: %s",l,e)))))}function O(e,t){let n=e.split("\n");return n.length>=t&&(n=n.slice(0,t),n.push("...")),n.join("\n")}const M=5,L=[576,768,992,1200].map((e=>`@media (max-width: ${e}px)`)),N=l.iK.div`
  ${e=>{let{showThumbnails:t,theme:n}=e;return`\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${12*n.gridUnit}px ${4*n.gridUnit}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${t?"314":"148"}px;\n    margin-top: ${-6*n.gridUnit}px;\n    padding: ${t?`${8*n.gridUnit+3}px ${9*n.gridUnit}px`:`${8*n.gridUnit+1}px ${9*n.gridUnit}px`};\n  `}}
`,I=l.iK.div`
  cursor: pointer;
  a {
    text-decoration: none;
  }
  .ant-card-cover > div {
    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */
    height: 168px;
  }
`,k=e=>u.iv`
  margin: auto ${2*e.gridUnit}px auto 0;
  color: ${e.colors.grayscale.base};
`,F=e=>"object"==typeof e&&Array.isArray(e._schema)&&1===e._schema.length&&"Must provide a password for the database"===e._schema[0],P=e=>"string"==typeof e&&i()(e).call(e,"already exists and `overwrite=true` was not passed"),$=e=>e.map((e=>Object.entries(e.extra).filter((e=>{let[,t]=e;return F(t)})).map((e=>{let[t]=e;return t})))).flat(),U=e=>e.map((e=>Object.entries(e.extra).filter((e=>{let[,t]=e;return P(t)})).map((e=>{let[t]=e;return t})))).flat(),V=e=>e.some((e=>{const t=Object.entries(e.extra).filter((e=>{let[t]=e;return"issue_codes"!==t}));return 0===t.length||!t.every((e=>{let[,t]=e;return F(t)||P(t)}))})),q=(e,t)=>void 0!==e&&o()(e,t).length>0,j=(e,t,n,a,o)=>{const r=(0,v.R)("can_this_form_get","CsvToDatabaseView",e)&&q(t,o),i=q(n,o)&&(0,v.R)("can_this_form_get","ColumnarToDatabaseView",e),l=q(a,o)&&(0,v.R)("can_this_form_get","ExcelToDatabaseView",e);return{canUploadCSV:r,canUploadColumnar:i,canUploadExcel:l,canUploadData:r||i||l}};function H(e,t,n,a){var o;return e===f.F.Created||t===b.g.SavedQueries&&e===f.F.Mine?[{id:"created_by",operator:"rel_o_m",value:`${null==n?void 0:n.userId}`}]:t===b.g.SavedQueries&&e===f.F.Favorite?[{id:"id",operator:"saved_query_is_fav",value:!0}]:e===f.F.Mine&&n?[{id:"owners",operator:"rel_m_m",value:`${n.userId}`}]:e===f.F.Favorite&&i()(o=[b.g.Dashboards,b.g.Charts]).call(o,t)?[{id:"id",operator:t===b.g.Dashboards?"dashboard_is_favorite":"chart_is_favorite",value:!0}]:e===f.F.Other?(a||[]).map((e=>({id:e.col,operator:e.opr,value:e.value}))):[]}},81568:(e,t,n)=>{var a;n.d(t,{g:()=>a}),function(e){e.Charts="CHARTS",e.Dashboards="DASHBOARDS",e.Recents="RECENTS",e.SavedQueries="SAVED_QUERIES"}(a||(a={}))}}]);
//# sourceMappingURL=7243.d7b079bcdc8dc0d868ac.entry.js.map