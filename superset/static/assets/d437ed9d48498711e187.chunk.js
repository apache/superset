"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8551],{88551:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r=n(78580),l=n.n(r),a=n(67294),s=n(16355),o=n(5364),c=n(63475),u=n(6915),i=n(51995),d=n(356),h=n(49239),f=n(11965);const{RadioButtonControl:g}=d.Z,p=i.iK.div`
  text-align: center;
`;function m(e){let{formData:t,setControlValue:n}=e;const{extraControlsOptions:r,extraControlsHandler:l,extraValue:s}=function(e){let{formData:t,setControlValue:n}=e;const{stack:r,area:l}=t,[s,o]=(0,a.useState)(null!=r?r:void 0);return(0,a.useEffect)((()=>{o(r)}),[r]),{extraControlsOptions:(0,a.useMemo)((()=>l?h.O0:[]),[l]),extraControlsHandler:(0,a.useCallback)((e=>{l&&n&&(n("stack",e),o(e))}),[l,n]),extraValue:s}}({formData:t,setControlValue:n});return t.showExtraControls?(0,f.tZ)(p,null,(0,f.tZ)(g,{options:r,onChange:l,value:s})):null}function v(e){let{formData:t,height:n,width:r,echartOptions:i,groupby:d,labelMap:h,selectedValues:g,setDataMask:p,setControlValue:v,legendData:C=[],onContextMenu:b,xValueFormatter:w,xAxis:k,refs:x,emitCrossFilters:y}=e;const{stack:E}=t,V=(0,a.useRef)(null);x.echartRef=V;const I=(0,a.useRef)(Date.now()),S=(0,a.useRef)(""),O=(0,a.useRef)(),R=(0,a.useRef)(null),[Z,D]=(0,a.useState)(0);(0,a.useEffect)((()=>{var e;const t=(null==(e=R.current)?void 0:e.offsetHeight)||0;D(t)}),[t.showExtraControls]);const H=(0,a.useCallback)((e=>{var t;const n=null==(t=V.current)?void 0:t.getEchartInstance();e?C.forEach((t=>{t===e?(u.aI.legend=t,null==n||n.dispatchAction({type:"legendSelect",name:t})):null==n||n.dispatchAction({type:"legendUnSelect",name:t})})):(u.aI.legend="",null==n||n.dispatchAction({type:"legendAllSelect"}))}),[C]),M=(0,a.useCallback)((e=>{const t=Object.values(g);let n;n=l()(t).call(t,e)?t.filter((t=>t!==e)):[e];const r=n.map((e=>h[e]));return{dataMask:{extraFormData:{filters:0===n.length?[]:d.map(((e,t)=>{const n=r.map((e=>e[t]));return null==n?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:n}}))},filterState:{label:r.length?r:void 0,value:r.length?r:null,selectedValues:n.length?n:null}},isCurrentValueSelected:l()(t).call(t,e)}}),[d,h,g]),A=(0,a.useCallback)((e=>{y&&p(M(e).dataMask)}),[y,p,M]),T={click:e=>{O.current&&clearTimeout(O.current),O.current=setTimeout((()=>{const{seriesName:t}=e;A(t)}),300)},mouseout:()=>{u.aI.name=""},mouseover:e=>{u.aI.name=e.seriesName},legendselectchanged:e=>{const t=Date.now();t-I.current<300&&S.current===e.name?H(e.name):(I.current=t,S.current=e.name),Object.values(e.selected).every((e=>!e))&&H()},contextmenu:e=>{if(b){e.event.stop();const{data:n,seriesName:r}=e,l=[],a=e.event.event,c=[...e.name?[e.name]:[],...h[e.seriesName]];n&&(k.type===s.we.time&&l.push({col:k.label===o.W3?t.granularitySqla:k.label,grain:t.timeGrainSqla,op:"==",val:n[0],formattedVal:w(n[0])}),[...k.type===s.we.category?[k.label]:[],...t.groupby].forEach(((e,t)=>l.push({col:e,op:"==",val:c[t],formattedVal:String(c[t])})))),b(a.clientX,a.clientY,{drillToDetail:l,crossFilter:M(r)})}}},N={dblclick:e=>{var t;O.current&&clearTimeout(O.current);const n=[e.offsetX,e.offsetY],r=null==(t=V.current)?void 0:t.getEchartInstance();if(null!=r&&r.containPixel("grid",n)){var l;if(!E&&"ec-polygon"===(null==(l=e.target)?void 0:l.type))return;const t=r.getModel(),n=((e,t)=>{let n=e,r=null;for(;n;){const e=n.__ecComponentInfo;if(null!=e){r=t.getComponent(e.mainType,e.index);break}n=n.parent}return r})(e.target,t),a=t.getSeriesCount(),s=t.getCurrentSeriesIndices();if(n){const{name:e}=n;a!==s.length?H():H(e)}}}};return(0,f.tZ)(a.Fragment,null,(0,f.tZ)("div",{ref:R},(0,f.tZ)(m,{formData:t,setControlValue:v})),(0,f.tZ)(c.Z,{refs:x,height:n-Z,width:r,echartOptions:i,eventHandlers:T,zrEventHandlers:N,selectedValues:g}))}},63475:(e,t,n)=>{n.d(t,{Z:()=>d});var r=n(78580),l=n.n(r),a=n(67294),s=n(51995),o=n(31431),c=n(11965);const u=s.iK.div`
  height: ${e=>{let{height:t}=e;return t}};
  width: ${e=>{let{width:t}=e;return t}};
`;function i(e,t){let{width:n,height:r,echartOptions:s,eventHandlers:i,zrEventHandlers:d,selectedValues:h={},refs:f}=e;const g=(0,a.useRef)(null);f&&(f.divRef=g);const p=(0,a.useRef)(),m=(0,a.useMemo)((()=>Object.keys(h)||[]),[h]),v=(0,a.useRef)([]);(0,a.useImperativeHandle)(t,(()=>({getEchartInstance:()=>p.current}))),(0,a.useEffect)((()=>{g.current&&(p.current||(p.current=(0,o.S1)(g.current)),Object.entries(i||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=p.current)||t.off(r),null==(n=p.current)||n.on(r,l)})),Object.entries(d||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=p.current)||t.getZr().off(r),null==(n=p.current)||n.getZr().on(r,l)})),p.current.setOption(s,!0))}),[s,i,d]),(0,a.useEffect)((()=>{p.current&&(p.current.dispatchAction({type:"downplay",dataIndex:v.current.filter((e=>!l()(m).call(m,e)))}),m.length&&p.current.dispatchAction({type:"highlight",dataIndex:m}),v.current=m)}),[m]);const C=(0,a.useCallback)((e=>{let{width:t,height:n}=e;p.current&&p.current.resize({width:t,height:n})}),[]);return(0,a.useEffect)((()=>(C({width:n,height:r}),()=>{var e;return null==(e=p.current)?void 0:e.dispose()})),[]),(0,a.useLayoutEffect)((()=>{C({width:n,height:r})}),[n,r,C]),(0,c.tZ)(u,{ref:g,height:r,width:n})}const d=(0,a.forwardRef)(i)}}]);
//# sourceMappingURL=d437ed9d48498711e187.chunk.js.map
