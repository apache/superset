{"version":3,"file":"d437ed9d48498711e187.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/plugin-chart-echarts/src/components/ExtraControls.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/Timeseries/EchartsTimeseries.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/components/Echart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { HandlerFunction, JsonValue, styled } from '@superset-ui/core';\nimport {\n  RadioButtonOption,\n  sharedControlComponents,\n} from '@superset-ui/chart-controls';\nimport { AreaChartExtraControlsOptions } from '../constants';\n\nconst { RadioButtonControl } = sharedControlComponents;\n\nconst ExtraControlsWrapper = styled.div`\n  text-align: center;\n`;\n\nexport function useExtraControl<\n  F extends {\n    stack: any;\n    area: boolean;\n  },\n>({\n  formData,\n  setControlValue,\n}: {\n  formData: F;\n  setControlValue?: HandlerFunction;\n}) {\n  const { stack, area } = formData;\n  const [extraValue, setExtraValue] = useState<JsonValue | undefined>(\n    stack ?? undefined,\n  );\n\n  useEffect(() => {\n    setExtraValue(stack);\n  }, [stack]);\n\n  const extraControlsOptions = useMemo(() => {\n    if (area) {\n      return AreaChartExtraControlsOptions;\n    }\n    return [];\n  }, [area]);\n\n  const extraControlsHandler = useCallback(\n    (value: RadioButtonOption[0]) => {\n      if (area) {\n        if (setControlValue) {\n          setControlValue('stack', value);\n          setExtraValue(value);\n        }\n      }\n    },\n    [area, setControlValue],\n  );\n\n  return {\n    extraControlsOptions,\n    extraControlsHandler,\n    extraValue,\n  };\n}\n\nexport function ExtraControls<\n  F extends {\n    stack: any;\n    area: boolean;\n    showExtraControls: boolean;\n  },\n>({\n  formData,\n  setControlValue,\n}: {\n  formData: F;\n  setControlValue?: HandlerFunction;\n}) {\n  const { extraControlsOptions, extraControlsHandler, extraValue } =\n    useExtraControl<F>({\n      formData,\n      setControlValue,\n    });\n\n  if (!formData.showExtraControls) {\n    return null;\n  }\n\n  return (\n    <ExtraControlsWrapper>\n      <RadioButtonControl\n        options={extraControlsOptions}\n        onChange={extraControlsHandler}\n        value={extraValue}\n      />\n    </ExtraControlsWrapper>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport {\n  DTTM_ALIAS,\n  BinaryQueryObjectFilterClause,\n  AxisType,\n} from '@superset-ui/core';\nimport { ViewRootGroup } from 'echarts/types/src/util/types';\nimport GlobalModel from 'echarts/types/src/model/Global';\nimport ComponentModel from 'echarts/types/src/model/Component';\nimport { EchartsHandler, EventHandlers } from '../types';\nimport Echart from '../components/Echart';\nimport { TimeseriesChartTransformedProps } from './types';\nimport { currentSeries } from '../utils/series';\nimport { ExtraControls } from '../components/ExtraControls';\n\nconst TIMER_DURATION = 300;\n\n// @ts-ignore\nexport default function EchartsTimeseries({\n  formData,\n  height,\n  width,\n  echartOptions,\n  groupby,\n  labelMap,\n  selectedValues,\n  setDataMask,\n  setControlValue,\n  legendData = [],\n  onContextMenu,\n  xValueFormatter,\n  xAxis,\n  refs,\n  emitCrossFilters,\n}: TimeseriesChartTransformedProps) {\n  const { stack } = formData;\n  const echartRef = useRef<EchartsHandler | null>(null);\n  // eslint-disable-next-line no-param-reassign\n  refs.echartRef = echartRef;\n  const lastTimeRef = useRef(Date.now());\n  const lastSelectedLegend = useRef('');\n  const clickTimer = useRef<ReturnType<typeof setTimeout>>();\n  const extraControlRef = useRef<HTMLDivElement>(null);\n  const [extraControlHeight, setExtraControlHeight] = useState(0);\n  useEffect(() => {\n    const updatedHeight = extraControlRef.current?.offsetHeight || 0;\n    setExtraControlHeight(updatedHeight);\n  }, [formData.showExtraControls]);\n\n  const handleDoubleClickChange = useCallback(\n    (name?: string) => {\n      const echartInstance = echartRef.current?.getEchartInstance();\n      if (!name) {\n        currentSeries.legend = '';\n        echartInstance?.dispatchAction({\n          type: 'legendAllSelect',\n        });\n      } else {\n        legendData.forEach(datum => {\n          if (datum === name) {\n            currentSeries.legend = datum;\n            echartInstance?.dispatchAction({\n              type: 'legendSelect',\n              name: datum,\n            });\n          } else {\n            echartInstance?.dispatchAction({\n              type: 'legendUnSelect',\n              name: datum,\n            });\n          }\n        });\n      }\n    },\n    [legendData],\n  );\n\n  const getModelInfo = (target: ViewRootGroup, globalModel: GlobalModel) => {\n    let el = target;\n    let model: ComponentModel | null = null;\n    while (el) {\n      // eslint-disable-next-line no-underscore-dangle\n      const modelInfo = el.__ecComponentInfo;\n      if (modelInfo != null) {\n        model = globalModel.getComponent(modelInfo.mainType, modelInfo.index);\n        break;\n      }\n      el = el.parent;\n    }\n    return model;\n  };\n\n  const getCrossFilterDataMask = useCallback(\n    (value: string) => {\n      const selected: string[] = Object.values(selectedValues);\n      let values: string[];\n      if (selected.includes(value)) {\n        values = selected.filter(v => v !== value);\n      } else {\n        values = [value];\n      }\n      const groupbyValues = values.map(value => labelMap[value]);\n      return {\n        dataMask: {\n          extraFormData: {\n            filters:\n              values.length === 0\n                ? []\n                : groupby.map((col, idx) => {\n                    const val = groupbyValues.map(v => v[idx]);\n                    if (val === null || val === undefined)\n                      return {\n                        col,\n                        op: 'IS NULL' as const,\n                      };\n                    return {\n                      col,\n                      op: 'IN' as const,\n                      val: val as (string | number | boolean)[],\n                    };\n                  }),\n          },\n          filterState: {\n            label: groupbyValues.length ? groupbyValues : undefined,\n            value: groupbyValues.length ? groupbyValues : null,\n            selectedValues: values.length ? values : null,\n          },\n        },\n        isCurrentValueSelected: selected.includes(value),\n      };\n    },\n    [groupby, labelMap, selectedValues],\n  );\n\n  const handleChange = useCallback(\n    (value: string) => {\n      if (!emitCrossFilters) {\n        return;\n      }\n      setDataMask(getCrossFilterDataMask(value).dataMask);\n    },\n    [emitCrossFilters, setDataMask, getCrossFilterDataMask],\n  );\n\n  const eventHandlers: EventHandlers = {\n    click: props => {\n      if (clickTimer.current) {\n        clearTimeout(clickTimer.current);\n      }\n      // Ensure that double-click events do not trigger single click event. So we put it in the timer.\n      clickTimer.current = setTimeout(() => {\n        const { seriesName: name } = props;\n        handleChange(name);\n      }, TIMER_DURATION);\n    },\n    mouseout: () => {\n      currentSeries.name = '';\n    },\n    mouseover: params => {\n      currentSeries.name = params.seriesName;\n    },\n    legendselectchanged: payload => {\n      const currentTime = Date.now();\n      // TIMER_DURATION is the interval between two legendselectchanged event\n      if (\n        currentTime - lastTimeRef.current < TIMER_DURATION &&\n        lastSelectedLegend.current === payload.name\n      ) {\n        // execute dbclick\n        handleDoubleClickChange(payload.name);\n      } else {\n        lastTimeRef.current = currentTime;\n        // remember last selected legend\n        lastSelectedLegend.current = payload.name;\n      }\n      // if all legend is unselected, we keep all selected\n      if (Object.values(payload.selected).every(i => !i)) {\n        handleDoubleClickChange();\n      }\n    },\n    contextmenu: eventParams => {\n      if (onContextMenu) {\n        eventParams.event.stop();\n        const { data, seriesName } = eventParams;\n        const drillToDetailFilters: BinaryQueryObjectFilterClause[] = [];\n        const pointerEvent = eventParams.event.event;\n        const values = [\n          ...(eventParams.name ? [eventParams.name] : []),\n          ...labelMap[eventParams.seriesName],\n        ];\n        if (data) {\n          if (xAxis.type === AxisType.time) {\n            drillToDetailFilters.push({\n              col:\n                // if the xAxis is '__timestamp', granularity_sqla will be the column of filter\n                xAxis.label === DTTM_ALIAS\n                  ? formData.granularitySqla\n                  : xAxis.label,\n              grain: formData.timeGrainSqla,\n              op: '==',\n              val: data[0],\n              formattedVal: xValueFormatter(data[0]),\n            });\n          }\n          [\n            ...(xAxis.type === AxisType.category ? [xAxis.label] : []),\n            ...formData.groupby,\n          ].forEach((dimension, i) =>\n            drillToDetailFilters.push({\n              col: dimension,\n              op: '==',\n              val: values[i],\n              formattedVal: String(values[i]),\n            }),\n          );\n        }\n        onContextMenu(pointerEvent.clientX, pointerEvent.clientY, {\n          drillToDetail: drillToDetailFilters,\n          crossFilter: getCrossFilterDataMask(seriesName),\n        });\n      }\n    },\n  };\n\n  const zrEventHandlers: EventHandlers = {\n    dblclick: params => {\n      // clear single click timer\n      if (clickTimer.current) {\n        clearTimeout(clickTimer.current);\n      }\n      const pointInPixel = [params.offsetX, params.offsetY];\n      const echartInstance = echartRef.current?.getEchartInstance();\n      if (echartInstance?.containPixel('grid', pointInPixel)) {\n        // do not trigger if click unstacked chart's blank area\n        if (!stack && params.target?.type === 'ec-polygon') return;\n        // @ts-ignore\n        const globalModel = echartInstance.getModel();\n        const model = getModelInfo(params.target, globalModel);\n        const seriesCount = globalModel.getSeriesCount();\n        const currentSeriesIndices = globalModel.getCurrentSeriesIndices();\n        if (model) {\n          const { name } = model;\n          if (seriesCount !== currentSeriesIndices.length) {\n            handleDoubleClickChange();\n          } else {\n            handleDoubleClickChange(name);\n          }\n        }\n      }\n    },\n  };\n\n  return (\n    <>\n      <div ref={extraControlRef}>\n        <ExtraControls formData={formData} setControlValue={setControlValue} />\n      </div>\n      <Echart\n        refs={refs}\n        height={height - extraControlHeight}\n        width={width}\n        echartOptions={echartOptions}\n        eventHandlers={eventHandlers}\n        zrEventHandlers={zrEventHandlers}\n        selectedValues={selectedValues}\n      />\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useCallback,\n} from 'react';\nimport { styled } from '@superset-ui/core';\nimport { ECharts, init } from 'echarts';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n    refs,\n  }: EchartsProps,\n  ref: React.Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  if (refs) {\n    // eslint-disable-next-line no-param-reassign\n    refs.divRef = divRef;\n  }\n  const chartRef = useRef<ECharts>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      if (chartRef.current) {\n        chartRef.current.resize({ width, height });\n      }\n    },\n    [],\n  );\n\n  // did mount\n  useEffect(() => {\n    handleSizeChange({ width, height });\n    return () => chartRef.current?.dispose();\n  }, []);\n\n  useLayoutEffect(() => {\n    handleSizeChange({ width, height });\n  }, [width, height, handleSizeChange]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n"],"names":["RadioButtonControl","sharedControlComponents","ExtraControlsWrapper","styled","ExtraControls","formData","setControlValue","extraControlsOptions","extraControlsHandler","extraValue","stack","area","setExtraValue","useState","undefined","useEffect","useMemo","AreaChartExtraControlsOptions","useCallback","value","useExtraControl","showExtraControls","options","onChange","EchartsTimeseries","height","width","echartOptions","groupby","labelMap","selectedValues","setDataMask","legendData","onContextMenu","xValueFormatter","xAxis","refs","emitCrossFilters","echartRef","useRef","lastTimeRef","Date","now","lastSelectedLegend","clickTimer","extraControlRef","extraControlHeight","setExtraControlHeight","updatedHeight","current","offsetHeight","handleDoubleClickChange","name","echartInstance","getEchartInstance","forEach","datum","currentSeries","dispatchAction","type","getCrossFilterDataMask","selected","Object","values","filter","v","groupbyValues","map","dataMask","extraFormData","filters","length","col","idx","val","op","filterState","label","isCurrentValueSelected","handleChange","eventHandlers","click","props","clearTimeout","setTimeout","seriesName","mouseout","mouseover","params","legendselectchanged","payload","currentTime","every","i","contextmenu","eventParams","event","stop","data","drillToDetailFilters","pointerEvent","AxisType","push","DTTM_ALIAS","granularitySqla","grain","timeGrainSqla","formattedVal","dimension","String","clientX","clientY","drillToDetail","crossFilter","zrEventHandlers","dblclick","pointInPixel","offsetX","offsetY","containPixel","target","globalModel","getModel","model","el","modelInfo","__ecComponentInfo","getComponent","mainType","index","parent","getModelInfo","seriesCount","getSeriesCount","currentSeriesIndices","getCurrentSeriesIndices","ref","Echart","Styles","divRef","chartRef","currentSelection","keys","previousSelection","useImperativeHandle","init","entries","handler","off","on","getZr","setOption","dataIndex","handleSizeChange","resize","dispose","useLayoutEffect","forwardRef"],"sourceRoot":""}