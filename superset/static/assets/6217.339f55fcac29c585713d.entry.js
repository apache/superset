"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[6217],{82607:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(5872),l=a.n(n),o=(a(67294),a(51995)),s=a(62529),r=a(11965);const i=(0,o.iK)((e=>{let{textColor:t,color:a,text:n,...o}=e;return(0,r.tZ)(s.Z,l()({text:n,color:n?a:void 0},o))}))`
  & > sup {
    padding: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    background: ${e=>{let{theme:t,color:a}=e;return a||t.colors.primary.base}};
    color: ${e=>{let{theme:t,textColor:a}=e;return a||t.colors.grayscale.light5}};
  }
`},73995:(e,t,a)=>{a.d(t,{Z:()=>S});var n=a(67294),l=a(51995),o=a(31069),s=a(55867),r=a(15926),i=a.n(r),d=a(4715),c=a(37921),u=a(49238),m=a(40277),h=a(14114),b=a(42582),p=a(11965);const f=l.iK.div`
  ${e=>{let{theme:t}=e;return`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${t.gridUnit}px;\n      margin-top: ${5*t.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .select {\n      width: calc(100% - 30px - ${t.gridUnit}px);\n      flex: 1;\n    }\n\n    & > div {\n      margin-bottom: ${4*t.gridUnit}px;\n    }\n  `}}
`,v=l.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-left: ${e=>{let{theme:t}=e;return t.gridUnit-2}}px;

  .backend {
    overflow: visible;
  }

  .name {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,g=e=>{let{backend:t,databaseName:a}=e;return(0,p.tZ)(v,null,(0,p.tZ)(c.Z,{className:"backend"},t),(0,p.tZ)("span",{className:"name",title:a},a))},Z=[];function S(e){let{db:t,formMode:a=!1,emptyState:l,getDbList:r,handleError:c,isDatabaseSelectEnabled:v=!0,onDbChange:S,onEmptyResults:x,onSchemaChange:y,onSchemasLoad:w,readOnly:_=!1,schema:$,sqlLabMode:C=!1}=e;const[k,E]=(0,n.useState)(),[L,I]=(0,n.useState)($?{label:$,value:$,title:$}:void 0),{addSuccessToast:N}=(0,h.e1)(),M=(0,n.useMemo)((()=>async(e,t,n)=>{const l=`/api/v1/database/?q=${i().encode({order_columns:"database_name",order_direction:"asc",page:t,page_size:n,...a||!C?{filters:[{col:"database_name",opr:"ct",value:e}]}:{filters:[{col:"database_name",opr:"ct",value:e},{col:"expose_in_sqllab",opr:"eq",value:!0}]}})}`;return o.Z.get({endpoint:l}).then((t=>{let{json:a}=t;const{result:n}=a;r&&r(n),0===n.length&&x&&x(e);const l=n.map((e=>({label:(0,p.tZ)(g,{backend:e.backend,databaseName:e.database_name}),value:e.id,id:e.id,database_name:e.database_name,backend:e.backend})));return{data:l,totalCount:l.length}}))}),[a,r,C]);function R(e){I(e),y&&y(null==e?void 0:e.value)}(0,n.useEffect)((()=>{E((e=>(null==e?void 0:e.id)!==(null==t?void 0:t.id)?t?{label:(0,p.tZ)(g,{backend:t.backend,databaseName:t.database_name}),value:t.id,...t}:void 0:e))}),[t]);const{data:U,isFetching:q,isFetched:D,refetch:F}=(0,b.Xx)({dbId:null==k?void 0:k.value,onSuccess:e=>{null==w||w(e),1===e.length?R(e[0]):e.find((e=>$===e.value))||R(void 0),D&&N("List refreshed")},onError:()=>c((0,s.t)("There was an error loading the schemas"))}),T=U||Z;function z(e,t){return(0,p.tZ)("div",{className:"section"},(0,p.tZ)("span",{className:"select"},e),(0,p.tZ)("span",{className:"refresh"},t))}return(0,p.tZ)(f,null,z((0,p.tZ)(d.qb,{ariaLabel:(0,s.t)("Select database or type database name"),optionFilterProps:["database_name","value"],header:(0,p.tZ)(u.lX,null,(0,s.t)("Database")),lazyLoading:!1,notFoundContent:l,onChange:function(e,t){E(t),I(void 0),S&&S(t),y&&y(void 0)},value:k,placeholder:(0,s.t)("Select database or type database name"),disabled:!v||_,options:M}),null),function(){const e=!_&&(0,p.tZ)(m.Z,{onClick:()=>F(),tooltipContent:(0,s.t)("Force refresh schema list")});return z((0,p.tZ)(d.Ph,{ariaLabel:(0,s.t)("Select schema or type schema name"),disabled:!k||_,header:(0,p.tZ)(u.lX,null,(0,s.t)("Schema")),labelInValue:!0,loading:q,name:"select-schema",notFoundContent:(0,s.t)("No compatible schema found"),placeholder:(0,s.t)("Select schema or type schema name"),onChange:e=>R(e),options:T,showSearch:!0,value:L}),e)}())}},40277:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(67294),l=a(58593),o=a(70163),s=a(11965);const r=e=>{let{onClick:t,tooltipContent:a}=e;const r=(0,n.forwardRef)(((e,t)=>(0,s.tZ)(o.Z.Refresh,e)));return(0,s.tZ)(l.u,{title:a},(0,s.tZ)(r,{role:"button",onClick:t,css:e=>({cursor:"pointer",color:e.colors.grayscale.base,"&:hover":{color:e.colors.primary.base}})}))}},17982:(e,t,a)=>{a.d(t,{ez:()=>w,PH:()=>$,ZP:()=>C});var n=a(5872),l=a.n(n),o=a(78580),s=a.n(o),r=a(67294),i=a(51995),d=a(55867),c=a(4715),u=a(49238),m=a(70163),h=a(73995),b=a(40277),p=a(79789),f=a(86057),v=a(14114),g=a(42582),Z=a(98286),S=a(11965);const x=i.iK.div`
  ${e=>{let{theme:t}=e;return`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${t.gridUnit}px;\n      margin-top: ${5*t.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${t.colors.secondary.light5};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${t.colors.grayscale.light1};\n    }\n\n    .select {\n      flex: 1;\n      max-width: calc(100% - ${t.gridUnit+30}px)\n    }\n  `}}
`,y=i.iK.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,w=e=>{let{table:t}=e;const{value:a,type:n,extra:l}=t;return(0,S.tZ)(y,{title:a},"view"===n?(0,S.tZ)(m.Z.Eye,{iconSize:"m"}):(0,S.tZ)(m.Z.Table,{iconSize:"m"}),(null==l?void 0:l.certification)&&(0,S.tZ)(p.Z,{certifiedBy:l.certification.certified_by,details:l.certification.details,size:"l"}),(null==l?void 0:l.warning_markdown)&&(0,S.tZ)(f.Z,{warningMarkdown:l.warning_markdown,size:"l"}),a)},_=e=>{let{database:t,emptyState:a,formMode:n=!1,getDbList:l,handleError:o,isDatabaseSelectEnabled:i=!0,onDbChange:m,onSchemaChange:p,onSchemasLoad:f,onTablesLoad:y,readOnly:_=!1,onEmptyResults:$,schema:C,sqlLabMode:k=!0,tableSelectMode:E="single",tableValue:L,onTableSelectChange:I}=e;const{addSuccessToast:N}=(0,v.e1)(),[M,R]=(0,r.useState)(C),[U,q]=(0,r.useState)(void 0),{data:D,isFetching:F,isFetched:T,refetch:z}=(0,g.zA)({dbId:null==t?void 0:t.id,schema:M,onSuccess:()=>{T&&N((0,d.t)("List updated"))},onError:e=>{(0,Z.O$)(e).then((e=>{o((0,Z.d7)((0,d.t)("There was an error loading the tables"),e))}))}});(0,r.useEffect)((()=>{D&&T&&(null==y||y(D.options))}),[D,T,y]);const j=(0,r.useMemo)((()=>D?D.options.map((e=>({value:e.value,label:(0,S.tZ)(w,{table:e}),text:e.value}))):[]),[D]);(0,r.useEffect)((()=>{void 0===t&&(R(void 0),q(void 0))}),[t,E]),(0,r.useEffect)((()=>{q("single"===E?j.find((e=>e.value===L)):(null==j?void 0:j.filter((e=>e&&(null==L?void 0:s()(L).call(L,e.value)))))||[])}),[j,L,E]);const O=e=>{M?null==I||I(Array.isArray(e)?e.map((e=>null==e?void 0:e.value)):null==e?void 0:e.value,M):q(e)},X=(0,r.useMemo)((()=>(e,t)=>{var a;const n=e.trim().toLowerCase(),{text:l}=t;return s()(a=l.toLowerCase()).call(a,n)}),[]);return(0,S.tZ)(x,null,(0,S.tZ)(h.Z,{db:t,emptyState:a,formMode:n,getDbList:l,handleError:o,onDbChange:_?void 0:e=>{m&&m(e)},onEmptyResults:$,onSchemaChange:_?void 0:e=>{R(e),p&&p(e),O("single"===E?void 0:[])},onSchemasLoad:f,schema:M,sqlLabMode:k,isDatabaseSelectEnabled:i&&!_,readOnly:_}),k&&!n&&(0,S.tZ)("div",{className:"divider"}),function(){const e=M&&!n&&_||!M,t=k?(0,S.tZ)(u.lX,null,(0,d.t)("See table schema")):(0,S.tZ)(u.lX,null,(0,d.t)("Table"));return a=(0,S.tZ)(c.Ph,{ariaLabel:(0,d.t)("Select table or type table name"),disabled:e,filterOption:X,header:t,labelInValue:!0,loading:F,name:"select-table",onChange:e=>O(e),options:j,placeholder:(0,d.t)("Select table or type table name"),showSearch:!0,mode:E,value:U,allowClear:"multiple"===E}),l=!_&&(0,S.tZ)(b.Z,{onClick:()=>z(),tooltipContent:(0,d.t)("Force refresh table list")}),(0,S.tZ)("div",{className:"section"},(0,S.tZ)("span",{className:"select"},a),(0,S.tZ)("span",{className:"refresh"},l));var a,l}())},$=e=>(0,S.tZ)(_,l()({tableSelectMode:"multiple"},e)),C=_},42582:(e,t,a)=>{a.d(t,{s_:()=>n.s_,hb:()=>i,QU:()=>d,Es:()=>c,JL:()=>u,Xx:()=>p,zA:()=>f});var n=a(42190),l=a(15926),o=a.n(l);function s(e){let{owners:t}=e;return t?t.map((e=>`${e.first_name} ${e.last_name}`)):null}const r=o().encode({columns:["owners.first_name","owners.last_name"],keys:["none"]});function i(e){return(0,n.l6)((0,n.s_)(`/api/v1/chart/${e}?q=${r}`),s)}const d=e=>(0,n.l6)((0,n.s_)(`/api/v1/dashboard/${e}`),(e=>({...e,metadata:e.json_metadata&&JSON.parse(e.json_metadata)||{},position_data:e.position_json&&JSON.parse(e.position_json)}))),c=e=>(0,n.s_)(`/api/v1/dashboard/${e}/charts`),u=e=>(0,n.s_)(`/api/v1/dashboard/${e}/datasets`);var m=a(67294),h=a(78926),b=a(31069);function p(e){const{dbId:t,onSuccess:a,onError:n}=e||{},l=(0,m.useRef)(!1),s={dbId:t},r=(0,h.useQuery)(["schemas",{dbId:t}],(()=>function(e){let{dbId:t,forceRefresh:a}=e;const n=`/api/v1/database/${t}/schemas/?q=${o().encode({force:a})}`;return b.Z.get({endpoint:n})}({...s,forceRefresh:l.current})),{select:e=>{let{json:t}=e;return t.result.map((e=>({value:e,label:e,title:e})))},enabled:Boolean(t),onSuccess:a,onError:n,onSettled:()=>{l.current=!1}});return{...r,refetch:()=>(l.current=!0,r.refetch())}}function f(e){const{data:t,isFetching:a}=p({dbId:e.dbId}),n=(0,m.useMemo)((()=>new Set(null==t?void 0:t.map((e=>{let{value:t}=e;return t})))),[t]),{dbId:l,schema:s,onSuccess:r,onError:i}=e||{},d=(0,m.useRef)(!1),c={dbId:l,schema:s},u=(0,h.useQuery)(["tables",{dbId:l,schema:s}],(()=>function(e){let{dbId:t,schema:a,forceRefresh:n}=e;const l=a?encodeURIComponent(a):"",s=`/api/v1/database/${null!=t?t:"undefined"}/tables/?q=${o().encode({force:n,schema_name:l})}`;return b.Z.get({endpoint:s})}({...c,forceRefresh:d.current})),{select:e=>{let{json:t}=e;return{options:t.result,hasMore:t.count>t.result.length}},enabled:Boolean(l&&s&&!a&&n.has(s)),onSuccess:r,onError:i,onSettled:()=>{d.current=!1}});return{...u,refetch:()=>(d.current=!0,u.refetch())}}}}]);
//# sourceMappingURL=6217.339f55fcac29c585713d.entry.js.map