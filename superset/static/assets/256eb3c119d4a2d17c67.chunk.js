"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4502],{30075:(e,a,t)=>{t.r(a),t.d(a,{default:()=>T});var l=t(51995),o=t(55867),n=t(31069),s=t(67294),r=t(15926),d=t.n(r),i=t(28216),c=t(35755),u=t(61337),b=t(38703),p=t(91877),_=t(93185),m=t(34858),h=t(40768),Z=t(14114),f=t(20755),v=t(17198),w=t(23525),g=t(27600),S=t(58593),C=t(70163),y=t(22318),E=t(18782),x=t(32228),k=t(6646),D=t(11965);const N=(0,l.iK)(C.Z.Check)`
  color: ${e=>{let{theme:a}=e;return a.colors.grayscale.dark1}};
`,A=(0,l.iK)(C.Z.CancelX)`
  color: ${e=>{let{theme:a}=e;return a.colors.grayscale.dark1}};
`,L=l.iK.div`
  color: ${e=>{let{theme:a}=e;return a.colors.grayscale.base}};

  .action-button {
    display: inline-block;
    height: 100%;
  }
`;function H(e){let{value:a}=e;return a?(0,D.tZ)(N,null):(0,D.tZ)(A,null)}const T=(0,Z.ZP)((function(e){let{addDangerToast:a,addSuccessToast:t}=e;const{state:{loading:l,resourceCount:r,resourceCollection:Z},hasPerm:N,fetchData:A,refreshData:T}=(0,m.Yi)("database",(0,o.t)("database"),a),q=(0,i.v9)((e=>e.user)),z=(0,w.eY)(g.KD.showDatabaseModal),[O,U]=(0,c.Kx)({databaseAdded:c.dJ}),[$,I]=(0,s.useState)(z||!1),[X,M]=(0,s.useState)(null),[V,K]=(0,s.useState)(null),[Q,j]=(0,s.useState)(!1),B=(0,y.i5)(q),P=Q||B,[R,Y]=(0,s.useState)(!1),{roles:F}=q,{CSV_EXTENSIONS:J,COLUMNAR_EXTENSIONS:W,EXCEL_EXTENSIONS:G,ALLOWED_EXTENSIONS:ee}=(0,i.v9)((e=>e.common.conf));function ae(e){let{database:a=null,modalOpen:t=!1}=void 0===e?{}:e;K(a),I(t)}(0,s.useEffect)((()=>{null!=O&&O.databaseAdded&&(U({databaseAdded:void 0}),T())}),[O,U,T]);const te=N("can_write"),le=N("can_write"),oe=N("can_write"),ne=N("can_export")&&(0,p.cr)(_.T.VERSIONED_EXPORT),{canUploadCSV:se,canUploadColumnar:re,canUploadExcel:de}=(0,h.Mc)(F,J,W,G,ee),ie=B&&!Q,ce=[{label:(0,o.t)("Upload file to database"),childs:[{label:(0,o.t)("Upload CSV"),name:"Upload CSV file",url:"/csvtodatabaseview/form",perm:se&&P,disable:ie},{label:(0,o.t)("Upload columnar file"),name:"Upload columnar file",url:"/columnartodatabaseview/form",perm:re&&P,disable:ie},{label:(0,o.t)("Upload Excel file"),name:"Upload Excel file",url:"/exceltodatabaseview/form",perm:de&&P,disable:ie}]}];(0,s.useEffect)((()=>{n.Z.get({endpoint:`/api/v1/database/?q=${d().encode({filters:[{col:"allow_file_upload",opr:"upload_is_enabled",value:!0}]})}`}).then((e=>{var a;let{json:t}=e;const l=(null==t||null==(a=t.result)?void 0:a.filter((e=>{var a;return null==e||null==(a=e.engine_information)?void 0:a.supports_file_upload})))||[];j((null==l?void 0:l.length)>=1)}))}),[$]);const ue={activeChild:"Databases",dropDownLinks:ce.reduce(((e,a)=>(a.childs=a.childs.filter((e=>e.perm)),a.childs.length?(e.push(a),e):e)),[]),name:(0,o.t)("Databases")};te&&(ue.buttons=[{"data-test":"btn-create-database",name:(0,D.tZ)(s.Fragment,null,(0,D.tZ)("i",{className:"fa fa-plus"})," ",(0,o.t)("Database")," "),buttonStyle:"primary",onClick:()=>{ae({modalOpen:!0})}}]);const be=(0,s.useMemo)((()=>[{accessor:"database_name",Header:(0,o.t)("Database")},{accessor:"backend",Header:(0,o.t)("Backend"),size:"lg",disableSortBy:!0},{accessor:"allow_run_async",Header:(0,D.tZ)(S.u,{id:"allow-run-async-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top"},(0,D.tZ)("span",null,(0,o.t)("AQE"))),Cell:e=>{let{row:{original:{allow_run_async:a}}}=e;return(0,D.tZ)(H,{value:a})},size:"sm"},{accessor:"allow_dml",Header:(0,D.tZ)(S.u,{id:"allow-dml-header-tooltip",title:(0,o.t)("Allow data manipulation language"),placement:"top"},(0,D.tZ)("span",null,(0,o.t)("DML"))),Cell:e=>{let{row:{original:{allow_dml:a}}}=e;return(0,D.tZ)(H,{value:a})},size:"sm"},{accessor:"allow_file_upload",Header:(0,o.t)("CSV upload"),Cell:e=>{let{row:{original:{allow_file_upload:a}}}=e;return(0,D.tZ)(H,{value:a})},size:"md"},{accessor:"expose_in_sqllab",Header:(0,o.t)("Expose in SQL Lab"),Cell:e=>{let{row:{original:{expose_in_sqllab:a}}}=e;return(0,D.tZ)(H,{value:a})},size:"md"},{accessor:"created_by",disableSortBy:!0,Header:(0,o.t)("Created by"),Cell:e=>{let{row:{original:{created_by:a}}}=e;return a?`${a.first_name} ${a.last_name}`:""},size:"xl"},{Cell:e=>{let{row:{original:{changed_on_delta_humanized:a}}}=e;return a},Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl"},{Cell:e=>{let{row:{original:a}}=e;return le||oe||ne?(0,D.tZ)(L,{className:"actions"},oe&&(0,D.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return e=a,n.Z.get({endpoint:`/api/v1/database/${e.id}/related_objects/`}).then((a=>{let{json:t={}}=a;M({...e,chart_count:t.charts.count,dashboard_count:t.dashboards.count,sqllab_tab_count:t.sqllab_tab_states.count})})).catch((0,h.v$)((e=>(0,o.t)("An error occurred while fetching database related data: %s",e))));var e}},(0,D.tZ)(S.u,{id:"delete-action-tooltip",title:(0,o.t)("Delete database"),placement:"bottom"},(0,D.tZ)(C.Z.Trash,null))),ne&&(0,D.tZ)(S.u,{id:"export-action-tooltip",title:(0,o.t)("Export"),placement:"bottom"},(0,D.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{var e;void 0!==(e=a).id&&((0,x.Z)("database",[e.id],(()=>{Y(!1)})),Y(!0))}},(0,D.tZ)(C.Z.Share,null))),le&&(0,D.tZ)(S.u,{id:"edit-action-tooltip",title:(0,o.t)("Edit"),placement:"bottom"},(0,D.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>ae({database:a,modalOpen:!0})},(0,D.tZ)(C.Z.EditAlt,null)))):null},Header:(0,o.t)("Actions"),id:"actions",hidden:!le&&!oe,disableSortBy:!0}]),[oe,le,ne]),pe=(0,s.useMemo)((()=>[{Header:(0,o.t)("Expose in SQL Lab"),key:"expose_in_sql_lab",id:"expose_in_sqllab",input:"select",operator:E.p.equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,D.tZ)(S.u,{id:"allow-run-async-filter-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top"},(0,D.tZ)("span",null,(0,o.t)("AQE"))),key:"allow_run_async",id:"allow_run_async",input:"select",operator:E.p.equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,o.t)("Search"),key:"search",id:"database_name",input:"search",operator:E.p.contains}]),[]);return(0,D.tZ)(s.Fragment,null,(0,D.tZ)(f.Z,ue),(0,D.tZ)(k.ZP,{databaseId:null==V?void 0:V.id,show:$,onHide:ae,onDatabaseAdd:()=>{T()}}),X&&(0,D.tZ)(v.Z,{description:(0,o.t)("The database %s is linked to %s charts that appear on %s dashboards and users have %s SQL Lab tabs using this database open. Are you sure you want to continue? Deleting the database will break those objects.",X.database_name,X.chart_count,X.dashboard_count,X.sqllab_tab_count),onConfirm:()=>{X&&function(e){let{id:l,database_name:s}=e;n.Z.delete({endpoint:`/api/v1/database/${l}`}).then((()=>{T(),t((0,o.t)("Deleted: %s",s)),(0,u.LS)(u.dR.db,null),M(null)}),(0,h.v$)((e=>a((0,o.t)("There was an issue deleting %s: %s",s,e)))))}(X)},onHide:()=>M(null),open:!0,title:(0,o.t)("Delete Database?")}),(0,D.tZ)(E.Z,{className:"database-list-view",columns:be,count:r,data:Z,fetchData:A,filters:pe,initialSort:[{id:"changed_on_delta_humanized",desc:!0}],loading:l,pageSize:25}),R&&(0,D.tZ)(b.Z,null))}))}}]);
//# sourceMappingURL=256eb3c119d4a2d17c67.chunk.js.map
