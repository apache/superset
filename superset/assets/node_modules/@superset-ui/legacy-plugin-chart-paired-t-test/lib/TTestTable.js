"use strict";exports.__esModule=!0,exports.default=exports.dataPropType=void 0;var _distributions=_interopRequireDefault(require("distributions")),_react=_interopRequireDefault(require("react")),_reactableArc=require("reactable-arc"),_propTypes=_interopRequireDefault(require("prop-types"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}var dataPropType=_propTypes.default.arrayOf(_propTypes.default.shape({group:_propTypes.default.arrayOf(_propTypes.default.string),values:_propTypes.default.arrayOf(_propTypes.default.shape({x:_propTypes.default.number,y:_propTypes.default.number}))}));exports.dataPropType=dataPropType;var propTypes={alpha:_propTypes.default.number,data:dataPropType.isRequired,groups:_propTypes.default.arrayOf(_propTypes.default.string).isRequired,liftValPrec:_propTypes.default.number,metric:_propTypes.default.string.isRequired,pValPrec:_propTypes.default.number},defaultProps={alpha:.05,liftValPrec:4,pValPrec:6},TTestTable=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,c.state={control:0,liftValues:[],pValues:[]},c}_inheritsLoose(b,a);var c=b.prototype;return c.componentWillMount=function b(){var a=this.state.control;this.computeTTest(a)},c.getLiftStatus=function f(a){var b=this.state,c=b.control,d=b.liftValues;// Get a css class name for coloring
if(a===c)return"control";var e=d[a];return Number.isNaN(e)||!Number.isFinite(e)?"invalid":0<=e?"true":"false";// green on true, red on false
},c.getPValueStatus=function f(a){var b=this.state,c=b.control,d=b.pValues;if(a===c)return"control";var e=d[a];return Number.isNaN(e)||!Number.isFinite(e)?"invalid":"";// p-values won't normally be colored
},c.getSignificance=function f(a){var b=this.state,c=b.control,d=b.pValues,e=this.props.alpha;// Color significant as green, else red
return a===c?"control":d[a]<=e;// p-values significant below set threshold
},c.computeLift=function g(a,b){for(var c=this.props.liftValPrec,d=0,e=0,f=0;f<a.length;f++)d+=a[f].y,e+=b[f].y;return(100*((d-e)/e)).toFixed(c)},c.computePValue=function k(a,b){for(var c,d=this.props.pValPrec,e=0,f=0,g=0,h=0;h<a.length;h++)c=b[h].y-a[h].y,isFinite(c)&&(g++,e+=c,f+=c*c);var j=-Math.abs(e*Math.sqrt((g-1)/(g*f-e*e)));try{return(2*new _distributions.default.Studentt(g-1).cdf(j)).toFixed(d);// two-sided test
}catch(a){return NaN}},c.computeTTest=function e(a){// Compute lift and p-values for each row
// against the selected control
var b=this.props.data,c=[],d=[];if(b){for(var f=0;f<b.length;f++)f===a?(c.push("control"),d.push("control")):(c.push(this.computePValue(b[f].values,b[a].values)),d.push(this.computeLift(b[f].values,b[a].values)));this.setState({control:a,liftValues:d,pValues:c})}},c.render=function o(){var a=this,b=this.props,c=b.data,d=b.metric,e=b.groups,f=this.state,g=f.control,h=f.liftValues,j=f.pValues,k=e.map(function(a,b){return _react.default.createElement(_reactableArc.Th,{key:b,column:a},a)}),l=e.length;k.push(_react.default.createElement(_reactableArc.Th,{key:l+1,column:"pValue"},"p-value")),k.push(_react.default.createElement(_reactableArc.Th,{key:l+2,column:"liftValue"},"Lift %")),k.push(_react.default.createElement(_reactableArc.Th,{key:l+3,column:"significant"},"Significant"));var m=c.map(function(b,c){var d=e.map(function(a,c){return(// group names
_react.default.createElement(_reactableArc.Td,{key:c,column:a,data:b.group[c]}))});return d.push(_react.default.createElement(_reactableArc.Td,{key:l+1,className:a.getPValueStatus(c),column:"pValue",data:j[c]})),d.push(_react.default.createElement(_reactableArc.Td,{key:l+2,className:a.getLiftStatus(c),column:"liftValue",data:h[c]})),d.push(_react.default.createElement(_reactableArc.Td,{key:l+3,className:a.getSignificance(c),column:"significant",data:a.getSignificance(c)})),_react.default.createElement(_reactableArc.Tr,{key:c,onClick:a.computeTTest.bind(a,c),className:c===g?"control":""},d)}),n=e.concat([{column:"pValue",sortFunction:function b(c,a){return"control"===c?-1:"control"===a?1:c>a?1:-1;// p-values ascending
}},{column:"liftValue",sortFunction:function b(c,a){return"control"===c?-1:"control"===a?1:parseFloat(c)>parseFloat(a)?-1:1;// lift values descending
}},{column:"significant",sortFunction:function b(c,a){return"control"===c?-1:"control"===a?1:c>a?-1:1;// significant values first
}}]);// When sorted ascending, 'control' will always be at top
return _react.default.createElement("div",null,_react.default.createElement("h3",null,d),_react.default.createElement(_reactableArc.Table,{className:"table",id:"table_"+d,sortable:n},_react.default.createElement(_reactableArc.Thead,null,k),m))},b}(_react.default.Component);TTestTable.propTypes=propTypes,TTestTable.defaultProps=defaultProps;var _default=TTestTable;exports.default=_default;