"use strict";exports.__esModule=!0,exports.default=void 0;var _d=_interopRequireDefault(require("d3")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_exploreUtils=require("../vendor/superset/exploreUtils"),_ReactNVD=_interopRequireDefault(require("../ReactNVD3")),_transformProps=_interopRequireDefault(require("../transformProps"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}var propTypes={width:_propTypes.default.number,height:_propTypes.default.number,annotationData:_propTypes.default.object,datasource:_propTypes.default.object,formData:_propTypes.default.object,onAddFilter:_propTypes.default.func,onError:_propTypes.default.func},defaultProps={onAddFilter:function a(){},onError:function a(){}};function getJson(a){return new Promise(function(b,c){_d.default.json(a,function(a,d){a?c(a):b(d.data)})})}/*
 * Show multiple line charts
 *
 * This visualization works by fetching the data from each of the saved
 * charts, building the payload data and passing it along to nvd3Vis.
 */var LineMulti=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,c.state={payload:[]},c}_inheritsLoose(b,a);var c=b.prototype;return c.componentDidMount=function a(){this.loadData(this.props)},c.componentWillReceiveProps=function b(a){this.loadData(a)},c.loadData=function n(a){var b=this,c=a.formData,d=a.payload,e=d.data.slices,f=c.extraFilters,g=c.filters,h=c.lineCharts,i=c.lineCharts2,j=c.prefixMetricWithSliceName,k=c.timeRange;this.setState({payload:[]});// fetch data from all the charts
var l=[].concat(e.axis1.map(function(a){return[1,a]}),e.axis2.map(function(a){return[2,a]})),m=l.map(function(a){var b=a[0],c=a[1],d=c.form_data,e=_extends({},c.form_data,{extra_filters:f||[],filters:(d.filters||[]).concat(g||[]),time_range:k});return getJson((0,_exploreUtils.getExploreLongUrl)(e,"json")).then(function(a){return a.map(function(a){var d=a.key,f=a.values;return{key:j?c.slice_name+": "+d:d,type:e.viz_type,values:f,yAxis:b}})})});Promise.all(m).then(function(a){var c,e=_extends({},d);// add null values at the edges to fix multiChart bug when series with
// different x values use different y axes
if(e.data=(c=[]).concat.apply(c,a),h.length&&i.length){var f=1/0,g=-Infinity;e.data.forEach(function(a){f=Math.min.apply(Math,[f].concat(a.values.map(function(a){return a.x}))),g=Math.max.apply(Math,[g].concat(a.values.map(function(a){return a.x})))}),e.data.forEach(function(a){a.values.push({x:f,y:null}),a.values.push({x:g,y:null})})}b.setState({payload:e})})},c.render=function j(){var a=this.props,b=a.width,c=a.height,d=a.annotationData,e=a.datasource,f=a.formData,g=a.onAddFilter,h=a.onError,i=this.state.payload;return _react.default.createElement(_ReactNVD.default,(0,_transformProps.default)({width:b,height:c,annotationData:d,datasource:e,formData:f,onError:h,onAddFilter:g,payload:i}))},b}(_react.default.Component);LineMulti.propTypes=propTypes,LineMulti.defaultProps=defaultProps;var _default=LineMulti;exports.default=_default;