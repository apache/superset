{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/SpatialControl.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\nRow,\nCol,\nButton,\nLabel,\nOverlayTrigger,\nPopover } from\n'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport ControlHeader from '../ControlHeader';\nimport SelectControl from './SelectControl';\nimport PopoverSection from '../../../components/PopoverSection';\nimport Checkbox from '../../../components/Checkbox';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst spatialTypes = {\n  latlong: 'latlong',\n  delimited: 'delimited',\n  geohash: 'geohash' };\n\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  animation: PropTypes.bool,\n  choices: PropTypes.array };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  animation: true,\n  choices: [] };\n\n\nexport default class SpatialControl extends React.Component {\n  constructor(props) {var _context, _context2, _context3;\n    super(props);\n    const v = props.value || {};\n    let defaultCol;\n    if (props.choices.length > 0) {\n      defaultCol = props.choices[0][0];\n    }\n    this.state = {\n      type: v.type || spatialTypes.latlong,\n      delimiter: v.delimiter || ',',\n      latCol: v.latCol || defaultCol,\n      lonCol: v.lonCol || defaultCol,\n      lonlatCol: v.lonlatCol || defaultCol,\n      reverseCheckbox: v.reverseCheckbox || false,\n      geohashCol: v.geohashCol || defaultCol,\n      value: null,\n      errors: [] };\n\n    this.toggleCheckbox = _bindInstanceProperty(_context = this.toggleCheckbox).call(_context, this);\n    this.onChange = _bindInstanceProperty(_context2 = this.onChange).call(_context2, this);\n    this.renderReverseCheckbox = _bindInstanceProperty(_context3 = this.renderReverseCheckbox).call(_context3, this);\n  }\n  componentDidMount() {\n    this.onChange();\n  }\n  onChange() {\n    const type = this.state.type;\n    const value = { type };\n    const errors = [];\n    const errMsg = t('Invalid lat/long configuration.');\n    if (type === spatialTypes.latlong) {\n      value.latCol = this.state.latCol;\n      value.lonCol = this.state.lonCol;\n      if (!value.lonCol || !value.latCol) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.delimited) {\n      value.lonlatCol = this.state.lonlatCol;\n      value.delimiter = this.state.delimiter;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.lonlatCol || !value.delimiter) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.geohash) {\n      value.geohashCol = this.state.geohashCol;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.geohashCol) {\n        errors.push(errMsg);\n      }\n    }\n    this.setState({ value, errors });\n    this.props.onChange(value, errors);\n  }\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n  close() {\n    this.refs.trigger.hide();\n  }\n  toggleCheckbox() {\n    this.setState(\n    { reverseCheckbox: !this.state.reverseCheckbox },\n    this.onChange);\n\n  }\n  renderLabelContent() {\n    if (this.state.errors.length > 0) {\n      return 'N/A';\n    }\n    if (this.state.type === spatialTypes.latlong) {\n      return this.state.lonCol + \" | \" + this.state.latCol;\n    } else if (this.state.type === spatialTypes.delimited) {\n      return \"\" + this.state.lonlatCol;\n    } else if (this.state.type === spatialTypes.geohash) {\n      return \"\" + this.state.geohashCol;\n    }\n    return null;\n  }\n  renderSelect(name, type) {\n    return (\n      ___EmotionJSX(SelectControl, {\n        name: name,\n        choices: this.props.choices,\n        value: this.state[name],\n        clearable: false,\n        onFocus: () => {\n          this.setType(type);\n        },\n        onChange: value => {\n          this.setState({ [name]: value }, this.onChange);\n        }, __source: { fileName: _jsxFileName, lineNumber: 136 }, __self: this }));\n\n\n  }\n  renderReverseCheckbox() {\n    return (\n      ___EmotionJSX(\"span\", { __source: { fileName: _jsxFileName, lineNumber: 152 }, __self: this },\n      t('Reverse lat/long '),\n      ___EmotionJSX(Checkbox, {\n        checked: this.state.reverseCheckbox,\n        onChange: this.toggleCheckbox, __source: { fileName: _jsxFileName, lineNumber: 154 }, __self: this })));\n\n\n\n  }\n  renderPopover() {var _context4, _context5, _context6, _context7;\n    return (\n      ___EmotionJSX(Popover, { id: \"filter-popover\", __source: { fileName: _jsxFileName, lineNumber: 163 }, __self: this },\n      ___EmotionJSX(\"div\", { style: { width: '300px' }, __source: { fileName: _jsxFileName, lineNumber: 164 }, __self: this },\n      ___EmotionJSX(PopoverSection, {\n        title: t('Longitude & Latitude columns'),\n        isSelected: this.state.type === spatialTypes.latlong,\n        onSelect: _bindInstanceProperty(_context4 = this.setType).call(_context4, this, spatialTypes.latlong), __source: { fileName: _jsxFileName, lineNumber: 165 }, __self: this },\n\n      ___EmotionJSX(Row, { __source: { fileName: _jsxFileName, lineNumber: 170 }, __self: this },\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 171 }, __self: this }, \"Longitude\",\n\n      this.renderSelect('lonCol', spatialTypes.latlong)),\n\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 175 }, __self: this }, \"Latitude\",\n\n      this.renderSelect('latCol', spatialTypes.latlong)))),\n\n\n\n      ___EmotionJSX(PopoverSection, {\n        title: t('Delimited long & lat single column'),\n        info: t(\n        'Multiple formats accepted, look the geopy.points ' +\n        'Python library for more details'),\n\n        isSelected: this.state.type === spatialTypes.delimited,\n        onSelect: _bindInstanceProperty(_context5 = this.setType).call(_context5, this, spatialTypes.delimited), __source: { fileName: _jsxFileName, lineNumber: 181 }, __self: this },\n\n      ___EmotionJSX(Row, { __source: { fileName: _jsxFileName, lineNumber: 190 }, __self: this },\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 191 }, __self: this },\n      t('Column'),\n      this.renderSelect('lonlatCol', spatialTypes.delimited)),\n\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 195 }, __self: this }, this.renderReverseCheckbox()))),\n\n\n      ___EmotionJSX(PopoverSection, {\n        title: t('Geohash'),\n        isSelected: this.state.type === spatialTypes.geohash,\n        onSelect: _bindInstanceProperty(_context6 = this.setType).call(_context6, this, spatialTypes.geohash), __source: { fileName: _jsxFileName, lineNumber: 198 }, __self: this },\n\n      ___EmotionJSX(Row, { __source: { fileName: _jsxFileName, lineNumber: 203 }, __self: this },\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 204 }, __self: this }, \"Column\",\n\n      this.renderSelect('geohashCol', spatialTypes.geohash)),\n\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 208 }, __self: this }, this.renderReverseCheckbox()))),\n\n\n      ___EmotionJSX(\"div\", { className: \"clearfix\", __source: { fileName: _jsxFileName, lineNumber: 211 }, __self: this },\n      ___EmotionJSX(Button, {\n        bsSize: \"small\",\n        className: \"float-left ok\",\n        bsStyle: \"primary\",\n        onClick: _bindInstanceProperty(_context7 = this.close).call(_context7, this), __source: { fileName: _jsxFileName, lineNumber: 212 }, __self: this }, \"Ok\")))));\n\n\n\n\n\n\n\n  }\n  render() {\n    return (\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 227 }, __self: this },\n      ___EmotionJSX(ControlHeader, _extends({}, this.props, { __source: { fileName: _jsxFileName, lineNumber: 228 }, __self: this })),\n      ___EmotionJSX(OverlayTrigger, {\n        animation: this.props.animation,\n        container: document.body,\n        trigger: \"click\",\n        rootClose: true,\n        ref: \"trigger\",\n        placement: \"right\",\n        overlay: this.renderPopover(), __source: { fileName: _jsxFileName, lineNumber: 229 }, __self: this },\n\n      ___EmotionJSX(Label, { style: { cursor: 'pointer' }, __source: { fileName: _jsxFileName, lineNumber: 238 }, __self: this },\n      this.renderLabelContent()))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nSpatialControl.propTypes = propTypes;\nSpatialControl.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(spatialTypes, \"spatialTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");reactHotLoader.register(SpatialControl, \"SpatialControl\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/SpatialControl.jsx"],"names":["React","PropTypes","Row","Col","Button","Label","OverlayTrigger","Popover","t","ControlHeader","SelectControl","PopoverSection","Checkbox","spatialTypes","latlong","delimited","geohash","propTypes","onChange","func","value","object","animation","bool","choices","array","defaultProps","SpatialControl","Component","constructor","props","v","defaultCol","length","state","type","delimiter","latCol","lonCol","lonlatCol","reverseCheckbox","geohashCol","errors","toggleCheckbox","renderReverseCheckbox","componentDidMount","errMsg","push","setState","setType","close","refs","trigger","hide","renderLabelContent","renderSelect","name","renderPopover","width","render","document","body","cursor"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  Row,\n  Col,\n  Button,\n  Label,\n  OverlayTrigger,\n  Popover,\n} from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\n\nimport ControlHeader from '../ControlHeader';\nimport SelectControl from './SelectControl';\nimport PopoverSection from '../../../components/PopoverSection';\nimport Checkbox from '../../../components/Checkbox';\n\nconst spatialTypes = {\n  latlong: 'latlong',\n  delimited: 'delimited',\n  geohash: 'geohash',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  animation: PropTypes.bool,\n  choices: PropTypes.array,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  animation: true,\n  choices: [],\n};\n\nexport default class SpatialControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const v = props.value || {};\n    let defaultCol;\n    if (props.choices.length > 0) {\n      defaultCol = props.choices[0][0];\n    }\n    this.state = {\n      type: v.type || spatialTypes.latlong,\n      delimiter: v.delimiter || ',',\n      latCol: v.latCol || defaultCol,\n      lonCol: v.lonCol || defaultCol,\n      lonlatCol: v.lonlatCol || defaultCol,\n      reverseCheckbox: v.reverseCheckbox || false,\n      geohashCol: v.geohashCol || defaultCol,\n      value: null,\n      errors: [],\n    };\n    this.toggleCheckbox = this.toggleCheckbox.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.renderReverseCheckbox = this.renderReverseCheckbox.bind(this);\n  }\n  componentDidMount() {\n    this.onChange();\n  }\n  onChange() {\n    const type = this.state.type;\n    const value = { type };\n    const errors = [];\n    const errMsg = t('Invalid lat/long configuration.');\n    if (type === spatialTypes.latlong) {\n      value.latCol = this.state.latCol;\n      value.lonCol = this.state.lonCol;\n      if (!value.lonCol || !value.latCol) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.delimited) {\n      value.lonlatCol = this.state.lonlatCol;\n      value.delimiter = this.state.delimiter;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.lonlatCol || !value.delimiter) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.geohash) {\n      value.geohashCol = this.state.geohashCol;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.geohashCol) {\n        errors.push(errMsg);\n      }\n    }\n    this.setState({ value, errors });\n    this.props.onChange(value, errors);\n  }\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n  close() {\n    this.refs.trigger.hide();\n  }\n  toggleCheckbox() {\n    this.setState(\n      { reverseCheckbox: !this.state.reverseCheckbox },\n      this.onChange,\n    );\n  }\n  renderLabelContent() {\n    if (this.state.errors.length > 0) {\n      return 'N/A';\n    }\n    if (this.state.type === spatialTypes.latlong) {\n      return `${this.state.lonCol} | ${this.state.latCol}`;\n    } else if (this.state.type === spatialTypes.delimited) {\n      return `${this.state.lonlatCol}`;\n    } else if (this.state.type === spatialTypes.geohash) {\n      return `${this.state.geohashCol}`;\n    }\n    return null;\n  }\n  renderSelect(name, type) {\n    return (\n      <SelectControl\n        name={name}\n        choices={this.props.choices}\n        value={this.state[name]}\n        clearable={false}\n        onFocus={() => {\n          this.setType(type);\n        }}\n        onChange={value => {\n          this.setState({ [name]: value }, this.onChange);\n        }}\n      />\n    );\n  }\n  renderReverseCheckbox() {\n    return (\n      <span>\n        {t('Reverse lat/long ')}\n        <Checkbox\n          checked={this.state.reverseCheckbox}\n          onChange={this.toggleCheckbox}\n        />\n      </span>\n    );\n  }\n  renderPopover() {\n    return (\n      <Popover id=\"filter-popover\">\n        <div style={{ width: '300px' }}>\n          <PopoverSection\n            title={t('Longitude & Latitude columns')}\n            isSelected={this.state.type === spatialTypes.latlong}\n            onSelect={this.setType.bind(this, spatialTypes.latlong)}\n          >\n            <Row>\n              <Col md={6}>\n                Longitude\n                {this.renderSelect('lonCol', spatialTypes.latlong)}\n              </Col>\n              <Col md={6}>\n                Latitude\n                {this.renderSelect('latCol', spatialTypes.latlong)}\n              </Col>\n            </Row>\n          </PopoverSection>\n          <PopoverSection\n            title={t('Delimited long & lat single column')}\n            info={t(\n              'Multiple formats accepted, look the geopy.points ' +\n                'Python library for more details',\n            )}\n            isSelected={this.state.type === spatialTypes.delimited}\n            onSelect={this.setType.bind(this, spatialTypes.delimited)}\n          >\n            <Row>\n              <Col md={6}>\n                {t('Column')}\n                {this.renderSelect('lonlatCol', spatialTypes.delimited)}\n              </Col>\n              <Col md={6}>{this.renderReverseCheckbox()}</Col>\n            </Row>\n          </PopoverSection>\n          <PopoverSection\n            title={t('Geohash')}\n            isSelected={this.state.type === spatialTypes.geohash}\n            onSelect={this.setType.bind(this, spatialTypes.geohash)}\n          >\n            <Row>\n              <Col md={6}>\n                Column\n                {this.renderSelect('geohashCol', spatialTypes.geohash)}\n              </Col>\n              <Col md={6}>{this.renderReverseCheckbox()}</Col>\n            </Row>\n          </PopoverSection>\n          <div className=\"clearfix\">\n            <Button\n              bsSize=\"small\"\n              className=\"float-left ok\"\n              bsStyle=\"primary\"\n              onClick={this.close.bind(this)}\n            >\n              Ok\n            </Button>\n          </div>\n        </div>\n      </Popover>\n    );\n  }\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <OverlayTrigger\n          animation={this.props.animation}\n          container={document.body}\n          trigger=\"click\"\n          rootClose\n          ref=\"trigger\"\n          placement=\"right\"\n          overlay={this.renderPopover()}\n        >\n          <Label style={{ cursor: 'pointer' }}>\n            {this.renderLabelContent()}\n          </Label>\n        </OverlayTrigger>\n      </div>\n    );\n  }\n}\n\nSpatialControl.propTypes = propTypes;\nSpatialControl.defaultProps = defaultProps;\n"]},"metadata":{},"sourceType":"module"}