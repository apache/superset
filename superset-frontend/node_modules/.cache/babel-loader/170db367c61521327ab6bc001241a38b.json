{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Table } from 'reactable-arc';\nimport { FormControl, Modal } from 'react-bootstrap';\nimport { SupersetClient } from '@superset-ui/connection';\nimport { t } from '@superset-ui/translation';\n\nimport getClientErrorObject from '../utils/getClientErrorObject';\nimport Loading from '../components/Loading';\nimport withToasts from '../messageToasts/enhancers/withToasts';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  addDangerToast: PropTypes.func.isRequired,\n  onChange: PropTypes.func,\n  onDatasourceSave: PropTypes.func,\n  onHide: PropTypes.func,\n  show: PropTypes.bool.isRequired };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: () => {},\n  onHide: () => {} };\n\n\nconst TABLE_COLUMNS = ['name', 'type', 'schema', 'connection', 'creator'];\nconst TABLE_FILTERABLE = ['rawName', 'type', 'schema', 'connection', 'creator'];\n\nclass ChangeDatasourceModal extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.state = {\n      loading: true,\n      datasources: null };\n\n    this.setSearchRef = _bindInstanceProperty(_context = this.setSearchRef).call(_context, this);\n    this.onEnterModal = _bindInstanceProperty(_context2 = this.onEnterModal).call(_context2, this);\n    this.selectDatasource = _bindInstanceProperty(_context3 = this.selectDatasource).call(_context3, this);\n    this.changeSearch = _bindInstanceProperty(_context4 = this.changeSearch).call(_context4, this);\n  }\n\n  onEnterModal() {\n    if (this.searchRef) {\n      this.searchRef.focus();\n    }\n    if (!this.state.datasources) {\n      SupersetClient.get({\n        endpoint: '/superset/datasources/' }).\n\n      then(({ json }) => {\n        const datasources = _mapInstanceProperty(json).call(json, ds => {var _context5;return {\n            rawName: ds.name,\n            connection: ds.connection,\n            schema: ds.schema,\n            name:\n            ___EmotionJSX(\"a\", {\n              href: \"#\",\n              onClick: _bindInstanceProperty(_context5 = this.selectDatasource).call(_context5, this, ds),\n              className: \"datasource-link\" },\n\n            ds.name),\n\n\n            type: ds.type };});\n\n\n        this.setState({ loading: false, datasources });\n      }).\n      catch(response => {\n        this.setState({ loading: false });\n        getClientErrorObject(response).then(({ error }) => {\n          this.props.addDangerToast(error.error || error.statusText || error);\n        });\n      });\n    }\n  }\n\n  setSearchRef(searchRef) {\n    this.searchRef = searchRef;\n  }\n\n  changeSearch(event) {\n    this.setState({ filter: event.target.value });\n  }\n\n  selectDatasource(datasource) {\n    SupersetClient.get({\n      endpoint: \"/datasource/get/\" + datasource.type + \"/\" + datasource.id }).\n\n    then(({ json }) => {\n      this.props.onDatasourceSave(json);\n      this.props.onChange(datasource.uid);\n    }).\n    catch(response => {\n      getClientErrorObject(response).then(({ error, message }) => {\n        const errorMessage = error ?\n        error.error || error.statusText || error :\n        message;\n        this.props.addDangerToast(errorMessage);\n      });\n    });\n    this.props.onHide();\n  }\n\n  render() {\n    const { datasources, filter, loading } = this.state;\n    const { show, onHide } = this.props;\n\n    return (\n      ___EmotionJSX(Modal, {\n        show: show,\n        onHide: onHide,\n        onEnter: this.onEnterModal,\n        onExit: this.setSearchRef,\n        bsSize: \"lg\" },\n\n      ___EmotionJSX(Modal.Header, { closeButton: true },\n      ___EmotionJSX(Modal.Title, null, t('Select a datasource'))),\n\n      ___EmotionJSX(Modal.Body, null,\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(FormControl, {\n        inputRef: ref => {\n          this.setSearchRef(ref);\n        },\n        type: \"text\",\n        bsSize: \"sm\",\n        value: filter,\n        placeholder: t('Search / Filter'),\n        onChange: this.changeSearch })),\n\n\n      loading && ___EmotionJSX(Loading, null),\n      datasources &&\n      ___EmotionJSX(Table, {\n        columns: TABLE_COLUMNS,\n        className: \"table table-condensed\",\n        data: datasources,\n        itemsPerPage: 20,\n        filterable: TABLE_FILTERABLE,\n        filterBy: filter,\n        hideFilterInput: true }))));\n\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nChangeDatasourceModal.propTypes = propTypes;\nChangeDatasourceModal.defaultProps = defaultProps;const _default =\n\nwithToasts(ChangeDatasourceModal);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/datasource/ChangeDatasourceModal.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/datasource/ChangeDatasourceModal.jsx\");reactHotLoader.register(TABLE_COLUMNS, \"TABLE_COLUMNS\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/datasource/ChangeDatasourceModal.jsx\");reactHotLoader.register(TABLE_FILTERABLE, \"TABLE_FILTERABLE\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/datasource/ChangeDatasourceModal.jsx\");reactHotLoader.register(ChangeDatasourceModal, \"ChangeDatasourceModal\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/datasource/ChangeDatasourceModal.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/datasource/ChangeDatasourceModal.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":null,"metadata":{},"sourceType":"module"}