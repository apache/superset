{"ast":null,"code":"import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Popover, OverlayTrigger } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport Button from '../../components/Button';\nimport CopyToClipboard from '../../components/CopyToClipboard';\nimport { storeQuery } from '../../utils/common';\nimport getClientErrorObject from '../../utils/getClientErrorObject';\nimport withToasts from '../../messageToasts/enhancers/withToasts';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  queryEditor: PropTypes.shape({\n    dbId: PropTypes.number,\n    title: PropTypes.string,\n    schema: PropTypes.string,\n    autorun: PropTypes.bool,\n    sql: PropTypes.string,\n    remoteId: PropTypes.number }).\n  isRequired,\n  addDangerToast: PropTypes.func.isRequired };\n\n\nclass ShareSqlLabQuery extends React.Component {\n  constructor(props) {var _context;\n    super(props);\n    this.state = {\n      shortUrl: t('Loading ...') };\n\n    this.getCopyUrl = _bindInstanceProperty(_context = this.getCopyUrl).call(_context, this);\n  }\n\n  getCopyUrl() {\n    if (isFeatureEnabled(FeatureFlag.SHARE_QUERIES_VIA_KV_STORE)) {\n      return this.getCopyUrlForKvStore();\n    }\n\n    return this.getCopyUrlForSavedQuery();\n  }\n\n  getCopyUrlForKvStore() {\n    const { dbId, title, schema, autorun, sql } = this.props.queryEditor;\n    const sharedQuery = { dbId, title, schema, autorun, sql };\n\n    return storeQuery(sharedQuery).\n    then(shortUrl => {\n      this.setState({ shortUrl });\n    }).\n    catch(response => {\n      getClientErrorObject(response).then(({ error }) => {\n        this.props.addDangerToast(error);\n        this.setState({ shortUrl: t('Error') });\n      });\n    });\n  }\n\n  getCopyUrlForSavedQuery() {\n    let savedQueryToastContent;\n\n    if (this.props.queryEditor.remoteId) {\n      savedQueryToastContent =\n      window.location.origin +\n      window.location.pathname + (\"?savedQueryId=\" +\n      this.props.queryEditor.remoteId);\n      this.setState({ shortUrl: savedQueryToastContent });\n    } else {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      this.setState({ shortUrl: savedQueryToastContent });\n    }\n  }\n\n  renderPopover() {\n    return (\n      ___EmotionJSX(Popover, { id: \"sqllab-shareurl-popover\", __source: { fileName: _jsxFileName, lineNumber: 93 }, __self: this },\n      ___EmotionJSX(CopyToClipboard, {\n        text: this.state.shortUrl || t('Loading ...'),\n        copyNode:\n        ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\", title: t('Copy to clipboard'), __source: { fileName: _jsxFileName, lineNumber: 97 }, __self: this }), __source: { fileName: _jsxFileName, lineNumber: 94 }, __self: this })));\n\n\n\n\n  }\n\n  render() {\n    return (\n      ___EmotionJSX(OverlayTrigger, {\n        trigger: \"click\",\n        placement: \"top\",\n        onEnter: this.getCopyUrl,\n        rootClose: true,\n        shouldUpdatePosition: true,\n        overlay: this.renderPopover(), __source: { fileName: _jsxFileName, lineNumber: 106 }, __self: this },\n\n      ___EmotionJSX(Button, { bsSize: \"small\", className: \"toggleSave\", __source: { fileName: _jsxFileName, lineNumber: 114 }, __self: this },\n      ___EmotionJSX(\"i\", { className: \"fa fa-share\", __source: { fileName: _jsxFileName, lineNumber: 115 }, __self: this }), \" \", t('Share'))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nShareSqlLabQuery.propTypes = propTypes;const _default =\n\nwithToasts(ShareSqlLabQuery);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.jsx\");reactHotLoader.register(ShareSqlLabQuery, \"ShareSqlLabQuery\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.jsx"],"names":["React","PropTypes","Popover","OverlayTrigger","t","isFeatureEnabled","FeatureFlag","Button","CopyToClipboard","storeQuery","getClientErrorObject","withToasts","propTypes","queryEditor","shape","dbId","number","title","string","schema","autorun","bool","sql","remoteId","isRequired","addDangerToast","func","ShareSqlLabQuery","Component","constructor","props","state","shortUrl","getCopyUrl","SHARE_QUERIES_VIA_KV_STORE","getCopyUrlForKvStore","getCopyUrlForSavedQuery","sharedQuery","then","setState","catch","response","error","savedQueryToastContent","window","location","origin","pathname","renderPopover","render"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Popover, OverlayTrigger } from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport Button from '../../components/Button';\nimport CopyToClipboard from '../../components/CopyToClipboard';\nimport { storeQuery } from '../../utils/common';\nimport getClientErrorObject from '../../utils/getClientErrorObject';\nimport withToasts from '../../messageToasts/enhancers/withToasts';\n\nconst propTypes = {\n  queryEditor: PropTypes.shape({\n    dbId: PropTypes.number,\n    title: PropTypes.string,\n    schema: PropTypes.string,\n    autorun: PropTypes.bool,\n    sql: PropTypes.string,\n    remoteId: PropTypes.number,\n  }).isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n};\n\nclass ShareSqlLabQuery extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      shortUrl: t('Loading ...'),\n    };\n    this.getCopyUrl = this.getCopyUrl.bind(this);\n  }\n\n  getCopyUrl() {\n    if (isFeatureEnabled(FeatureFlag.SHARE_QUERIES_VIA_KV_STORE)) {\n      return this.getCopyUrlForKvStore();\n    }\n\n    return this.getCopyUrlForSavedQuery();\n  }\n\n  getCopyUrlForKvStore() {\n    const { dbId, title, schema, autorun, sql } = this.props.queryEditor;\n    const sharedQuery = { dbId, title, schema, autorun, sql };\n\n    return storeQuery(sharedQuery)\n      .then(shortUrl => {\n        this.setState({ shortUrl });\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(({ error }) => {\n          this.props.addDangerToast(error);\n          this.setState({ shortUrl: t('Error') });\n        });\n      });\n  }\n\n  getCopyUrlForSavedQuery() {\n    let savedQueryToastContent;\n\n    if (this.props.queryEditor.remoteId) {\n      savedQueryToastContent =\n        window.location.origin +\n        window.location.pathname +\n        `?savedQueryId=${this.props.queryEditor.remoteId}`;\n      this.setState({ shortUrl: savedQueryToastContent });\n    } else {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      this.setState({ shortUrl: savedQueryToastContent });\n    }\n  }\n\n  renderPopover() {\n    return (\n      <Popover id=\"sqllab-shareurl-popover\">\n        <CopyToClipboard\n          text={this.state.shortUrl || t('Loading ...')}\n          copyNode={\n            <i className=\"fa fa-clipboard\" title={t('Copy to clipboard')} />\n          }\n        />\n      </Popover>\n    );\n  }\n\n  render() {\n    return (\n      <OverlayTrigger\n        trigger=\"click\"\n        placement=\"top\"\n        onEnter={this.getCopyUrl}\n        rootClose\n        shouldUpdatePosition\n        overlay={this.renderPopover()}\n      >\n        <Button bsSize=\"small\" className=\"toggleSave\">\n          <i className=\"fa fa-share\" /> {t('Share')}\n        </Button>\n      </OverlayTrigger>\n    );\n  }\n}\n\nShareSqlLabQuery.propTypes = propTypes;\n\nexport default withToasts(ShareSqlLabQuery);\n"]},"metadata":{},"sourceType":"module"}