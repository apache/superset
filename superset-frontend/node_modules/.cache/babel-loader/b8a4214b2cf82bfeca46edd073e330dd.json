{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/DatasourceControl.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\nCol,\nCollapse,\nDropdownButton,\nLabel,\nMenuItem,\nOverlayTrigger,\nRow,\nTooltip,\nWell } from\n'react-bootstrap';\nimport { t } from '@superset-ui/translation';\nimport { ColumnOption, MetricOption } from '@superset-ui/chart-controls';\nimport ControlHeader from '../ControlHeader';\nimport DatasourceModal from '../../../datasource/DatasourceModal';\nimport ChangeDatasourceModal from '../../../datasource/ChangeDatasourceModal';\nimport TooltipWrapper from '../../../components/TooltipWrapper';\nimport './DatasourceControl.less';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  datasource: PropTypes.object.isRequired,\n  onDatasourceSave: PropTypes.func };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: null,\n  value: null };\n\n\nclass DatasourceControl extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.state = {\n      showEditDatasourceModal: false,\n      showChangeDatasourceModal: false,\n      menuExpanded: false };\n\n    this.toggleChangeDatasourceModal = _bindInstanceProperty(_context = this.toggleChangeDatasourceModal).call(_context,\n    this);\n\n    this.toggleEditDatasourceModal = _bindInstanceProperty(_context2 = this.toggleEditDatasourceModal).call(_context2, this);\n    this.toggleShowDatasource = _bindInstanceProperty(_context3 = this.toggleShowDatasource).call(_context3, this);\n    this.renderDatasource = _bindInstanceProperty(_context4 = this.renderDatasource).call(_context4, this);\n  }\n\n  toggleShowDatasource() {\n    this.setState(({ showDatasource }) => ({\n      showDatasource: !showDatasource }));\n\n  }\n\n  toggleChangeDatasourceModal() {\n    this.setState(({ showChangeDatasourceModal }) => ({\n      showChangeDatasourceModal: !showChangeDatasourceModal }));\n\n  }\n\n  toggleEditDatasourceModal() {\n    this.setState(({ showEditDatasourceModal }) => ({\n      showEditDatasourceModal: !showEditDatasourceModal }));\n\n  }\n\n  renderDatasource() {var _context5, _context6;\n    const datasource = this.props.datasource;\n    return (\n      ___EmotionJSX(\"div\", { className: \"m-t-10\", __source: { fileName: _jsxFileName, lineNumber: 90 }, __self: this },\n      ___EmotionJSX(Well, { className: \"m-t-0\", __source: { fileName: _jsxFileName, lineNumber: 91 }, __self: this },\n      ___EmotionJSX(\"div\", { className: \"m-b-10\", __source: { fileName: _jsxFileName, lineNumber: 92 }, __self: this },\n      ___EmotionJSX(Label, { __source: { fileName: _jsxFileName, lineNumber: 93 }, __self: this },\n      ___EmotionJSX(\"i\", { className: \"fa fa-database\", __source: { fileName: _jsxFileName, lineNumber: 94 }, __self: this }), \" \", datasource.database.backend), \" \" +\n\n      datasource.database.name + \" \"),\n\n      ___EmotionJSX(Row, { className: \"datasource-container\", __source: { fileName: _jsxFileName, lineNumber: 98 }, __self: this },\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 99 }, __self: this },\n      ___EmotionJSX(\"strong\", { __source: { fileName: _jsxFileName, lineNumber: 100 }, __self: this }, \"Columns\"),\n      _mapInstanceProperty(_context5 = datasource.columns).call(_context5, (col) =>\n      ___EmotionJSX(\"div\", { key: col.column_name, __source: { fileName: _jsxFileName, lineNumber: 102 }, __self: this },\n      ___EmotionJSX(ColumnOption, { showType: true, column: col, __source: { fileName: _jsxFileName, lineNumber: 103 }, __self: this })))),\n\n\n\n      ___EmotionJSX(Col, { md: 6, __source: { fileName: _jsxFileName, lineNumber: 107 }, __self: this },\n      ___EmotionJSX(\"strong\", { __source: { fileName: _jsxFileName, lineNumber: 108 }, __self: this }, \"Metrics\"),\n      _mapInstanceProperty(_context6 = datasource.metrics).call(_context6, (m) =>\n      ___EmotionJSX(\"div\", { key: m.metric_name, __source: { fileName: _jsxFileName, lineNumber: 110 }, __self: this },\n      ___EmotionJSX(MetricOption, { metric: m, showType: true, __source: { fileName: _jsxFileName, lineNumber: 111 }, __self: this }))))))));\n\n\n\n\n\n\n\n  }\n\n  render() {\n    const { showChangeDatasourceModal, showEditDatasourceModal } = this.state;\n    const { datasource, onChange, onDatasourceSave, value } = this.props;\n    return (\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 125 }, __self: this },\n      ___EmotionJSX(ControlHeader, _extends({}, this.props, { __source: { fileName: _jsxFileName, lineNumber: 126 }, __self: this })),\n      ___EmotionJSX(\"div\", { className: \"btn-group label-dropdown\", __source: { fileName: _jsxFileName, lineNumber: 127 }, __self: this },\n      ___EmotionJSX(TooltipWrapper, {\n        label: \"change-datasource\",\n        tooltip: t('Click to change the datasource'), __source: { fileName: _jsxFileName, lineNumber: 128 }, __self: this },\n\n      ___EmotionJSX(DropdownButton, {\n        title: datasource.name,\n        className: \"label label-default label-btn m-r-5\",\n        bsSize: \"sm\",\n        id: \"datasource_menu\", __source: { fileName: _jsxFileName, lineNumber: 132 }, __self: this },\n\n      ___EmotionJSX(MenuItem, { eventKey: \"3\", onClick: this.toggleChangeDatasourceModal, __source: { fileName: _jsxFileName, lineNumber: 138 }, __self: this },\n      t('Change Datasource')),\n\n      datasource.type === 'table' &&\n      ___EmotionJSX(MenuItem, {\n        eventKey: \"3\",\n        href: \"/superset/sqllab?datasourceKey=\" + value,\n        target: \"_blank\",\n        rel: \"noopener noreferrer\", __source: { fileName: _jsxFileName, lineNumber: 142 }, __self: this },\n\n      t('Explore in SQL Lab')),\n\n\n      !!this.props.onDatasourceSave &&\n      ___EmotionJSX(MenuItem, { eventKey: \"3\", onClick: this.toggleEditDatasourceModal, __source: { fileName: _jsxFileName, lineNumber: 152 }, __self: this },\n      t('Edit Datasource')))),\n\n\n\n\n      ___EmotionJSX(OverlayTrigger, {\n        placement: \"right\",\n        overlay:\n        ___EmotionJSX(Tooltip, { id: 'toggle-datasource-tooltip', __source: { fileName: _jsxFileName, lineNumber: 161 }, __self: this },\n        t('Expand/collapse datasource configuration')), __source: { fileName: _jsxFileName, lineNumber: 158 }, __self: this },\n\n\n\n      ___EmotionJSX(\"a\", { href: \"#\", __source: { fileName: _jsxFileName, lineNumber: 166 }, __self: this },\n      ___EmotionJSX(\"i\", {\n        className: \"fa fa-\" + (\n        this.state.showDatasource ? 'minus' : 'plus') + \"-square m-r-5 m-l-5 m-t-4\",\n\n        onClick: this.toggleShowDatasource, __source: { fileName: _jsxFileName, lineNumber: 167 }, __self: this })))),\n\n\n\n\n      ___EmotionJSX(Collapse, { in: this.state.showDatasource, __source: { fileName: _jsxFileName, lineNumber: 176 }, __self: this },\n      this.renderDatasource()),\n\n      ___EmotionJSX(DatasourceModal, {\n        datasource: datasource,\n        show: showEditDatasourceModal,\n        onDatasourceSave: onDatasourceSave,\n        onHide: this.toggleEditDatasourceModal, __source: { fileName: _jsxFileName, lineNumber: 179 }, __self: this }),\n\n      ___EmotionJSX(ChangeDatasourceModal, {\n        onDatasourceSave: onDatasourceSave,\n        onHide: this.toggleChangeDatasourceModal,\n        show: showChangeDatasourceModal,\n        onChange: onChange, __source: { fileName: _jsxFileName, lineNumber: 185 }, __self: this })));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nDatasourceControl.propTypes = propTypes;\nDatasourceControl.defaultProps = defaultProps;const _default =\n\nDatasourceControl;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/DatasourceControl.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/DatasourceControl.jsx\");reactHotLoader.register(DatasourceControl, \"DatasourceControl\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/DatasourceControl.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/DatasourceControl.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/explore/components/controls/DatasourceControl.jsx"],"names":["React","PropTypes","Col","Collapse","DropdownButton","Label","MenuItem","OverlayTrigger","Row","Tooltip","Well","t","ColumnOption","MetricOption","ControlHeader","DatasourceModal","ChangeDatasourceModal","TooltipWrapper","propTypes","onChange","func","value","string","datasource","object","isRequired","onDatasourceSave","defaultProps","DatasourceControl","PureComponent","constructor","props","state","showEditDatasourceModal","showChangeDatasourceModal","menuExpanded","toggleChangeDatasourceModal","toggleEditDatasourceModal","toggleShowDatasource","renderDatasource","setState","showDatasource","database","backend","name","columns","col","column_name","metrics","m","metric_name","render","type"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  Col,\n  Collapse,\n  DropdownButton,\n  Label,\n  MenuItem,\n  OverlayTrigger,\n  Row,\n  Tooltip,\n  Well,\n} from 'react-bootstrap';\nimport { t } from '@superset-ui/translation';\nimport { ColumnOption, MetricOption } from '@superset-ui/chart-controls';\nimport ControlHeader from '../ControlHeader';\nimport DatasourceModal from '../../../datasource/DatasourceModal';\nimport ChangeDatasourceModal from '../../../datasource/ChangeDatasourceModal';\nimport TooltipWrapper from '../../../components/TooltipWrapper';\nimport './DatasourceControl.less';\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  datasource: PropTypes.object.isRequired,\n  onDatasourceSave: PropTypes.func,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: null,\n  value: null,\n};\n\nclass DatasourceControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showEditDatasourceModal: false,\n      showChangeDatasourceModal: false,\n      menuExpanded: false,\n    };\n    this.toggleChangeDatasourceModal = this.toggleChangeDatasourceModal.bind(\n      this,\n    );\n    this.toggleEditDatasourceModal = this.toggleEditDatasourceModal.bind(this);\n    this.toggleShowDatasource = this.toggleShowDatasource.bind(this);\n    this.renderDatasource = this.renderDatasource.bind(this);\n  }\n\n  toggleShowDatasource() {\n    this.setState(({ showDatasource }) => ({\n      showDatasource: !showDatasource,\n    }));\n  }\n\n  toggleChangeDatasourceModal() {\n    this.setState(({ showChangeDatasourceModal }) => ({\n      showChangeDatasourceModal: !showChangeDatasourceModal,\n    }));\n  }\n\n  toggleEditDatasourceModal() {\n    this.setState(({ showEditDatasourceModal }) => ({\n      showEditDatasourceModal: !showEditDatasourceModal,\n    }));\n  }\n\n  renderDatasource() {\n    const datasource = this.props.datasource;\n    return (\n      <div className=\"m-t-10\">\n        <Well className=\"m-t-0\">\n          <div className=\"m-b-10\">\n            <Label>\n              <i className=\"fa fa-database\" /> {datasource.database.backend}\n            </Label>\n            {` ${datasource.database.name} `}\n          </div>\n          <Row className=\"datasource-container\">\n            <Col md={6}>\n              <strong>Columns</strong>\n              {datasource.columns.map(col => (\n                <div key={col.column_name}>\n                  <ColumnOption showType column={col} />\n                </div>\n              ))}\n            </Col>\n            <Col md={6}>\n              <strong>Metrics</strong>\n              {datasource.metrics.map(m => (\n                <div key={m.metric_name}>\n                  <MetricOption metric={m} showType />\n                </div>\n              ))}\n            </Col>\n          </Row>\n        </Well>\n      </div>\n    );\n  }\n\n  render() {\n    const { showChangeDatasourceModal, showEditDatasourceModal } = this.state;\n    const { datasource, onChange, onDatasourceSave, value } = this.props;\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <div className=\"btn-group label-dropdown\">\n          <TooltipWrapper\n            label=\"change-datasource\"\n            tooltip={t('Click to change the datasource')}\n          >\n            <DropdownButton\n              title={datasource.name}\n              className=\"label label-default label-btn m-r-5\"\n              bsSize=\"sm\"\n              id=\"datasource_menu\"\n            >\n              <MenuItem eventKey=\"3\" onClick={this.toggleChangeDatasourceModal}>\n                {t('Change Datasource')}\n              </MenuItem>\n              {datasource.type === 'table' && (\n                <MenuItem\n                  eventKey=\"3\"\n                  href={`/superset/sqllab?datasourceKey=${value}`}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  {t('Explore in SQL Lab')}\n                </MenuItem>\n              )}\n              {!!this.props.onDatasourceSave && (\n                <MenuItem eventKey=\"3\" onClick={this.toggleEditDatasourceModal}>\n                  {t('Edit Datasource')}\n                </MenuItem>\n              )}\n            </DropdownButton>\n          </TooltipWrapper>\n          <OverlayTrigger\n            placement=\"right\"\n            overlay={\n              <Tooltip id={'toggle-datasource-tooltip'}>\n                {t('Expand/collapse datasource configuration')}\n              </Tooltip>\n            }\n          >\n            <a href=\"#\">\n              <i\n                className={`fa fa-${\n                  this.state.showDatasource ? 'minus' : 'plus'\n                }-square m-r-5 m-l-5 m-t-4`}\n                onClick={this.toggleShowDatasource}\n              />\n            </a>\n          </OverlayTrigger>\n        </div>\n        <Collapse in={this.state.showDatasource}>\n          {this.renderDatasource()}\n        </Collapse>\n        <DatasourceModal\n          datasource={datasource}\n          show={showEditDatasourceModal}\n          onDatasourceSave={onDatasourceSave}\n          onHide={this.toggleEditDatasourceModal}\n        />\n        <ChangeDatasourceModal\n          onDatasourceSave={onDatasourceSave}\n          onHide={this.toggleChangeDatasourceModal}\n          show={showChangeDatasourceModal}\n          onChange={onChange}\n        />\n      </div>\n    );\n  }\n}\n\nDatasourceControl.propTypes = propTypes;\nDatasourceControl.defaultProps = defaultProps;\n\nexport default DatasourceControl;\n"]},"metadata":{},"sourceType":"module"}