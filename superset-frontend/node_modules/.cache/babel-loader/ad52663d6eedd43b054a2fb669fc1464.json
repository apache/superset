{"ast":null,"code":"import _sortInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/sort\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/TableElement.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { ButtonGroup, Collapse, Fade, Well } from 'react-bootstrap';\nimport shortid from 'shortid';\nimport { t } from '@superset-ui/translation';\n\nimport CopyToClipboard from '../../components/CopyToClipboard';\nimport Link from '../../components/Link';\nimport ColumnElement from './ColumnElement';\nimport ShowSQL from './ShowSQL';\nimport ModalTrigger from '../../components/ModalTrigger';\nimport Loading from '../../components/Loading';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  table: PropTypes.object,\n  actions: PropTypes.object,\n  timeout: PropTypes.number // used for tests\n};\n\nconst defaultProps = {\n  actions: {},\n  table: null,\n  timeout: 500 };\n\n\nclass TableElement extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.state = {\n      sortColumns: false,\n      expanded: true,\n      hovered: false };\n\n    this.removeFromStore = _bindInstanceProperty(_context = this.removeFromStore).call(_context, this);\n    this.toggleSortColumns = _bindInstanceProperty(_context2 = this.toggleSortColumns).call(_context2, this);\n    this.removeTable = _bindInstanceProperty(_context3 = this.removeTable).call(_context3, this);\n    this.setHover = _bindInstanceProperty(_context4 = this.setHover).call(_context4, this);\n  }\n\n  setHover(hovered) {\n    this.setState({ hovered });\n  }\n\n  popSelectStar() {\n    const qe = {\n      id: shortid.generate(),\n      title: this.props.table.name,\n      dbId: this.props.table.dbId,\n      autorun: true,\n      sql: this.props.table.selectStar };\n\n    this.props.actions.addQueryEditor(qe);\n  }\n\n  toggleTable(e) {\n    e.preventDefault();\n    if (this.props.table.expanded) {\n      this.props.actions.collapseTable(this.props.table);\n    } else {\n      this.props.actions.expandTable(this.props.table);\n    }\n  }\n\n  removeTable() {\n    this.setState({ expanded: false });\n    this.props.actions.removeDataPreview(this.props.table);\n  }\n  toggleSortColumns() {\n    this.setState({ sortColumns: !this.state.sortColumns });\n  }\n\n  removeFromStore() {\n    this.props.actions.removeTable(this.props.table);\n  }\n\n  renderWell() {\n    const table = this.props.table;\n    let header;\n    if (table.partitions) {\n      let partitionQuery;\n      let partitionClipBoard;\n      if (table.partitions.partitionQuery) {\n        partitionQuery = table.partitions.partitionQuery;\n        const tt = t('Copy partition query to clipboard');\n        partitionClipBoard =\n        ___EmotionJSX(CopyToClipboard, {\n          text: partitionQuery,\n          shouldShowText: false,\n          tooltipText: tt,\n          copyNode: ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\", __source: { fileName: _jsxFileName, lineNumber: 108 }, __self: this }), __source: { fileName: _jsxFileName, lineNumber: 104 }, __self: this });\n\n\n      }\n      let latest = [];\n      for (const k in table.partitions.latest) {\n        latest.push(k + \"=\" + table.partitions.latest[k]);\n      }\n      latest = latest.join('/');\n      header =\n      ___EmotionJSX(Well, { bsSize: \"small\", __source: { fileName: _jsxFileName, lineNumber: 118 }, __self: this },\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 119 }, __self: this },\n      ___EmotionJSX(\"small\", { __source: { fileName: _jsxFileName, lineNumber: 120 }, __self: this },\n      t('latest partition:'), \" \", latest),\n      ' ',\n      partitionClipBoard));\n\n\n\n    }\n    return header;\n  }\n  renderControls() {\n    let keyLink;\n    const table = this.props.table;\n    if (table.indexes && table.indexes.length > 0) {var _context5;\n      keyLink =\n      ___EmotionJSX(ModalTrigger, {\n        modalTitle:\n        ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 137 }, __self: this },\n        t('Keys for table'), \" \", ___EmotionJSX(\"strong\", { __source: { fileName: _jsxFileName, lineNumber: 138 }, __self: this }, table.name)),\n\n\n        modalBody: _mapInstanceProperty(_context5 = table.indexes).call(_context5, (ix, i) =>\n        ___EmotionJSX(\"pre\", { key: i, __source: { fileName: _jsxFileName, lineNumber: 142 }, __self: this }, _JSON$stringify(ix, null, '  '))),\n\n        triggerNode:\n        ___EmotionJSX(Link, {\n          className: \"fa fa-key pull-left m-l-2\",\n          tooltip: t('View keys & indexes (%s)', table.indexes.length), __source: { fileName: _jsxFileName, lineNumber: 145 }, __self: this }), __source: { fileName: _jsxFileName, lineNumber: 135 }, __self: this });\n\n\n\n\n    }\n    return (\n      ___EmotionJSX(ButtonGroup, { className: \"ws-el-controls\", __source: { fileName: _jsxFileName, lineNumber: 154 }, __self: this },\n      keyLink,\n      ___EmotionJSX(Link, {\n        className:\n        \"fa fa-sort-\" + (!this.state.sortColumns ? 'alpha' : 'numeric') + \"-asc \" +\n        'pull-left sort-cols m-l-2',\n\n        onClick: this.toggleSortColumns,\n        tooltip:\n        !this.state.sortColumns ?\n        t('Sort columns alphabetically') :\n        t('Original table column order'),\n\n        href: \"#\", __source: { fileName: _jsxFileName, lineNumber: 156 }, __self: this }),\n\n      table.selectStar &&\n      ___EmotionJSX(CopyToClipboard, {\n        copyNode: ___EmotionJSX(\"a\", { className: \"fa fa-clipboard pull-left m-l-2\", __source: { fileName: _jsxFileName, lineNumber: 171 }, __self: this }),\n        text: table.selectStar,\n        shouldShowText: false,\n        tooltipText: t('Copy SELECT statement to the clipboard'), __source: { fileName: _jsxFileName, lineNumber: 170 }, __self: this }),\n\n\n      table.view &&\n      ___EmotionJSX(ShowSQL, {\n        sql: table.view,\n        tooltipText: t('Show CREATE VIEW statement'),\n        title: t('CREATE VIEW statement'), __source: { fileName: _jsxFileName, lineNumber: 178 }, __self: this }),\n\n\n      ___EmotionJSX(Link, {\n        className: \"fa fa-times table-remove pull-left m-l-2\",\n        onClick: this.removeTable,\n        tooltip: t('Remove table preview'),\n        href: \"#\", __source: { fileName: _jsxFileName, lineNumber: 184 }, __self: this })));\n\n\n\n  }\n  renderHeader() {\n    const table = this.props.table;\n    return (\n      ___EmotionJSX(\"div\", { className: \"clearfix\", __source: { fileName: _jsxFileName, lineNumber: 196 }, __self: this },\n      ___EmotionJSX(\"div\", { className: \"pull-left\", __source: { fileName: _jsxFileName, lineNumber: 197 }, __self: this },\n      ___EmotionJSX(\"a\", {\n        href: \"#\",\n        className: \"table-name\",\n        onClick: e => {\n          this.toggleTable(e);\n        }, __source: { fileName: _jsxFileName, lineNumber: 198 }, __self: this },\n\n      ___EmotionJSX(\"strong\", { __source: { fileName: _jsxFileName, lineNumber: 205 }, __self: this }, table.name))),\n\n\n      ___EmotionJSX(\"div\", { className: \"pull-right\", __source: { fileName: _jsxFileName, lineNumber: 208 }, __self: this },\n      table.isMetadataLoading || table.isExtraMetadataLoading ?\n      ___EmotionJSX(Loading, { size: 50, position: \"normal\", className: \"margin-zero\", __source: { fileName: _jsxFileName, lineNumber: 210 }, __self: this }) :\n\n      ___EmotionJSX(Fade, { in: this.state.hovered, __source: { fileName: _jsxFileName, lineNumber: 212 }, __self: this }, this.renderControls()),\n\n      ___EmotionJSX(\"i\", {\n        onClick: e => {\n          this.toggleTable(e);\n        },\n        className:\n        'text-primary pointer m-l-10 ' +\n        'fa fa-lg ' + (\"fa-angle-\" + (\n        table.expanded ? 'up' : 'down')), __source: { fileName: _jsxFileName, lineNumber: 214 }, __self: this }))));\n\n\n\n\n\n  }\n  renderBody() {\n    const table = this.props.table;\n    let cols;\n    if (table.columns) {var _context6;\n      cols = _sliceInstanceProperty(_context6 = table.columns).call(_context6);\n      if (this.state.sortColumns) {\n        _sortInstanceProperty(cols).call(cols, (a, b) => {\n          const colA = a.name.toUpperCase();\n          const colB = b.name.toUpperCase();\n          if (colA < colB) {\n            return -1;\n          } else if (colA > colB) {\n            return 1;\n          }\n          return 0;\n        });\n      }\n    }\n    const metadata =\n    ___EmotionJSX(Collapse, { in: table.expanded, timeout: this.props.timeout, __source: { fileName: _jsxFileName, lineNumber: 247 }, __self: this },\n    ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 248 }, __self: this },\n    this.renderWell(),\n    ___EmotionJSX(\"div\", { className: \"table-columns m-t-5\", __source: { fileName: _jsxFileName, lineNumber: 250 }, __self: this },\n    cols &&\n    _mapInstanceProperty(cols).call(cols, col => ___EmotionJSX(ColumnElement, { column: col, key: col.name, __source: { fileName: _jsxFileName, lineNumber: 252 }, __self: this })))));\n\n\n\n\n    return metadata;\n  }\n\n  render() {\n    return (\n      ___EmotionJSX(Collapse, {\n        in: this.state.expanded,\n        timeout: this.props.timeout,\n        onExited: this.removeFromStore, __source: { fileName: _jsxFileName, lineNumber: 262 }, __self: this },\n\n      ___EmotionJSX(\"div\", {\n        className: \"TableElement table-schema m-b-10\",\n        onMouseEnter: () => this.setHover(true),\n        onMouseLeave: () => this.setHover(false), __source: { fileName: _jsxFileName, lineNumber: 267 }, __self: this },\n\n      this.renderHeader(),\n      ___EmotionJSX(\"div\", { __source: { fileName: _jsxFileName, lineNumber: 273 }, __self: this }, this.renderBody()))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}TableElement.propTypes = propTypes;\nTableElement.defaultProps = defaultProps;const _default =\n\nTableElement;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/TableElement.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/TableElement.jsx\");reactHotLoader.register(TableElement, \"TableElement\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/TableElement.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/TableElement.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/TableElement.jsx"],"names":["React","PropTypes","ButtonGroup","Collapse","Fade","Well","shortid","t","CopyToClipboard","Link","ColumnElement","ShowSQL","ModalTrigger","Loading","propTypes","table","object","actions","timeout","number","defaultProps","TableElement","PureComponent","constructor","props","state","sortColumns","expanded","hovered","removeFromStore","toggleSortColumns","removeTable","setHover","setState","popSelectStar","qe","id","generate","title","name","dbId","autorun","sql","selectStar","addQueryEditor","toggleTable","e","preventDefault","collapseTable","expandTable","removeDataPreview","renderWell","header","partitions","partitionQuery","partitionClipBoard","tt","latest","k","push","join","renderControls","keyLink","indexes","length","ix","i","view","renderHeader","isMetadataLoading","isExtraMetadataLoading","renderBody","cols","columns","a","b","colA","toUpperCase","colB","metadata","col","render"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { ButtonGroup, Collapse, Fade, Well } from 'react-bootstrap';\nimport shortid from 'shortid';\nimport { t } from '@superset-ui/translation';\n\nimport CopyToClipboard from '../../components/CopyToClipboard';\nimport Link from '../../components/Link';\nimport ColumnElement from './ColumnElement';\nimport ShowSQL from './ShowSQL';\nimport ModalTrigger from '../../components/ModalTrigger';\nimport Loading from '../../components/Loading';\n\nconst propTypes = {\n  table: PropTypes.object,\n  actions: PropTypes.object,\n  timeout: PropTypes.number, // used for tests\n};\n\nconst defaultProps = {\n  actions: {},\n  table: null,\n  timeout: 500,\n};\n\nclass TableElement extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      sortColumns: false,\n      expanded: true,\n      hovered: false,\n    };\n    this.removeFromStore = this.removeFromStore.bind(this);\n    this.toggleSortColumns = this.toggleSortColumns.bind(this);\n    this.removeTable = this.removeTable.bind(this);\n    this.setHover = this.setHover.bind(this);\n  }\n\n  setHover(hovered) {\n    this.setState({ hovered });\n  }\n\n  popSelectStar() {\n    const qe = {\n      id: shortid.generate(),\n      title: this.props.table.name,\n      dbId: this.props.table.dbId,\n      autorun: true,\n      sql: this.props.table.selectStar,\n    };\n    this.props.actions.addQueryEditor(qe);\n  }\n\n  toggleTable(e) {\n    e.preventDefault();\n    if (this.props.table.expanded) {\n      this.props.actions.collapseTable(this.props.table);\n    } else {\n      this.props.actions.expandTable(this.props.table);\n    }\n  }\n\n  removeTable() {\n    this.setState({ expanded: false });\n    this.props.actions.removeDataPreview(this.props.table);\n  }\n  toggleSortColumns() {\n    this.setState({ sortColumns: !this.state.sortColumns });\n  }\n\n  removeFromStore() {\n    this.props.actions.removeTable(this.props.table);\n  }\n\n  renderWell() {\n    const table = this.props.table;\n    let header;\n    if (table.partitions) {\n      let partitionQuery;\n      let partitionClipBoard;\n      if (table.partitions.partitionQuery) {\n        partitionQuery = table.partitions.partitionQuery;\n        const tt = t('Copy partition query to clipboard');\n        partitionClipBoard = (\n          <CopyToClipboard\n            text={partitionQuery}\n            shouldShowText={false}\n            tooltipText={tt}\n            copyNode={<i className=\"fa fa-clipboard\" />}\n          />\n        );\n      }\n      let latest = [];\n      for (const k in table.partitions.latest) {\n        latest.push(`${k}=${table.partitions.latest[k]}`);\n      }\n      latest = latest.join('/');\n      header = (\n        <Well bsSize=\"small\">\n          <div>\n            <small>\n              {t('latest partition:')} {latest}\n            </small>{' '}\n            {partitionClipBoard}\n          </div>\n        </Well>\n      );\n    }\n    return header;\n  }\n  renderControls() {\n    let keyLink;\n    const table = this.props.table;\n    if (table.indexes && table.indexes.length > 0) {\n      keyLink = (\n        <ModalTrigger\n          modalTitle={\n            <div>\n              {t('Keys for table')} <strong>{table.name}</strong>\n            </div>\n          }\n          modalBody={table.indexes.map((ix, i) => (\n            <pre key={i}>{JSON.stringify(ix, null, '  ')}</pre>\n          ))}\n          triggerNode={\n            <Link\n              className=\"fa fa-key pull-left m-l-2\"\n              tooltip={t('View keys & indexes (%s)', table.indexes.length)}\n            />\n          }\n        />\n      );\n    }\n    return (\n      <ButtonGroup className=\"ws-el-controls\">\n        {keyLink}\n        <Link\n          className={\n            `fa fa-sort-${!this.state.sortColumns ? 'alpha' : 'numeric'}-asc ` +\n            'pull-left sort-cols m-l-2'\n          }\n          onClick={this.toggleSortColumns}\n          tooltip={\n            !this.state.sortColumns\n              ? t('Sort columns alphabetically')\n              : t('Original table column order')\n          }\n          href=\"#\"\n        />\n        {table.selectStar && (\n          <CopyToClipboard\n            copyNode={<a className=\"fa fa-clipboard pull-left m-l-2\" />}\n            text={table.selectStar}\n            shouldShowText={false}\n            tooltipText={t('Copy SELECT statement to the clipboard')}\n          />\n        )}\n        {table.view && (\n          <ShowSQL\n            sql={table.view}\n            tooltipText={t('Show CREATE VIEW statement')}\n            title={t('CREATE VIEW statement')}\n          />\n        )}\n        <Link\n          className=\"fa fa-times table-remove pull-left m-l-2\"\n          onClick={this.removeTable}\n          tooltip={t('Remove table preview')}\n          href=\"#\"\n        />\n      </ButtonGroup>\n    );\n  }\n  renderHeader() {\n    const table = this.props.table;\n    return (\n      <div className=\"clearfix\">\n        <div className=\"pull-left\">\n          <a\n            href=\"#\"\n            className=\"table-name\"\n            onClick={e => {\n              this.toggleTable(e);\n            }}\n          >\n            <strong>{table.name}</strong>\n          </a>\n        </div>\n        <div className=\"pull-right\">\n          {table.isMetadataLoading || table.isExtraMetadataLoading ? (\n            <Loading size={50} position=\"normal\" className=\"margin-zero\" />\n          ) : (\n            <Fade in={this.state.hovered}>{this.renderControls()}</Fade>\n          )}\n          <i\n            onClick={e => {\n              this.toggleTable(e);\n            }}\n            className={\n              'text-primary pointer m-l-10 ' +\n              'fa fa-lg ' +\n              `fa-angle-${table.expanded ? 'up' : 'down'}`\n            }\n          />\n        </div>\n      </div>\n    );\n  }\n  renderBody() {\n    const table = this.props.table;\n    let cols;\n    if (table.columns) {\n      cols = table.columns.slice();\n      if (this.state.sortColumns) {\n        cols.sort((a, b) => {\n          const colA = a.name.toUpperCase();\n          const colB = b.name.toUpperCase();\n          if (colA < colB) {\n            return -1;\n          } else if (colA > colB) {\n            return 1;\n          }\n          return 0;\n        });\n      }\n    }\n    const metadata = (\n      <Collapse in={table.expanded} timeout={this.props.timeout}>\n        <div>\n          {this.renderWell()}\n          <div className=\"table-columns m-t-5\">\n            {cols &&\n              cols.map(col => <ColumnElement column={col} key={col.name} />)}\n          </div>\n        </div>\n      </Collapse>\n    );\n    return metadata;\n  }\n\n  render() {\n    return (\n      <Collapse\n        in={this.state.expanded}\n        timeout={this.props.timeout}\n        onExited={this.removeFromStore}\n      >\n        <div\n          className=\"TableElement table-schema m-b-10\"\n          onMouseEnter={() => this.setHover(true)}\n          onMouseLeave={() => this.setHover(false)}\n        >\n          {this.renderHeader()}\n          <div>{this.renderBody()}</div>\n        </div>\n      </Collapse>\n    );\n  }\n}\nTableElement.propTypes = propTypes;\nTableElement.defaultProps = defaultProps;\n\nexport default TableElement;\n"]},"metadata":{},"sourceType":"module"}