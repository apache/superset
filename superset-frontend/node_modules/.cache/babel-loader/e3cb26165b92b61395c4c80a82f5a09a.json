{"ast":null,"code":"import _fillInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/fill\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/DashboardGrid.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { componentShape } from '../util/propShapes';\nimport DashboardComponent from '../containers/DashboardComponent';\nimport DragDroppable from './dnd/DragDroppable';\n\nimport { GRID_GUTTER_SIZE, GRID_COLUMN_COUNT } from '../util/constants';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  depth: PropTypes.number.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  gridComponent: componentShape.isRequired,\n  handleComponentDrop: PropTypes.func.isRequired,\n  isComponentVisible: PropTypes.bool.isRequired,\n  resizeComponent: PropTypes.func.isRequired,\n  setDirectPathToChild: PropTypes.func.isRequired,\n  width: PropTypes.number.isRequired };\n\n\nconst defaultProps = {};\n\nclass DashboardGrid extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7;\n    super(props);\n    this.state = {\n      isResizing: false,\n      rowGuideTop: null };\n\n\n    this.handleResizeStart = _bindInstanceProperty(_context = this.handleResizeStart).call(_context, this);\n    this.handleResize = _bindInstanceProperty(_context2 = this.handleResize).call(_context2, this);\n    this.handleResizeStop = _bindInstanceProperty(_context3 = this.handleResizeStop).call(_context3, this);\n    this.handleTopDropTargetDrop = _bindInstanceProperty(_context4 = this.handleTopDropTargetDrop).call(_context4, this);\n    this.getRowGuidePosition = _bindInstanceProperty(_context5 = this.getRowGuidePosition).call(_context5, this);\n    this.setGridRef = _bindInstanceProperty(_context6 = this.setGridRef).call(_context6, this);\n    this.handleChangeTab = _bindInstanceProperty(_context7 = this.handleChangeTab).call(_context7, this);\n  }\n\n  getRowGuidePosition(resizeRef) {\n    if (resizeRef && this.grid) {\n      return (\n        resizeRef.getBoundingClientRect().bottom -\n        this.grid.getBoundingClientRect().top -\n        2);\n\n    }\n    return null;\n  }\n\n  setGridRef(ref) {\n    this.grid = ref;\n  }\n\n  handleResizeStart({ ref, direction }) {\n    let rowGuideTop = null;\n    if (direction === 'bottom' || direction === 'bottomRight') {\n      rowGuideTop = this.getRowGuidePosition(ref);\n    }\n\n    this.setState(() => ({\n      isResizing: true,\n      rowGuideTop }));\n\n  }\n\n  handleResize({ ref, direction }) {\n    if (direction === 'bottom' || direction === 'bottomRight') {\n      this.setState(() => ({ rowGuideTop: this.getRowGuidePosition(ref) }));\n    }\n  }\n\n  handleResizeStop({ id, widthMultiple: width, heightMultiple: height }) {\n    this.props.resizeComponent({ id, width, height });\n\n    this.setState(() => ({\n      isResizing: false,\n      rowGuideTop: null }));\n\n  }\n\n  handleTopDropTargetDrop(dropResult) {\n    if (dropResult) {\n      this.props.handleComponentDrop(_Object$assign({},\n      dropResult, {\n        destination: _Object$assign({},\n        dropResult.destination, {\n          // force appending as the first child if top drop target\n          index: 0 }) }));\n\n\n    }\n  }\n\n  handleChangeTab({ pathToTabIndex }) {\n    this.props.setDirectPathToChild(pathToTabIndex);\n  }\n\n  render() {var _context8, _context9, _context10;\n    const {\n      gridComponent,\n      handleComponentDrop,\n      depth,\n      editMode,\n      width,\n      isComponentVisible } =\n    this.props;\n\n    const columnPlusGutterWidth =\n    (width + GRID_GUTTER_SIZE) / GRID_COLUMN_COUNT;\n\n    const columnWidth = columnPlusGutterWidth - GRID_GUTTER_SIZE;\n    const { isResizing, rowGuideTop } = this.state;\n\n    return width < 100 ? null :\n    ___EmotionJSX(\"div\", { className: \"dashboard-grid\", ref: this.setGridRef, __source: { fileName: _jsxFileName, lineNumber: 134 }, __self: this },\n    ___EmotionJSX(\"div\", { className: \"grid-content\", __source: { fileName: _jsxFileName, lineNumber: 135 }, __self: this },\n\n    editMode &&\n    ___EmotionJSX(DragDroppable, {\n      component: gridComponent,\n      depth: depth,\n      parentComponent: null,\n      index: 0,\n      orientation: \"column\",\n      onDrop: this.handleTopDropTargetDrop,\n      className: \"empty-droptarget\",\n      editMode: true, __source: { fileName: _jsxFileName, lineNumber: 138 }, __self: this },\n\n    ({ dropIndicatorProps }) =>\n    dropIndicatorProps &&\n    ___EmotionJSX(\"div\", { className: \"drop-indicator drop-indicator--bottom\", __source: { fileName: _jsxFileName, lineNumber: 150 }, __self: this })),\n\n\n\n\n\n    _mapInstanceProperty(_context8 = gridComponent.children).call(_context8, (id, index) =>\n    ___EmotionJSX(DashboardComponent, {\n      key: id,\n      id: id,\n      parentId: gridComponent.id,\n      depth: depth + 1,\n      index: index,\n      availableColumnCount: GRID_COLUMN_COUNT,\n      columnWidth: columnWidth,\n      isComponentVisible: isComponentVisible,\n      onResizeStart: this.handleResizeStart,\n      onResize: this.handleResize,\n      onResizeStop: this.handleResizeStop,\n      onChangeTab: this.handleChangeTab, __source: { fileName: _jsxFileName, lineNumber: 157 }, __self: this })),\n\n\n\n\n    editMode &&\n    ___EmotionJSX(DragDroppable, {\n      component: gridComponent,\n      depth: depth,\n      parentComponent: null,\n      index: gridComponent.children.length,\n      orientation: \"column\",\n      onDrop: handleComponentDrop,\n      className: \"empty-droptarget\",\n      editMode: true, __source: { fileName: _jsxFileName, lineNumber: 175 }, __self: this },\n\n    ({ dropIndicatorProps }) =>\n    dropIndicatorProps &&\n    ___EmotionJSX(\"div\", { className: \"drop-indicator drop-indicator--top\", __source: { fileName: _jsxFileName, lineNumber: 187 }, __self: this })),\n\n\n\n\n\n    isResizing &&\n    _mapInstanceProperty(_context9 = _fillInstanceProperty(_context10 = Array(GRID_COLUMN_COUNT)).call(_context10,\n    null)).call(_context9,\n    (_, i) =>\n    ___EmotionJSX(\"div\", {\n      key: \"grid-column-\" + i,\n      className: \"grid-column-guide\",\n      style: {\n        left: i * GRID_GUTTER_SIZE + i * columnWidth,\n        width: columnWidth }, __source: { fileName: _jsxFileName, lineNumber: 197 }, __self: this })),\n\n\n\n\n    isResizing && rowGuideTop &&\n    ___EmotionJSX(\"div\", {\n      className: \"grid-row-guide\",\n      style: {\n        top: rowGuideTop,\n        width }, __source: { fileName: _jsxFileName, lineNumber: 208 }, __self: this })));\n\n\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nDashboardGrid.propTypes = propTypes;\nDashboardGrid.defaultProps = defaultProps;const _default =\n\nDashboardGrid;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/DashboardGrid.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/DashboardGrid.jsx\");reactHotLoader.register(DashboardGrid, \"DashboardGrid\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/DashboardGrid.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/DashboardGrid.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/dashboard/components/DashboardGrid.jsx"],"names":["React","PropTypes","componentShape","DashboardComponent","DragDroppable","GRID_GUTTER_SIZE","GRID_COLUMN_COUNT","propTypes","depth","number","isRequired","editMode","bool","gridComponent","handleComponentDrop","func","isComponentVisible","resizeComponent","setDirectPathToChild","width","defaultProps","DashboardGrid","PureComponent","constructor","props","state","isResizing","rowGuideTop","handleResizeStart","handleResize","handleResizeStop","handleTopDropTargetDrop","getRowGuidePosition","setGridRef","handleChangeTab","resizeRef","grid","getBoundingClientRect","bottom","top","ref","direction","setState","id","widthMultiple","heightMultiple","height","dropResult","destination","index","pathToTabIndex","render","columnPlusGutterWidth","columnWidth","dropIndicatorProps","children","length","Array","_","i","left"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { componentShape } from '../util/propShapes';\nimport DashboardComponent from '../containers/DashboardComponent';\nimport DragDroppable from './dnd/DragDroppable';\n\nimport { GRID_GUTTER_SIZE, GRID_COLUMN_COUNT } from '../util/constants';\n\nconst propTypes = {\n  depth: PropTypes.number.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  gridComponent: componentShape.isRequired,\n  handleComponentDrop: PropTypes.func.isRequired,\n  isComponentVisible: PropTypes.bool.isRequired,\n  resizeComponent: PropTypes.func.isRequired,\n  setDirectPathToChild: PropTypes.func.isRequired,\n  width: PropTypes.number.isRequired,\n};\n\nconst defaultProps = {};\n\nclass DashboardGrid extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isResizing: false,\n      rowGuideTop: null,\n    };\n\n    this.handleResizeStart = this.handleResizeStart.bind(this);\n    this.handleResize = this.handleResize.bind(this);\n    this.handleResizeStop = this.handleResizeStop.bind(this);\n    this.handleTopDropTargetDrop = this.handleTopDropTargetDrop.bind(this);\n    this.getRowGuidePosition = this.getRowGuidePosition.bind(this);\n    this.setGridRef = this.setGridRef.bind(this);\n    this.handleChangeTab = this.handleChangeTab.bind(this);\n  }\n\n  getRowGuidePosition(resizeRef) {\n    if (resizeRef && this.grid) {\n      return (\n        resizeRef.getBoundingClientRect().bottom -\n        this.grid.getBoundingClientRect().top -\n        2\n      );\n    }\n    return null;\n  }\n\n  setGridRef(ref) {\n    this.grid = ref;\n  }\n\n  handleResizeStart({ ref, direction }) {\n    let rowGuideTop = null;\n    if (direction === 'bottom' || direction === 'bottomRight') {\n      rowGuideTop = this.getRowGuidePosition(ref);\n    }\n\n    this.setState(() => ({\n      isResizing: true,\n      rowGuideTop,\n    }));\n  }\n\n  handleResize({ ref, direction }) {\n    if (direction === 'bottom' || direction === 'bottomRight') {\n      this.setState(() => ({ rowGuideTop: this.getRowGuidePosition(ref) }));\n    }\n  }\n\n  handleResizeStop({ id, widthMultiple: width, heightMultiple: height }) {\n    this.props.resizeComponent({ id, width, height });\n\n    this.setState(() => ({\n      isResizing: false,\n      rowGuideTop: null,\n    }));\n  }\n\n  handleTopDropTargetDrop(dropResult) {\n    if (dropResult) {\n      this.props.handleComponentDrop({\n        ...dropResult,\n        destination: {\n          ...dropResult.destination,\n          // force appending as the first child if top drop target\n          index: 0,\n        },\n      });\n    }\n  }\n\n  handleChangeTab({ pathToTabIndex }) {\n    this.props.setDirectPathToChild(pathToTabIndex);\n  }\n\n  render() {\n    const {\n      gridComponent,\n      handleComponentDrop,\n      depth,\n      editMode,\n      width,\n      isComponentVisible,\n    } = this.props;\n\n    const columnPlusGutterWidth =\n      (width + GRID_GUTTER_SIZE) / GRID_COLUMN_COUNT;\n\n    const columnWidth = columnPlusGutterWidth - GRID_GUTTER_SIZE;\n    const { isResizing, rowGuideTop } = this.state;\n\n    return width < 100 ? null : (\n      <div className=\"dashboard-grid\" ref={this.setGridRef}>\n        <div className=\"grid-content\">\n          {/* make the area above components droppable */}\n          {editMode && (\n            <DragDroppable\n              component={gridComponent}\n              depth={depth}\n              parentComponent={null}\n              index={0}\n              orientation=\"column\"\n              onDrop={this.handleTopDropTargetDrop}\n              className=\"empty-droptarget\"\n              editMode\n            >\n              {({ dropIndicatorProps }) =>\n                dropIndicatorProps && (\n                  <div className=\"drop-indicator drop-indicator--bottom\" />\n                )\n              }\n            </DragDroppable>\n          )}\n\n          {gridComponent.children.map((id, index) => (\n            <DashboardComponent\n              key={id}\n              id={id}\n              parentId={gridComponent.id}\n              depth={depth + 1}\n              index={index}\n              availableColumnCount={GRID_COLUMN_COUNT}\n              columnWidth={columnWidth}\n              isComponentVisible={isComponentVisible}\n              onResizeStart={this.handleResizeStart}\n              onResize={this.handleResize}\n              onResizeStop={this.handleResizeStop}\n              onChangeTab={this.handleChangeTab}\n            />\n          ))}\n\n          {/* make the area below components droppable */}\n          {editMode && (\n            <DragDroppable\n              component={gridComponent}\n              depth={depth}\n              parentComponent={null}\n              index={gridComponent.children.length}\n              orientation=\"column\"\n              onDrop={handleComponentDrop}\n              className=\"empty-droptarget\"\n              editMode\n            >\n              {({ dropIndicatorProps }) =>\n                dropIndicatorProps && (\n                  <div className=\"drop-indicator drop-indicator--top\" />\n                )\n              }\n            </DragDroppable>\n          )}\n\n          {isResizing &&\n            Array(GRID_COLUMN_COUNT)\n              .fill(null)\n              .map((_, i) => (\n                <div\n                  key={`grid-column-${i}`}\n                  className=\"grid-column-guide\"\n                  style={{\n                    left: i * GRID_GUTTER_SIZE + i * columnWidth,\n                    width: columnWidth,\n                  }}\n                />\n              ))}\n\n          {isResizing && rowGuideTop && (\n            <div\n              className=\"grid-row-guide\"\n              style={{\n                top: rowGuideTop,\n                width,\n              }}\n            />\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nDashboardGrid.propTypes = propTypes;\nDashboardGrid.defaultProps = defaultProps;\n\nexport default DashboardGrid;\n"]},"metadata":{},"sourceType":"module"}