{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Date$now from \"@babel/runtime-corejs3/core-js-stable/date/now\";import _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";var _jsxFileName = \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Licensed to the Apache Software Foundation (ASF) under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * or more contributor license agreements.  See the NOTICE file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * distributed with this work for additional information\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * regarding copyright ownership.  The ASF licenses this file\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * to you under the Apache License, Version 2.0 (the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * \"License\"); you may not use this file except in compliance\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * with the License.  You may obtain a copy of the License at\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   http://www.apache.org/licenses/LICENSE-2.0\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Unless required by applicable law or agreed to in writing,\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * software distributed under the License is distributed on an\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * KIND, either express or implied.  See the License for the\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * specific language governing permissions and limitations\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * under the License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport shortid from 'shortid';\nimport { Alert, Label, Tab, Tabs } from 'react-bootstrap';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { t } from '@superset-ui/translation';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport * as Actions from '../actions/sqlLab';\nimport QueryHistory from './QueryHistory';\nimport ResultSet from './ResultSet';\nimport {\nSTATUS_OPTIONS,\nSTATE_BSSTYLE_MAP,\nLOCALSTORAGE_MAX_QUERY_AGE_MS } from\n'../constants';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst TAB_HEIGHT = 44;\n\n/*\n                           editorQueries are queries executed by users passed from SqlEditor component\n                           dataPrebiewQueries are all queries executed for preview of table data (from SqlEditorLeft)\n                       */\nconst propTypes = {\n  editorQueries: PropTypes.array.isRequired,\n  latestQueryId: PropTypes.string,\n  dataPreviewQueries: PropTypes.array.isRequired,\n  actions: PropTypes.object.isRequired,\n  activeSouthPaneTab: PropTypes.string,\n  height: PropTypes.number,\n  databases: PropTypes.object.isRequired,\n  offline: PropTypes.bool,\n  displayLimit: PropTypes.number.isRequired };\n\n\nconst defaultProps = {\n  activeSouthPaneTab: 'Results',\n  offline: false };\n\n\nexport class SouthPane extends React.PureComponent {\n  constructor(props) {var _context, _context2;\n    super(props);\n    this.state = {\n      height: props.height };\n\n    this.southPaneRef = React.createRef();\n    this.getSouthPaneHeight = _bindInstanceProperty(_context = this.getSouthPaneHeight).call(_context, this);\n    this.switchTab = _bindInstanceProperty(_context2 = this.switchTab).call(_context2, this);\n  }\n  UNSAFE_componentWillReceiveProps() {\n    // south pane expands the entire height of the tab content on mount\n    this.setState({ height: this.getSouthPaneHeight() });\n  }\n  // One layer of abstraction for easy spying in unit tests\n  getSouthPaneHeight() {\n    return this.southPaneRef.current ?\n    this.southPaneRef.current.clientHeight :\n    0;\n  }\n  switchTab(id) {\n    this.props.actions.setActiveSouthPaneTab(id);\n  }\n  render() {var _context4;\n    if (this.props.offline) {\n      return (\n        ___EmotionJSX(Label, {\n          className: \"m-r-3\",\n          bsStyle: STATE_BSSTYLE_MAP[STATUS_OPTIONS.offline], __source: { fileName: _jsxFileName, lineNumber: 86 }, __self: this },\n\n        STATUS_OPTIONS.offline));\n\n\n    }\n    const innerTabContentHeight = this.state.height - TAB_HEIGHT;\n    let latestQuery;\n    const props = this.props;\n    if (props.editorQueries.length > 0) {var _context3;\n      // get the latest query\n      latestQuery = _findInstanceProperty(_context3 = props.editorQueries).call(_context3,\n      q => q.id === this.props.latestQueryId);\n\n    }\n    let results;\n    if (latestQuery) {\n      if (\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n      latestQuery.state === 'success' &&\n      !latestQuery.resultsKey &&\n      !latestQuery.results)\n      {\n        results =\n        ___EmotionJSX(Alert, { bsStyle: \"warning\", __source: { fileName: _jsxFileName, lineNumber: 112 }, __self: this },\n        t('No stored results found, you need to re-run your query'));\n\n\n      } else if (\n      _Date$now() - latestQuery.startDttm <=\n      LOCALSTORAGE_MAX_QUERY_AGE_MS)\n      {\n        results =\n        ___EmotionJSX(ResultSet, {\n          showControls: true,\n          search: true,\n          query: latestQuery,\n          actions: props.actions,\n          height: innerTabContentHeight,\n          database: this.props.databases[latestQuery.dbId],\n          displayLimit: this.props.displayLimit, __source: { fileName: _jsxFileName, lineNumber: 121 }, __self: this });\n\n\n      }\n    } else {\n      results =\n      ___EmotionJSX(Alert, { bsStyle: \"info\", __source: { fileName: _jsxFileName, lineNumber: 134 }, __self: this }, t('Run a query to display results here'));\n\n    }\n    const dataPreviewTabs = _mapInstanceProperty(_context4 = props.dataPreviewQueries).call(_context4, (query) =>\n    ___EmotionJSX(Tab, {\n      title: t('Preview: `%s`', decodeURIComponent(query.tableName)),\n      eventKey: query.id,\n      key: query.id, __source: { fileName: _jsxFileName, lineNumber: 138 }, __self: this },\n\n    ___EmotionJSX(ResultSet, {\n      query: query,\n      visualize: false,\n      csv: false,\n      actions: props.actions,\n      cache: true,\n      height: innerTabContentHeight,\n      displayLimit: this.props.displayLimit, __source: { fileName: _jsxFileName, lineNumber: 143 }, __self: this })));\n\n\n\n\n    return (\n      ___EmotionJSX(\"div\", { className: \"SouthPane\", ref: this.southPaneRef, __source: { fileName: _jsxFileName, lineNumber: 156 }, __self: this },\n      ___EmotionJSX(Tabs, {\n        bsStyle: \"tabs\",\n        animation: false,\n        className: \"SouthPaneTabs\",\n        id: shortid.generate(),\n        activeKey: this.props.activeSouthPaneTab,\n        onSelect: this.switchTab, __source: { fileName: _jsxFileName, lineNumber: 157 }, __self: this },\n\n      ___EmotionJSX(Tab, { title: t('Results'), eventKey: \"Results\", __source: { fileName: _jsxFileName, lineNumber: 165 }, __self: this },\n      results),\n\n      ___EmotionJSX(Tab, { title: t('Query History'), eventKey: \"History\", __source: { fileName: _jsxFileName, lineNumber: 168 }, __self: this },\n      ___EmotionJSX(QueryHistory, {\n        queries: props.editorQueries,\n        actions: props.actions,\n        displayLimit: props.displayLimit, __source: { fileName: _jsxFileName, lineNumber: 169 }, __self: this })),\n\n\n      dataPreviewTabs)));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nfunction mapStateToProps({ sqlLab }) {\n  return {\n    activeSouthPaneTab: sqlLab.activeSouthPaneTab,\n    databases: sqlLab.databases,\n    offline: sqlLab.offline };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(Actions, dispatch) };\n\n}\n\nSouthPane.propTypes = propTypes;\nSouthPane.defaultProps = defaultProps;const _default =\n\nconnect(mapStateToProps, mapDispatchToProps)(SouthPane);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(TAB_HEIGHT, \"TAB_HEIGHT\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\");reactHotLoader.register(SouthPane, \"SouthPane\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\");reactHotLoader.register(_default, \"default\", \"/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/tiago/git-facilit/incubator-superset/superset-frontend/src/SqlLab/components/SouthPane.jsx"],"names":["React","PropTypes","shortid","Alert","Label","Tab","Tabs","connect","bindActionCreators","t","isFeatureEnabled","FeatureFlag","Actions","QueryHistory","ResultSet","STATUS_OPTIONS","STATE_BSSTYLE_MAP","LOCALSTORAGE_MAX_QUERY_AGE_MS","TAB_HEIGHT","propTypes","editorQueries","array","isRequired","latestQueryId","string","dataPreviewQueries","actions","object","activeSouthPaneTab","height","number","databases","offline","bool","displayLimit","defaultProps","SouthPane","PureComponent","constructor","props","state","southPaneRef","createRef","getSouthPaneHeight","switchTab","UNSAFE_componentWillReceiveProps","setState","current","clientHeight","id","setActiveSouthPaneTab","render","innerTabContentHeight","latestQuery","length","q","results","SQLLAB_BACKEND_PERSISTENCE","resultsKey","startDttm","dbId","dataPreviewTabs","query","decodeURIComponent","tableName","generate","mapStateToProps","sqlLab","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport shortid from 'shortid';\nimport { Alert, Label, Tab, Tabs } from 'react-bootstrap';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { t } from '@superset-ui/translation';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport * as Actions from '../actions/sqlLab';\nimport QueryHistory from './QueryHistory';\nimport ResultSet from './ResultSet';\nimport {\n  STATUS_OPTIONS,\n  STATE_BSSTYLE_MAP,\n  LOCALSTORAGE_MAX_QUERY_AGE_MS,\n} from '../constants';\n\nconst TAB_HEIGHT = 44;\n\n/*\n    editorQueries are queries executed by users passed from SqlEditor component\n    dataPrebiewQueries are all queries executed for preview of table data (from SqlEditorLeft)\n*/\nconst propTypes = {\n  editorQueries: PropTypes.array.isRequired,\n  latestQueryId: PropTypes.string,\n  dataPreviewQueries: PropTypes.array.isRequired,\n  actions: PropTypes.object.isRequired,\n  activeSouthPaneTab: PropTypes.string,\n  height: PropTypes.number,\n  databases: PropTypes.object.isRequired,\n  offline: PropTypes.bool,\n  displayLimit: PropTypes.number.isRequired,\n};\n\nconst defaultProps = {\n  activeSouthPaneTab: 'Results',\n  offline: false,\n};\n\nexport class SouthPane extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      height: props.height,\n    };\n    this.southPaneRef = React.createRef();\n    this.getSouthPaneHeight = this.getSouthPaneHeight.bind(this);\n    this.switchTab = this.switchTab.bind(this);\n  }\n  UNSAFE_componentWillReceiveProps() {\n    // south pane expands the entire height of the tab content on mount\n    this.setState({ height: this.getSouthPaneHeight() });\n  }\n  // One layer of abstraction for easy spying in unit tests\n  getSouthPaneHeight() {\n    return this.southPaneRef.current\n      ? this.southPaneRef.current.clientHeight\n      : 0;\n  }\n  switchTab(id) {\n    this.props.actions.setActiveSouthPaneTab(id);\n  }\n  render() {\n    if (this.props.offline) {\n      return (\n        <Label\n          className=\"m-r-3\"\n          bsStyle={STATE_BSSTYLE_MAP[STATUS_OPTIONS.offline]}\n        >\n          {STATUS_OPTIONS.offline}\n        </Label>\n      );\n    }\n    const innerTabContentHeight = this.state.height - TAB_HEIGHT;\n    let latestQuery;\n    const props = this.props;\n    if (props.editorQueries.length > 0) {\n      // get the latest query\n      latestQuery = props.editorQueries.find(\n        q => q.id === this.props.latestQueryId,\n      );\n    }\n    let results;\n    if (latestQuery) {\n      if (\n        isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n        latestQuery.state === 'success' &&\n        !latestQuery.resultsKey &&\n        !latestQuery.results\n      ) {\n        results = (\n          <Alert bsStyle=\"warning\">\n            {t('No stored results found, you need to re-run your query')}\n          </Alert>\n        );\n      } else if (\n        Date.now() - latestQuery.startDttm <=\n        LOCALSTORAGE_MAX_QUERY_AGE_MS\n      ) {\n        results = (\n          <ResultSet\n            showControls\n            search\n            query={latestQuery}\n            actions={props.actions}\n            height={innerTabContentHeight}\n            database={this.props.databases[latestQuery.dbId]}\n            displayLimit={this.props.displayLimit}\n          />\n        );\n      }\n    } else {\n      results = (\n        <Alert bsStyle=\"info\">{t('Run a query to display results here')}</Alert>\n      );\n    }\n    const dataPreviewTabs = props.dataPreviewQueries.map(query => (\n      <Tab\n        title={t('Preview: `%s`', decodeURIComponent(query.tableName))}\n        eventKey={query.id}\n        key={query.id}\n      >\n        <ResultSet\n          query={query}\n          visualize={false}\n          csv={false}\n          actions={props.actions}\n          cache\n          height={innerTabContentHeight}\n          displayLimit={this.props.displayLimit}\n        />\n      </Tab>\n    ));\n\n    return (\n      <div className=\"SouthPane\" ref={this.southPaneRef}>\n        <Tabs\n          bsStyle=\"tabs\"\n          animation={false}\n          className=\"SouthPaneTabs\"\n          id={shortid.generate()}\n          activeKey={this.props.activeSouthPaneTab}\n          onSelect={this.switchTab}\n        >\n          <Tab title={t('Results')} eventKey=\"Results\">\n            {results}\n          </Tab>\n          <Tab title={t('Query History')} eventKey=\"History\">\n            <QueryHistory\n              queries={props.editorQueries}\n              actions={props.actions}\n              displayLimit={props.displayLimit}\n            />\n          </Tab>\n          {dataPreviewTabs}\n        </Tabs>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ sqlLab }) {\n  return {\n    activeSouthPaneTab: sqlLab.activeSouthPaneTab,\n    databases: sqlLab.databases,\n    offline: sqlLab.offline,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(Actions, dispatch),\n  };\n}\n\nSouthPane.propTypes = propTypes;\nSouthPane.defaultProps = defaultProps;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SouthPane);\n"]},"metadata":{},"sourceType":"module"}