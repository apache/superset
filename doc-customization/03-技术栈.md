# Apache Superset 技术栈

## 1. 后端技术栈

### 1.1 核心框架

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Python** | 3.9-3.12 | 编程语言 | 主要开发语言 |
| **Flask** | 3.x | Web 框架 | 轻量级 Web 框架 |
| **Flask-AppBuilder** | 4.x | 应用框架 | 提供 RBAC、认证、CRUD UI |
| **SQLAlchemy** | 2.x | ORM | 数据库对象关系映射 |
| **Flask-RESTful** | 0.3.x | REST API | RESTful API 框架 |
| **Marshmallow** | 3.x | 序列化 | 数据序列化和验证 |

### 1.2 数据库和缓存

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **PostgreSQL** | 16+ | 元数据存储 | 生产环境推荐 |
| **MySQL** | 8.x | 元数据存储 | 可选的元数据存储 |
| **SQLite** | 3.x | 元数据存储 | 开发环境默认 |
| **Redis** | 7.x | 缓存/会话 | 查询结果缓存、会话存储 |
| **Memcached** | 1.6+ | 缓存 | 可选的缓存后端 |

### 1.3 异步任务

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Celery** | 5.x | 任务队列 | 异步任务处理 |
| **Celery Beat** | 5.x | 定时任务 | 定时任务调度 |
| **RabbitMQ** | 3.x | 消息代理 | Celery 消息代理（可选） |
| **Redis** | 7.x | 消息代理 | Celery 消息代理（推荐） |

### 1.4 数据处理

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Pandas** | 2.x | 数据处理 | 数据分析和处理 |
| **NumPy** | 1.26+ | 数值计算 | 数值计算基础库 |
| **SQLGlot** | 最新 | SQL 解析 | SQL 解析和转换 |

### 1.5 认证和安全

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Flask-Login** | 0.6.x | 用户认证 | 用户会话管理 |
| **Flask-JWT-Extended** | 4.x | JWT 认证 | JWT Token 认证 |
| **Authlib** | 1.x | OAuth 2.0 | OAuth 2.0 支持 |
| **Cryptography** | 41.x | 加密 | 数据加密 |

### 1.6 API 和序列化

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Flask-RESTful** | 0.3.x | REST API | RESTful API 框架 |
| **Marshmallow** | 3.x | 序列化 | 数据序列化和验证 |
| **OpenAPI** | 3.x | API 文档 | 自动生成 API 文档 |

### 1.7 测试框架

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **pytest** | 7.x | 单元测试 | 单元测试框架 |
| **pytest-cov** | 4.x | 代码覆盖率 | 测试覆盖率统计 |
| **factory-boy** | 3.x | 测试数据 | 测试数据工厂 |
| **freezegun** | 1.x | 时间模拟 | 模拟时间 |

### 1.8 其他重要库

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Click** | 8.x | CLI | 命令行工具 |
| **Python-dateutil** | 2.8.x | 日期处理 | 日期时间处理 |
| **pytz** | 2023.x | 时区 | 时区处理 |
| **colorlog** | 6.x | 日志 | 彩色日志输出 |

## 2. 前端技术栈

### 2.1 核心框架

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **React** | 17.0.2 | UI 框架 | 前端 UI 框架 |
| **TypeScript** | 5.4.5 | 类型系统 | 类型安全的 JavaScript |
| **ReactDOM** | 17.0.2 | DOM 渲染 | React DOM 渲染 |
| **React Router** | 5.3.4 | 路由 | 客户端路由 |
| **Redux** | 4.2.1 | 状态管理 | 应用状态管理 |
| **Redux Toolkit** | 1.9.3 | Redux 工具 | Redux 开发工具包 |
| **Redux Thunk** | 2.1.0 | 异步 Action | 异步 Action 处理 |

### 2.2 UI 组件库

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Ant Design** | 5.26.0 | UI 组件 | 企业级 UI 设计语言 |
| **@ant-design/icons** | 5.x | 图标 | Ant Design 图标库 |
| **Emotion** | 11.14.0 | CSS-in-JS | CSS-in-JS 样式方案 |

### 2.3 数据可视化

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **D3.js** | 7.x | 可视化 | 数据可视化库 |
| **ECharts** | 5.6.0 | 图表 | 强大的图表库 |
| **@visx/** | 最新 | 可视化 | 可视化组件集合 |
| **Mapbox GL** | 3.17.0 | 地图 | WebGL 地图渲染 |
| **@deck.gl/** | 9.2.x | 地图 | WebGL 大数据可视化 |

### 2.4 表格和数据展示

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **AG Grid** | 34.3.1 | 表格 | 高性能数据表格 |
| **react-table** | 7.8.0 | 表格 | 灵活的表格组件 |
| **react-window** | 1.8.10 | 虚拟滚动 | 高性能列表渲染 |
| **react-virtualized-auto-sizer** | 1.0.26 | 自适应 | 自动调整大小 |

### 2.5 工具库

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **lodash** | 4.17.21 | 工具函数 | JavaScript 工具库 |
| **dayjs** | 1.11.19 | 日期处理 | 轻量级日期处理 |
| **nanoid** | 5.1.6 | ID 生成 | 唯一 ID 生成 |
| **memoize-one** | 5.2.1 | 记忆化 | 函数记忆化 |
| **fuse.js** | 7.1.0 | 模糊搜索 | 模糊搜索库 |
| **js-levenshtein** | 1.1.6 | 字符串相似度 | 字符串相似度计算 |

### 2.6 网络和 API

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **axios** | 1.x | HTTP 客户端 | HTTP 请求库 |
| **rison** | 0.1.1 | URL 编码 | RISON 编码/解码 |
| **urijs** | 1.19.8 | URL 处理 | URL 解析和操作 |

### 2.7 构建工具

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Webpack** | 5.104.1 | 模块打包 | 模块打包工具 |
| **Webpack Dev Server** | 5.2.3 | 开发服务器 | 开发服务器 |
| **Babel** | 7.28.x | 编译器 | JavaScript 编译器 |
| **TypeScript** | 5.4.5 | 类型检查 | TypeScript 编译器 |
| **SWC** | 1.14.0 | 编译器 | 快速 JavaScript/TypeScript 编译器 |
| **ESLint** | 8.56.0 | 代码检查 | JavaScript 代码检查 |
| **Prettier** | 3.8.0 | 代码格式化 | 代码格式化工具 |
| **Oxlint** | 1.32.0 | 代码检查 | 快速代码检查工具 |

### 2.8 测试框架

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Jest** | 30.2.0 | 测试框架 | JavaScript 测试框架 |
| **React Testing Library** | 12.1.5 | React 测试 | React 组件测试 |
| **@testing-library/user-event** | 12.8.3 | 用户事件 | 模拟用户事件 |
| **Cypress** | 最新 | E2E 测试 | 端到端测试 |
| **Playwright** | 1.57.0 | E2E 测试 | 现代化 E2E 测试 |

### 2.9 其他重要库

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **react-hot-loader** | 4.13.1 | 热更新 | React 热更新 |
| **react-loadable** | 5.5.0 | 代码分割 | 组件懒加载 |
| **react-split** | 2.0.9 | 分割面板 | 可调整大小的分割面板 |
| **react-sortable-hoc** | 2.0.0 | 拖拽排序 | 可拖拽排序列表 |
| **react-dnd** | 11.1.3 | 拖拽 | 拖拽功能 |
| **react-diff-viewer-continued** | 3.4.0 | 差异对比 | 文本差异对比 |
| **markdown-to-jsx** | 7.7.4 | Markdown | Markdown 渲染 |

## 3. WebSocket 服务 (superset-websocket/)

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **TypeScript** | 5.x | 类型系统 | 类型安全的 JavaScript |
| **ws** | 8.x | WebSocket | WebSocket 库 |
| **express** | 4.x | Web 框架 | Web 服务器 |

## 4. 共享核心库 (superset-core/)

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Python** | 3.9+ | 编程语言 | 主要开发语言 |
| **pydantic** | 2.x | 数据验证 | 数据验证和设置 |

## 5. 部署和运维

### 5.1 容器化

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Docker** | 最新 | 容器化 | 应用容器化 |
| **Docker Compose** | 2.x | 容器编排 | 多容器编排 |
| **Kubernetes** | 1.28+ | 容器编排 | 生产环境容器编排 |
| **Helm** | 3.x | 包管理 | Kubernetes 包管理 |

### 5.2 反向代理

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Nginx** | 最新 | 反向代理 | HTTP 反向代理和负载均衡 |

### 5.3 监控和日志

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Prometheus** | 最新 | 监控 | 系统监控 |
| **Grafana** | 最新 | 可视化 | 监控数据可视化 |
| **StatsD** | 最新 | 指标 | 指标收集 |
| **ELK Stack** | 最新 | 日志 | 日志收集和分析 |

## 6. 开发工具

### 6.1 代码质量

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Black** | 23.x | 代码格式化 | Python 代码格式化 |
| **isort** | 5.x | 导入排序 | Python 导入排序 |
| **Flake8** | 6.x | 代码检查 | Python 代码检查 |
| **Pylint** | 3.x | 代码检查 | Python 代码检查 |
| **MyPy** | 1.x | 类型检查 | Python 类型检查 |

### 6.2 版本控制

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Git** | 2.x | 版本控制 | 分布式版本控制 |
| **GitHub Actions** | 最新 | CI/CD | 持续集成和部署 |

### 6.3 包管理

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **pip** | 23.x | Python 包管理 | Python 包管理器 |
| **npm** | 10.x | Node 包管理 | Node.js 包管理器 |
| **yarn** | 1.x | Node 包管理 | Node.js 包管理器（可选） |
| **Lerna** | 8.x | Monorepo | JavaScript Monorepo 管理 |

## 7. 技术选型理由

### 7.1 后端技术选型

#### Flask vs Django
- **选择 Flask**: 更轻量、更灵活，适合定制化开发
- **Flask-AppBuilder**: 提供 RBAC、认证、CRUD UI 等开箱即用功能

#### SQLAlchemy vs 其他 ORM
- **选择 SQLAlchemy**: Python 最成熟的 ORM，支持多种数据库
- **灵活性**: 支持复杂查询和原生 SQL

#### Celery vs 其他任务队列
- **选择 Celery**: Python 生态最成熟的任务队列
- **可扩展**: 支持多种消息代理和结果后端

### 7.2 前端技术选型

#### React vs Vue/Angular
- **选择 React**: 生态丰富、组件化、性能优秀
- **TypeScript**: 提供类型安全，减少运行时错误

#### Redux vs MobX/Context API
- **选择 Redux**: 成熟的状态管理方案，适合大型应用
- **Redux Toolkit**: 简化 Redux 使用，提供最佳实践

#### ECharts vs D3.js/Chart.js
- **选择 ECharts**: 功能强大、性能优秀、易于使用
- **D3.js**: 灵活性高，适合自定义可视化

#### Ant Design vs Material-UI
- **选择 Ant Design**: 企业级设计、组件丰富、中文友好

### 7.3 数据库选型

#### PostgreSQL vs MySQL
- **选择 PostgreSQL**: 功能强大、性能优秀、扩展性好
- **支持**: JSON、全文搜索、地理数据等高级功能

#### Redis vs Memcached
- **选择 Redis**: 功能丰富、性能优秀、支持持久化
- **用途**: 缓存、会话存储、消息代理

## 8. 技术栈版本兼容性

### 8.1 Python 版本

```python
# 支持的 Python 版本
Python 3.9
Python 3.10
Python 3.11
Python 3.12
```

### 8.2 Node.js 版本

```json
{
  "engines": {
    "node": "^20.18.1",
    "npm": "^10.8.1"
  }
}
```

### 8.3 数据库版本

| 数据库 | 最低版本 | 推荐版本 |
|--------|---------|---------|
| PostgreSQL | 12 | 16+ |
| MySQL | 5.7 | 8.0+ |
| SQLite | 3.35 | 3.42+ |
| Redis | 6.0 | 7.0+ |

## 9. 技术栈演进

### 9.1 历史演进

| 版本 | 主要变化 |
|------|---------|
| 1.x | 初始版本，基于 Flask 1.x |
| 2.x | 迁移到 Flask 2.x，引入 Celery |
| 3.x | 前端迁移到 TypeScript，引入 ECharts |
| 4.x | 引入 Deck.GL 地图，性能优化 |
| 5.x | 引入 AG Grid，表格性能提升 |
| 6.x | WebSocket 服务独立，架构优化 |

### 9.2 未来规划

- **前端**: 考虑迁移到 React 18+
- **后端**: 考虑迁移到 FastAPI
- **数据库**: 支持更多云原生数据库
- **可视化**: 引入更多 AI 辅助可视化

## 10. 技术栈最佳实践

### 10.1 后端最佳实践

```python
# 使用类型注解
from typing import Optional, List

def get_chart_data(
    chart_id: int,
    force_refresh: bool = False
) -> Optional[dict]:
    """
    获取图表数据

    Args:
        chart_id: 图表 ID
        force_refresh: 是否强制刷新

    Returns:
        图表数据字典，如果不存在返回 None
    """
    pass

# 使用命令模式
from superset.commands.chart.create import CreateChartCommand

command = CreateChartCommand(data=chart_data)
try:
    chart = command.run()
except Exception as e:
    logger.error(f"创建图表失败: {e}")
    raise

# 使用依赖注入
from superset.extensions import db

class ChartService:
    def __init__(self, db_session):
        self.db = db_session

    def create_chart(self, data):
        # 使用注入的 db_session
        pass
```

### 10.2 前端最佳实践

```typescript
// 使用 TypeScript 类型
interface ChartData {
  id: number;
  name: string;
  vizType: string;
  formData: Record<string, unknown>;
}

// 使用 React Hooks
import { useState, useEffect, useCallback } from 'react';

const ChartComponent: React.FC<{ chartId: number }> = ({ chartId }) => {
  const [data, setData] = useState<ChartData | null>(null);
  const [loading, setLoading] = useState(false);

  const fetchData = useCallback(async () => {
    setLoading(true);
    try {
      const response = await fetchChartData(chartId);
      setData(response);
    } catch (error) {
      console.error('获取图表数据失败:', error);
    } finally {
      setLoading(false);
    }
  }, [chartId]);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  if (loading) return <Loading />;
  return <div>{/* 渲染图表 */}</div>;
};

// 使用 Redux Toolkit
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

export const fetchChart = createAsyncThunk(
  'chart/fetch',
  async (chartId: number) => {
    const response = await api.get(`/api/v1/chart/${chartId}`);
    return response.data;
  }
);

const chartSlice = createSlice({
  name: 'chart',
  initialState,
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchChart.pending, (state) => {
        state.loading = true;
      })
      .addCase(fetchChart.fulfilled, (state, action) => {
        state.loading = false;
        state.data = action.payload;
      })
      .addCase(fetchChart.rejected, (state, action) => {
        state.loading = false;
        state.error = action.error.message;
      });
  },
});
```

## 11. 下一步

阅读完本文档后，建议继续学习：

1. [后端架构](./04-后端架构.md) - 学习后端实现细节
2. [前端架构](./08-前端架构.md) - 学习前端实现细节
3. [请求流程](./14-请求流程.md) - 了解请求处理流程
