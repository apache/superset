name: SupersetBot Workflow

on:
  issue_comment:
    types: [created, edited]

jobs:
  supersetbot:
    runs-on: ubuntu-latest
    steps:
      - name: Execute SupersetBot Command
        uses: actions/github-script@v7
        with:
          script: |
            const commandPrefix = '@supersetbot';
            const commentBody = context.payload.comment.body;
            if (!commentBody.startsWith(commandPrefix)) return;

            const [_, command, ...args] = commentBody.slice(commandPrefix.length).trim().split(/\s+/);
            const issue_number = context.issue.number;
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const label = args.join(" ").replace(/['"]/g, '');
            if (command === 'label') {
              await github.rest.issues.addLabels({
                owner,
                repo,
                issue_number,
                labels: [label],
              });
            } else if (command === 'unlabel') {
              await github.rest.issues.removeLabel({
                owner,
                repo,
                issue_number,
                name: label,
              }).catch(error => {
                if (error.status !== 404) {
                  throw error;
                }
              });
            }
