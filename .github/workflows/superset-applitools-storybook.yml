name: Applitools Storybook

on:
  schedule:
    - cron: "0 0 * * *"

env:
  APPLITOOLS_APP_NAME: Superset
  APPLITOOLS_API_KEY: ${{ secrets.APPLITOOLS_API_KEY }}
  APPLITOOLS_BATCH_ID: ${{ github.sha }}
  APPLITOOLS_BATCH_NAME: Superset Storybook

jobs:
  cron:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        node: [16]
    steps:
      - name: "Checkout ${{ github.ref }} ( ${{ github.sha }} )"
        uses: actions/checkout@v3
        with:
          persist-credentials: false
          submodules: recursive
          ref: master
      - name: Set up Node.js
        uses: actions/setup-node@v3.1.1
        with:
          node-version: ${{ matrix.node }}
      - name: Install eyes-storybook dependencies
        uses: ./.github/actions/cached-dependencies
        with:
          run: eyes-storybook-dependencies
      - name: Install NPM dependencies
        uses: ./.github/actions/cached-dependencies
        with:
          run: npm-install
      - name: Run Applitools Eyes-Storybook
        working-directory: ./superset-frontend
        run: npx eyes-storybook -u https://superset-storybook.netlify.app/
